<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>nerkeler</title>
  
  
  <link href="https://nerkeler.github.io/atom.xml" rel="self"/>
  
  <link href="https://nerkeler.github.io/"/>
  <updated>2023-12-03T08:34:24.036Z</updated>
  <id>https://nerkeler.github.io/</id>
  
  <author>
    <name>nerkeler</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å›æº¯ç»å…¸æ¡ˆä¾‹</title>
    <link href="https://nerkeler.github.io/2023/12/03/%E5%9B%9E%E6%BA%AF%E7%BB%8F%E5%85%B8%E6%A1%88%E4%BE%8B/"/>
    <id>https://nerkeler.github.io/2023/12/03/%E5%9B%9E%E6%BA%AF%E7%BB%8F%E5%85%B8%E6%A1%88%E4%BE%8B/</id>
    <published>2023-12-03T08:32:00.000Z</published>
    <updated>2023-12-03T08:34:24.036Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å›æº¯ç»å…¸æ¡ˆä¾‹"><a href="#å›æº¯ç»å…¸æ¡ˆä¾‹" class="headerlink" title="å›æº¯ç»å…¸æ¡ˆä¾‹"></a>å›æº¯ç»å…¸æ¡ˆä¾‹</h2><h4 id="å…¨æ’åˆ—"><a href="#å…¨æ’åˆ—" class="headerlink" title="å…¨æ’åˆ—"></a>å…¨æ’åˆ—</h4><p>å…¨æ’åˆ—é—®é¢˜æ˜¯å›æº¯ç®—æ³•çš„ä¸€ä¸ªå…¸å‹åº”ç”¨ã€‚å®ƒçš„å®šä¹‰æ˜¯åœ¨ç»™å®šä¸€ä¸ªé›†åˆï¼ˆå¦‚ä¸€ä¸ªæ•°ç»„æˆ–å­—ç¬¦ä¸²ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰¾ å‡ºè¿™ä¸ªé›†åˆä¸­å…ƒç´ çš„æ‰€æœ‰å¯èƒ½çš„æ’åˆ—ã€‚</p><h5 id="question1"><a href="#question1" class="headerlink" title="question1"></a>question1</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ•°ç»„ä¸­ä¸åŒ…å«é‡å¤å…ƒç´ ï¼Œè¿”å›æ‰€æœ‰å¯èƒ½çš„æ’åˆ—ã€‚</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><ul><li>[1, 2] ï¼š[1, 2], [2, 1]</li><li>[1, 2, 3] [1, 2, 3], [1, 3, 2], [2, 1, 3], [2, 3, 1], [3, 1, 2], [3, 2, 1]</li></ul><p>å›æº¯ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permutationsI</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line"></span><br><span class="line">    backtrack(nums);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">( <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(path.size() &gt;= nums.length)&#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        <span class="comment">// æ’é™¤é‡å¤å…ƒç´  ï¼ˆå‰ªæï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (!path.contains(num)) &#123;</span><br><span class="line">            path.add(num);</span><br><span class="line">            backtrack(nums);</span><br><span class="line">            path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†åˆ—è¡¨å»é‡ï¼Œè·¯å¾„ä¸­å¦‚æœåŒ…å«å½“å‰å…ƒç´ è¡¨ç¤ºå·²ç»æœ‰æ·»åŠ ï¼Œç›´æ¥è·³è¿‡ï¼Œè¿™æ ·å°±é¿å…äº†  <code>111  122  133 .....</code> ç­‰æ’åˆ—çš„å½¢å¼å‡ºç°</p><p>å½“ç„¶å»é‡çš„é€»è¾‘ä¸æ­¢ä¸€ç§ï¼Œä½¿ç”¨å¸ƒå°”å€¼ï¼Œset éƒ½å¯ä»¥ï¼Œè¿™é‡Œå°±ä¸å±•å¼€ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªå·±å°è¯•ã€‚</p><h4 id="å­é›†"><a href="#å­é›†" class="headerlink" title="å­é›†"></a>å­é›†</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ç»™å®šä¸€ç»„ä¸å«é‡å¤å…ƒç´ çš„æ•´æ•°æ•°ç»„</span> <span class="string">numsï¼Œè¿”å›è¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">è¯´æ˜ï¼šè§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„å­é›†ã€‚</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><ul><li>è¾“å…¥: <code>nums</code> &#x3D; [1,2,3] è¾“å‡º: [ [3],  [1],  [2],  [1,2,3],  [1,3],  [2,3],  [1,2],  [] ]</li></ul><p>å›æº¯ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        bfs(<span class="number">0</span>, nums);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bfs</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= nums.length) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index; i &lt; nums.length; i++) &#123;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            bfs(i + <span class="number">1</span>, nums);</span><br><span class="line">            path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Nçš‡å"><a href="#Nçš‡å" class="headerlink" title="Nçš‡å"></a>Nçš‡å</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">æ ¹æ®å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œçš‡åå¯ä»¥æ”»å‡»ä¸ä¹‹å¤„åœ¨åŒä¸€è¡Œæˆ–åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šçš„æ£‹å­ã€‚ç»™å®š</span> <span class="string">ğ‘›</span></span><br><span class="line"><span class="string">ä¸ªçš‡åå’Œä¸€ä¸ª</span> <span class="string">ğ‘›</span> <span class="string">Ã—</span> <span class="string">ğ‘›</span> <span class="string">å¤§å°çš„æ£‹ç›˜ï¼Œå¯»æ‰¾ä½¿å¾—æ‰€æœ‰çš‡åä¹‹é—´æ— æ³•ç›¸äº’æ”»å‡»çš„æ‘†æ”¾æ–¹æ¡ˆã€‚</span></span><br></pre></td></tr></table></figure><p>å…«çš‡åé—®é¢˜å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¤åˆçš„å›æº¯é—®é¢˜ï¼Œæ¯”ä¹‹ä¸€èˆ¬çš„å›æº¯é—®é¢˜çš„é™å®šæ¡ä»¶æ¥è¯´ ååˆ†å¤æ‚ æ”¾ç½®æ¯ä¸€ä¸ªæ£‹å­ï¼ˆQï¼‰æ—¶éœ€è¦åœ¨ è¡Œã€åˆ—ã€å¯¹è§’çº¿ æ¯”è¾ƒæ˜¯å¦æœ‰å†²çªæ”¾ç½®ï¼Œè€Œå›æº¯çš„åœ°æ–¹å°±æ˜¯  æ”¾ç½®çš„ â€Qâ€œ,  åœ¨ä¸æ»¡è¶³æ¡ä»¶çš„æ—¶å€™éœ€è¦å›æº¯æˆåŸå§‹çš„ â€.â€œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[][] chessboard = <span class="keyword">new</span> <span class="title class_">char</span>[n][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span>[] c : chessboard) &#123;</span><br><span class="line">            Arrays.fill(c, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        backTrack(n, <span class="number">0</span>, chessboard);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backTrack</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> row, <span class="type">char</span>[][] chessboard)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (row == n) &#123;</span><br><span class="line">            res.add(Array2List(chessboard));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">col</span> <span class="operator">=</span> <span class="number">0</span>;col &lt; n; ++col) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isValid (row, col, n, chessboard)) &#123;</span><br><span class="line">                chessboard[row][col] = <span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">                backTrack(n, row+<span class="number">1</span>, chessboard);</span><br><span class="line">                chessboard[row][col] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List <span class="title function_">Array2List</span><span class="params">(<span class="type">char</span>[][] chessboard)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span>[] c : chessboard) &#123;</span><br><span class="line">            list.add(String.copyValueOf(c));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(<span class="type">int</span> row, <span class="type">int</span> col, <span class="type">int</span> n, <span class="type">char</span>[][] chessboard)</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥åˆ—</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;row; ++i) &#123; <span class="comment">// ç›¸å½“äºå‰ªæ</span></span><br><span class="line">            <span class="keyword">if</span> (chessboard[i][col] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥45åº¦å¯¹è§’çº¿</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=row-<span class="number">1</span>, j=col-<span class="number">1</span>; i&gt;=<span class="number">0</span> &amp;&amp; j&gt;=<span class="number">0</span>; i--, j--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (chessboard[i][j] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ£€æŸ¥135åº¦å¯¹è§’çº¿</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=row-<span class="number">1</span>, j=col+<span class="number">1</span>; i&gt;=<span class="number">0</span> &amp;&amp; j&lt;=n-<span class="number">1</span>; i--, j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (chessboard[i][j] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    <category term="ç®—æ³•" scheme="https://nerkeler.github.io/categories/Java/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="å›æº¯" scheme="https://nerkeler.github.io/tags/%E5%9B%9E%E6%BA%AF/"/>
    
  </entry>
  
  <entry>
    <title>å›æº¯åŸºç¡€</title>
    <link href="https://nerkeler.github.io/2023/11/28/%E5%9B%9E%E6%BA%AF%E5%9F%BA%E7%A1%80/"/>
    <id>https://nerkeler.github.io/2023/11/28/%E5%9B%9E%E6%BA%AF%E5%9F%BA%E7%A1%80/</id>
    <published>2023-11-28T09:41:00.000Z</published>
    <updated>2023-11-28T09:42:30.939Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å›æº¯"><a href="#å›æº¯" class="headerlink" title="å›æº¯"></a>å›æº¯</h2><h4 id="ç†è®ºåŸºç¡€"><a href="#ç†è®ºåŸºç¡€" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h4><p>ã€Œå›æº¯ç®—æ³• backtracking algorithmã€æ˜¯ä¸€ç§é€šè¿‡ç©·ä¸¾æ¥è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»ä¸€ä¸ªåˆå§‹çŠ¶æ€å‡ºå‘ï¼Œæš´åŠ›æœç´¢æ‰€æœ‰å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œå½“é‡åˆ°æ­£ç¡®çš„è§£åˆ™å°†å…¶è®°å½•ï¼Œç›´åˆ°æ‰¾åˆ°è§£æˆ–è€…å°è¯•äº†æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©éƒ½æ— æ³•æ‰¾åˆ°è§£ä¸ºæ­¢ï¼Œæ‰€ä»¥å›æº¯ç®—æ³•ä¹Ÿé€šå¸¸é‡‡ç”¨â€œæ·±åº¦ä¼˜å…ˆæœç´¢â€æ¥éå†è§£ç©ºé—´ã€‚</p><h4 id="å›æº¯æ³•è§£å†³çš„é—®é¢˜"><a href="#å›æº¯æ³•è§£å†³çš„é—®é¢˜" class="headerlink" title="å›æº¯æ³•è§£å†³çš„é—®é¢˜"></a>å›æº¯æ³•è§£å†³çš„é—®é¢˜</h4><ul><li>ç»„åˆé—®é¢˜ï¼šNä¸ªæ•°é‡Œé¢æŒ‰ä¸€å®šè§„åˆ™æ‰¾å‡ºkä¸ªæ•°çš„é›†åˆ</li><li>åˆ‡å‰²é—®é¢˜ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ä¸€å®šè§„åˆ™æœ‰å‡ ç§åˆ‡å‰²æ–¹å¼</li><li>å­é›†é—®é¢˜ï¼šä¸€ä¸ªNä¸ªæ•°çš„é›†åˆé‡Œæœ‰å¤šå°‘ç¬¦åˆæ¡ä»¶çš„å­é›†</li><li>æ’åˆ—é—®é¢˜ï¼šNä¸ªæ•°æŒ‰ä¸€å®šè§„åˆ™å…¨æ’åˆ—ï¼Œæœ‰å‡ ç§æ’åˆ—æ–¹å¼</li><li>æ£‹ç›˜é—®é¢˜ï¼šNçš‡åï¼Œè§£æ•°ç‹¬ç­‰ç­‰</li></ul><h4 id="å¦‚ä½•ç†è§£å›æº¯æ³•"><a href="#å¦‚ä½•ç†è§£å›æº¯æ³•" class="headerlink" title="å¦‚ä½•ç†è§£å›æº¯æ³•"></a>å¦‚ä½•ç†è§£å›æº¯æ³•</h4><p><strong>å›æº¯æ³•è§£å†³çš„é—®é¢˜éƒ½å¯ä»¥æŠ½è±¡ä¸ºæ ‘å½¢ç»“æ„</strong>ï¼Œ<strong>é›†åˆçš„å¤§å°å°±æ„æˆäº†æ ‘çš„å®½åº¦ï¼Œé€’å½’çš„æ·±åº¦ï¼Œéƒ½æ„æˆçš„æ ‘çš„æ·±åº¦</strong>ã€‚</p><h4 id="äºŒå‰æ ‘ä¾‹å­"><a href="#äºŒå‰æ ‘ä¾‹å­" class="headerlink" title="äºŒå‰æ ‘ä¾‹å­"></a>äºŒå‰æ ‘ä¾‹å­</h4><h5 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h5><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæœç´¢å¹¶è®°å½•æ‰€æœ‰å€¼ä¸º <span class="number">7</span> çš„èŠ‚ç‚¹ï¼Œè¯·è¿”å›èŠ‚ç‚¹åˆ—è¡¨</span><br></pre></td></tr></table></figure><p><img src="https://pic.imgdb.cn/item/6565a520c458853aef6e2cb0.png"></p><h5 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å‰åºéå†ï¼š */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="comment">// é€’å½’åˆ°ç»ˆæ­¢èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (root.val == <span class="number">7</span>) &#123;</span><br><span class="line">        <span class="comment">// è®°å½•è§£</span></span><br><span class="line">        res.add(root);</span><br><span class="line">    &#125;</span><br><span class="line">    preOrder(root.left);</span><br><span class="line">    preOrder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬éå†çš„é¡ºåºå°±æ˜¯  <code> 1-3-2-5-4-7-6</code>  ï¼Œä¹Ÿå¯ä»¥ä»ä¸‹å›¾ä¸­çœ‹å‡ºã€‚</p><p><img src="https://pic.imgdb.cn/item/6565a4dec458853aef6d60f0.png"></p><h4 id="ç®€å•ç»„åˆä¾‹å­"><a href="#ç®€å•ç»„åˆä¾‹å­" class="headerlink" title="ç®€å•ç»„åˆä¾‹å­"></a>ç®€å•ç»„åˆä¾‹å­</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ç»™å®šä¸¤ä¸ªæ•´æ•°</span> <span class="string">n</span> <span class="string">å’Œ</span> <span class="string">kï¼Œè¿”å›èŒƒå›´</span> [<span class="number">1</span>, <span class="string">n</span>] <span class="string">ä¸­æ‰€æœ‰å¯èƒ½çš„</span> <span class="string">k</span> <span class="string">ä¸ªæ•°çš„ç»„åˆã€‚</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚  <code>n = 4ã€ k = 3</code>  ï¼Œç›¸å½“äºæˆ‘ä»¬åœ¨ <code>[1,2,3,4</code>]ä¸­å– <code>3</code> ä¸ªæ•°ç»„åˆ åˆ™å›¾è§£åº”ä¸º</p><p><img src="https://pic.imgdb.cn/item/6565a9cdc458853aef7ba00b.png"></p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;List&lt;Integer&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] ints = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        ints[i-<span class="number">1</span>] = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dfs(<span class="number">0</span>,k,ints);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> start,<span class="type">int</span> k,<span class="type">int</span>[] ints)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(path.size() == k)</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(start &gt;= ints.length || path.size() &gt;= k) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; ints.length; i++) &#123;</span><br><span class="line">        path.add(ints[i]);</span><br><span class="line">        dfs(i+<span class="number">1</span>,k,ints);</span><br><span class="line">        path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç æš‚ä¸”ä¸ç®¡ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªé—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªæ ‘å½¢éå†ï¼Œ å°†å›æº¯é—®é¢˜ è½¬æ¢ä¸º æ•°å±‚éå†æœ‰åŠ©äºæˆ‘ä»¬ç†è§£å›æº¯çš„è¿‡ç¨‹ã€‚</p><h4 id="å°è¯•ä¸å›é€€"><a href="#å°è¯•ä¸å›é€€" class="headerlink" title="å°è¯•ä¸å›é€€"></a>å°è¯•ä¸å›é€€</h4><p><strong>ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºå›æº¯ç®—æ³•ï¼Œæ˜¯å› ä¸ºè¯¥ç®—æ³•åœ¨æœç´¢è§£ç©ºé—´æ—¶ä¼šé‡‡ç”¨â€œå°è¯•â€ä¸â€œå›é€€â€çš„ç­–ç•¥</strong>ã€‚å½“ç®—æ³•åœ¨æœç´¢è¿‡ç¨‹ä¸­é‡åˆ°æŸä¸ªçŠ¶æ€æ— æ³•ç»§ç»­å‰è¿›æˆ–æ— æ³•å¾—åˆ°æ»¡è¶³æ¡ä»¶çš„è§£æ—¶ï¼Œå®ƒä¼šæ’¤é”€ä¸Šä¸€æ­¥çš„é€‰æ‹©ï¼Œé€€å›åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œå¹¶å°è¯•å…¶ä»–å¯èƒ½çš„é€‰æ‹©ã€‚</p><h5 id="å°è¯•"><a href="#å°è¯•" class="headerlink" title="å°è¯•"></a>å°è¯•</h5><p>åœ¨è¿›å…¥é€’å½’åç´§æ¥ç€å°±æ˜¯ é€»è¾‘åˆ¤æ–­ çš„ <code>return</code> è¯­å¥ï¼Œå®ƒä¼šåœ¨å°è¯•å¤±è´¥åè¿”å›åˆ°ä¸Šä¸€å±‚é€’å½’ï¼Œä»æ ‘å½¢ç»“æ„ç†è§£å°±æ˜¯è¿”å›åˆ°äº†å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p><h5 id="å›é€€"><a href="#å›é€€" class="headerlink" title="å›é€€"></a>å›é€€</h5><p>é€šå¸¸ä½¿ç”¨<code>path</code> è®°å½•é€’å½’è°ƒç”¨çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹çš„ç¬¦åˆæ¡ä»¶çš„è§£ï¼Œå½“é€’å½’è¿”å›æ—¶ï¼Œè·¯å¾„ä¹Ÿè¦ç›¸åº”çš„å›é€€</p><p>ä¾‹å¦‚ä¸Šè¿°å›¾è§£ï¼Œæˆ‘ä»¬åœ¨ <code>[1-2-3]</code> å¾—åˆ°ä¸€ä¸ªæ»¡è¶³çš„è§£åï¼Œç¨‹åº <code>return</code>, è¿™æ—¶éœ€è¦å¼¹å‡º<code>path</code>ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ ä½¿é€’å½’å±‚ å›åˆ°  <code>[1-2]</code></p><h5 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h5><p>åœ¨ä¸Šè¿°çš„äºŒå‰æ ‘ä¾‹é¢˜ä¸­ï¼Œå¦‚æœè¦è·å–èŠ‚ç‚¹çš„è·¯å¾„å‘¢ï¼Ÿ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">åœ¨äºŒå‰æ ‘ä¸­æœç´¢æ‰€æœ‰å€¼ä¸º</span> <span class="number">7</span> <span class="string">çš„èŠ‚ç‚¹ï¼Œè¯·è¿”å›æ ¹èŠ‚ç‚¹åˆ°è¿™äº›èŠ‚ç‚¹çš„è·¯å¾„ã€‚</span></span><br></pre></td></tr></table></figure><p>é¢˜è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å‰åºéå†ï¼šä¾‹é¢˜äºŒ */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°è¯•</span></span><br><span class="line">    path.add(root);</span><br><span class="line">    <span class="keyword">if</span> (root.val == <span class="number">7</span>) &#123;</span><br><span class="line">        <span class="comment">// è®°å½•è§£</span></span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">    &#125;</span><br><span class="line">    preOrder(root.left);</span><br><span class="line">    preOrder(root.right);</span><br><span class="line">    <span class="comment">// å›é€€</span></span><br><span class="line">    path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong><code>path</code> ï¼šè·¯å¾„ï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³æ¡ä»¶çš„ä¸€æ¡è§£ã€‚</strong></p><h4 id="å‰ªæ"><a href="#å‰ªæ" class="headerlink" title="å‰ªæ"></a>å‰ªæ</h4><p>å¤æ‚çš„å›æº¯é—®é¢˜é€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªçº¦æŸæ¡ä»¶ï¼Œ<strong>çº¦æŸæ¡ä»¶é€šå¸¸å¯ç”¨äºâ€œå‰ªæâ€</strong>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">åœ¨äºŒå‰æ ‘ä¸­æœç´¢æ‰€æœ‰å€¼ä¸º</span> <span class="number">7</span> <span class="string">çš„èŠ‚ç‚¹ï¼Œè¯·è¿”å›æ ¹èŠ‚ç‚¹åˆ°è¿™äº›èŠ‚ç‚¹çš„è·¯å¾„ï¼Œ**å¹¶è¦æ±‚è·¯å¾„ä¸­ä¸åŒ…å«å€¼ä¸º</span> <span class="number">3</span> <span class="string">çš„èŠ‚ç‚¹**ã€‚</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å‰ªæï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¢åŠ é€’å½’çš„é™å®šæ¡ä»¶ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„è·¯å¾„ä¼šæå‰å¼¹å‡º</p><p>å›¾ç¤ºï¼š</p><p><img src="https://pic.imgdb.cn/item/6565b200c458853aef9446af.png"></p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="comment">// å‰ªæ</span></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span> || root.val == <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°è¯•</span></span><br><span class="line">    path.add(root);</span><br><span class="line">    <span class="keyword">if</span> (root.val == <span class="number">7</span>) &#123;</span><br><span class="line">        <span class="comment">// è®°å½•è§£</span></span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">    &#125;</span><br><span class="line">    preOrder(root.left);</span><br><span class="line">    preOrder(root.right);</span><br><span class="line">    <span class="comment">// å›é€€</span></span><br><span class="line">    path.remove(path.size() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ªææ“ä½œä¸æ­¢åœ¨é™å®šæ¡ä»¶ä¸­ï¼Œå¦‚ <strong>ç®€å•ç»„åˆä¾‹å­</strong> ä¸­ï¼Œæ¨ªå‘éå†äº† ç¬¬ä¸€å±‚ æ•°å€¼ï¼Œ åœ¨ä¸‹é¢çš„é€’å½’å±‚çº§ä¸­ï¼Œ<code>start</code>éƒ½å¢åŠ äº† <code>1</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; ints.length; i++) &#123;</span><br><span class="line">           path.add(ints[i]);</span><br><span class="line">           dfs(i+<span class="number">1</span>,k,ints);</span><br><span class="line">           path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ · ä¸‹ä¸€å±‚çº§èŠ‚ç‚¹å°±ä» <code>i+1</code>å¼€å§‹ï¼Œè¿™æ ·å°±å‡å°‘äº†  å½“å‰å€¼çš„å±‚çº§ï¼Œç›¸å½“äºå‰ªæã€‚</p><h4 id="æ¡†æ¶ä»£ç "><a href="#æ¡†æ¶ä»£ç " class="headerlink" title="æ¡†æ¶ä»£ç "></a>æ¡†æ¶ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»“æœé›†</span></span><br><span class="line"><span class="keyword">private</span> List  result;</span><br><span class="line"><span class="comment">// è·¯å¾„</span></span><br><span class="line"><span class="keyword">private</span> List path</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å›æº¯ç®—æ³•æ¡†æ¶ */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span> start, List&lt;Choice&gt; choices,)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºè§£</span></span><br><span class="line">    <span class="keyword">if</span> (isSolution(start)) &#123;</span><br><span class="line">        <span class="comment">// è®°å½•è§£</span></span><br><span class="line">       result.add(path)</span><br><span class="line">        <span class="comment">// åœæ­¢ç»§ç»­æœç´¢</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰é€‰æ‹©</span></span><br><span class="line">    <span class="keyword">for</span> (Choice choice : choices) &#123;</span><br><span class="line">        <span class="comment">// å‰ªæï¼šåˆ¤æ–­é€‰æ‹©æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> (isValid(state, choice)) &#123;</span><br><span class="line">            <span class="comment">// å°è¯•ï¼šåšå‡ºé€‰æ‹©ï¼Œæ›´æ–°çŠ¶æ€</span></span><br><span class="line">            makeChoice(state, choice);</span><br><span class="line">            backtrack(state, choices, res);</span><br><span class="line">            <span class="comment">// å›é€€ï¼šæ’¤é”€é€‰æ‹©ï¼Œæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€</span></span><br><span class="line">            undoChoice(state, choice);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="https://www.hello-algo.com/chapter_backtracking/backtracking_algorithm/#1316">HELLO ç®—æ³•</a></p><p><a href="https://www.programmercarl.com/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80.html#%E9%A2%98%E7%9B%AE%E5%88%86%E7%B1%BB">ä»£ç éšæƒ³å½•</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    <category term="ç®—æ³•" scheme="https://nerkeler.github.io/categories/Java/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="ç®—æ³•" scheme="https://nerkeler.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="å›æº¯" scheme="https://nerkeler.github.io/tags/%E5%9B%9E%E6%BA%AF/"/>
    
  </entry>
  
  <entry>
    <title>SpringSecurityè¡¨å•è®¤è¯ï¼ˆä¸€ï¼‰</title>
    <link href="https://nerkeler.github.io/2023/08/02/SpringSecurity%E8%A1%A8%E5%8D%95%E8%AE%A4%E8%AF%81%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>https://nerkeler.github.io/2023/08/02/SpringSecurity%E8%A1%A8%E5%8D%95%E8%AE%A4%E8%AF%81%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2023-08-02T06:55:00.000Z</published>
    <updated>2023-08-02T06:56:53.820Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringSecurityè¡¨å•è®¤è¯ï¼ˆä¸€ï¼‰"><a href="#SpringSecurityè¡¨å•è®¤è¯ï¼ˆä¸€ï¼‰" class="headerlink" title="SpringSecurityè¡¨å•è®¤è¯ï¼ˆä¸€ï¼‰"></a>SpringSecurityè¡¨å•è®¤è¯ï¼ˆä¸€ï¼‰</h1><h2 id="æ–°å»ºä¸€ä¸ªSpringSecutiryé¡¹ç›®"><a href="#æ–°å»ºä¸€ä¸ªSpringSecutiryé¡¹ç›®" class="headerlink" title="æ–°å»ºä¸€ä¸ªSpringSecutiryé¡¹ç›®"></a>æ–°å»ºä¸€ä¸ªSpringSecutiryé¡¹ç›®</h2><p>åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œåç§°ä»»æ„</p><p><img src="https://pic.imgdb.cn/item/64c861f01ddac507cc1a539b.png"></p><p>pomæ–‡ä»¶å¼•å…¥ä¾èµ–ï¼Œç‰ˆæœ¬ä»»æ„ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç®€ç•¥è®¾ç½®ä¸€ä¸‹ï¼Œå¯åŠ¨æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">(<span class="meta">@RequestParam(value = &quot;name&quot;, defaultValue = &quot;World&quot;)</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;Hello %s!&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è®¿é—®ä»»æ„è·¯å¾„éƒ½ä¼šè¢«æ‹¦æˆªåˆ°  &#x2F;login è·¯å¾„ï¼Œå‘ˆç°ä»¥ä¸‹ç™»å½•é¡µé¢</p><p><img src="https://pic.imgdb.cn/item/64c865d91ddac507cc21bc69.png"></p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå°±å·²ç»æ–°å»ºäº†ä¸€ä¸ªSpringSecutiryæœ€åŸºæœ¬çš„demo</p><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p>springsecutityä½œä¸ºé‡é‡çº§çš„å®‰å…¨æ¡†æ¶ï¼ˆç›¸å¯¹äºshiro)ï¼Œæ­å»ºèµ·æ¥å´å¹¶æ²¡æœ‰å¾ˆç¹çï¼Œå…¶å®è¿™å½’åŠŸäºspringbootè‡ªåŠ¨é…ç½®å¸®æˆ‘ä»¬èŠ‚çœäº†ç¹ççš„é…ç½®ï¼Œspringsecurityæä¾›äº†å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†æœ€æ ¸å¿ƒçš„å½“å±ä¸¤æ–¹é¢</p><ul><li><strong>è®¤è¯</strong> <strong>Authentication</strong></li><li><strong>æˆæƒ</strong> <strong>Authorization</strong></li></ul><p>é€šä¿—æ¥è¯´ï¼Œè®¤è¯å°±æ˜¯ä½ æ˜¯è°ï¼Œæˆæƒå°±æ˜¯ä½ å¯ä»¥ä½œä»€ä¹ˆ</p><h2 id="ç®€è¿°è®¤è¯"><a href="#ç®€è¿°è®¤è¯" class="headerlink" title="ç®€è¿°è®¤è¯"></a>ç®€è¿°è®¤è¯</h2><p>springsecutiryæ”¯æŒå¤šç§ä¸åŒçš„è®¤è¯æ–¹å¼</p><ul><li>è¡¨å•è®¤è¯</li><li>OAuth2.0è®¤è¯</li><li>SAML2.0è®¤è¯</li><li>CAS2.0è®¤è¯</li><li>RememberMe è‡ªåŠ¨è®¤è¯</li><li>JAASè®¤è¯</li><li>OpenID å»ä¸­å¿ƒåŒ–è®¤è¯</li><li>Pre-Authentication Scenarios è®¤è¯</li><li>X509 è®¤è¯</li><li>HTTP Basicè®¤è¯</li><li>HTTP Digestè®¤è¯</li></ul><h3 id="è®¤è¯æ¥å£"><a href="#è®¤è¯æ¥å£" class="headerlink" title="è®¤è¯æ¥å£"></a>è®¤è¯æ¥å£</h3><p>è®¤è¯ä¿¡æ¯ä¸»è¦çš„æ“ä½œåŠŸèƒ½ç”±Authentication å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Authentication</span> <span class="keyword">extends</span> <span class="title class_">Principal</span>, Serializable &#123;</span><br><span class="line">    Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities();</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getCredentials</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getDetails</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getPrincipal</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAuthenticated</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setAuthenticated</span><span class="params">(<span class="type">boolean</span> var1)</span> <span class="keyword">throws</span> IllegalArgumentException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>getAuthorities   è·å–ç”¨æˆ·æƒé™</li><li>getCredentials è·å–ç”¨æˆ·å‡­è¯ï¼Œä¸€èˆ¬æ¥è¯´å°±æ˜¯å¯†ç </li><li>getDetails è·å–ç”¨æˆ·æºå¸¦çš„è¯¦ç»†ä¿¡æ¯  è¯·æ±‚è·¯å¾„ç­‰</li><li>getPrincipal è·å–å½“å‰ç”¨æˆ· </li><li>isAuthenticated  æ˜¯å¦è®¤è¯æˆåŠŸ</li></ul><p>å¤§è‡´çœ‹ä¸€ä¸‹Authentication çš„å­ç±»å®ç°ï¼Œå¯ä»¥çœ‹åˆ°ä¸åŒçš„è®¤è¯æ–¹å¼ä¼šæœ‰ä¸åŒçš„å®ç°ç±»ï¼Œè¿™é‡Œå…ˆä¸å±•å¼€è¯´æ˜ï¼Œå¤§è‡´æœ‰ä¸ªå°è±¡</p><p><img src="https://pic.imgdb.cn/item/64c86f121ddac507cc35078a.png"></p><p>è®¤è¯ä¿¡æ¯ç”±Authenticationå’Œå…¶å­ç±»æä¾›ï¼Œè€Œè®¤è¯å·¥ä½œåˆ™æ˜¯ç”±AuthenticationManageræ¥å£æå…¶å­ç±»å®ç°</p><p>AuthenticationManageræ¥å£åªæä¾›äº†ä¸€ä¸ªè®¤è¯æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthenticationManager</span> &#123;</span><br><span class="line">    Authentication <span class="title function_">authenticate</span><span class="params">(Authentication var1)</span> <span class="keyword">throws</span> AuthenticationException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸åŒçš„å­ç±»ä¹Ÿä»£è¡¨äº†ä¸åŒçš„è®¤è¯æ–¹å¼ï¼Œåªéœ€è¦æœ‰ä¸ªå°è±¡å°±å¤Ÿäº†ï¼Œåé¢ç¢°åˆ°ä¼šè¯¦ç»†è¯´æ˜</p><p><img src="https://pic.imgdb.cn/item/64c871be1ddac507cc3b3a1a.png"></p><h2 id="è¿‡æ»¤å™¨é“¾"><a href="#è¿‡æ»¤å™¨é“¾" class="headerlink" title="è¿‡æ»¤å™¨é“¾"></a>è¿‡æ»¤å™¨é“¾</h2><p>åœ¨Spring Securityä¸­ï¼Œè®¤è¯å’Œæˆæƒç­‰åŠŸèƒ½éƒ½æ˜¯åŸºäºè¿‡æ»¤å™¨å®Œæˆï¼ŒSpring Securiyå¸¸è§çš„è¿‡æ»¤å™¨å¦‚ä¸‹</p><table><thead><tr><th>è¿‡æ»¤å™¨</th><th>è¿‡æ»¤å™¨ä½œç”¨</th><th>é¢„åŠ è½½</th></tr></thead><tbody><tr><td>ChannelProcessingFilter</td><td>è¿‡æ»¤è¯·æ±‚åè®®ï¼ŒHTTPS&#x2F;HTTP</td><td>NO</td></tr><tr><td>WebAsyncManagerIntegrationFilter</td><td>å°†WebAsyncManager ä¸Spring Security ä¸Šä¸‹æ–‡è¿›è¡Œé›†æˆ</td><td>YES</td></tr><tr><td>SecurityContextPersistenceFilter</td><td>åœ¨å¤„ç†è¯·æ±‚å‰ï¼Œå°†å®‰å…¨ä¿¡æ¯åŠ è½½åˆ°SecurityContextHolderä¸­æ–¹ä¾¿åç»­ä½¿ç”¨ï¼Œè¯·æ±‚ç»“æŸåï¼Œåœ¨æ“¦é™¤æ‰ä¿¡æ¯</td><td>YES</td></tr><tr><td>HeaderWriterFilter</td><td>å¤´ä¿¡æ¯åŠ å…¥åˆ°ç›¸åº”ä¸­</td><td>YES</td></tr><tr><td>CorsFilter</td><td>å¤„ç†è·¨åŸŸé—®é¢˜</td><td>NO</td></tr><tr><td>Csffilter</td><td>å¤„ç†CSRFæ”»å‡»</td><td>YES</td></tr><tr><td>LogoutFilter</td><td>å¤„ç†æ³¨é”€ç™»å½•</td><td>YES</td></tr><tr><td>OAuth2AuthorizationRequestRedirectFilter</td><td>å¤„ç†OAuth2è®¤è¯é‡å®šå‘</td><td>NO</td></tr><tr><td>Saml2WebSsoAuthenticationRequestFilter</td><td>å¤„ç†SAMLè®¤è¯</td><td>NO</td></tr><tr><td>X509AuthenticationFilter</td><td>å¤„ç†X509è®¤è¯</td><td>NO</td></tr><tr><td>AbstractPreAuthenticatedProcessingFilter</td><td>å¤„ç†é¢„è®¤è¯é—®é¢˜</td><td>NO</td></tr><tr><td>CasAuthenticationFilter</td><td>å¤„ç†CASå•ç‚¹ç™»å½•</td><td>NO</td></tr><tr><td>OAuth2LoginAuthenticationFilter</td><td>å¤„ç†OAuth2</td><td>NO</td></tr><tr><td>Saml2WebSsoAuthenticationFilter</td><td>å¤„ç†SAMLè®¤è¯</td><td>NO</td></tr><tr><td>UsenamePasswordAuthenticationFilter</td><td>å¤„ç†è¡¨å•ç™»å½•</td><td>YES</td></tr><tr><td>OpenIDAuthenticationFilter</td><td>å¤„ç†OpenIDè®¤è¯</td><td>NO</td></tr><tr><td>DefaultLoginPageGenemtingFilter</td><td>é…ç½®é»˜è®¤ç™»å½•é¡µé¢</td><td>YES</td></tr><tr><td>DefaultLogoutPageGeneratingFilter</td><td>é…ç½®é»˜è®¤æ³¨é”€é¡µé¢</td><td>YES</td></tr><tr><td>ConcurentSessionFilter</td><td>å¤„ç†Sessionæœ‰æ•ˆæœŸ</td><td>NO</td></tr><tr><td>DigestAuthenticationFilter</td><td>å¤„ç†HTTPæ‘˜è¦è®¤è¯</td><td>NO</td></tr><tr><td>BearerTokenAuthenticationFilter</td><td>å¤„ç†OAuth2è®¤è¯æ—¶çš„Access Token</td><td>NO</td></tr><tr><td>BasicAuthenticationFilter</td><td>å¤„ç†HttpBasicç™»å½•</td><td>YES</td></tr><tr><td>RequestCacheAwareFilter</td><td>å¤„ç†è¯·æ±‚ç¼“å­˜</td><td>YES</td></tr><tr><td>SecurityContextHolderAwareRequestFilter</td><td>åŒ…è£…åŸå§‹è¯·æ±‚</td><td>YES</td></tr><tr><td>JaasApiIntegrationFilter</td><td>å¤„ç†JAASè®¤è¯</td><td>NO</td></tr><tr><td>RememberMeAuthenticationFilter</td><td>å¤„ç†RememberMeç™»å½•</td><td>NO</td></tr><tr><td>AnonymousAuthenticationFilter</td><td>é…ç½®åŒ¿åè®¤è¯</td><td>YES</td></tr><tr><td>OAuth2AuthorizationCodeGrantFilter</td><td>å¤„ç†OAuth2è®¤è¯ä¸­çš„æˆæƒç </td><td>NO</td></tr><tr><td>SessionManagementFilter</td><td>å¤„ç†Sessionå¹¶å‘é—®é¢˜</td><td>YES</td></tr><tr><td>ExceptionTranslationFilter</td><td>æ± å¼‚å¸¸è®¤è¯&#x2F;æˆæƒä¸­çš„æƒ…å†µ</td><td>YES</td></tr><tr><td>FilterSecurityInterceptor</td><td>å¤„ç†æˆæƒ</td><td>YES</td></tr><tr><td>SwitchUserFilter</td><td>å¤„ç†è´¦æˆ·åˆ‡æ¢</td><td>NO</td></tr></tbody></table><p>Spring Securityæä¾›çš„åŠŸèƒ½åŸºæœ¬éƒ½æ˜¯ç”±ä¸Šè¿°è¿‡æ»¤å™¨æ¥å®ç°çš„ï¼Œè¿™äº›è¿‡æ»¤å™¨æŒ‰ç…§æ—¢å®šçš„ä¼˜å…ˆçº§æ’åˆ—å½¢æˆè¿‡æ»¤å™¨é“¾ã€‚å½“ç„¶å¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„ä½ç½®ï¼Œè¿™é‡Œæš‚ä¸è®¨è®ºã€‚</p><h2 id="Spring-Securityç™»å½•è®¤è¯"><a href="#Spring-Securityç™»å½•è®¤è¯" class="headerlink" title="Spring Securityç™»å½•è®¤è¯"></a>Spring Securityç™»å½•è®¤è¯</h2><p>ä¸Šå›¾ä¸­æ–°å»ºäº†ä¸€ä¸ªæœ€åŸºæœ¬çš„Spring Security demo ï¼Œåœ¨è®¿é—®&#x2F;helloçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨é‡å®šå‘åˆ°&#x2F;loginé¡µé¢ï¼Œå¹¶ä¸”éœ€è¦è¾“å…¥è´¦å·å¯†ç ç™»å½•</p><p>è€Œåœ¨å¯åŠ¨æ—¶ï¼Œå‘ç°ç»ˆç«¯ä¸Šæ‰“å°äº†ä¸€è¡Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using generated security password: 535d2c4d-44eb-4808-8ae1-f272b9317b29</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯Spring Security éšæœºç”Ÿæˆçš„å¯†ç ï¼ˆuuidï¼‰ é»˜è®¤ç”¨æˆ·åä¸ºuserã€‚</p><h3 id="æµç¨‹åˆ†æ"><a href="#æµç¨‹åˆ†æ" class="headerlink" title="æµç¨‹åˆ†æ"></a>æµç¨‹åˆ†æ</h3><p>ä¸Šè¿°æµç¨‹ä»¥å›¾æ ‡çš„æ–¹å¼å±•ç°å¦‚ä¸‹</p><p><img src="https://pic.imgdb.cn/item/64c8c3661ddac507ccdcbe59.png"></p><ol><li>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘èµ·è¯·æ±‚  <code>/hello</code> æ¥å£ï¼Œç”±äºå¼•å…¥äº†<code>Spring Security</code>ï¼Œç™»å½•éœ€è¦è®¤è¯</li><li>è¯·æ±‚ä¼šèµ°ä¸€é<code>Spring Security</code> ä¸­çš„è¿‡æ»¤é“¾ï¼Œåœ¨æœ€åçš„<code>FilterSecurityInterceptor</code>è¿‡æ»¤å…¶ä¸­è¢«æ‹¦æˆªä¸‹æ¥ï¼Œå› ä¸ºç³»ç»Ÿå‘ç°ç”¨æˆ·æœªè®¤è¯ã€‚è¯·æ±‚æ‹¦æˆªä¸‹æ‹‰åä¼šæŠ›å‡º <code>AccessDeniedException</code> å¼‚å¸¸</li><li>æŠ›å‡ºçš„<code>AccessDeniedException</code> å¼‚å¸¸ åœ¨ <code>ExceptionTranslationFilter</code>è¿‡æ»¤å™¨ä¸­è¢«æ•è·ï¼Œ<code>ExceptionTranslationFilter</code> è¿‡æ»¤å™¨é€šè¿‡è°ƒç”¨ <code>LoginUrlAuthenticationEntryPoint</code>ä¸­ <code>commmence</code>æ–¹æ³•è¿”å›å®¢æˆ·ç«¯302ï¼Œè¦æ±‚å®¢æˆ·ç«¯é‡å®šå‘åˆ°&#x2F;loginé¡µé¢</li><li>å®¢æˆ·ç«¯é‡æ–°å‘é€ &#x2F;loginè¯·æ±‚</li><li>&#x2F;login è¯·æ±‚è¢« <code>DefaultLoginPageGeneratingFilter</code>è¿‡æ»¤å™¨æ‹¦æˆªä¸‹æ¥ï¼Œå¹¶åœ¨è¯¥è¿‡æ»¤å™¨ä¸­è¿”å›ç™»å½•é¡µé¢ã€‚</li></ol><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><h4 id="FilterSecurityInterceptor"><a href="#FilterSecurityInterceptor" class="headerlink" title="FilterSecurityInterceptor"></a>FilterSecurityInterceptor</h4><p>å½“è¿‡æ»¤é“¾æ‰§è¡Œåˆ°<code>FilterSecurityInterceptor</code>æ—¶ï¼Œä¼šè°ƒç”¨<code>doFilter</code>æ–¹æ³•å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¦è°ƒç”¨äº†<code>invoke</code>æ–¹æ³•ï¼Œ<code>FilterInvocation</code>åˆ†è£…äº†å½“å‰è¯·æ±‚ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">FilterInvocation</span> <span class="variable">fi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterInvocation</span>(request, response, chain);</span><br><span class="line">    <span class="built_in">this</span>.invoke(fi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>invoke()</code>æ–¹æ³•ä¸­ï¼Œå®ƒä¼šè°ƒç”¨<code>beforeInvocation()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯<code>AbstractSecurityInterceptor</code>çš„ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°ç”±å­ç±»æä¾›ã€‚<code>beforeInvocation()</code>æ–¹æ³•ä¼šè°ƒç”¨<code>AccessDecisionManager</code>æ¥è¿›è¡Œè®¿é—®å†³ç­–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(FilterInvocation fi)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="keyword">if</span> (fi.getRequest() != <span class="literal">null</span> &amp;&amp; fi.getRequest().getAttribute(<span class="string">&quot;__spring_security_filterSecurityInterceptor_filterApplied&quot;</span>) != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.observeOncePerRequest) &#123;</span><br><span class="line">        fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fi.getRequest() != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.observeOncePerRequest) &#123;</span><br><span class="line">            fi.getRequest().setAttribute(<span class="string">&quot;__spring_security_filterSecurityInterceptor_filterApplied&quot;</span>, Boolean.TRUE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">InterceptorStatusToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="built_in">super</span>.beforeInvocation(fi);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.finallyInvocation(token);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.afterInvocation(token, (Object)<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>beforeInvocation</code>æ–¹æ³•ä¸­å¹¶ä¸ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ç›¸åï¼Œå®ƒä¼šå§”æ‰˜ç»™<code>AccessDecisionManager</code>æ¥è¿›è¡Œè®¿é—®å†³ç­–ã€‚å¦‚æœè®¿é—®å†³ç­–å¤±è´¥ï¼Œ<code>AccessDecisionManager</code>å°†æŠ›å‡º<code>AccessDeniedException</code>å¼‚å¸¸ï¼Œè¡¨ç¤ºè®¿é—®è¢«æ‹’ç»ã€‚ä¸»è¦è¯­å¥æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.accessDecisionManager.decide(authenticated, object, attributes);</span><br><span class="line">&#125; <span class="keyword">catch</span> (AccessDeniedException var7) &#123;</span><br><span class="line">    <span class="built_in">this</span>.publishEvent(<span class="keyword">new</span> <span class="title class_">AuthorizationFailureEvent</span>(object, attributes, authenticated, var7));</span><br><span class="line">    <span class="keyword">throw</span> var7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>FilterSecurityInterceptor</code>ä¼šæ£€æŸ¥ç”¨æˆ·çš„è®¤è¯çŠ¶æ€å’Œæƒé™ï¼Œç„¶åè°ƒç”¨<code>AccessDecisionManager</code>çš„<code>decide</code>æ–¹æ³•æ¥è¿›è¡Œè®¿é—®å†³ç­–ã€‚</p><p>è¿™é‡Œé»˜è®¤çš„å†³ç­–å™¨æ˜¯<code>AffirmativeBased</code>ï¼Œç›¸å…³ä»£ç ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(var5.hasNext()) &#123;</span><br><span class="line">    <span class="type">AccessDecisionVoter</span> <span class="variable">voter</span> <span class="operator">=</span> (AccessDecisionVoter)var5.next();</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> voter.vote(authentication, object, configAttributes);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">        <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Voter: &quot;</span> + voter + <span class="string">&quot;, returned: &quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(result) &#123;</span><br><span class="line">    <span class="keyword">case</span> -<span class="number">1</span>:</span><br><span class="line">        ++deny;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (deny &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="built_in">this</span>.messages.getMessage(<span class="string">&quot;AbstractAccessDecisionManager.accessDenied&quot;</span>, <span class="string">&quot;Access is denied&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.checkAllowIfAllAbstainDecisions();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AffirmativeBased</code>: å¦‚æœä»»ä½•ä¸€ä¸ªè®¿é—®å†³ç­–å™¨è¿”å›<code>ACCESS_GRANTED</code>ï¼ˆè®¿é—®å…è®¸ï¼‰ï¼Œåˆ™å†³ç­–é€šè¿‡ï¼›å¦åˆ™ï¼Œå¦‚æœæ‰€æœ‰è®¿é—®å†³ç­–å™¨éƒ½è¿”å›<code>ACCESS_ABSTAIN</code>ï¼ˆå¼ƒæƒï¼‰æˆ–æ²¡æœ‰å†³ç­–å™¨ï¼Œé‚£ä¹ˆè®¿é—®ä¹Ÿä¼šè¢«å…è®¸ã€‚</p><p><code>AffirmativeBased</code> é»˜è®¤ä¼ å…¥çš„æ„é€ å™¨åªæœ‰ä¸€ä¸ª <code>WebExpressionVoter</code>ï¼Œè¿™ä¸ªæ„é€ å™¨ä¼šæ ¹æ®ä½ åœ¨é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®è¿›è¡Œé€»è¾‘å¤„ç†å¾—å‡ºæŠ•ç¥¨ç»“æœï¼Œè¿™é‡Œè¿”å› -1ï¼Œdeny &gt; 0 ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><h4 id="ExceptionTranslationFilter"><a href="#ExceptionTranslationFilter" class="headerlink" title="ExceptionTranslationFilter"></a>ExceptionTranslationFilter</h4><p><code>ExceptionTranslationFilter</code> æ•è·<code>FilterSecurityInterceptor</code>æŠ›å‡ºçš„<code>AccessDeniedException</code>å¼‚å¸¸ï¼Œé€šè¿‡è°ƒç”¨ <code>LoginUrlAuthenticationEntryPoint</code>ä¸­ <code>commmence</code>æ–¹æ³•è¿”å›å®¢æˆ·ç«¯302ï¼Œè¦æ±‚å®¢æˆ·ç«¯é‡å®šå‘åˆ°&#x2F;loginé¡µé¢ã€‚</p><p>è¿™é‡Œèµ°çš„æ˜¯<code>catch(Excception var10)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest)req;</span><br><span class="line">    <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse)res;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">        <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Chain processed normally&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException var9) &#123;</span><br><span class="line">        <span class="keyword">throw</span> var9;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var10) &#123;</span><br><span class="line">    ...........</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.handleSpringSecurityException(request, response, chain, (RuntimeException)ase);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>handleSpringSecurityException</code>æ–¹æ³•ä¸»è¦æ˜¯ç¦æ­¢è®¿é—®å’Œé‡å®šå‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleSpringSecurityException</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, RuntimeException exception)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> AuthenticationException) &#123;</span><br><span class="line">        <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Authentication exception occurred; redirecting to authentication entry point&quot;</span>, exception);</span><br><span class="line">        <span class="built_in">this</span>.sendStartAuthentication(request, response, chain, (AuthenticationException)exception);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> AccessDeniedException) &#123;</span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.authenticationTrustResolver.isAnonymous(authentication) &amp;&amp; !<span class="built_in">this</span>.authenticationTrustResolver.isRememberMe(authentication)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Access is denied (user is not anonymous); delegating to AccessDeniedHandler&quot;</span>, exception);</span><br><span class="line">            <span class="built_in">this</span>.accessDeniedHandler.handle(request, response, (AccessDeniedException)exception);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Access is denied (user is &quot;</span> + (<span class="built_in">this</span>.authenticationTrustResolver.isAnonymous(authentication) ? <span class="string">&quot;anonymous&quot;</span> : <span class="string">&quot;not fully authenticated&quot;</span>) + <span class="string">&quot;); redirecting to authentication entry point&quot;</span>, exception);</span><br><span class="line">            <span class="built_in">this</span>.sendStartAuthentication(request, response, chain, <span class="keyword">new</span> <span class="title class_">InsufficientAuthenticationException</span>(<span class="built_in">this</span>.messages.getMessage(<span class="string">&quot;ExceptionTranslationFilter.insufficientAuthentication&quot;</span>, <span class="string">&quot;Full authentication is required to access this resource&quot;</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾è€Œæ˜“è§è¿™é‡Œèµ°çš„æ˜¯ <code>this.sendStartAuthentication(request, response, chain, new InsufficientAuthenticationException(this.messages.getMessage(&quot;ExceptionTranslationFilter.insufficientAuthentication&quot;, &quot;Full authentication is required to access this resource&quot;)));</code></p><p>è€Œ<code>sendStartAuthentication</code>å®é™…ä¸Šè°ƒç”¨çš„å°±æ˜¯<code>LoginUrlAuthenticationEntryPoint</code>çš„<code>commence</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">sendStartAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, AuthenticationException reason)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    SecurityContextHolder.getContext().setAuthentication((Authentication)<span class="literal">null</span>);</span><br><span class="line">    <span class="built_in">this</span>.requestCache.saveRequest(request, response);</span><br><span class="line">    <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Calling Authentication entry point.&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.authenticationEntryPoint.commence(request, response, reason);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>commence</code>çœŸæ­£å®ç°äº†ç”±<code>Spring Security</code> æä¾›çš„é»˜è®¤<code>/login</code> è·¯å¾„çš„é‡å®šå‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.useForward) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.forceHttps &amp;&amp; <span class="string">&quot;http&quot;</span>.equals(request.getScheme())) &#123;</span><br><span class="line">            redirectUrl = <span class="built_in">this</span>.buildHttpsRedirectUrlForRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (redirectUrl == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">loginForm</span> <span class="operator">=</span> <span class="built_in">this</span>.determineUrlToUseForThisRequest(request, response, authException);</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;Server side forward to: &quot;</span> + loginForm);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">RequestDispatcher</span> <span class="variable">dispatcher</span> <span class="operator">=</span> request.getRequestDispatcher(loginForm);</span><br><span class="line">            dispatcher.forward(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        redirectUrl = <span class="built_in">this</span>.buildRedirectUrlToLoginPage(request, response, authException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.redirectStrategy.sendRedirect(request, response, redirectUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DefaultLoginPageGeneratingFilter"><a href="#DefaultLoginPageGeneratingFilter" class="headerlink" title="DefaultLoginPageGeneratingFilter"></a>DefaultLoginPageGeneratingFilter</h4><p>ç»è¿‡ä¸Šè¿°é‡å®šå‘æ“ä½œï¼Œå®¢æˆ·ç«¯é‡æ–°å‘èµ·è¯·æ±‚&#x2F;helloï¼Œè¿™ä¸ªè¯·æ±‚ä¼šåœ¨<code>DefaultLoginPageGeneratingFilter</code>è¢«æ‹¦æˆªä¸‹æ‹‰ï¼Œå¹¶è¿”å›é»˜è®¤çš„ç™»å½•é¡µé¢</p><p><code>DefaultLoginPageGeneratingFilter</code>çš„æ“ä½œè¦ç®€å•äº›ï¼Œå½“åŒ¹é…åˆ°ç™»å½•æ“ä½œçš„æ—¶å€™ï¼ˆelse)ï¼Œä¼šå‘é€é»˜è®¤ç”Ÿæˆçš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„demo ç™»å½•é¡µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest)req;</span><br><span class="line">    <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse)res;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">loginError</span> <span class="operator">=</span> <span class="built_in">this</span>.isErrorPage(request);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">logoutSuccess</span> <span class="operator">=</span> <span class="built_in">this</span>.isLogoutSuccess(request);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.isLoginUrlRequest(request) &amp;&amp; !loginError &amp;&amp; !logoutSuccess) &#123;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// é¡¾åæ€ä¹‰ï¼Œç”Ÿæˆé»˜è®¤é¡µé¢ï¼Œè¯¦ç»†ä»£ç å¯ä»¥ç‚¹å¼€generateLoginPageHtmlæ–¹æ³•</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">loginPageHtml</span> <span class="operator">=</span> <span class="built_in">this</span>.generateLoginPageHtml(request, loginError, logoutSuccess);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        response.setContentLength(loginPageHtml.getBytes(StandardCharsets.UTF_8).length);</span><br><span class="line">        response.getWriter().write(loginPageHtml);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è‡³æ­¤ï¼Œè§£é‡Šäº†ä»è¾“å…¥<code>/hello</code> åˆ° é‡å®šå‘åˆ° <code>/login</code>ä»£ç çš„åŸç†ï¼Œç”±äºå®ƒçš„å®ç°è¿‡ç¨‹éå¸¸å¤æ‚ï¼Œè¿™é‡Œä¹Ÿåªæ˜¯å®šä½åˆ°æœ¬æ¬¡è¯·æ±‚ç»è¿‡çš„ä»£ç é“¾è·¯æ“ä½œã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç”Ÿæˆäº†é»˜è®¤çš„ç™»å½•é¡µï¼Œé‚£åœ¨å“ªé‡Œç”Ÿæˆçš„é»˜è®¤è´¦å·å’Œå¯†ç å‘¢ï¼Ÿåç»­å°†ç»§ç»­ä»‹ç»</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>ã€Šæ·±å…¥æµ…å‡ºSpring Securityã€‹ç‹æ¾</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="SpringSecurity" scheme="https://nerkeler.github.io/categories/SpringSecurity/"/>
    
    
    <category term="SpringSecurity" scheme="https://nerkeler.github.io/tags/SpringSecurity/"/>
    
    <category term="spring" scheme="https://nerkeler.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçŸ¥è¯†ç½‘ç»œ(ä¸€)-MYSQLç»“æ„ä½“ç³»</title>
    <link href="https://nerkeler.github.io/2023/07/21/MySQL%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%9C-%E4%B8%80-MYSQL%E7%BB%93%E6%9E%84%E4%BD%93%E7%B3%BB/"/>
    <id>https://nerkeler.github.io/2023/07/21/MySQL%E7%9F%A5%E8%AF%86%E7%BD%91%E7%BB%9C-%E4%B8%80-MYSQL%E7%BB%93%E6%9E%84%E4%BD%93%E7%B3%BB/</id>
    <published>2023-07-21T06:20:00.000Z</published>
    <updated>2023-07-21T06:21:28.983Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="MySQLçŸ¥è¯†ç½‘ç»œï¼ˆä¸€ï¼‰"><a href="#MySQLçŸ¥è¯†ç½‘ç»œï¼ˆä¸€ï¼‰" class="headerlink" title="MySQLçŸ¥è¯†ç½‘ç»œï¼ˆä¸€ï¼‰"></a>MySQLçŸ¥è¯†ç½‘ç»œï¼ˆä¸€ï¼‰</h1><h3 id="ä¸€æ¡SQLæ˜¯æ€ä¹ˆæ‰§è¡Œçš„"><a href="#ä¸€æ¡SQLæ˜¯æ€ä¹ˆæ‰§è¡Œçš„" class="headerlink" title="ä¸€æ¡SQLæ˜¯æ€ä¹ˆæ‰§è¡Œçš„"></a>ä¸€æ¡SQLæ˜¯æ€ä¹ˆæ‰§è¡Œçš„</h3><p>å…¥é—¨javaæ—¶è§‚çœ‹å®‹çº¢åº·è€å¸ˆçš„è§†é¢‘ä¸­æœ‰å¥è¯è®©æˆ‘å°è±¡æ·±åˆ»ï¼Œå¤§å¤„ç€çœ¼ï¼Œå°å¤„ç€æ‰‹ã€‚å­¦ä¹ ä¸€ä¸ªæ–°çš„æŠ€æœ¯ï¼Œåº”è¯¥å…ˆ<em><strong>é¸Ÿç°å…¶å…¨è²Œï¼Œä»é«˜ç»´åº¦ç†è§£é—®é¢˜</strong></em>ã€‚åœ¨æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªç®€å•çš„SQLæŸ¥è¯¢è¯­å¥æ—¶ï¼Œå¿ƒä¸­åº”è¯¥å¯¹ä»–çš„æ•´ä½“æ‰§è¡Œæµç¨‹æœ‰ä¸ªæ¦‚å¿µï¼Œåšåˆ°èƒ¸æœ‰æˆç«¹ï¼Œæ‰èƒ½åœ¨é‡åˆ°é—®é¢˜æ—¶ï¼Œå‡†ç¡®å®šä½ï¼Œè¿›è€Œæ ¹æ®æƒ…å†µå¯¹åº”è§£å†³æ–¹æ¡ˆã€‚è€Œæƒ³è¦åšåˆ°è¿™ç‚¹ï¼Œä¸å¾—ä¸æçš„å°±æ˜¯MYSQLç»“æ„ä½“ç³»ã€‚</p><h3 id="MYSQLç»“æ„ä½“ç³»-Serverå±‚"><a href="#MYSQLç»“æ„ä½“ç³»-Serverå±‚" class="headerlink" title="MYSQLç»“æ„ä½“ç³»(Serverå±‚)"></a>MYSQLç»“æ„ä½“ç³»(Serverå±‚)</h3><p><img src="https://pic.imgdb.cn/item/64b8cab61ddac507ccf5b8e4.png"></p><p>å¤§ä½“æ¥è¯´ï¼ŒMySQLå¯ä»¥åˆ†ä¸ºServerå±‚å’Œå­˜å‚¨å¼•æ“å±‚ä¸¤éƒ¨åˆ†</p><p>Serverå±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›–MySQLçš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å­˜è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚</p><p>å­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼Œå…¶æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒInnoDBã€MyISAMã€Memoryç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯InnoDB,å®ƒä»MySQL 5.5.5ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><h4 id="è¿æ¥å™¨å’Œå®‰å…¨ç®¡ç†"><a href="#è¿æ¥å™¨å’Œå®‰å…¨ç®¡ç†" class="headerlink" title="è¿æ¥å™¨å’Œå®‰å…¨ç®¡ç†"></a>è¿æ¥å™¨å’Œå®‰å…¨ç®¡ç†</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>h$ip <span class="operator">-</span>P$port <span class="operator">-</span>u$<span class="keyword">user</span> <span class="operator">-</span>p</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ç™»å½•mysqlæœåŠ¡å™¨ï¼Œå…¶ä¸­</p><ul><li>h ï¼ˆhostï¼‰ä»£è¡¨host ä¹Ÿå°±æ˜¯ä¸»æœºip</li><li>p (port)ä»£è¡¨ç«¯å£</li><li>u (user)ä»£è¡¨ç”¨æˆ·å</li><li>p (password)ä»£è¡¨å¯†ç ï¼Œ-påé¢æ²¡å¡«å†™å¯†ç æ˜¯ä¸ºäº†åœ¨ç»ˆç«¯ä¸­ä¸å¯è§çš„è¾“å…¥å¯†ç ï¼Œä¸€å®šç¨‹åº¦ä¸Šé¿å…å¯†ç æ³„éœ²ã€‚</li></ul><p>æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„å¯è§†åŒ–å·¥å…·éœ€è¦æä¾›çš„ä¹Ÿæ˜¯ä¸Šè¿°å‚æ•°ï¼Œå¦‚navicat</p><p><img src="https://pic.imgdb.cn/item/64b9056f1ddac507ccd40880.png"></p><p>é™¤äº†å¸¸è§„çš„è´¦å·å¯†ç ç™»å½•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¥—æ¥å­—ï¼ˆSSLï¼‰ç™»å½•ï¼Œä¸€æ—¦å®¢æˆ·ç«¯é“¾æ¥æˆåŠŸï¼ŒæœåŠ¡å™¨ä¼šç»§ç»­éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦å…·æœ‰æ‰§è¡ŒæŸä¸ªç‰¹å®šæŸ¥è¯¢çš„æƒé™ã€‚</p><h4 id="æŸ¥è¯¢ç¼“å­˜"><a href="#æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜"></a>æŸ¥è¯¢ç¼“å­˜</h4><p>åœ¨å»ºç«‹è¿æ¥åï¼Œåˆ™è¿›å…¥äº†Serverå±‚æ‰§è¡ŒæŸ¥è¯¢æ¡ä»¶ï¼Œè€ŒæŸ¥è¯¢é¦–å…ˆè¦åšçš„å°±æ˜¯æŸ¥è¯¢ç¼“å­˜</p><p>å¦‚ä¸Šå›¾ä¸­æ‰€ç¤ºï¼ŒMySQLåœ¨æ‹¿åˆ°ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚åé¦–å…ˆå›åˆ°æŸ¥è¯¢ç¼“å­˜ä¸­çœ‹çœ‹ä¹‹å‰æ˜¯å¦æ‰§è¡Œè¿‡è¿™æ¡è¯­å¥ã€‚ä¹‹å‰æ‰§è¡Œçš„è¯­å¥åŠç»“æœä¼šä»¥key-valueå½¢å¼å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°è¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„keyï¼Œåˆ™ç›´æ¥è¿”å›valueã€‚åä¹‹åˆ™ä¼šç»§ç»­åç»­çš„æŸ¥è¯¢æµç¨‹ã€‚</p><p>ç›´æ¥ä»ç¼“å­˜ä¸­æŸ¥è¯¢ä¼šå¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­å¹¶ä¸æ¨èè¿™ä¹ˆåšï¼Œå› ä¸ºåœ¨åŸSQLæ¶‰åŠè¡¨ä¸­ï¼Œå¦‚æœä»»ä¸€è¡¨æ ¼ä¸­çš„æ•°æ®è¢«æ›´æ–°ï¼ˆåŒ…æ‹¬æ–°å»ºå’Œåˆ é™¤ï¼‰ï¼Œç¼“å­˜åˆ™å°†å¤±æ•ˆï¼Œå¯¹äºæ›´æ–°é¢‘ç¹çš„è¡¨æ ¼ï¼Œç¼“å­˜å‘½ä¸­çš„å‡ ç‡ä¼šå¾ˆå°ã€‚ç¼“å­˜çš„ä½¿ç”¨åˆ™é€‚åˆè¡¨æ›´æ–°ä¸é¢‘ç¹æƒ…æ™¯ä¸‹ã€‚</p><p><em><strong>MySQL 8.0ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´8.0å¼€å§‹å½»åº•æ²¡æœ‰ç¼“å­˜åŠŸèƒ½äº†ã€‚</strong></em></p><h4 id="åˆ†æå™¨"><a href="#åˆ†æå™¨" class="headerlink" title="åˆ†æå™¨"></a>åˆ†æå™¨</h4><p>å¦‚æœæ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œåˆ™è¿›å…¥åˆ†æå™¨é˜¶æ®µè¿›è¡Œæ­¤æ³•åˆ†æå’Œè¯­æ³•åˆ†æ</p><p>æ‰€è°“è¯æ³•åˆ†æå°±æ˜¯å°†æˆ‘ä»¬è¾“å…¥çš„ä¸€æ•´æ¡SQLè¯­å¥ï¼Œæ‹†è§£æˆå¯¹åº”çš„è¡¨åå’Œå­—æ®µç­‰ï¼Œè¯­æ³•åˆ†æåˆ™æ˜¯æ ¹æ®MySQLè¯­æ³•è§„åˆ™åˆ¤æ–­è¾“å…¥çš„SQLè¯­å¥æ˜¯å¦ç¬¦åˆè¯­æ³•ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬è¾“å…¥ä»¥ä¸‹SQLè¯­å¥ï¼Œåˆ™ä¼šæ”¶åˆ°<em><strong>â€œYou have an error in your SQL syntaxâ€</strong></em>çš„é”™è¯¯æé†’ã€‚åŸå› åˆ™æ˜¯selectå°‘æ‰“äº†ä¸€ä¸ªt</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">selec <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> ID<span class="operator">=</span><span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;SELEC * FROM `T`&#x27; at line 1</span></span><br></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–å™¨"><a href="#ä¼˜åŒ–å™¨" class="headerlink" title="ä¼˜åŒ–å™¨"></a>ä¼˜åŒ–å™¨</h4><p>ç»è¿‡äº†åˆ†æå™¨ï¼ŒMySQLå°±çŸ¥é“ä½ è¦åšä»€ä¹ˆäº†ã€‚åœ¨å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿˜è¦å…ˆç»è¿‡ä¼˜åŒ–å™¨çš„å¤„ç†ã€‚</p><p>ä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨ä¸­æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™å†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥å…³è”å¤šå¼ è¡¨çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„é“¾æ¥é¡ºåº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">join</span> t2 <span class="keyword">using</span>(ID)  <span class="keyword">where</span> t1.c<span class="operator">=</span><span class="number">10</span> <span class="keyword">and</span> t2.d<span class="operator">=</span><span class="number">20</span>;</span><br></pre></td></tr></table></figure><ul><li>å³å¯ä»¥å…ˆä»è¡¨t1é‡Œé¢å–å‡º c&#x3D;10çš„è®°å½•çš„IDå€¼ï¼Œå†æ ¹æ®IDå€¼å…³è”åˆ°è¡¨t2,å†åˆ¤æ–­t2é‡Œé¢çš„dçš„å€¼æ˜¯å¦ç­‰äº20</li><li>ä¹Ÿå¯ä»¥å…ˆä»t2é‡Œé¢å–å‡ºd &#x3D; 20çš„IDå€¼ï¼Œå†æ ¹æ®IDå…³è”T1ï¼Œå†åˆ¤æ–­t1çš„cå€¼æ˜¯å¦ç­‰äº10</li></ul><p>è¿™ä¸¤ç§æ‰§è¡Œæ–¹æ³•çš„é€»è¾‘ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ‰§è¡Œçš„æ•ˆç‡ä¼šæœ‰ä¸åŒï¼Œè€Œä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯å†³å®šé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªæ–¹æ¡ˆã€‚</p><h4 id="æ‰§è¡Œå™¨"><a href="#æ‰§è¡Œå™¨" class="headerlink" title="æ‰§è¡Œå™¨"></a>æ‰§è¡Œå™¨</h4><p>åˆ†æå™¨å‘Šè¯‰æˆ‘ä»¬æ”¹åšä»€ä¹ˆï¼Œä¼˜åŒ–å™¨å‘Šè¯‰æˆ‘ä»¬æ”¹æ€ä¹ˆåšï¼Œé‚£ä¹ˆæ‰§è¡Œå™¨å°±æ˜¯è¦å…·ä½“å»åšäº†</p><p>ä¸è¿‡å†æ‰§è¡Œä¹‹å‰æµ‹ç»˜åˆ¤æ–­ä¸€ä¸‹å½“å‰ç”¨æˆ·å¯¹SQLè¯­å¥æ¶‰åŠåˆ°çš„è¡¨æ˜¯å¦æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£è¾¹å°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ã€‚</p><p>å¦‚æœæœ‰æƒé™ï¼Œåˆ™æ‰“å¼€è¡¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œæ‰§è¡Œå™¨é€šè¿‡è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ï¼ˆå¦‚InnoDB)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">table</span> STATUS</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ordersInnoDB10Dynamic2081916384000212023-07-21 02:09:312023-07-21 02:10:01utf8mb4_0900_ai_ci</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ä¼šå±•ç¤ºå½“å‰è¡¨çš„ä¿¡æ¯, å…¶ä¸­InnoDB è¡¨ç¤ºè¿™å¼ è¡¨ä½¿ç”¨çš„å¼•æ“æ˜¯InnoDB.</p><p>å…·ä½“æŸ¥è¯¢è¡¨æ ¼çš„ç»†èŠ‚åç»­ä¼šå†è¯¦ç»†æè¿°ã€‚</p><h3 id="MySQLçš„å­˜å‚¨å¼•æ“"><a href="#MySQLçš„å­˜å‚¨å¼•æ“" class="headerlink" title="MySQLçš„å­˜å‚¨å¼•æ“"></a>MySQLçš„å­˜å‚¨å¼•æ“</h3><p>MySQLçš„å­˜å‚¨å¼•æ“æœ‰å¾ˆå¤šï¼Œæœ¬æ–‡åªç®€ç•¥ä»‹ç»å‡ ä¸ªå¸¸è§çš„ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šè¯¦ç»†ä»‹ç»ï¼Œåªæ˜¯ä¸ºäº†åšåˆ°æœ‰ä¸ªå°è±¡ã€‚</p><h4 id="InnoDBå­˜å‚¨å¼•æ“"><a href="#InnoDBå­˜å‚¨å¼•æ“" class="headerlink" title="InnoDBå­˜å‚¨å¼•æ“"></a>InnoDBå­˜å‚¨å¼•æ“</h4><p>InnoDBæ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡å‹å­˜å‚¨å¼•æ“ï¼Œé‡‡ç”¨MVCCæ”¯æŒé«˜å¹¶å‘ï¼Œå¹¶å®ç°äº†å››ä¸ªæ ‡å‡†çš„éš”ç¦»çº§åˆ«ã€‚å…¶é»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰ï¼Œå¹¶ä¸”é€šè¿‡é—´éš™é”ï¼ˆnext-key locking)ç­–ç•¥é˜²æ­¢å¹»è¯»çš„å‡ºç°ï¼Œé—´éš™é”ä½¿å¾—InnoDBä¸ä»…ä»…é”å®šæŸ¥è¯¢æ¶‰åŠçš„è¡Œï¼Œè¿˜ä¼šå¯¹ç´¢å¼•ä¸­çš„é—´éš™è¿›è¡Œé”å®šï¼Œä»¥é˜²æ­¢å¹»å½±è¡Œçš„æ’å…¥ã€‚</p><h4 id="MyISAMå­˜å‚¨å¼•æ“"><a href="#MyISAMå­˜å‚¨å¼•æ“" class="headerlink" title="MyISAMå­˜å‚¨å¼•æ“"></a>MyISAMå­˜å‚¨å¼•æ“</h4><p>å†MySQL5.1åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒMyISAMæ˜¯é»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚MyISAMæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€æ§ä»¶å‡½æ•°ï¼ˆGIS)ç­‰ï¼Œä½†MyISAMä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œè€Œä¸”å†å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚</p><p>ç°åœ¨MySQLé»˜è®¤å¼•æ“å·²ç»æ˜¯InnoDBï¼Œæ‰€ä»¥MyISAMå°±ä¸è¿‡å¤šè®¨è®ºäº†ï¼Œéœ€è¦çŸ¥é“çš„æ˜¯MyISAMä¸æ”¯æŒäº‹åŠ¡ï¼Œå¹¶ä¸”åªæ”¯æŒè¡¨é”ã€‚</p><h4 id="Memoryå¼•æ“"><a href="#Memoryå¼•æ“" class="headerlink" title="Memoryå¼•æ“"></a>Memoryå¼•æ“</h4><p>ç±»ä¼¼äºRedis,Memoryå¼•æ“æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½ä¿å­˜å†å†…å­˜ä¸­ï¼Œå› è€ŒæŸ¥è¯¢é€Ÿåº¦å¾ˆå¿«ï¼Œå› ä¸ºå­˜å‚¨å†å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ•°æ®å†æœºå™¨é‡å¯åä¼šä¸¢å¤±ï¼Œä½†æ˜¯è¡¨ç»“æ„ä¼šä¿ç•™ã€‚</p><p>å½“æ‰§è¡ŒMySQLæŸ¥è¯¢æ—¶éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼Œè¿™æ—¶å€™ä½¿ç”¨çš„ä¸´æ—¶è¡¨å°±æ˜¯Memoryè¡¨ï¼Œä¸è¿‡å½“ç»“æœå¤ªå¤§è¶…å‡ºMemoryè¡¨é™åˆ¶æˆ–è€…å«æœ‰BLOBæˆ–è€…TEXTå­—æ®µï¼Œä¸´æ—¶è¡¨ä¼šè½¬æ¢ä½MyISAMè¡¨ã€‚</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>é€šè¿‡ä¸€æ¡SQLçš„æ‰§è¡Œæµç¨‹ï¼Œç®€ç•¥ä»‹ç»äº†MySQLä¸­çš„å†…éƒ¨ç»“æ„ç»„æˆï¼ŒåŒ…æ‹¬ è¿æ¥å™¨ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ã€å’ŒMySQLçš„å­˜å‚¨å¼•æ“ï¼Œæ–‡ç« ä¸»è¦è¿˜æ˜¯ç®€ç•¥ä»‹ç»ï¼Œåªæ˜¯ä¸ºäº†æœ‰ä¸ªæ•´ä½“çš„æ¦‚å¿µï¼Œç›¸å…³ç»†èŠ‚å¾…åç»­è¡¥å……</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://funnylog.gitee.io/mysql45/">æ—æ™“æ–Œ-æå®¢æ—¶é—´MySQL45è®²</a></p><p>ã€Šé«˜æ€§èƒ½MySQLã€‹</p><p>ã€ŠMySQLæŠ€æœ¯å†…å¹•-InnoDBå­˜å‚¨å¼•æ“ã€‹</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="MySQL" scheme="https://nerkeler.github.io/categories/MySQL/"/>
    
    
    <category term="MySQL" scheme="https://nerkeler.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>JWTè¯¦è§£</title>
    <link href="https://nerkeler.github.io/2023/06/27/JWT%E8%AF%A6%E8%A7%A3/"/>
    <id>https://nerkeler.github.io/2023/06/27/JWT%E8%AF%A6%E8%A7%A3/</id>
    <published>2023-06-27T05:55:00.000Z</published>
    <updated>2023-06-27T06:36:55.474Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="JWTè¯¦è§£"><a href="#JWTè¯¦è§£" class="headerlink" title="JWTè¯¦è§£"></a>JWTè¯¦è§£</h1><p><strong>è½¬è½½è‡ªï¼š<a href="https://baobao555.tech/archives/40">JWTè¯¦è§£ (baobao555.tech)</a></strong>*</p><h2 id="JWTç®€ä»‹"><a href="#JWTç®€ä»‹" class="headerlink" title="JWTç®€ä»‹"></a>JWTç®€ä»‹</h2><h2 id="1-ä»€ä¹ˆæ˜¯JWT"><a href="#1-ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="1.ä»€ä¹ˆæ˜¯JWT"></a>1.ä»€ä¹ˆæ˜¯JWT</h2><p>åœ¨ä»‹ç»JWTä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹åˆ©ç”¨<code>token</code>è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯çš„æµç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¯·æ±‚ç™»å½•</li><li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼ŒéªŒè¯ç”¨æˆ·åå’Œå¯†ç </li><li>éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç­¾å‘ä¸€ä¸ª<code>token</code>ï¼Œå†æŠŠè¿™ä¸ª<code>token</code>è¿”å›ç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯æ”¶åˆ°tokenåå¯ä»¥æŠŠå®ƒå­˜å‚¨èµ·æ¥ï¼Œæ¯”å¦‚æ”¾åˆ°cookieä¸­</li><li>å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºæ—¶éœ€è¦æºå¸¦æœåŠ¡ç«¯ç­¾å‘çš„tokenï¼Œå¯ä»¥åœ¨<code>cookie</code>æˆ–è€…<code>header</code>ä¸­æºå¸¦</li><li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå»éªŒè¯å®¢æˆ·ç«¯è¯·æ±‚é‡Œé¢å¸¦ç€çš„<code>token</code>ï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›è¯·æ±‚æ•°æ®</li></ol><p> è¿™ç§åŸºäº<code>token</code>çš„è®¤è¯æ–¹å¼ç›¸æ¯”ä¼ ç»Ÿçš„<code>session</code>è®¤è¯æ–¹å¼æ›´èŠ‚çº¦æœåŠ¡å™¨èµ„æºï¼Œå¹¶ä¸”å¯¹ç§»åŠ¨ç«¯å’Œåˆ†å¸ƒå¼æ›´åŠ å‹å¥½ã€‚å…¶ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p><ul><li><code>æ”¯æŒè·¨åŸŸè®¿é—®</code>ï¼š<code>cookie</code>æ˜¯æ— æ³•è·¨åŸŸçš„ï¼Œè€Œ<code>token</code>ç”±äºæ²¡æœ‰ç”¨åˆ°<code>cookie</code>(å‰ææ˜¯å°†<code>token</code>æ”¾åˆ°è¯·æ±‚å¤´ä¸­)ï¼Œæ‰€ä»¥è·¨åŸŸåä¸ä¼šå­˜åœ¨ä¿¡æ¯ä¸¢å¤±é—®é¢˜</li><li><code>æ— çŠ¶æ€</code>ï¼š<code>token</code>æœºåˆ¶åœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨<code>session</code>ä¿¡æ¯ï¼Œå› ä¸ºtokenè‡ªèº«åŒ…å«äº†æ‰€æœ‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥å‡è½»æœåŠ¡ç«¯å‹åŠ›</li><li><code>æ›´é€‚ç”¨CDN</code>ï¼šå¯ä»¥é€šè¿‡å†…å®¹åˆ†å‘ç½‘ç»œè¯·æ±‚æœåŠ¡ç«¯çš„æ‰€æœ‰èµ„æ–™</li><li><code>æ›´é€‚ç”¨äºç§»åŠ¨ç«¯</code>ï¼šå½“å®¢æˆ·ç«¯æ˜¯éæµè§ˆå™¨å¹³å°æ—¶ï¼Œ<code>cookie</code>æ˜¯ä¸è¢«æ”¯æŒçš„ï¼Œæ­¤æ—¶é‡‡ç”¨<code>token</code>è®¤è¯æ–¹å¼ä¼šç®€å•å¾ˆå¤š</li><li><code>æ— éœ€è€ƒè™‘CSRF</code>ï¼šç”±äºä¸å†ä¾èµ–<code>cookie</code>ï¼Œæ‰€ä»¥é‡‡ç”¨tokenè®¤è¯æ–¹å¼ä¸ä¼šå‘ç”ŸCSRFï¼Œæ‰€ä»¥ä¹Ÿå°±æ— éœ€è€ƒè™‘CSRFçš„é˜²å¾¡</li></ul><p> è€Œ<code>JWT</code>å°±æ˜¯ä¸Šè¿°æµç¨‹å½“ä¸­<code>token</code>çš„ä¸€ç§å…·ä½“å®ç°æ–¹å¼ï¼Œå…¶å…¨ç§°æ˜¯<code>JSON Web Token</code>ï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://jwt.io/">https://jwt.io/</a></p><p> é€šä¿—åœ°è¯´ï¼Œ<code>JWTçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</code>ï¼Œå®ƒæ˜¯å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªJsonå­—ç¬¦ä¸²ä¸­ï¼Œç„¶åè¿›è¡Œç¼–ç åå¾—åˆ°ä¸€ä¸ª<code>JWT token</code>ï¼Œ<code>å¹¶ä¸”è¿™ä¸ªJWT tokenå¸¦æœ‰ç­¾åä¿¡æ¯ï¼Œæ¥æ”¶åå¯ä»¥æ ¡éªŒæ˜¯å¦è¢«ç¯¡æ”¹</code>ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°å°†ä¿¡æ¯ä½œä¸ºJsonå¯¹è±¡ä¼ è¾“ã€‚JWTçš„è®¤è¯æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>é¦–å…ˆï¼Œå‰ç«¯é€šè¿‡Webè¡¨å•å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°åç«¯çš„æ¥å£ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ª<code>POST</code>è¯·æ±‚ã€‚å»ºè®®çš„æ–¹å¼æ˜¯é€šè¿‡SSLåŠ å¯†çš„ä¼ è¾“(HTTPS)ï¼Œä»è€Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å—…æ¢</li><li>åç«¯æ ¸å¯¹ç”¨æˆ·åå’Œå¯†ç æˆåŠŸåï¼Œ<code>å°†åŒ…å«ç”¨æˆ·ä¿¡æ¯çš„æ•°æ®ä½œä¸ºJWTçš„Payloadï¼Œå°†å…¶ä¸JWT Headeråˆ†åˆ«è¿›è¡ŒBase64ç¼–ç æ‹¼æ¥åç­¾å</code>ï¼Œå½¢æˆä¸€ä¸ª<code>JWT Token</code>ï¼Œå½¢æˆçš„<code>JWT Token</code>å°±æ˜¯ä¸€ä¸ªå¦‚åŒ<code>lll.zzz.xxx</code>çš„å­—ç¬¦ä¸²</li><li>åç«¯å°†<code>JWT Token</code>å­—ç¬¦ä¸²ä½œä¸ºç™»å½•æˆåŠŸçš„ç»“æœè¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼Œé€€å‡ºç™»å½•æ—¶åˆ é™¤ä¿å­˜çš„<code>JWT Token</code>å³å¯</li><li><code>å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWT Tokenæ”¾å…¥HTTPè¯·æ±‚å¤´ä¸­çš„Authorizationå±æ€§ä¸­</code>(è§£å†³XSSå’ŒXSRFé—®é¢˜)</li><li>åç«¯æ£€æŸ¥å‰ç«¯ä¼ è¿‡æ¥çš„<code>JWT Token</code>ï¼ŒéªŒè¯å…¶æœ‰æ•ˆæ€§ï¼Œæ¯”å¦‚æ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ã€æ˜¯å¦è¿‡æœŸã€tokençš„æ¥æ”¶æ–¹æ˜¯å¦æ˜¯è‡ªå·±ç­‰ç­‰</li><li>éªŒè¯é€šè¿‡åï¼Œåç«¯è§£æå‡º<code>JWT Token</code>ä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œ(ä¸€èˆ¬æ˜¯æ ¹æ®ç”¨æˆ·ä¿¡æ¯å¾—åˆ°æƒé™ç­‰)ï¼Œè¿”å›ç»“æœ</li></ol><p> <img src="https://pic.imgdb.cn/item/649a7ae81ddac507cca6ac94.png"></p><h2 id="2-ä¸ºä»€ä¹ˆè¦ç”¨JWT"><a href="#2-ä¸ºä»€ä¹ˆè¦ç”¨JWT" class="headerlink" title="2.ä¸ºä»€ä¹ˆè¦ç”¨JWT"></a>2.ä¸ºä»€ä¹ˆè¦ç”¨JWT</h2><h3 id="2-1-ä¼ ç»ŸSessionè®¤è¯çš„å¼Šç«¯"><a href="#2-1-ä¼ ç»ŸSessionè®¤è¯çš„å¼Šç«¯" class="headerlink" title="2.1 ä¼ ç»ŸSessionè®¤è¯çš„å¼Šç«¯"></a>2.1 ä¼ ç»ŸSessionè®¤è¯çš„å¼Šç«¯</h3><p> æˆ‘ä»¬çŸ¥é“<code>HTTPæœ¬èº«æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®</code>ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœç”¨æˆ·å‘æˆ‘ä»¬çš„åº”ç”¨æä¾›äº†ç”¨æˆ·åå’Œå¯†ç æ¥è¿›è¡Œç”¨æˆ·è®¤è¯ï¼Œè®¤è¯é€šè¿‡åHTTPåè®®ä¸ä¼šè®°å½•ä¸‹è®¤è¯åçš„çŠ¶æ€ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œç”¨æˆ·è¿˜è¦å†ä¸€æ¬¡è¿›è¡Œè®¤è¯ï¼Œå› ä¸ºæ ¹æ®HTTPåè®®ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæ‰€ä»¥ä¸ºäº†è®©æˆ‘ä»¬çš„åº”ç”¨èƒ½è¯†åˆ«æ˜¯å“ªä¸ªç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªèƒ½åœ¨ç”¨æˆ·é¦–æ¬¡ç™»å½•æˆåŠŸåï¼Œåœ¨æœåŠ¡å™¨å­˜å‚¨ä¸€ä»½ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ï¼Œè¿™ä»½ç™»å½•ä¿¡æ¯ä¼šåœ¨å“åº”æ—¶ä¼ é€’ç»™æµè§ˆå™¨ï¼Œå‘Šè¯‰å…¶ä¿å­˜ä¸º<code>cookie</code>ï¼Œä»¥ä¾¿ä¸‹æ¬¡è¯·æ±‚æ—¶å‘é€ç»™æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨å°±èƒ½è¯†åˆ«è¯·æ±‚æ¥è‡ªå“ªä¸ªç”¨æˆ·äº†ï¼Œè¿™æ˜¯ä¼ ç»Ÿçš„åŸºäº<code>session</code>è®¤è¯çš„è¿‡ç¨‹</p><p> <img src="https://pic.imgdb.cn/item/649a7b711ddac507cca7e1c3.png"></p><p> ç„¶è€Œï¼Œä¼ ç»Ÿçš„<code>session</code>è®¤è¯æœ‰å¦‚ä¸‹çš„é—®é¢˜ï¼š</p><ul><li>æ¯ä¸ªç”¨æˆ·çš„ç™»å½•ä¿¡æ¯éƒ½ä¼šä¿å­˜åˆ°æœåŠ¡å™¨çš„<code>session</code>ä¸­ï¼Œ<code>éšç€ç”¨æˆ·çš„å¢å¤šï¼ŒæœåŠ¡å™¨å¼€é”€ä¼šæ˜æ˜¾å¢å¤§</code></li><li>ç”±äº<code>session</code>æ˜¯å­˜åœ¨ä¸æœåŠ¡å™¨çš„ç‰©ç†å†…å­˜ä¸­ï¼Œæ‰€ä»¥<code>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™ç§æ–¹å¼å°†ä¼šå¤±æ•ˆ</code>ã€‚è™½ç„¶å¯ä»¥å°†<code>session</code>ç»Ÿä¸€ä¿å­˜åˆ°Redisä¸­ï¼Œä½†æ˜¯è¿™æ ·åšæ— ç–‘å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œå¯¹äºä¸éœ€è¦redisçš„åº”ç”¨ä¹Ÿä¼šç™½ç™½å¤šå¼•å…¥ä¸€ä¸ªç¼“å­˜ä¸­é—´ä»¶</li><li><code>å¯¹äºéæµè§ˆå™¨çš„å®¢æˆ·ç«¯ã€æ‰‹æœºç§»åŠ¨ç«¯ç­‰ä¸é€‚ç”¨</code>ï¼Œå› ä¸º<code>session</code>ä¾èµ–äº<code>cookie</code>ï¼Œè€Œç§»åŠ¨ç«¯ç»å¸¸æ²¡æœ‰<code>cookie</code></li><li>å› ä¸º<code>session</code>è®¤è¯æœ¬è´¨åŸºäº<code>cookie</code>ï¼Œæ‰€ä»¥å¦‚æœ<code>cookie</code>è¢«æˆªè·ï¼Œç”¨æˆ·å¾ˆå®¹æ˜“æ”¶åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»ã€‚å¹¶ä¸”å¦‚æœæµè§ˆå™¨ç¦ç”¨äº†<code>cookie</code>ï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šå¤±æ•ˆ</li><li>å‰åç«¯åˆ†ç¦»ç³»ç»Ÿä¸­æ›´åŠ ä¸é€‚ç”¨ï¼Œåç«¯éƒ¨ç½²å¤æ‚ï¼Œå‰ç«¯å‘é€çš„è¯·æ±‚å¾€å¾€ç»è¿‡å¤šä¸ªä¸­é—´ä»¶åˆ°è¾¾åç«¯ï¼Œ<code>cookie</code>ä¸­å…³äº<code>session</code>çš„ä¿¡æ¯ä¼šè½¬å‘å¤šæ¬¡</li><li>ç”±äºåŸºäºCookieï¼Œè€Œ<code>cookieæ— æ³•è·¨åŸŸï¼Œæ‰€ä»¥sessionçš„è®¤è¯ä¹Ÿæ— æ³•è·¨åŸŸï¼Œå¯¹å•ç‚¹ç™»å½•ä¸é€‚ç”¨</code></li></ul><h3 id="2-2-JWTè®¤è¯çš„ä¼˜åŠ¿"><a href="#2-2-JWTè®¤è¯çš„ä¼˜åŠ¿" class="headerlink" title="2.2 JWTè®¤è¯çš„ä¼˜åŠ¿"></a>2.2 JWTè®¤è¯çš„ä¼˜åŠ¿</h3><p> å¯¹æ¯”ä¼ ç»Ÿçš„<code>session</code>è®¤è¯æ–¹å¼ï¼ŒJWTçš„ä¼˜åŠ¿æ˜¯ï¼š</p><ul><li>ç®€æ´ï¼š<code>JWT Token</code>æ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦ä¹Ÿå¾ˆå¿«</li><li>å› ä¸ºJWT Tokenæ˜¯ä»¥JSONåŠ å¯†å½¢å¼ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥JWTæ˜¯<code>è·¨è¯­è¨€</code>çš„ï¼ŒåŸåˆ™ä¸Šä»»ä½•webå½¢å¼éƒ½æ”¯æŒ</li><li>ä¸éœ€è¦åœ¨æœåŠ¡ç«¯ä¿å­˜ä¼šè¯ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´<code>ä¸ä¾èµ–äºcookieå’Œsessionï¼Œæ‰€ä»¥æ²¡æœ‰äº†ä¼ ç»Ÿsessionè®¤è¯çš„å¼Šç«¯ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼å¾®æœåŠ¡</code></li><li><code>å•ç‚¹ç™»å½•å‹å¥½</code>ï¼šä½¿ç”¨Sessionè¿›è¡Œèº«ä»½è®¤è¯çš„è¯ï¼Œç”±äºcookieæ— æ³•è·¨åŸŸï¼Œéš¾ä»¥å®ç°å•ç‚¹ç™»å½•ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨tokenè¿›è¡Œè®¤è¯çš„è¯ï¼Œ <code>tokenå¯ä»¥è¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ä»»æ„ä½ç½®çš„å†…å­˜ä¸­ï¼Œä¸ä¸€å®šæ˜¯cookieï¼Œæ‰€ä»¥ä¸ä¾èµ–cookie</code>ï¼Œä¸ä¼šå­˜åœ¨è¿™äº›é—®é¢˜</li><li><code>é€‚åˆç§»åŠ¨ç«¯åº”ç”¨</code>ï¼šä½¿ç”¨Sessionè¿›è¡Œèº«ä»½è®¤è¯çš„è¯ï¼Œéœ€è¦ä¿å­˜ä¸€ä»½ä¿¡æ¯åœ¨æœåŠ¡å™¨ç«¯ï¼Œè€Œä¸”è¿™ç§æ–¹å¼ä¼šä¾èµ–åˆ°Cookieï¼ˆéœ€è¦ Cookie ä¿å­˜ SessionIdï¼‰ï¼Œæ‰€ä»¥ä¸é€‚åˆç§»åŠ¨ç«¯</li></ul><p>  å› ä¸ºè¿™äº›ä¼˜åŠ¿ï¼Œç›®å‰æ— è®ºå•ä½“åº”ç”¨è¿˜æ˜¯åˆ†å¸ƒå¼åº”ç”¨ï¼Œéƒ½æ›´åŠ <code>æ¨èç”¨JWT tokençš„æ–¹å¼è¿›è¡Œç”¨æˆ·è®¤è¯</code></p><h2 id="JWTç»“æ„"><a href="#JWTç»“æ„" class="headerlink" title="JWTç»“æ„"></a>JWTç»“æ„</h2><p> JWTç”±3éƒ¨åˆ†ç»„æˆï¼šæ ‡å¤´(Header)ã€æœ‰æ•ˆè½½è·(Payload)å’Œç­¾å(Signature)ã€‚åœ¨ä¼ è¾“çš„æ—¶å€™ï¼Œä¼šå°†JWTçš„3éƒ¨åˆ†åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç åç”¨<code>.</code>è¿›è¡Œè¿æ¥å½¢æˆæœ€ç»ˆä¼ è¾“çš„å­—ç¬¦ä¸²</p><p> <code>JWTString\=Base64(Header).Base64(Payload).HMACSHA256(base64UrlEncode(header)+&quot;.&quot;+base64UrlEncode(payload),secret)</code></p><p> <code>JWTString = Base64(Header).Base64(Payload).HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret)</code></p><p> <img src="https://pic.imgdb.cn/item/649a7bd41ddac507cca8a236.png"></p><h3 id="1-Header"><a href="#1-Header" class="headerlink" title="1.Header"></a>1.Header</h3><p> <code>JWTå¤´</code>æ˜¯ä¸€ä¸ªæè¿°JWTå…ƒæ•°æ®çš„JSONå¯¹è±¡ï¼Œalgå±æ€§è¡¨ç¤ºç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºHMAC SHA256ï¼ˆå†™ä¸ºHS256ï¼‰ï¼›typå±æ€§è¡¨ç¤ºä»¤ç‰Œçš„ç±»å‹ï¼ŒJWTä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚æœ€åï¼Œä½¿ç”¨Base64 URLç®—æ³•å°†ä¸Šè¿°JSONå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¿å­˜</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-Payload"><a href="#2-Payload" class="headerlink" title="2.Payload"></a>2.Payload</h3><p> <code>æœ‰æ•ˆè½½è·</code>éƒ¨åˆ†ï¼Œæ˜¯JWTçš„ä¸»ä½“å†…å®¹éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª<code>JSONå¯¹è±¡</code>ï¼ŒåŒ…å«éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚ JWTæŒ‡å®šä¸ƒä¸ªé»˜è®¤å­—æ®µä¾›é€‰æ‹©</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">issï¼šå‘è¡Œäºº</span><br><span class="line">expï¼šåˆ°æœŸæ—¶é—´</span><br><span class="line">subï¼šä¸»é¢˜</span><br><span class="line">audï¼šç”¨æˆ·</span><br><span class="line">nbfï¼šåœ¨æ­¤ä¹‹å‰ä¸å¯ç”¨</span><br><span class="line">iatï¼šå‘å¸ƒæ—¶é—´</span><br><span class="line">jtiï¼šJWT IDç”¨äºæ ‡è¯†è¯¥JWT</span><br></pre></td></tr></table></figure><p> é™¤ä»¥ä¸Šé»˜è®¤å­—æ®µå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç§æœ‰å­—æ®µï¼Œ<code>ä¸€èˆ¬ä¼šæŠŠåŒ…å«ç”¨æˆ·ä¿¡æ¯çš„æ•°æ®æ”¾åˆ°payloadä¸­</code>ï¼Œå¦‚ä¸‹ä¾‹ï¼š</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Helen&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>  è¯·æ³¨æ„ï¼Œ<code>é»˜è®¤æƒ…å†µä¸‹JWTæ˜¯æœªåŠ å¯†çš„ï¼Œå› ä¸ºåªæ˜¯é‡‡ç”¨base64ç®—æ³•ï¼Œæ‹¿åˆ°JWTå­—ç¬¦ä¸²åå¯ä»¥è½¬æ¢å›åŸæœ¬çš„JSONæ•°æ®ï¼Œä»»ä½•äººéƒ½å¯ä»¥è§£è¯»å…¶å†…å®¹ï¼Œå› æ­¤ä¸è¦æ„å»ºéšç§ä¿¡æ¯å­—æ®µï¼Œæ¯”å¦‚ç”¨æˆ·çš„å¯†ç ä¸€å®šä¸èƒ½ä¿å­˜åˆ°JWTä¸­</code>ï¼Œä»¥é˜²æ­¢ä¿¡æ¯æ³„éœ²ã€‚<code>JWTåªæ˜¯é€‚åˆåœ¨ç½‘ç»œä¸­ä¼ è¾“ä¸€äº›éæ•æ„Ÿçš„ä¿¡æ¯</code></p><h3 id="3-Signature"><a href="#3-Signature" class="headerlink" title="3.Signature"></a>3.Signature</h3><p> <code>ç­¾åå“ˆå¸Œ</code>éƒ¨åˆ†æ˜¯å¯¹ä¸Šé¢ä¸¤éƒ¨åˆ†æ•°æ®ç­¾åï¼Œéœ€è¦ä½¿ç”¨base64ç¼–ç åçš„headerå’Œpayloadæ•°æ®ï¼Œé€šè¿‡æŒ‡å®šçš„ç®—æ³•ç”Ÿæˆå“ˆå¸Œï¼Œä»¥<code>ç¡®ä¿æ•°æ®ä¸ä¼šè¢«ç¯¡æ”¹</code>ã€‚é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚è¯¥å¯†ç ä»…ä»…ä¸ºä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä¸”ä¸èƒ½å‘ç”¨æˆ·å…¬å¼€ã€‚ç„¶åï¼Œä½¿ç”¨headerä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸ºHMAC SHA256ï¼‰æ ¹æ®ä»¥ä¸‹å…¬å¼ç”Ÿæˆç­¾å</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header)+<span class="string">&quot;.&quot;</span>+base64UrlEncode(payload),secret)HMACSHA256(base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> + base64UrlEncode(payload), secret)</span><br></pre></td></tr></table></figure><p> åœ¨è®¡ç®—å‡ºç­¾åå“ˆå¸Œåï¼ŒJWTå¤´ï¼Œæœ‰æ•ˆè½½è·å’Œç­¾åå“ˆå¸Œçš„ä¸‰ä¸ªéƒ¨åˆ†ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”¨<code>.</code>åˆ†éš”ï¼Œå°±æ„æˆæ•´ä¸ªJWTå¯¹è±¡</p><p> <img src="https://pic.imgdb.cn/item/649a7d5d1ddac507ccab799f.png"></p><p>  æ³¨æ„JWTæ¯éƒ¨åˆ†çš„ä½œç”¨ï¼Œåœ¨æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„JWT tokenä¹‹åï¼š</p><ul><li><code>header</code>å’Œ<code>payload</code>å¯ä»¥ç›´æ¥åˆ©ç”¨base64è§£ç å‡ºåŸæ–‡ï¼Œä»<code>header</code>ä¸­è·å–å“ˆå¸Œç­¾åçš„ç®—æ³•ï¼Œä»<code>payload</code>ä¸­è·å–æœ‰æ•ˆæ•°æ®</li><li><code>signature</code>ç”±äºä½¿ç”¨äº†ä¸å¯é€†çš„åŠ å¯†ç®—æ³•ï¼Œæ— æ³•è§£ç å‡ºåŸæ–‡ï¼Œå®ƒçš„ä½œç”¨æ˜¯<code>æ ¡éªŒtokenæœ‰æ²¡æœ‰è¢«ç¯¡æ”¹</code>ã€‚æœåŠ¡ç«¯è·å–<code>header</code>ä¸­çš„åŠ å¯†ç®—æ³•ä¹‹åï¼Œåˆ©ç”¨è¯¥ç®—æ³•åŠ ä¸Š<code>secretKey</code>å¯¹<code>header</code>ã€<code>payload</code>è¿›è¡ŒåŠ å¯†ï¼Œæ¯”å¯¹åŠ å¯†åçš„æ•°æ®å’Œå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ˜¯å¦ä¸€è‡´ã€‚æ³¨æ„<code>secretKey</code>åªèƒ½ä¿å­˜åœ¨æœåŠ¡ç«¯ï¼Œè€Œä¸”å¯¹äºä¸åŒçš„åŠ å¯†ç®—æ³•å…¶å«ä¹‰æœ‰æ‰€ä¸åŒï¼Œä¸€èˆ¬å¯¹äºMD5ç±»å‹çš„æ‘˜è¦åŠ å¯†ç®—æ³•ï¼Œ<code>secretKey</code>å®é™…ä¸Šä»£è¡¨çš„æ˜¯ç›å€¼</li></ul><h2 id="JWTçš„ç§ç±»"><a href="#JWTçš„ç§ç±»" class="headerlink" title="JWTçš„ç§ç±»"></a>JWTçš„ç§ç±»</h2><p> å…¶å®JWT(JSON Web Token)æŒ‡çš„æ˜¯ä¸€ç§è§„èŒƒï¼Œè¿™ç§è§„èŒƒå…è®¸æˆ‘ä»¬ä½¿ç”¨JWTåœ¨ä¸¤ä¸ªç»„ç»‡ä¹‹é—´ä¼ é€’å®‰å…¨å¯é çš„ä¿¡æ¯ï¼ŒJWTçš„å…·ä½“å®ç°å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><code>nonsecure JWT</code>ï¼šæœªç»è¿‡ç­¾åï¼Œä¸å®‰å…¨çš„JWT</li><li><code>JWS</code>ï¼šç»è¿‡ç­¾åçš„JWT</li><li><code>JWE</code>ï¼š<code>payload</code>éƒ¨åˆ†ç»è¿‡åŠ å¯†çš„JWT</li></ul><h2 id="1-nonsecure-JWT"><a href="#1-nonsecure-JWT" class="headerlink" title="1.nonsecure JWT"></a>1.nonsecure JWT</h2><p> æœªç»è¿‡ç­¾åï¼Œä¸å®‰å…¨çš„JWTã€‚å…¶<code>header</code>éƒ¨åˆ†æ²¡æœ‰æŒ‡å®šç­¾åç®—æ³•{</p> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p> å¹¶ä¸”ä¹Ÿæ²¡æœ‰<code>Signature</code>éƒ¨åˆ†</p><h2 id="2-JWS"><a href="#2-JWS" class="headerlink" title="2.JWS"></a>2.JWS</h2><p> JWS ï¼Œä¹Ÿå°±æ˜¯JWT Signatureï¼Œå…¶ç»“æ„å°±æ˜¯åœ¨ä¹‹å‰nonsecure JWTçš„åŸºç¡€ä¸Šï¼Œåœ¨å¤´éƒ¨å£°æ˜ç­¾åç®—æ³•ï¼Œå¹¶åœ¨æœ€åæ·»åŠ ä¸Šç­¾åã€‚<code>åˆ›å»ºç­¾åï¼Œæ˜¯ä¿è¯jwtä¸èƒ½è¢«ä»–äººéšæ„ç¯¡æ”¹</code>ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„JWTä¸€èˆ¬éƒ½æ˜¯JWS</p><p> ä¸ºäº†å®Œæˆç­¾åï¼Œé™¤äº†ç”¨åˆ°headerä¿¡æ¯å’Œpayloadä¿¡æ¯å¤–ï¼Œè¿˜éœ€è¦ç®—æ³•çš„å¯†é’¥ï¼Œä¹Ÿå°±æ˜¯<code>secretKey</code>ã€‚åŠ å¯†çš„ç®—æ³•ä¸€èˆ¬æœ‰2ç±»ï¼š</p><ul><li>å¯¹ç§°åŠ å¯†ï¼š<code>secretKey</code>æŒ‡åŠ å¯†å¯†é’¥ï¼Œå¯ä»¥ç”Ÿæˆç­¾åä¸éªŒç­¾</li><li>éå¯¹ç§°åŠ å¯†ï¼š<code>secretKey</code>æŒ‡ç§é’¥ï¼Œåªç”¨æ¥ç”Ÿæˆç­¾åï¼Œä¸èƒ½ç”¨æ¥éªŒç­¾(éªŒç­¾ç”¨çš„æ˜¯å…¬é’¥)</li></ul><p> JWTçš„å¯†é’¥æˆ–è€…å¯†é’¥å¯¹ï¼Œä¸€èˆ¬ç»Ÿä¸€ç§°ä¸ºJSON Web Keyï¼Œä¹Ÿå°±æ˜¯<code>JWK</code></p><p> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œjwtçš„ç­¾åç®—æ³•æœ‰ä¸‰ç§ï¼š</p><ul><li>HMACã€å“ˆå¸Œæ¶ˆæ¯éªŒè¯ç (å¯¹ç§°)ã€‘ï¼šHS256&#x2F;HS384&#x2F;HS512</li><li>RSASSAã€RSAç­¾åç®—æ³•(éå¯¹ç§°)ã€‘ï¼ˆRS256&#x2F;RS384&#x2F;RS512ï¼‰</li><li>ECDSAã€æ¤­åœ†æ›²çº¿æ•°æ®ç­¾åç®—æ³•(éå¯¹ç§°)ã€‘ï¼ˆES256&#x2F;ES384&#x2F;ES512ï¼‰</li></ul><h2 id="Javaä¸­ä½¿ç”¨JWT"><a href="#Javaä¸­ä½¿ç”¨JWT" class="headerlink" title="Javaä¸­ä½¿ç”¨JWT"></a>Javaä¸­ä½¿ç”¨JWT</h2><p> å®˜ç½‘æ¨èäº†6ä¸ªJavaä½¿ç”¨JWTçš„å¼€æºåº“ï¼Œå…¶ä¸­æ¯”è¾ƒæ¨èä½¿ç”¨çš„æ˜¯<code>java-jwt</code>å’Œ<code>jjwt-root</code></p><p> <img src="https://pic.imgdb.cn/item/649a7dea1ddac507ccacef30.png"></p><h2 id="1-java-jwt"><a href="#1-java-jwt" class="headerlink" title="1.java-jwt"></a>1.java-jwt</h2><h3 id="1-1-å¯¹ç§°ç­¾å"><a href="#1-1-å¯¹ç§°ç­¾å" class="headerlink" title="1.1 å¯¹ç§°ç­¾å"></a>1.1 å¯¹ç§°ç­¾å</h3><p> é¦–å…ˆå¼•å…¥ä¾èµ–</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p> ç”ŸæˆJWTçš„token</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JWTTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerateToken</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// æŒ‡å®štokenè¿‡æœŸæ—¶é—´ä¸º10ç§’</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.add(Calendar.SECOND, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWT.create()</span><br><span class="line">                .withHeader(<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;())  <span class="comment">// Header</span></span><br><span class="line">                .withClaim(<span class="string">&quot;userId&quot;</span>, <span class="number">21</span>)  <span class="comment">// Payload</span></span><br><span class="line">                .withClaim(<span class="string">&quot;userName&quot;</span>, <span class="string">&quot;baobao&quot;</span>)</span><br><span class="line">                .withExpiresAt(calendar.getTime())  <span class="comment">// è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                .sign(Algorithm.HMAC256(<span class="string">&quot;!34ADAS&quot;</span>));  <span class="comment">// ç­¾åç”¨çš„secret</span></span><br><span class="line"></span><br><span class="line">        System.out.println(token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <img src="https://pic.imgdb.cn/item/649a7f5e1ddac507ccb0970f.png"></p><p>  æ³¨æ„<code>å¤šæ¬¡è¿è¡Œæ–¹æ³•ç”Ÿæˆçš„tokenå­—ç¬¦ä¸²å†…å®¹æ˜¯ä¸ä¸€æ ·çš„</code>ï¼Œå°½ç®¡æˆ‘ä»¬çš„payloadä¿¡æ¯æ²¡æœ‰å˜åŠ¨ã€‚å› ä¸º<code>JWTä¸­æºå¸¦äº†è¶…æ—¶æ—¶é—´</code>ï¼Œæ‰€ä»¥æ¯æ¬¡ç”Ÿæˆçš„tokenä¼šä¸ä¸€æ ·ï¼Œæˆ‘ä»¬åˆ©ç”¨base64è§£å¯†å·¥å…·å¯ä»¥å‘ç°payloadç¡®å®æºå¸¦äº†è¶…æ—¶æ—¶é—´</p><p>  <img src="https://pic.imgdb.cn/item/649a7f7c1ddac507ccb0c510.png"></p><p> è§£æJWTå­—ç¬¦ä¸²</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResolveToken</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºè§£æå¯¹è±¡ï¼Œä½¿ç”¨çš„ç®—æ³•å’Œsecretè¦ä¸åˆ›å»ºtokenæ—¶ä¿æŒä¸€è‡´</span></span><br><span class="line">    <span class="type">JWTVerifier</span> <span class="variable">jwtVerifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(<span class="string">&quot;!34ADAS&quot;</span>)).build();</span><br><span class="line">    <span class="comment">// è§£ææŒ‡å®šçš„token</span></span><br><span class="line">    <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> jwtVerifier.verify(<span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6ImJhb2JhbyIsImV4cCI6MTU5OTkyMjUyOCwidXNlcklkIjoyMX0.YhA3kh9KZOAb7om1C7o3vBhYp0f61mhQWWOoCrrhqvo&quot;</span>);</span><br><span class="line">    <span class="comment">// è·å–è§£æåçš„tokenä¸­çš„payloadä¿¡æ¯</span></span><br><span class="line">    <span class="type">Claim</span> <span class="variable">userId</span> <span class="operator">=</span> decodedJWT.getClaim(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">    <span class="type">Claim</span> <span class="variable">userName</span> <span class="operator">=</span> decodedJWT.getClaim(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    System.out.println(userId.asInt());</span><br><span class="line">    System.out.println(userName.asString());</span><br><span class="line">    <span class="comment">// è¾“å‡ºè¶…æ—¶æ—¶é—´</span></span><br><span class="line">    System.out.println(decodedJWT.getExpiresAt());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> è¿è¡Œåå‘ç°æŠ¥å¼‚å¸¸ï¼ŒåŸå› æ˜¯ä¹‹å‰ç”Ÿæˆçš„tokenå·²ç»è¿‡æœŸ</p><p> <img src="https://pic.imgdb.cn/item/649a7fae1ddac507ccb10252.png"></p><p> å†è¿è¡Œä¸€æ¬¡ç”Ÿæˆtokençš„æ–¹æ³•ï¼Œç„¶ååœ¨è¿‡æœŸæ—¶é—´10ç§’ä¹‹å†…å°†ç”Ÿæˆçš„å­—ç¬¦ä¸²æ‹·è´åˆ°è§£ææ–¹æ³•ä¸­ï¼Œè¿è¡Œè§£ææ–¹æ³•å³å¯æˆåŠŸ</p><p> <img src="https://pic.imgdb.cn/item/649a803a1ddac507ccb1deb3.png"></p><p> æˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°æ–¹æ³•å°è£…æˆå·¥å…·ç±»</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JWTUtils</span> &#123;</span><br><span class="line">    <span class="comment">// ç­¾åå¯†é’¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET</span> <span class="operator">=</span> <span class="string">&quot;!DAR$&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payload tokenæºå¸¦çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> tokenå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getToken</span><span class="params">(Map&lt;String,String&gt; payload)</span>&#123;</span><br><span class="line">        <span class="comment">// æŒ‡å®štokenè¿‡æœŸæ—¶é—´ä¸º7å¤©</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.add(Calendar.DATE, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">        JWTCreator.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> JWT.create();</span><br><span class="line">        <span class="comment">// æ„å»ºpayload</span></span><br><span class="line">        payload.forEach((k,v) -&gt; builder.withClaim(k,v));</span><br><span class="line">        <span class="comment">// æŒ‡å®šè¿‡æœŸæ—¶é—´å’Œç­¾åç®—æ³•</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> builder.withExpiresAt(calendar.getTime()).sign(Algorithm.HMAC256(SECRET));</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£ætoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token tokenå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è§£æåçš„token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DecodedJWT <span class="title function_">decode</span><span class="params">(String token)</span>&#123;</span><br><span class="line">        <span class="type">JWTVerifier</span> <span class="variable">jwtVerifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(SECRET)).build();</span><br><span class="line">        <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> jwtVerifier.verify(token);</span><br><span class="line">        <span class="keyword">return</span> decodedJWT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-2-éå¯¹ç§°ç­¾å"><a href="#1-2-éå¯¹ç§°ç­¾å" class="headerlink" title="1.2 éå¯¹ç§°ç­¾å"></a>1.2 éå¯¹ç§°ç­¾å</h3><p> ç”Ÿæˆjwtä¸²çš„æ—¶å€™éœ€è¦æŒ‡å®šç§é’¥ï¼Œè§£æjwtä¸²çš„æ—¶å€™éœ€è¦æŒ‡å®šå…¬é’¥</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RSA_PRIVATE_KEY</span> <span class="operator">=</span> <span class="string">&quot;...&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RSA_PUBLIC_KEY</span> <span class="operator">=</span> <span class="string">&quot;...&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payload tokenæºå¸¦çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> tokenå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getTokenRsa</span><span class="params">(Map&lt;String,String&gt; payload)</span>&#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®štokenè¿‡æœŸæ—¶é—´ä¸º7å¤©</span></span><br><span class="line">    <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">    calendar.add(Calendar.DATE, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">    JWTCreator.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> JWT.create();</span><br><span class="line">    <span class="comment">// æ„å»ºpayload</span></span><br><span class="line">    payload.forEach((k,v) -&gt; builder.withClaim(k,v));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ©ç”¨hutoolåˆ›å»ºRSA</span></span><br><span class="line">    <span class="type">RSA</span> <span class="variable">rsa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RSA</span>(RSA_PRIVATE_KEY, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// è·å–ç§é’¥</span></span><br><span class="line">    <span class="type">RSAPrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> (RSAPrivateKey) rsa.getPrivateKey();</span><br><span class="line">    <span class="comment">// ç­¾åæ—¶ä¼ å…¥ç§é’¥</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> builder.withExpiresAt(calendar.getTime()).sign(Algorithm.RSA256(<span class="literal">null</span>, privateKey));</span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£ætoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token tokenå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è§£æåçš„token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> DecodedJWT <span class="title function_">decodeRsa</span><span class="params">(String token)</span>&#123;</span><br><span class="line">    <span class="comment">// åˆ©ç”¨hutoolåˆ›å»ºRSA</span></span><br><span class="line">    <span class="type">RSA</span> <span class="variable">rsa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RSA</span>(<span class="literal">null</span>, RSA_PUBLIC_KEY);</span><br><span class="line">    <span class="comment">// è·å–RSAå…¬é’¥</span></span><br><span class="line">    <span class="type">RSAPublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> (RSAPublicKey) rsa.getPublicKey();</span><br><span class="line">    <span class="comment">// éªŒç­¾æ—¶ä¼ å…¥å…¬é’¥</span></span><br><span class="line">    <span class="type">JWTVerifier</span> <span class="variable">jwtVerifier</span> <span class="operator">=</span> JWT.require(Algorithm.RSA256(publicKey, <span class="literal">null</span>)).build();</span><br><span class="line">    <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> jwtVerifier.verify(token);</span><br><span class="line">    <span class="keyword">return</span> decodedJWT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-jjwt-root"><a href="#2-jjwt-root" class="headerlink" title="2.jjwt-root"></a>2.jjwt-root</h2><h3 id="2-1-å¯¹ç§°ç­¾å"><a href="#2-1-å¯¹ç§°ç­¾å" class="headerlink" title="2.1 å¯¹ç§°ç­¾å"></a>2.1 å¯¹ç§°ç­¾å</h3><p> å¼•å…¥ä¾èµ–</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p> ä½¿ç”¨æ–¹æ³•ç±»ä¼¼ï¼Œå¯å‚è€ƒä¸‹åˆ—ä»£ç </p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line">    <span class="comment">// tokenæ—¶æ•ˆï¼š24å°æ—¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">EXPIRE</span> <span class="operator">=</span> <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line">    <span class="comment">// ç­¾åå“ˆå¸Œçš„å¯†é’¥ï¼Œå¯¹äºä¸åŒçš„åŠ å¯†ç®—æ³•æ¥è¯´å«ä¹‰ä¸åŒ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APP_SECRET</span> <span class="operator">=</span> <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç”¨æˆ·idå’Œæ˜µç§°ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id  ç”¨æˆ·id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nickname ç”¨æˆ·æ˜µç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWTè§„åˆ™ç”Ÿæˆçš„token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getJwtToken</span><span class="params">(String id, String nickname)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">JwtToken</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">                .setSubject(<span class="string">&quot;baobao-user&quot;</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + EXPIRE))</span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, id)</span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, nickname)</span><br><span class="line">            <span class="comment">// HS256ç®—æ³•å®é™…ä¸Šå°±æ˜¯MD5åŠ ç›å€¼ï¼Œæ­¤æ—¶APP_SECRETå°±ä»£è¡¨ç›å€¼</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, APP_SECRET)</span><br><span class="line">                .compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken tokenå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœtokenæœ‰æ•ˆè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(String jwtToken)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request Httpè¯·æ±‚å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœtokenæœ‰æ•ˆè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä»httpè¯·æ±‚å¤´ä¸­è·å–tokenå­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®tokenè·å–ä¼šå‘˜id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request Httpè¯·æ±‚å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è§£ætokenåè·å¾—çš„ç”¨æˆ·id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> claimsJws.getBody();</span><br><span class="line">        <span class="keyword">return</span> (String)claims.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>  æ³¨æ„ï¼š</p><ul><li>jjwtåœ¨0.10ç‰ˆæœ¬ä»¥åå‘ç”Ÿäº†è¾ƒå¤§å˜åŒ–ï¼Œpomä¾èµ–è¦å¼•å…¥å¤šä¸ª</li></ul>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> <span class="comment">&lt;!-- or jjwt-gson if Gson is preferred --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>æ ‡å‡†è§„èŒƒä¸­å¯¹å„ç§åŠ å¯†ç®—æ³•çš„<code>secretKey</code>çš„é•¿åº¦æœ‰å¦‚ä¸‹è¦æ±‚ï¼š</p><ul><li><code>HS256</code>ï¼šè¦æ±‚è‡³å°‘ 256 bits (32 bytes)</li><li><code>HS384</code>ï¼šè¦æ±‚è‡³å°‘384 bits (48 bytes)</li><li><code>HS512</code>ï¼šè¦æ±‚è‡³å°‘512 bits (64 bytes)</li><li><code>RS256</code> and <code>PS256</code>ï¼šè‡³å°‘2048 bits</li><li><code>RS384</code> and <code>PS384</code>ï¼šè‡³å°‘3072 bits</li><li><code>RS512</code> and <code>PS512</code>ï¼šè‡³å°‘4096 bits</li><li><code>ES256</code>ï¼šè‡³å°‘256 bits (32 bytes)</li><li><code>ES384</code>ï¼šè‡³å°‘384 bits (48 bytes)</li><li><code>ES512</code>ï¼šè‡³å°‘512 bits (64 bytes)</li></ul><p>åœ¨jjwt0.10ç‰ˆæœ¬ä¹‹å‰ï¼Œæ²¡æœ‰å¼ºåˆ¶è¦æ±‚ï¼Œ<code>secretKey</code>é•¿åº¦ä¸æ»¡è¶³è¦æ±‚æ—¶ä¹Ÿå¯ä»¥ç­¾åæˆåŠŸã€‚ä½†æ˜¯0.10ç‰ˆæœ¬åå¼ºåˆ¶è¦æ±‚<code>secretKey</code>æ»¡è¶³è§„èŒƒä¸­çš„é•¿åº¦è¦æ±‚ï¼Œå¦åˆ™ç”Ÿæˆjwsæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸</p><p><img src="https://pic.imgdb.cn/item/649a818e1ddac507ccb3f812.png"></p></li><li><p>æ–°ç‰ˆæœ¬çš„jjwtä¸­ï¼Œä¹‹å‰çš„ç­¾åå’ŒéªŒç­¾æ–¹æ³•éƒ½æ˜¯ä¼ å…¥å¯†é’¥çš„å­—ç¬¦ä¸²ï¼Œå·²ç»è¿‡æ—¶ã€‚æœ€æ–°çš„æ–¹æ³•éœ€è¦ä¼ å…¥<code>Key</code>å¯¹è±¡</p></li></ul> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line">    <span class="comment">// tokenæ—¶æ•ˆï¼š24å°æ—¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">EXPIRE</span> <span class="operator">=</span> <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line">    <span class="comment">// ç­¾åå“ˆå¸Œçš„å¯†é’¥ï¼Œå¯¹äºä¸åŒçš„åŠ å¯†ç®—æ³•æ¥è¯´å«ä¹‰ä¸åŒ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APP_SECRET</span> <span class="operator">=</span> <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHOsdadasdasfdssfeweee&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç”¨æˆ·idå’Œæ˜µç§°ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id  ç”¨æˆ·id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nickname ç”¨æˆ·æ˜µç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWTè§„åˆ™ç”Ÿæˆçš„token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getJwtToken</span><span class="params">(String id, String nickname)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">JwtToken</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .setSubject(<span class="string">&quot;baobao-user&quot;</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + EXPIRE))</span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, id)</span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, nickname)</span><br><span class="line">                <span class="comment">// ä¼ å…¥Keyå¯¹è±¡</span></span><br><span class="line">                .signWith(Keys.hmacShaKeyFor(APP_SECRET.getBytes(StandardCharsets.UTF_8)), SignatureAlgorithm.HS256)</span><br><span class="line">                .compact();</span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken tokenå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœtokenæœ‰æ•ˆè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Jws&lt;Claims&gt; <span class="title function_">decode</span><span class="params">(String jwtToken)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¼ å…¥Keyå¯¹è±¡</span></span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parserBuilder().setSigningKey(Keys.hmacShaKeyFor(APP_SECRET.getBytes(StandardCharsets.UTF_8))).build().parseClaimsJws(jwtToken);</span><br><span class="line">        <span class="keyword">return</span> claimsJws;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-2-éå¯¹ç§°ç­¾å"><a href="#2-2-éå¯¹ç§°ç­¾å" class="headerlink" title="2.2 éå¯¹ç§°ç­¾å"></a>2.2 éå¯¹ç§°ç­¾å</h3><p> ç”Ÿæˆjwtä¸²çš„æ—¶å€™éœ€è¦æŒ‡å®šç§é’¥ï¼Œè§£æjwtä¸²çš„æ—¶å€™éœ€è¦æŒ‡å®šå…¬é’¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RSA_PRIVATE_KEY</span> <span class="operator">=</span> <span class="string">&quot;...&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RSA_PUBLIC_KEY</span> <span class="operator">=</span> <span class="string">&quot;...&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç”¨æˆ·idå’Œæ˜µç§°ç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id  ç”¨æˆ·id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nickname ç”¨æˆ·æ˜µç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWTè§„åˆ™ç”Ÿæˆçš„token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getJwtTokenRsa</span><span class="params">(String id, String nickname)</span>&#123;</span><br><span class="line">    <span class="comment">// åˆ©ç”¨hutoolåˆ›å»ºRSA</span></span><br><span class="line">    <span class="type">RSA</span> <span class="variable">rsa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RSA</span>(RSA_PRIVATE_KEY, <span class="literal">null</span>);</span><br><span class="line">    <span class="type">RSAPrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> (RSAPrivateKey) rsa.getPrivateKey();</span><br><span class="line">    <span class="type">String</span> <span class="variable">JwtToken</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">        .setSubject(<span class="string">&quot;baobao-user&quot;</span>)</span><br><span class="line">        .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">        .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + EXPIRE))</span><br><span class="line">        .claim(<span class="string">&quot;id&quot;</span>, id)</span><br><span class="line">        .claim(<span class="string">&quot;nickname&quot;</span>, nickname)</span><br><span class="line">        <span class="comment">// ç­¾åæŒ‡å®šç§é’¥</span></span><br><span class="line">        .signWith(privateKey, SignatureAlgorithm.RS256)</span><br><span class="line">        .compact();</span><br><span class="line">    <span class="keyword">return</span> JwtToken;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken tokenå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœtokenæœ‰æ•ˆè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Jws&lt;Claims&gt; <span class="title function_">decodeRsa</span><span class="params">(String jwtToken)</span> &#123;</span><br><span class="line">    <span class="type">RSA</span> <span class="variable">rsa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RSA</span>(<span class="literal">null</span>, RSA_PUBLIC_KEY);</span><br><span class="line">    <span class="type">RSAPublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> (RSAPublicKey) rsa.getPublicKey();</span><br><span class="line">    <span class="comment">// éªŒç­¾æŒ‡å®šå…¬é’¥</span></span><br><span class="line">    Jws&lt;Claims&gt; claimsJws = Jwts.parserBuilder().setSigningKey(publicKey).build().parseClaimsJws(jwtToken);</span><br><span class="line">    <span class="keyword">return</span> claimsJws;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å®é™…å¼€å‘ä¸­çš„åº”ç”¨"><a href="#å®é™…å¼€å‘ä¸­çš„åº”ç”¨" class="headerlink" title="å®é™…å¼€å‘ä¸­çš„åº”ç”¨"></a>å®é™…å¼€å‘ä¸­çš„åº”ç”¨</h2><p> åœ¨å®é™…çš„<code>SpringBoot</code>é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æµç¨‹åšç™»å½•ï¼š</p><ol><li>åœ¨ç™»å½•éªŒè¯é€šè¿‡åï¼Œç»™ç”¨æˆ·ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„éšæœºtoken(æ³¨æ„è¿™ä¸ªtokenä¸æ˜¯æŒ‡jwtï¼Œå¯ä»¥ç”¨uuidç­‰ç®—æ³•ç”Ÿæˆ)ï¼Œç„¶åå°†è¿™ä¸ªtokenä½œä¸ºkeyçš„ä¸€éƒ¨åˆ†ï¼Œç”¨æˆ·ä¿¡æ¯ä½œä¸ºvalueå­˜å…¥Redisï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å°±æ˜¯ç™»å½•å¤±æ•ˆçš„æ—¶é—´</li><li>å°†ç¬¬1æ­¥ä¸­ç”Ÿæˆçš„éšæœºtokenä½œä¸ºJWTçš„payloadç”ŸæˆJWTå­—ç¬¦ä¸²è¿”å›ç»™å‰ç«¯</li><li>å‰ç«¯ä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½åœ¨è¯·æ±‚å¤´ä¸­çš„<code>Authorization</code>å­—æ®µä¸­æºå¸¦JWTå­—ç¬¦ä¸²</li><li>åç«¯å®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ¯æ¬¡æ”¶åˆ°å‰ç«¯è¯·æ±‚æ—¶ï¼Œéƒ½å…ˆä»è¯·æ±‚å¤´ä¸­çš„<code>Authorization</code>å­—æ®µä¸­å–å‡ºJWTå­—ç¬¦ä¸²å¹¶è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åè§£æå‡ºpayloadä¸­çš„éšæœºtokenï¼Œç„¶åå†ç”¨è¿™ä¸ªéšæœºtokenå¾—åˆ°keyï¼Œä»Redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœèƒ½è·å–åˆ°å°±è¯´æ˜ç”¨æˆ·å·²ç»ç™»å½•</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JWTInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">JWT</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.æ ¡éªŒJWTå­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> JWTUtils.decode(JWT);</span><br><span class="line">            <span class="comment">// 2.å–å‡ºJWTå­—ç¬¦ä¸²è½½è·ä¸­çš„éšæœºtokenï¼Œä»Redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (SignatureVerificationException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ— æ•ˆç­¾å&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (TokenExpiredException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;tokenå·²ç»è¿‡æœŸ&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (AlgorithmMismatchException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç®—æ³•ä¸ä¸€è‡´&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;tokenæ— æ•ˆ&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>  åœ¨å®é™…å¼€å‘ä¸­éœ€è¦ç”¨ä¸‹åˆ—æ‰‹æ®µæ¥å¢åŠ JWTçš„å®‰å…¨æ€§ï¼š</p><ul><li>å› ä¸ºJWTæ˜¯åœ¨è¯·æ±‚å¤´ä¸­ä¼ é€’çš„ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…ç½‘ç»œåŠ«æŒï¼Œæ¨èä½¿ç”¨<code>HTTPS</code>æ¥ä¼ è¾“ï¼Œæ›´åŠ å®‰å…¨</li><li>JWTçš„å“ˆå¸Œç­¾åçš„å¯†é’¥æ˜¯å­˜æ”¾åœ¨æœåŠ¡ç«¯çš„ï¼Œæ‰€ä»¥åªè¦æœåŠ¡å™¨ä¸è¢«æ”»ç ´ï¼Œç†è®ºä¸ŠJWTæ˜¯å®‰å…¨çš„ã€‚å› æ­¤è¦ä¿è¯æœåŠ¡å™¨çš„å®‰å…¨</li><li>JWTå¯ä»¥ä½¿ç”¨æš´åŠ›ç©·ä¸¾æ¥ç ´è§£ï¼Œæ‰€ä»¥ä¸ºäº†åº”å¯¹è¿™ç§ç ´è§£æ–¹å¼ï¼Œå¯ä»¥å®šæœŸæ›´æ¢æœåŠ¡ç«¯çš„å“ˆå¸Œç­¾åå¯†é’¥(ç›¸å½“äºç›å€¼)ã€‚è¿™æ ·å¯ä»¥ä¿è¯ç­‰ç ´è§£ç»“æœå‡ºæ¥äº†ï¼Œä½ çš„å¯†é’¥ä¹Ÿå·²ç»æ¢äº†</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="è½¬è½½" scheme="https://nerkeler.github.io/tags/%E8%BD%AC%E8%BD%BD/"/>
    
    <category term="JWT" scheme="https://nerkeler.github.io/tags/JWT/"/>
    
  </entry>
  
  <entry>
    <title>EasyExcel æ•°å€¼å‹å’Œæœ€åä¸€åˆ—è¶…å‡ºæ–‡æœ¬æ¡†é—®é¢˜</title>
    <link href="https://nerkeler.github.io/2023/06/27/EasyExcel-%E6%95%B0%E5%80%BC%E5%9E%8B%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E5%88%97%E8%B6%85%E5%87%BA%E6%96%87%E6%9C%AC%E6%A1%86%E9%97%AE%E9%A2%98/"/>
    <id>https://nerkeler.github.io/2023/06/27/EasyExcel-%E6%95%B0%E5%80%BC%E5%9E%8B%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E5%88%97%E8%B6%85%E5%87%BA%E6%96%87%E6%9C%AC%E6%A1%86%E9%97%AE%E9%A2%98/</id>
    <published>2023-06-27T02:49:00.000Z</published>
    <updated>2023-06-27T02:50:43.728Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="EasyExcel-æ•°å€¼å‹å’Œæœ€åä¸€åˆ—è¶…å‡ºæ–‡æœ¬æ¡†é—®é¢˜"><a href="#EasyExcel-æ•°å€¼å‹å’Œæœ€åä¸€åˆ—è¶…å‡ºæ–‡æœ¬æ¡†é—®é¢˜" class="headerlink" title="EasyExcel æ•°å€¼å‹å’Œæœ€åä¸€åˆ—è¶…å‡ºæ–‡æœ¬æ¡†é—®é¢˜"></a>EasyExcel æ•°å€¼å‹å’Œæœ€åä¸€åˆ—è¶…å‡ºæ–‡æœ¬æ¡†é—®é¢˜</h1><p>Alibabaå‡ºå“çš„EasyExcelå¯¹æ¯”åŸç‰ˆexcelåº“POIï¼Œæå¤§çš„ç®€åŒ–äº†å¼€å‘äººå‘˜çš„ä»£ç ç¼–å†™å·¥ä½œã€‚EasyExcelä½¿ç”¨æ³¨è§£å’Œç›‘å¬å™¨ç­‰ç®€åŒ–è¯»å†™å¼€å‘ï¼Œ</p><h2 id="é—®é¢˜è¯´æ˜"><a href="#é—®é¢˜è¯´æ˜" class="headerlink" title="é—®é¢˜è¯´æ˜"></a>é—®é¢˜è¯´æ˜</h2><p>åœ¨æˆ‘çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†çš„å·¥ä½œéƒ½æ˜¯å°†æ•°æ®åº“çš„æ•°æ®æ•´ç†å½’çº³åå¯¼å‡ºä¸ºExcelï¼Œå½“ç„¶ä¼šç¢°åˆ°è®¸è®¸å¤šå¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚å¯¼å‡ºè¶…æ—¶ï¼ˆå½“ç„¶è¿™ä¸ªé—®é¢˜å¤§å¤šæ•°éƒ½æ˜¯SQLæ‰§è¡Œçš„é—®é¢˜ï¼Œæ—¥å¸¸å‡ åä¸‡æ¡æ•°æ®çš„excelå¹¶ä¸ä¼šèŠ±è´¹å¤šå°‘æ—¶é—´ï¼‰ï¼Œå­—æ®µç±»å‹ä¸éœ€æ±‚ä¸åŒ¹é…ã€æ–‡æœ¬è¶…å‡ºå•å…ƒæ ¼ã€åŠ¨æ€å¤´â€¦..</p><p>è¿™é‡Œä¸»è¦è®°å½•å’Œè¯´æ˜å…¶ä¸­å‡ ä¸ªé—®é¢˜</p><ul><li>å­—æ®µç±»å‹ä¸åŒ¹é…</li><li>æœ€åä¸€åˆ—æ–‡æœ¬å†…å®¹è¶…å‡ºå•å…ƒæ ¼</li></ul><h3 id="å­—æ®µç±»å‹ä¸åŒ¹é…"><a href="#å­—æ®µç±»å‹ä¸åŒ¹é…" class="headerlink" title="å­—æ®µç±»å‹ä¸åŒ¹é…"></a>å­—æ®µç±»å‹ä¸åŒ¹é…</h3><p>è§£å†³æ–¹æ³•å¯çœ‹easyexcel å®˜æ–¹github Issues  :<a href="https://github.com/alibaba/easyexcel/issues/2409">https://github.com/alibaba/easyexcel/issues/2409</a></p><h4 id="é—®é¢˜å±•ç¤º"><a href="#é—®é¢˜å±•ç¤º" class="headerlink" title="é—®é¢˜å±•ç¤º"></a>é—®é¢˜å±•ç¤º</h4><p><img src="https://pic.imgdb.cn/item/6492b9221ddac507cce8d399.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬è®¾ç½®å®ä½“ç±»çš„å±æ€§ä¸ºå­—ç¬¦ä¸²å‹æ—¶ï¼Œé»˜è®¤å¯¼å‡ºçš„æ—¶å€™æ•°å€¼å‹ä¼šæ¨¡ç³Šå•å…ƒæ ¼çš„æ ¼å¼ï¼Œæ‰€ä»¥ä¸Šæ–¹æœ‰ä¸ªä¸‰è§’ç¬¦å·ï¼Œè¿™æ—¶å€™excelæ˜¯æ— æ³•è¿›è¡Œæ•°å€¼çš„æ±‚å’Œæ±‡æ€»ç­‰è¿ç®—çš„ã€‚</p><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å¯¼å‡ºexcelæ—¶çš„å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç¼–å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿå§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç”Ÿæ—¥&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(&quot;yyyy-mm-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;å­¦å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String stuNo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ <code>private String stuNo;</code>ä¸ºStringç±»å‹ï¼Œè¿™é‡Œå°±æ˜¯å¯¼è‡´å¯¼å‡ºexcelæ— æ³•ç¡®å®šå•å…ƒæ ¼æ ¼å¼çš„ä¸»è¦åŸå› ã€‚</p><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>ä¿®æ”¹æ–¹å¼å¾ˆç®€å•ï¼Œå°†Stringæ”¹ä¸ºå¯¹åº”çš„æ•°å€¼å‹æ ¼å¼å³å¯å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç¼–å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿå§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç”Ÿæ—¥&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(&quot;yyyy-mm-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;å­¦å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer stuNo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><p><img src="https://pic.imgdb.cn/item/649a3a3e1ddac507cc3e6c52.png"></p><p><em>PS: ç¬¬ä¸€åˆ—ä»ä¸ºStringç±»å‹ï¼Œæ‰€ä»¥å¯¼å‡ºä»æœ‰ä¸‰è§’ç¬¦å·ã€‚</em></p><h3 id="æœ€åä¸€åˆ—æ–‡æœ¬å†…å®¹è¶…å‡ºå•å…ƒæ ¼"><a href="#æœ€åä¸€åˆ—æ–‡æœ¬å†…å®¹è¶…å‡ºå•å…ƒæ ¼" class="headerlink" title="æœ€åä¸€åˆ—æ–‡æœ¬å†…å®¹è¶…å‡ºå•å…ƒæ ¼"></a>æœ€åä¸€åˆ—æ–‡æœ¬å†…å®¹è¶…å‡ºå•å…ƒæ ¼</h3><p>è¿™ä¸ªé—®é¢˜æˆ‘åœ¨issues ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œå¯èƒ½é—®é¢˜æ¯”è¾ƒç®€å•:joy::joy::joy:</p><p><strong>å…ˆè¯´ä¸€ä¸‹æ€è·¯ï¼Œæ„é€ å‡ºä¸€åˆ—ç©ºå€¼è¦†ç›–å‰ä¸€åˆ—å†…å®¹è¶…å‡ºéƒ¨åˆ†ï¼Œå†æ‰‹åŠ¨ç”Ÿæˆæ ‡é¢˜å¤´</strong></p><h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><p>å¦‚æœæœ€åä¸€åˆ—å¯¼å‡ºä¸ºé•¿æ–‡æœ¬å­—ç¬¦å‹æ—¶ï¼Œå¾ˆå®¹æ˜“è¶…å‡ºå•å…ƒæ ¼ï¼Œè§‚æ„Ÿä¸ä½³ï¼Œç°è±¡å¦‚ä¸‹ã€‚</p><p><img src="https://pic.imgdb.cn/item/649a3bcb1ddac507cc40a317.png"></p><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ä½“ç±»å¤šåŠ äº†ä¸€ä¸ªnoteå­—æ®µï¼Œè¿™ä¸ªä¹Ÿå°±æ˜¯ä¸Šæ–¹é•¿æ–‡æœ¬çš„å­—æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç¼–å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿå§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç”Ÿæ—¥&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(&quot;yyyy-mm-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;å­¦å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer stuNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;å¤‡æ³¨&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String note;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•-1"><a href="#è§£å†³æ–¹æ³•-1" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å¯¼å‡ºä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EasyExcel.write(<span class="string">&quot;å­¦ç”Ÿä¿¡æ¯è¡¨.xlsx&quot;</span>, Student.class)</span><br><span class="line">        .sheet()</span><br><span class="line">        .head(Student.class)</span><br><span class="line">        .doWrite(WriteDemo.getData());</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸€ä¸‹å…¶ä¸­çš„æ–¹æ³•å’Œå‚æ•°write()å’Œhead()</p><p><strong>write()é‡è½½æ–¹æ³•å…¥å‚</strong></p><ul><li>File  file</li><li>File file,@Nullable Class head</li><li>String pathName</li><li>String pathName, @Nullable Class head</li><li>outputStream outputStream</li><li>outputStream outputStream, @Nullable Class head</li></ul><p>æ‰€æœ‰çš„é‡è½½æ–¹æ³•å…¥å‚ç¬¬ä¸€ä¸ªéƒ½æ˜¯ç¡®å®šæ–‡ä»¶åç§°ï¼ˆFile  ï¼‰å’Œä½ç½®ï¼ˆpathNameï¼‰ï¼ŒoutputStream æ˜¯webä¸Šä¼ ã€ä¸‹è½½ã€‚æˆ‘ä»¬å…³æ³¨åé¢ä¸€ä¸ªå‚æ•° <code>Class head</code>è¿™é‡ŒæŒ‡å®šäº†å¯¼å‡ºæ–‡ä»¶çš„headï¼ŒåŒheadæ–¹æ³•åŠŸèƒ½ç›¸ä¼¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œæˆ‘ä»¬å»åˆ°  <code>.head(Student.class)</code>æˆ–è€…<code>.write(&quot;å­¦ç”Ÿä¿¡æ¯è¡¨.xlsx&quot;, Student.class)</code>ä¸­çš„<code>Student.class</code>éƒ½æ˜¯æ­£å¸¸çš„ã€‚</p><h5 id="ç®€å•åˆ†æä¸€ä¸‹æºä»£ç "><a href="#ç®€å•åˆ†æä¸€ä¸‹æºä»£ç " class="headerlink" title="ç®€å•åˆ†æä¸€ä¸‹æºä»£ç "></a>ç®€å•åˆ†æä¸€ä¸‹æºä»£ç </h5><h5 id="write"><a href="#write" class="headerlink" title="write"></a>write</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyExcelFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">(String pathName, Class head)</span> &#123;</span><br><span class="line">        <span class="type">ExcelWriterBuilder</span> <span class="variable">excelWriterBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExcelWriterBuilder</span>();</span><br><span class="line">        excelWriterBuilder.file(pathName);</span><br><span class="line">        <span class="keyword">if</span> (head != <span class="literal">null</span>) &#123;</span><br><span class="line">            excelWriterBuilder.head(head);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> excelWriterBuilder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractParameterBuilder</span>&lt;T <span class="keyword">extends</span> <span class="title class_">AbstractParameterBuilder</span>, C <span class="keyword">extends</span> <span class="title class_">BasicParameter</span>&gt; &#123;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">head</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.parameter().setClazz(clazz);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.self();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œç»™<code>excelWriterBuilder</code>è®¾ç½®äº†ä¸€ä¸ª<code>head</code>ç„¶åè°ƒç”¨äº†<code>AbstractParameterBuilder</code>çš„headæ–¹æ³•</p><h5 id="head"><a href="#head" class="headerlink" title="head"></a>head</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractParameterBuilder</span>&lt;T <span class="keyword">extends</span> <span class="title class_">AbstractParameterBuilder</span>, C <span class="keyword">extends</span> <span class="title class_">BasicParameter</span>&gt; &#123;</span><br><span class="line"> <span class="comment">/***/</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">head</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.parameter().setClazz(clazz);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.self();</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">/***/</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> C <span class="title function_">parameter</span><span class="params">()</span>;</span><br><span class="line">     <span class="comment">/***/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç»™ <code>this.parameter()</code>è®¾ç½®äº†ç±»åï¼Œè¿™é‡Œçš„this.parameteræŒ‡çš„æ˜¯<code>AbstractParameterBuilder</code>  ä¸­çš„<code>protected abstract C parameter();</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå…¶å®æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨äº†åŒä¸€ä¸ªæ–¹æ³•ã€‚</p><h5 id="headçš„ç‰¹åˆ«ä¹‹å¤„"><a href="#headçš„ç‰¹åˆ«ä¹‹å¤„" class="headerlink" title="headçš„ç‰¹åˆ«ä¹‹å¤„"></a>headçš„ç‰¹åˆ«ä¹‹å¤„</h5><p>headæ–¹æ³•æœ¬è´¨ä¸Šæ˜¯ç”¨æ¥åŠ¨æ€ç”Ÿæˆå¤´æ–‡ä»¶çš„ï¼Œè¯¦æƒ…å¯å‚ç…§å®˜æ–¹æ–‡æ¡£<a href="https://easyexcel.opensource.alibaba.com/docs/current/quickstart/write#%E5%8A%A8%E6%80%81%E5%A4%B4%E5%AE%9E%E6%97%B6%E7%94%9F%E6%88%90%E5%A4%B4%E5%86%99%E5%85%A5">https://easyexcel.opensource.alibaba.com/docs/current/quickstart/write#%E5%8A%A8%E6%80%81%E5%A4%B4%E5%AE%9E%E6%97%B6%E7%94%9F%E6%88%90%E5%A4%B4%E5%86%99%E5%85%A5</a></p><p>å¦‚æœæˆ‘ä»¬å†writeæ–¹æ³•ä¸Šæ²¡æœ‰æŒ‡å®šæ ‡é¢˜å¤´ï¼Œåˆ™å¯ä»¥æ‰‹åŠ¨é€šè¿‡headæ–¹æ³•æ„é€ ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°æœ€åä¸€åˆ—ä¸å‡ºå•å…ƒæ ¼äº†</p><h5 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h5><p>å…ˆä¿®æ”¹å¯¼å‡ºå®ä½“ç±»æ·»åŠ ä¸€ä¸ªå ä½ç¬¦<strong>å¹¶èµ‹åˆå§‹å€¼ä¸ºç©º</strong>ï¼ˆ<em><strong>æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰èµ‹å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œåˆ™ä¸ä¼šå†™å…¥excelè¿›è¡Œè¦†ç›–å‰ä¸€åˆ—</strong></em>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç¼–å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿå§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty( &quot;å­¦ç”Ÿç”Ÿæ—¥&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(&quot;yyyy-mm-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;å­¦å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer stuNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;å¤‡æ³¨&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String note;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å ä½ç¬¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">palaceHolder</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨æ„é€ å¤´æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">setHead</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(</span><br><span class="line">            <span class="string">&quot;å­¦ç”Ÿç¼–å·&quot;</span>,</span><br><span class="line">            <span class="string">&quot;å­¦ç”Ÿå§“å&quot;</span>,</span><br><span class="line">            <span class="string">&quot;å­¦ç”Ÿç”Ÿæ—¥&quot;</span>,</span><br><span class="line">            <span class="string">&quot;å­¦å·&quot;</span>,</span><br><span class="line">            <span class="string">&quot;å¤‡æ³¨&quot;</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> list.stream()</span><br><span class="line">            .map(Arrays::asList)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åç”Ÿæˆexcel</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dynamicHeadWrite</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    EasyExcel.write(<span class="string">&quot;å­¦ç”Ÿä¿¡æ¯è¡¨.xlsx&quot;</span>)</span><br><span class="line">            .sheet()</span><br><span class="line">            .head(setHead())</span><br><span class="line">            .doWrite(WriteDemo.getData());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><p><img src="https://pic.imgdb.cn/item/649a4d1c1ddac507cc5d38dc.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€åˆ—å†…å®¹æ²¡æœ‰è¶…å‡ºå•å…ƒæ ¼äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="java" scheme="https://nerkeler.github.io/tags/java/"/>
    
    <category term="easyexcel" scheme="https://nerkeler.github.io/tags/easyexcel/"/>
    
  </entry>
  
  <entry>
    <title> Javaä¸­çš„å¹¶å‘å·¥å…·ç±»-CountDownLatchå’ŒCyclicBarrier</title>
    <link href="https://nerkeler.github.io/2023/06/16/Java%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB-CountDownLatch%E5%92%8CCyclicBarrier/"/>
    <id>https://nerkeler.github.io/2023/06/16/Java%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB-CountDownLatch%E5%92%8CCyclicBarrier/</id>
    <published>2023-06-16T08:34:00.000Z</published>
    <updated>2023-06-16T09:00:32.661Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Javaä¸­çš„å¹¶å‘å·¥å…·ç±»-CountDownLatchå’ŒCyclicBarrier"><a href="#Javaä¸­çš„å¹¶å‘å·¥å…·ç±»-CountDownLatchå’ŒCyclicBarrier" class="headerlink" title="Javaä¸­çš„å¹¶å‘å·¥å…·ç±»-CountDownLatchå’ŒCyclicBarrier"></a>Javaä¸­çš„å¹¶å‘å·¥å…·ç±»-CountDownLatchå’ŒCyclicBarrier</h1><p>åœ¨JDKçš„å¹¶å‘åŒ…ä¸­ï¼Œæœ‰å‡ ä¸ªéå¸¸æœ‰ç”¨çš„å¹¶å‘å·¥å…·ç±»ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š<code>CountDownLatch</code>ã€<code>CyclicBarrier</code>ã€<code>Semaphore</code>å’Œ<code>Exchanger</code>ã€‚</p><ul><li><code>CountDownLatch</code>ï¼ˆå€’è®¡æ—¶é—¨é—©ï¼‰ï¼šå®ƒå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œåå†ç»§ç»­æ‰§è¡Œã€‚å®ƒé€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°ï¼Œçº¿ç¨‹é€šè¿‡è°ƒç”¨ <code>countDown()</code> æ–¹æ³•æ¥å‡å°‘è®¡æ•°å™¨çš„å€¼ï¼Œ<code>await()</code>æ–¹æ³•è¿›è¡Œé˜»å¡ç­‰å¾…è®¡æ•°å™¨å‡å°‘ï¼Œå½“è®¡æ•°å™¨è¾¾åˆ°é›¶æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹å°†è¢«é‡Šæ”¾ã€‚</li><li><code>CyclicBarrier</code>ï¼ˆå¾ªç¯å±éšœï¼‰ï¼šå®ƒå…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾ä¸€ä¸ªå…±åŒçš„å±éšœç‚¹ï¼Œç„¶åç»§ç»­æ‰§è¡Œåç»­æ“ä½œã€‚ä¸<code>CountDownLatch</code>ä¸åŒçš„æ˜¯ï¼Œ<code>CyclicBarrier</code>çš„è®¡æ•°å™¨å¯ä»¥é‡å¤ä½¿ç”¨ï¼ˆ<code>reset()</code>æ–¹æ³•ï¼‰ï¼Œå½“æ‰€æœ‰ç­‰å¾…çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœç‚¹åï¼Œè®¡æ•°å™¨ä¼šé‡ç½®ï¼Œçº¿ç¨‹å¯ä»¥ç»§ç»­ä¸‹ä¸€æ¬¡ç­‰å¾…ã€‚</li><li><code>Semaphore</code>ï¼ˆä¿¡å·é‡ï¼‰ï¼šå®ƒç”¨äºæ§åˆ¶å¯¹æŸä¸ªèµ„æºçš„è®¿é—®æƒé™ã€‚<code>Semaphore</code>ç»´æŠ¤äº†ä¸€ç»„è®¸å¯è¯ï¼Œçº¿ç¨‹åœ¨è®¿é—®èµ„æºå‰éœ€è¦è·å–è®¸å¯è¯ï¼Œå¦‚æœè®¸å¯è¯ä¸å¯ç”¨ï¼Œåˆ™çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„è®¸å¯è¯ã€‚</li><li><code>Exchanger</code>ï¼ˆäº¤æ¢å™¨ï¼‰ï¼šå®ƒæä¾›äº†ä¸€ç§çº¿ç¨‹é—´äº¤æ¢æ•°æ®çš„æœºåˆ¶ã€‚ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥é€šè¿‡<code>Exchanger</code>äº¤æ¢æ•°æ®ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨ <code>exchange()</code> æ–¹æ³•åï¼Œä»–ä»¬ä¼šå½¼æ­¤äº¤æ¢æ•°æ®ï¼Œå¹¶ç»§ç»­æ‰§è¡Œåç»­æ“ä½œã€‚</li></ul><h2 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h2><h3 id="Latchï¼ˆé—¨é—©ï¼‰è®¾è®¡æ¨¡å¼"><a href="#Latchï¼ˆé—¨é—©ï¼‰è®¾è®¡æ¨¡å¼" class="headerlink" title="Latchï¼ˆé—¨é—©ï¼‰è®¾è®¡æ¨¡å¼"></a><code>Latch</code>ï¼ˆé—¨é—©ï¼‰è®¾è®¡æ¨¡å¼</h3><p>å½“å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œä»»åŠ¡ï¼Œç„¶ååªæœ‰ç­‰å¾…æ‰€æœ‰å­ä»»åŠ¡å…¨éƒ¨å®Œæˆè¿›è¡Œæ±‡æ€»ï¼Œç¨‹åºçš„é—¨é—©æ‰èƒ½æ‰“å¼€è®©ç¨‹åºç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å®ƒæŒ‡å®šäº†ä¸€ä¸ªå±éšœï¼Œåªæœ‰æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³çš„æ—¶å€™ï¼Œé—¨é˜€æ‰èƒ½æ‰“å¼€ã€‚</p><p>æ¯”å¦‚å°æ˜å’Œå°çº¢ç›¸çº¦å‘¨æœ«å»çˆ¬å±±ï¼Œçº¦å®šåœ¨äººæ°‘å¹¿åœºç¢°å¤´ï¼Œç„¶åä¸€åŒå‡ºå‘å»çˆ¬å±±ï¼Œä»–ä»¬å„è‡ªä»å®¶é‡Œå‡ºå‘ï¼Œæ— è®ºæ˜¯å…¶ä¸­æŸä¸€ä¸ªå…ˆåˆ°è¾¾äº†äººæ°‘å¹¿åœºéƒ½è¦ç­‰å¾…å¦ä¸€ä¸ªåˆ°è¾¾ä¹‹åæ‰å¯ä»¥ç»§ç»­è¿›è¡Œä¸‹å»ï¼Œè¿™é‡Œçš„äººæ°‘å¹¿åœºç¢°å¤´å°±ç›¸å½“äºä¸Šè¿°çš„é—¨é—©ã€‚</p><p><img src="https://pic.imgdb.cn/item/648bbc501ddac507cc564792.png"></p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿå°æ˜å’Œå°çº¢ä»å®¶å‡ºå‘ï¼Œè®¾å®šä¸åŒçš„ç­‰å¾…æ—¶é—´æ¨¡æ‹Ÿåˆ°è¾¾äººæ°‘å¹¿åœºçš„è·¯ç¨‹è€—æ—¶ã€‚ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadNum</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(threadNum);</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadNum);</span><br><span class="line"></span><br><span class="line">        executorService.execute(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;å°æ˜å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            countDownLatch.countDown();  <span class="comment">// è®¡æ•°å™¨ -1</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å°æ˜åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        executorService.execute(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;å°çº¢å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            countDownLatch.countDown();  <span class="comment">// è®¡æ•°å™¨ -1</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å°çº¢åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        System.out.println(<span class="string">&quot;å°æ˜å’Œå°çº¢éƒ½åˆ°è¾¾äº†äººæ°‘å¹¿åœºï¼Œå¼€å§‹ä¸€èµ·å‡ºå‘å»çˆ¬å±±&quot;</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å°æ˜å¼€å§‹å‡ºå‘</span><br><span class="line">å°çº¢å¼€å§‹å‡ºå‘</span><br><span class="line">å°æ˜åˆ°è¾¾äººæ°‘å¹¿åœº  <span class="comment">// 2såæ‰“å°</span></span><br><span class="line">å°çº¢åˆ°è¾¾äººæ°‘å¹¿åœº  <span class="comment">// 3såæ‰“å°</span></span><br><span class="line">å°æ˜å’Œå°çº¢éƒ½åˆ°è¾¾äº†äººæ°‘å¹¿åœºï¼Œå¼€å§‹ä¸€èµ·å‡ºå‘å»çˆ¬å±± <span class="comment">//3såæ‰“å°</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="ä¸Join-çš„åŒºåˆ«"><a href="#ä¸Join-çš„åŒºåˆ«" class="headerlink" title="ä¸Join()çš„åŒºåˆ«"></a>ä¸Join()çš„åŒºåˆ«</h3><p>å¯èƒ½è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼Œä½¿ç”¨<code>Thread.join()</code>ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œè¿™ä¸ä½¿ç”¨<code>CountDownLatch</code>æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><h4 id="join-çš„å®ç°"><a href="#join-çš„å®ç°" class="headerlink" title="join()çš„å®ç°"></a>join()çš„å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å°æ˜å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å°æ˜åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;, <span class="string">&quot;thread1&quot;</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å°çº¢å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;å°çº¢åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;, <span class="string">&quot;thread2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    thread1.start();</span><br><span class="line">    thread2.start();</span><br><span class="line">    thread1.join();</span><br><span class="line">    thread2.join();</span><br><span class="line">    System.out.println(<span class="string">&quot;å°æ˜å’Œå°çº¢éƒ½åˆ°è¾¾äº†äººæ°‘å¹¿åœºï¼Œå¼€å§‹ä¸€èµ·å‡ºå‘å»çˆ¬å±±&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å°æ˜å¼€å§‹å‡ºå‘</span><br><span class="line">å°çº¢å¼€å§‹å‡ºå‘</span><br><span class="line">å°æ˜åˆ°è¾¾äººæ°‘å¹¿åœº  <span class="comment">// 2såæ‰“å°</span></span><br><span class="line">å°çº¢åˆ°è¾¾äººæ°‘å¹¿åœº  <span class="comment">// 3såæ‰“å°</span></span><br><span class="line">å°æ˜å’Œå°çº¢éƒ½åˆ°è¾¾äº†äººæ°‘å¹¿åœºï¼Œå¼€å§‹ä¸€èµ·å‡ºå‘å»çˆ¬å±± <span class="comment">//3såæ‰“å°</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å‘ç°ä½¿ç”¨join()å®ç°å’Œ<code>countDownCatch</code>å®ç°å¥½åƒåœ¨ä»£ç ä¸Šçš„ä½“ç°å¹¶æ²¡æœ‰å¤ªå¤§å·®å¼‚ï¼Œä¸æ€¥ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹</p><h4 id="join-å®ç°åŸç†"><a href="#join-å®ç°åŸç†" class="headerlink" title="join()å®ç°åŸç†"></a>join()å®ç°åŸç†</h4><p>æˆ‘ä»¬ç‚¹è¿›å»joinçš„<code>jdk</code>æºç æŸ¥çœ‹å®ƒçš„å®ç°é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">join</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    join(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">join</span><span class="params">(<span class="type">long</span> millis)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨joinçœŸæ­£æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (millis == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                wait(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">delay</span> <span class="operator">=</span> millis - now;</span><br><span class="line">                <span class="keyword">if</span> (delay &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                wait(delay);</span><br><span class="line">                now = System.currentTimeMillis() - base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ä»–çš„æ ¸å¿ƒä»£ç å°±å‡ è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">    wait(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å‡ è¡Œä»£ç ä¸éš¾ç†è§£ï¼Œé€šè¿‡ä¸åœçš„æ£€æŸ¥joinçº¿ç¨‹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœçº¿ç¨‹çŠ¶æ€æ˜¯æ´»åŠ¨çš„ï¼Œé‚£ä¹ˆå°±ä¸€ç›´ç­‰å¾…ä¸‹å»ï¼ˆwait(0)è¡¨ç¤ºæ°¸ä¹…ç­‰å¾…ï¼‰ï¼Œç›´åˆ°joinçº¿ç¨‹ä¸­æ­¢åï¼Œçº¿ç¨‹çš„<code>this.notifyAll()</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œä¸è¿‡è°ƒç”¨<code>notifyAll()</code>æ–¹æ³•æ˜¯åœ¨JVMé‡Œ å®ç°çš„ï¼Œæ‰€ä»¥åœ¨JDKé‡Œçœ‹ä¸åˆ°ã€‚</p><h4 id="Join-ä¸countDownLatchæ¯”è¾ƒ"><a href="#Join-ä¸countDownLatchæ¯”è¾ƒ" class="headerlink" title="Join()ä¸countDownLatchæ¯”è¾ƒ"></a>Join()ä¸countDownLatchæ¯”è¾ƒ</h4><p>å›åˆ°ä¸Šä¸€ä¸ªé—®é¢˜ï¼Œjoinåˆ°åº•å’Œ<code>countDownLatch</code>æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œ<code>countDownLatch</code>åº•å±‚ä½¿ç”¨äº†è®¡æ•°å™¨æ¥æ§åˆ¶çº¿ç¨‹çš„å”¤é†’ï¼Œæä¾›äº†æ›´ç»†ç²’åº¦çš„çº¿ç¨‹æ§åˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿è¡Œäº†100ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯åªéœ€è¦80ä¸ªçº¿ç¨‹æ‰§è¡Œç»“æŸå°±å¯ä»¥ç»§ç»­ä¸‹å»ï¼Œé‚£ä¹ˆä½¿ç”¨joinå°±ä¸åˆé€‚äº†ã€‚</p><p>ç»¼ä¸Šæ‰€è¿° <code>CountDownLatch</code>ç›¸å¯¹äºJoinçš„ä¼˜åŠ¿ï¼š</p><ul><li><code>CountDownLatch</code>å¯ä»¥ç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„å®Œæˆï¼Œè€ŒJoinåªèƒ½ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li><code>CountDownLatch</code>å¯ä»¥çµæ´»åœ°è®¾ç½®è®¡æ•°å™¨çš„å€¼ï¼Œä¸ä»…ä»…é™äºçº¿ç¨‹æ•°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªç”±æ§åˆ¶ã€‚</li><li><code>CountDownLatch</code>æä¾›äº†æ›´ç»†ç²’åº¦çš„çº¿ç¨‹é—´åä½œå’Œæ§åˆ¶ï¼Œå¯ä»¥åœ¨ä»»æ„ä½ç½®è¿›è¡Œ<code>countDown</code>()å’Œawait()çš„è°ƒç”¨ï¼Œæ›´çµæ´»åœ°æ§åˆ¶çº¿ç¨‹çš„æµç¨‹ã€‚</li></ul><h3 id="CountDownLatchç¨‹åºå®ç°"><a href="#CountDownLatchç¨‹åºå®ç°" class="headerlink" title="CountDownLatchç¨‹åºå®ç°"></a>CountDownLatchç¨‹åºå®ç°</h3><p>ä¸Šé¢è¯´äº†å¾ˆå¤š<code>CountDownLatch</code>çš„ç¤ºä¾‹å’Œä¸joinæ¯”è¾ƒï¼Œä¹Ÿæäº†ä¸€ä¸‹<code>CountDownLatch</code>åº•å±‚çš„åŸç†ï¼Œä¸‹é¢å°±çœ‹ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„<code>CountDownLatch</code></p><h4 id="ç¨‹åº"><a href="#ç¨‹åº" class="headerlink" title="ç¨‹åº"></a>ç¨‹åº</h4><p>æˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒåŒ…å«countDownLatchéœ€è¦çš„å‚æ•°å’Œæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Latch</span> &#123;</span><br><span class="line">    <span class="comment">// æ§åˆ¶äº†å¤šå°‘çº¿ç¨‹å®Œæˆåé—¨é˜€æ‰èƒ½æ‰“å¼€</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> limit;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Latch</span><span class="params">(<span class="type">int</span> limit)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.limit = limit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹æ³•ä½¿å¾—çº¿ç¨‹ä¸€ç›´ç­‰å¾…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰ä»»åŠ¡çº¿ç¨‹å®Œæˆå·¥ä½œä¹‹åè°ƒç”¨è¯¥æ–¹æ³•ä½¿å¾—è®¡æ•°å™¨å‡ä¸€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">countDown</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å½“å‰è¿˜æœ‰å¤šå°‘ä¸ªçº¿ç¨‹æ²¡æœ‰å®Œæˆä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">getUnArrived</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå®ç°è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå¹¶å†™å…¥å…·ä½“é€»è¾‘ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatch</span> <span class="keyword">extends</span> <span class="title class_">Latch</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CountDownLatch</span><span class="params">(<span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(limit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">await</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">while</span> (limit &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            condition.await();</span><br><span class="line">        &#125;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countDown</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">if</span>(limit &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        limit--;</span><br><span class="line">        condition.signalAll();</span><br><span class="line"></span><br><span class="line">        lock.unlock();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getUnArrived</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> limit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LatchDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Latch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        executorService.execute(()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å°æ˜å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            latch.countDown();  <span class="comment">// è®¡æ•°å™¨ -1</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å°æ˜åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        executorService.execute(()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å°çº¢å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            latch.countDown();  <span class="comment">// è®¡æ•°å™¨ -1</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å°çº¢åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        latch.await();</span><br><span class="line">        System.out.println(<span class="string">&quot;å°æ˜å’Œå°çº¢éƒ½åˆ°è¾¾äº†äººæ°‘å¹¿åœºï¼Œå¼€å§‹ä¸€èµ·å‡ºå‘å»çˆ¬å±±&quot;</span>);</span><br><span class="line"></span><br><span class="line">        executorService.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å°æ˜å¼€å§‹å‡ºå‘</span><br><span class="line">å°çº¢å¼€å§‹å‡ºå‘</span><br><span class="line">å°æ˜åˆ°è¾¾äººæ°‘å¹¿åœº</span><br><span class="line">å°çº¢åˆ°è¾¾äººæ°‘å¹¿åœº</span><br><span class="line">å°æ˜å’Œå°çº¢éƒ½åˆ°è¾¾äº†äººæ°‘å¹¿åœºï¼Œå¼€å§‹ä¸€èµ·å‡ºå‘å»çˆ¬å±±</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç»“æœå¦‚å‰æ–‡ä¸€è‡´ï¼Œè¿™å°±å®ç°äº†ä¸€ä¸ªç®€å•çš„<code>CountDownLatch</code>,å½“ç„¶å…·ä½“å®ç°è¿˜æœ‰æ›´å¤šçš„ç»†èŠ‚ï¼Œå¦‚æœ‰éœ€è¦ï¼Œè¯·ç¿»é˜…æºç ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>é€šè¿‡ä¸Šé¢çš„ç®€å•å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>CountDownLatch</code>åŸºäºè®¡æ•°å™¨å®ç°äº†å¤šçº¿ç¨‹ä¹‹é—´çš„é—¨é˜€æ‹¦æˆªï¼Œåº•å±‚è¿˜æ˜¯é€šè¿‡çº¿ç¨‹ä¹‹é—´çš„é€šè®¯ã€é”å’Œè®¡æ•°å™¨æ§åˆ¶ã€‚</p><h2 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h2><p>é™¤äº†ä½¿ç”¨<code>CountDownLatch</code>æ¥å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„é˜»å¡åŒæ­¥,ä¹Ÿå¯ä»¥ä½¿ç”¨<code>CyclicBarrier</code>æ¥å®ç°ï¼Œå¹¶ä¸”<code>CyclicBarrier</code>æä¾›äº†æ¯”<code>CountDownLatch</code>æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚</p><p><code>CyclicBarrier</code>çš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ä½¿ç”¨çš„å±éšœã€‚å®ƒæä¾›äº†ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œä½¿ä¸€ç»„çº¿ç¨‹èƒ½å¤Ÿåœ¨è¾¾åˆ°å±éšœæ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€å¯ï¼Œæ‰€æœ‰è¢«é˜»å¡çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p><p><em>ç½‘ä¸Šæ‰¾çš„ä¸€å¼ ç¤ºæ„å›¾</em></p><p><img src="https://pic.imgdb.cn/item/648c20e51ddac507cc518a1f.png"></p><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>è¿˜æ˜¯ç”¨ä¹‹å‰çš„ä¾‹å­ï¼Œæ¨¡æ‹Ÿå°æ˜å’Œå°çº¢å»çˆ¬å±±ï¼Œä»£ç å¦‚ä¸‹ï¼Œç»“æœå°±ä¸èµ˜è¿°äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, BrokenBarrierException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">CyclicBarrier</span> <span class="variable">cyclicBarrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    executorService.execute(()-&gt;&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å°æ˜å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;å°æ˜åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line">            cyclicBarrier.await(); <span class="comment">// è®¡æ•°å™¨ -1</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">    executorService.execute(()-&gt;&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å°çº¢å¼€å§‹å‡ºå‘&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;å°çº¢åˆ°è¾¾äººæ°‘å¹¿åœº&quot;</span>);</span><br><span class="line">            cyclicBarrier.await(); <span class="comment">// è®¡æ•°å™¨ -1</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    cyclicBarrier.await();</span><br><span class="line">    System.out.println(<span class="string">&quot;å°æ˜å’Œå°çº¢éƒ½åˆ°è¾¾äº†äººæ°‘å¹¿åœºï¼Œå¼€å§‹ä¸€èµ·å‡ºå‘å»çˆ¬å±±&quot;</span>);</span><br><span class="line"></span><br><span class="line">    executorService.shutdown();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œæˆ‘è®¾ç½®äº†ä¸‰ä¸ªå±éšœç‚¹ <code>cyclicBarrier.await()</code>;ï¼Œè€Œä½¿ç”¨<code>CountDownLatch</code>åªç”¨äº†ä¸¤ä¸ªè®¡æ•°å™¨å‡ä¸€æ“ä½œ + ä¸€ä¸ªwait()æ–¹æ³•ï¼Œä½¿ç”¨èµ·æ¥å¾ˆç›¸ä¼¼ï¼Œæˆ‘ä»¬è¯´<code>cyclicBarrier</code> æ¯” <code>CountDownLatch</code> åŠŸèƒ½æ›´å¼ºå¤§ï¼Œé‚£ä¹ˆå¼ºå¤§åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><h3 id="é‡ç½®è®¡æ•°å™¨å’Œè·å–çŠ¶æ€"><a href="#é‡ç½®è®¡æ•°å™¨å’Œè·å–çŠ¶æ€" class="headerlink" title="é‡ç½®è®¡æ•°å™¨å’Œè·å–çŠ¶æ€"></a>é‡ç½®è®¡æ•°å™¨å’Œè·å–çŠ¶æ€</h3><h4 id="é‡ç½®è®¡æ•°å™¨"><a href="#é‡ç½®è®¡æ•°å™¨" class="headerlink" title="é‡ç½®è®¡æ•°å™¨"></a>é‡ç½®è®¡æ•°å™¨</h4><p><code>CountDownLatch</code>çš„è®¡æ•°å™¨åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè€Œ<code>CyclicBarrier</code>çš„è®¡æ•°å™¨å¯ä»¥ä½¿ç”¨<code>reset()</code>æ–¹æ³•é‡ç½®ã€‚æ‰€ä»¥<code>CyclicBarrier</code>èƒ½å¤„ç†æ›´ä¸ºå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¡ç®—å‘ç”Ÿé”™è¯¯ï¼Œå¯ä»¥é‡ç½®è®¡æ•°å™¨ï¼Œå¹¶è®©çº¿ç¨‹é‡æ–°æ‰§è¡Œä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, BrokenBarrierException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadNum</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(threadNum);</span><br><span class="line">    <span class="type">CyclicBarrier</span> <span class="variable">cyclicBarrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(threadNum, () -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœ&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadNum; i++) &#123;</span><br><span class="line">        executorService.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; åˆ°è¾¾å±éšœ&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="number">2000</span>); <span class="comment">// ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç¡®ä¿æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœ</span></span><br><span class="line"></span><br><span class="line">    cyclicBarrier.reset(); <span class="comment">// é‡ç½®å±éšœ</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;å±éšœå·²é‡ç½®&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadNum-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        executorService.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; åˆ°è¾¾å±éšœ&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;ç¬¬äºŒæ¬¡è¿›å…¥ å¾ªç¯å±éšœ&quot;</span>);</span><br><span class="line">    cyclicBarrier.await();</span><br><span class="line">    System.out.println(<span class="string">&quot;ç¬¬äºŒæ¬¡å¾ªç¯  è¿ˆè¿‡å±éšœ&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    executorService.shutdown();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> åˆ°è¾¾å±éšœ</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> åˆ°è¾¾å±éšœ</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> åˆ°è¾¾å±éšœ</span><br><span class="line">æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœ</span><br><span class="line">å±éšœå·²é‡ç½®</span><br><span class="line">ç¬¬äºŒæ¬¡è¿›å…¥ å¾ªç¯å±éšœ</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> åˆ°è¾¾å±éšœ</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> åˆ°è¾¾å±éšœ</span><br><span class="line">æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœ</span><br><span class="line">ç¬¬äºŒæ¬¡å¾ªç¯  è¿ˆè¿‡å±éšœ</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…ˆè¯´ä¸€ä¸‹<code>CyclicBarrier</code>æä¾›çš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°<code>CyclicBarrierï¼ˆint partiesï¼ŒRunnable barrierActionï¼‰</code>ï¼Œç”¨äºåœ¨çº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œä¼˜å…ˆæ‰§è¡Œ<code>barrierAction</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–¹ä»£ç ä¸­ç”¨åˆ°çš„è¿™å‡ æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CyclicBarrier</span> <span class="variable">cyclicBarrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(threadNum, () -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœ&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨äºæç¤ºæ‰€æœ‰çš„çº¿ç¨‹åˆ°è¾¾å±éšœã€‚ç´§æ¥ç€æ˜¯æ¯”è¾ƒå¸¸è§„çš„ä»£ç ï¼Œå¾ªç¯æ„é€ çº¿ç¨‹å¹¶åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œäº† <code>cyclicBarrier.await();</code>åˆ°è¾¾å±éšœã€‚é‡ç‚¹æ˜¯ <code>cyclicBarrier.reset(); </code>é‡ç½®å±éšœåï¼Œæˆ‘ç•™ä¸‹ä¸€ä¸ªå±éšœç»™ä¸»çº¿ç¨‹æµ‹è¯•ä½¿ç”¨ï¼Œè€Œåœ¨æ–°æ„é€ çš„çº¿ç¨‹ä¸­åœç•™1s, <code>System.out.println(&quot;ç¬¬äºŒæ¬¡å¾ªç¯  è¿ˆè¿‡å±éšœ&quot;);</code>æ‰“å°åœ¨            <code>System.out.println(Thread.currentThread().getName() + &quot; åˆ°è¾¾å±éšœ&quot;);</code>ä¹‹åï¼Œè¯´æ˜å±éšœè®¡æ•°å™¨å·²ç»é‡ç½®å¹¶ä¸”ç”Ÿæ•ˆäº†ã€‚</p><h4 id="è·å–çŠ¶æ€"><a href="#è·å–çŠ¶æ€" class="headerlink" title="è·å–çŠ¶æ€"></a>è·å–çŠ¶æ€</h4><p>é™¤äº†ä¸Šè¿°çš„åŸºæœ¬åŠŸèƒ½å¤–ï¼Œ<code>CyclicBarrier</code>ä¹Ÿæä¾›äº†ä»¥ä¸‹APIç”¨æ¥æŸ¥çœ‹çŠ¶æ€ï¼Œ</p><ul><li><code>getNumberWaiting</code>()   &#x2F;&#x2F; é¡¾åæ€ä¹‰ï¼Œè·å–ç›®å‰æ­£åœ¨å±éšœå¤„é˜»å¡ç­‰å¾…çš„çº¿ç¨‹æ•°é‡ã€‚</li><li><code>getParties</code>()               &#x2F;&#x2F;  è·å–å±éšœæ•°é‡ ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥æ„é€ å‡½æ•°ä¸­çš„<code>parties</code>å‚æ•°</li><li><code>isBroken</code>()                   &#x2F;&#x2F;  æŸ¥è¯¢é˜»å¡çš„çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­</li></ul><h2 id="å‚è€ƒèµ„æº"><a href="#å‚è€ƒèµ„æº" class="headerlink" title="å‚è€ƒèµ„æº"></a>å‚è€ƒèµ„æº</h2><p>ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</p><p>ã€ŠJavaé«˜å¹¶å‘ç¼–ç¨‹è¯¦è§£ã€‹</p><p><code>jdk1.8 api</code>æ–‡æ¡£</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://nerkeler.github.io/tags/JUC/"/>
    
    <category term="å¹¶å‘ç¼–ç¨‹" scheme="https://nerkeler.github.io/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨</title>
    <link href="https://nerkeler.github.io/2023/06/16/HashMap%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8/"/>
    <id>https://nerkeler.github.io/2023/06/16/HashMap%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8/</id>
    <published>2023-06-16T03:24:00.000Z</published>
    <updated>2023-06-16T03:26:04.572Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨"><a href="#HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨" class="headerlink" title="HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨"></a>HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨</h1><p>è½¬è½½è‡ªï¼š<a href="https://segmentfault.com/a/1190000038989240">java - HashMapä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨ - ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦</a></p><h4 id="ä¸€ã€å­¦ä¹ ç›®æ ‡"><a href="#ä¸€ã€å­¦ä¹ ç›®æ ‡" class="headerlink" title="ä¸€ã€å­¦ä¹ ç›®æ ‡"></a>ä¸€ã€å­¦ä¹ ç›®æ ‡</h4><p>1ã€HashMapçº¿ç¨‹ä¸å®‰å…¨åŸå› ï¼š</p><p>åŸå› ï¼š</p><ul><li><strong>JDK1.7 ä¸­ï¼Œç”±äºå¤šçº¿ç¨‹å¯¹HashMapè¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨äº†HashMap#transfer()ï¼Œå…·ä½“åŸå› ï¼šæŸä¸ªçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¢«æŒ‚èµ·ï¼Œå…¶ä»–çº¿ç¨‹å·²ç»å®Œæˆæ•°æ®è¿ç§»ï¼Œç­‰CPUèµ„æºé‡Šæ”¾åè¢«æŒ‚èµ·çš„çº¿ç¨‹é‡æ–°æ‰§è¡Œä¹‹å‰çš„é€»è¾‘ï¼Œæ•°æ®å·²ç»è¢«æ”¹å˜ï¼Œé€ æˆæ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€‚</strong></li><li><strong>JDK1.8 ä¸­ï¼Œç”±äºå¤šçº¿ç¨‹å¯¹HashMapè¿›è¡Œputæ“ä½œï¼Œè°ƒç”¨äº†HashMap#putVal()ï¼Œå…·ä½“åŸå› ï¼šå‡è®¾ä¸¤ä¸ªçº¿ç¨‹Aã€Béƒ½åœ¨è¿›è¡Œputæ“ä½œï¼Œå¹¶ä¸”hashå‡½æ•°è®¡ç®—å‡ºçš„æ’å…¥ä¸‹æ ‡æ˜¯ç›¸åŒçš„ï¼Œå½“çº¿ç¨‹Aæ‰§è¡Œå®Œç¬¬å…­è¡Œä»£ç åç”±äºæ—¶é—´ç‰‡è€—å°½å¯¼è‡´è¢«æŒ‚èµ·ï¼Œè€Œçº¿ç¨‹Bå¾—åˆ°æ—¶é—´ç‰‡ååœ¨è¯¥ä¸‹æ ‡å¤„æ’å…¥äº†å…ƒç´ ï¼Œå®Œæˆäº†æ­£å¸¸çš„æ’å…¥ï¼Œç„¶åçº¿ç¨‹Aè·å¾—æ—¶é—´ç‰‡ï¼Œç”±äºä¹‹å‰å·²ç»è¿›è¡Œäº†hashç¢°æ’çš„åˆ¤æ–­ï¼Œæ‰€æœ‰æ­¤æ—¶ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥è¿›è¡Œæ’å…¥ï¼Œè¿™å°±å¯¼è‡´äº†çº¿ç¨‹Bæ’å…¥çš„æ•°æ®è¢«çº¿ç¨‹Aè¦†ç›–äº†ï¼Œä»è€Œçº¿ç¨‹ä¸å®‰å…¨ã€‚</strong></li></ul><p>æ”¹å–„ï¼š</p><ul><li>æ•°æ®ä¸¢å¤±ã€æ­»å¾ªç¯å·²ç»åœ¨åœ¨JDK1.8ä¸­å·²ç»å¾—åˆ°äº†å¾ˆå¥½çš„è§£å†³ï¼Œå¦‚æœä½ å»é˜…è¯»1.8çš„æºç ä¼šå‘ç°æ‰¾ä¸åˆ°HashMap#transfer()ï¼Œå› ä¸ºJDK1.8ç›´æ¥åœ¨HashMap#resize()ä¸­å®Œæˆäº†æ•°æ®è¿ç§»ã€‚</li></ul><p>2ã€HashMapçº¿ç¨‹ä¸å®‰å…¨çš„ä½“ç°ï¼š</p><ul><li>JDK1.7 HashMapçº¿ç¨‹ä¸å®‰å…¨ä½“ç°åœ¨ï¼šæ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±</li><li>JDK1.8 HashMapçº¿ç¨‹ä¸å®‰å…¨ä½“ç°åœ¨ï¼šæ•°æ®è¦†ç›–</li></ul><h4 id="äºŒã€HashMapçº¿ç¨‹ä¸å®‰å…¨ã€æ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€æ•°æ®è¦†ç›–çš„åŸå› "><a href="#äºŒã€HashMapçº¿ç¨‹ä¸å®‰å…¨ã€æ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€æ•°æ®è¦†ç›–çš„åŸå› " class="headerlink" title="äºŒã€HashMapçº¿ç¨‹ä¸å®‰å…¨ã€æ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€æ•°æ®è¦†ç›–çš„åŸå› "></a>äºŒã€HashMapçº¿ç¨‹ä¸å®‰å…¨ã€æ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€æ•°æ®è¦†ç›–çš„åŸå› </h4><p>1ã€JDK1.7 æ‰©å®¹å¼•å‘çš„çº¿ç¨‹ä¸å®‰å…¨</p><p>HashMapçš„çº¿ç¨‹ä¸å®‰å…¨ä¸»è¦æ˜¯å‘ç”Ÿåœ¨æ‰©å®¹å‡½æ•°ä¸­ï¼Œå…¶ä¸­è°ƒç”¨äº†JDK1.7 HashMap #transfer()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Entry[] newTable, <span class="type">boolean</span> rehash)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">null</span> != e) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="keyword">if</span> (rehash) &#123;</span><br><span class="line">                e.hash = <span class="literal">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity);</span><br><span class="line">            e.next = newTable[i];</span><br><span class="line">            newTable[i] = e;</span><br><span class="line">            e = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯HashMapçš„æ‰©å®¹æ“ä½œï¼Œé‡æ–°å®šä½æ¯ä¸ªæ¡¶çš„ä¸‹æ ‡ï¼Œå¹¶é‡‡ç”¨å¤´æ’æ³•å°†å…ƒç´ è¿ç§»åˆ°æ–°æ•°ç»„ä¸­ã€‚å¤´æ’æ³•ä¼šå°†é“¾è¡¨çš„é¡ºåºç¿»è½¬ï¼Œè¿™ä¹Ÿæ˜¯å½¢æˆæ­»å¾ªç¯çš„å…³é”®ç‚¹ã€‚ç†è§£äº†å¤´æ’æ³•åå†ç»§ç»­å¾€ä¸‹çœ‹æ˜¯å¦‚ä½•é€ æˆæ­»å¾ªç¯ä»¥åŠæ•°æ®ä¸¢å¤±çš„ã€‚</p><p>2ã€æ‰©å®¹é€ æˆæ­»å¾ªç¯å’Œæ•°æ®ä¸¢å¤±</p><p>å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹Aã€BåŒæ—¶å¯¹ä¸‹é¢è¿™ä¸ªHashMapè¿›è¡Œæ‰©å®¹æ“ä½œï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000038989243" alt="image" title="image"></p><p>æ­£å¸¸æ‰©å®¹åçš„ç»“æœæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000038989246" alt="image" title="image"></p><p>ä½†æ˜¯å½“çº¿ç¨‹Aæ‰§è¡Œåˆ°ä¸Šé¢transferå‡½æ•°çš„ç¬¬11è¡Œä»£ç æ—¶ï¼ŒCPUæ—¶é—´ç‰‡è€—å°½ï¼Œçº¿ç¨‹Aè¢«æŒ‚èµ·ã€‚å³å¦‚ä¸‹å›¾ä¸­ä½ç½®æ‰€ç¤ºï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000038989244" alt="image" title="image"></p><p>æ­¤æ—¶çº¿ç¨‹Aä¸­ï¼še&#x3D;3ã€next&#x3D;7ã€e.next&#x3D;null</p><p><img src="https://segmentfault.com/img/remote/1460000038989245" alt="image" title="image"></p><p>å½“çº¿ç¨‹Açš„æ—¶é—´ç‰‡è€—å°½åï¼ŒCPUå¼€å§‹æ‰§è¡Œçº¿ç¨‹Bï¼Œå¹¶åœ¨çº¿ç¨‹Bä¸­æˆåŠŸçš„å®Œæˆäº†æ•°æ®è¿ç§»</p><p><img src="https://segmentfault.com/img/remote/1460000038989251" alt="image" title="image"></p><p><strong>é‡ç‚¹æ¥äº†ï¼Œæ ¹æ®Javaå†…å­˜æ¨¡å¼å¯çŸ¥ï¼Œçº¿ç¨‹Bæ‰§è¡Œå®Œæ•°æ®è¿ç§»åï¼Œæ­¤æ—¶ä¸»å†…å­˜ä¸­newTableå’Œtableéƒ½æ˜¯æœ€æ–°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š7.next&#x3D;3ã€3.next&#x3D;nullã€‚</strong></p><p>éšåçº¿ç¨‹Aè·å¾—CPUæ—¶é—´ç‰‡ç»§ç»­æ‰§è¡ŒnewTable[i] &#x3D; eï¼Œå°†3æ”¾å…¥æ–°æ•°ç»„å¯¹åº”çš„ä½ç½®ï¼Œæ‰§è¡Œå®Œæ­¤è½®å¾ªç¯åçº¿ç¨‹Açš„æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000038989250" alt="image" title="image"></p><p>æ¥ç€ç»§ç»­æ‰§è¡Œä¸‹ä¸€è½®å¾ªç¯ï¼Œæ­¤æ—¶e&#x3D;7ï¼Œä»ä¸»å†…å­˜ä¸­è¯»å–e.nextæ—¶å‘ç°ä¸»å†…å­˜ä¸­7.next&#x3D;3ï¼Œæ­¤æ—¶next&#x3D;3ï¼Œå¹¶å°†7é‡‡ç”¨å¤´æ’æ³•çš„æ–¹å¼æ”¾å…¥æ–°æ•°ç»„ä¸­ï¼Œå¹¶ç»§ç»­æ‰§è¡Œå®Œæ­¤è½®å¾ªç¯ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000038989249" alt="image" title="image"></p><p><strong>æ­¤æ—¶æ²¡ä»»ä½•é—®é¢˜ã€‚</strong></p><p>ä¸Šè½®next&#x3D;3ï¼Œe&#x3D;3ï¼Œæ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯å¯ä»¥å‘ç°ï¼Œ3.next&#x3D;nullï¼Œæ‰€ä»¥æ­¤è½®å¾ªç¯å°†ä¼šæ˜¯æœ€åä¸€è½®å¾ªç¯ã€‚</p><p>æ¥ä¸‹æ¥å½“æ‰§è¡Œå®Œe.next&#x3D;newTable[i]å³3.next&#x3D;7åï¼Œ3å’Œ7ä¹‹é—´å°±ç›¸äº’è¿æ¥äº†ï¼Œå½“æ‰§è¡Œå®ŒnewTable[i]&#x3D;eåï¼Œ3è¢«å¤´æ’æ³•é‡æ–°æ’å…¥åˆ°é“¾è¡¨ä¸­ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000038989247" alt="image" title="image"></p><p><strong>ä¸Šé¢è¯´äº†æ­¤æ—¶e.next&#x3D;nullå³next&#x3D;nullï¼Œå½“æ‰§è¡Œå®Œe&#x3D;nullåï¼Œå°†ä¸ä¼šè¿›è¡Œä¸‹ä¸€è½®å¾ªç¯ã€‚åˆ°æ­¤çº¿ç¨‹Aã€Bçš„æ‰©å®¹æ“ä½œå®Œæˆï¼Œå¾ˆæ˜æ˜¾å½“çº¿ç¨‹Aæ‰§è¡Œå®Œåï¼ŒHashMapä¸­å‡ºç°äº†ç¯å½¢ç»“æ„ï¼Œå½“åœ¨ä»¥åå¯¹è¯¥HashMapè¿›è¡Œæ“ä½œæ—¶ä¼šå‡ºç°æ­»å¾ªç¯ã€‚</strong></p><p><strong>å¹¶ä¸”ä»ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œå…ƒç´ 5åœ¨æ‰©å®¹æœŸé—´è¢«è«åçš„ä¸¢å¤±äº†ï¼Œè¿™å°±å‘ç”Ÿäº†æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚</strong></p><p>3ã€JDK1.8ä¸­çš„çº¿ç¨‹ä¸å®‰å…¨</p><p>ä¸Šé¢çš„æ‰©å®¹é€ æˆçš„æ•°æ®ä¸¢å¤±ã€æ­»å¾ªç¯å·²ç»åœ¨åœ¨JDK1.8ä¸­å·²ç»å¾—åˆ°äº†å¾ˆå¥½çš„è§£å†³ï¼Œå¦‚æœä½ å»é˜…è¯»1.8çš„æºç ä¼šå‘ç°æ‰¾ä¸åˆ°HashMap#transfer()ï¼Œå› ä¸ºJDK1.8ç›´æ¥åœ¨HashMap#resize()ä¸­å®Œæˆäº†æ•°æ®è¿ç§»ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´ <strong>JDK1.8ä¼šå‡ºç°æ•°æ®è¦†ç›–çš„æƒ…å†µï¼Ÿ</strong> æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ®µJDK1.8ä¸­çš„putæ“ä½œä»£ç ï¼š</p><p><img src="https://segmentfault.com/img/remote/1460000038989248" alt="image" title="image"></p><p>å…¶ä¸­ç¬¬å…­è¡Œä»£ç æ˜¯åˆ¤æ–­æ˜¯å¦å‡ºç°hashç¢°æ’ï¼Œå‡è®¾ä¸¤ä¸ªçº¿ç¨‹Aã€Béƒ½åœ¨è¿›è¡Œputæ“ä½œï¼Œå¹¶ä¸”hashå‡½æ•°è®¡ç®—å‡ºçš„æ’å…¥ä¸‹æ ‡æ˜¯ç›¸åŒçš„ï¼Œå½“çº¿ç¨‹Aæ‰§è¡Œå®Œç¬¬å…­è¡Œä»£ç åç”±äºæ—¶é—´ç‰‡è€—å°½å¯¼è‡´è¢«æŒ‚èµ·ï¼Œè€Œçº¿ç¨‹Bå¾—åˆ°æ—¶é—´ç‰‡ååœ¨è¯¥ä¸‹æ ‡å¤„æ’å…¥äº†å…ƒç´ ï¼Œå®Œæˆäº†æ­£å¸¸çš„æ’å…¥ï¼Œç„¶åçº¿ç¨‹Aè·å¾—æ—¶é—´ç‰‡ï¼Œç”±äºä¹‹å‰å·²ç»è¿›è¡Œäº†hashç¢°æ’çš„åˆ¤æ–­ï¼Œæ‰€æœ‰æ­¤æ—¶ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥è¿›è¡Œæ’å…¥ï¼Œè¿™å°±å¯¼è‡´äº†çº¿ç¨‹Bæ’å…¥çš„æ•°æ®è¢«çº¿ç¨‹Aè¦†ç›–äº†ï¼Œä»è€Œçº¿ç¨‹ä¸å®‰å…¨ã€‚</p><p>é™¤æ­¤ä¹‹å‰ï¼Œè¿˜æœ‰å°±æ˜¯ä»£ç çš„ç¬¬38è¡Œå¤„æœ‰ä¸ª++sizeï¼Œæˆ‘ä»¬è¿™æ ·æƒ³ï¼Œè¿˜æ˜¯çº¿ç¨‹Aã€Bï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œputæ“ä½œæ—¶ï¼Œå‡è®¾å½“å‰HashMapçš„ziseå¤§å°ä¸º10ï¼Œå½“çº¿ç¨‹Aæ‰§è¡Œåˆ°ç¬¬38è¡Œä»£ç æ—¶ï¼Œä»ä¸»å†…å­˜ä¸­è·å¾—sizeçš„å€¼ä¸º10åå‡†å¤‡è¿›è¡Œ+1æ“ä½œï¼Œä½†æ˜¯ç”±äºæ—¶é—´ç‰‡è€—å°½åªå¥½è®©å‡ºCPUï¼Œçº¿ç¨‹Bå¿«ä¹çš„æ‹¿åˆ°CPUè¿˜æ˜¯ä»ä¸»å†…å­˜ä¸­æ‹¿åˆ°sizeçš„å€¼10è¿›è¡Œ+1æ“ä½œï¼Œå®Œæˆäº†putæ“ä½œå¹¶å°†size&#x3D;11å†™å›ä¸»å†…å­˜ï¼Œç„¶åçº¿ç¨‹Aå†æ¬¡æ‹¿åˆ°CPUå¹¶ç»§ç»­æ‰§è¡Œ(æ­¤æ—¶sizeçš„å€¼ä»ä¸º10)ï¼Œå½“æ‰§è¡Œå®Œputæ“ä½œåï¼Œè¿˜æ˜¯å°†size&#x3D;11å†™å›å†…å­˜ï¼Œæ­¤æ—¶ï¼Œçº¿ç¨‹Aã€Béƒ½æ‰§è¡Œäº†ä¸€æ¬¡putæ“ä½œï¼Œä½†æ˜¯sizeçš„å€¼åªå¢åŠ äº†1ï¼Œæ‰€æœ‰è¯´è¿˜æ˜¯ç”±äºæ•°æ®è¦†ç›–åˆå¯¼è‡´äº†çº¿ç¨‹ä¸å®‰å…¨ã€‚</p><h4 id="ä¸‰ã€å¦‚ä½•ä½¿HashMapåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è¿›è¡Œçº¿ç¨‹å®‰å…¨æ“ä½œï¼Ÿ"><a href="#ä¸‰ã€å¦‚ä½•ä½¿HashMapåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è¿›è¡Œçº¿ç¨‹å®‰å…¨æ“ä½œï¼Ÿ" class="headerlink" title="ä¸‰ã€å¦‚ä½•ä½¿HashMapåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è¿›è¡Œçº¿ç¨‹å®‰å…¨æ“ä½œï¼Ÿ"></a>ä¸‰ã€å¦‚ä½•ä½¿HashMapåœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹è¿›è¡Œçº¿ç¨‹å®‰å…¨æ“ä½œï¼Ÿ</h4><p>ä½¿ç”¨ Collections.synchronizedMap(map)ï¼ŒåŒ…è£…æˆåŒæ­¥Mapï¼ŒåŸç†å°±æ˜¯åœ¨HashMapçš„æ‰€æœ‰æ–¹æ³•ä¸Šsynchronizedã€‚</p><p>ä¾‹å¦‚ï¼šCollections.SynchronizedMap#get()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mutex) &#123;</span><br><span class="line">        <span class="keyword">return</span> m.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h4><p>1ã€HashMapçº¿ç¨‹ä¸å®‰å…¨åŸå› ï¼š</p><p>åŸå› ï¼š</p><ul><li>JDK1.7 ä¸­ï¼Œç”±äºå¤šçº¿ç¨‹å¯¹HashMapè¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨äº†HashMap#transfer()ï¼Œå…·ä½“åŸå› ï¼šæŸä¸ªçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¢«æŒ‚èµ·ï¼Œå…¶ä»–çº¿ç¨‹å·²ç»å®Œæˆæ•°æ®è¿ç§»ï¼Œç­‰CPUèµ„æºé‡Šæ”¾åè¢«æŒ‚èµ·çš„çº¿ç¨‹é‡æ–°æ‰§è¡Œä¹‹å‰çš„é€»è¾‘ï¼Œæ•°æ®å·²ç»è¢«æ”¹å˜ï¼Œé€ æˆæ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ã€‚</li><li>JDK1.8 ä¸­ï¼Œç”±äºå¤šçº¿ç¨‹å¯¹HashMapè¿›è¡Œputæ“ä½œï¼Œè°ƒç”¨äº†HashMap#putVal()ï¼Œå…·ä½“åŸå› ï¼šå‡è®¾ä¸¤ä¸ªçº¿ç¨‹Aã€Béƒ½åœ¨è¿›è¡Œputæ“ä½œï¼Œå¹¶ä¸”hashå‡½æ•°è®¡ç®—å‡ºçš„æ’å…¥ä¸‹æ ‡æ˜¯ç›¸åŒçš„ï¼Œå½“çº¿ç¨‹Aæ‰§è¡Œå®Œç¬¬å…­è¡Œä»£ç åç”±äºæ—¶é—´ç‰‡è€—å°½å¯¼è‡´è¢«æŒ‚èµ·ï¼Œè€Œçº¿ç¨‹Bå¾—åˆ°æ—¶é—´ç‰‡ååœ¨è¯¥ä¸‹æ ‡å¤„æ’å…¥äº†å…ƒç´ ï¼Œå®Œæˆäº†æ­£å¸¸çš„æ’å…¥ï¼Œç„¶åçº¿ç¨‹Aè·å¾—æ—¶é—´ç‰‡ï¼Œç”±äºä¹‹å‰å·²ç»è¿›è¡Œäº†hashç¢°æ’çš„åˆ¤æ–­ï¼Œæ‰€æœ‰æ­¤æ—¶ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥è¿›è¡Œæ’å…¥ï¼Œè¿™å°±å¯¼è‡´äº†çº¿ç¨‹Bæ’å…¥çš„æ•°æ®è¢«çº¿ç¨‹Aè¦†ç›–äº†ï¼Œä»è€Œçº¿ç¨‹ä¸å®‰å…¨ã€‚</li></ul><p>æ”¹å–„ï¼š</p><ul><li>æ•°æ®ä¸¢å¤±ã€æ­»å¾ªç¯å·²ç»åœ¨åœ¨JDK1.8ä¸­å·²ç»å¾—åˆ°äº†å¾ˆå¥½çš„è§£å†³ï¼Œå¦‚æœä½ å»é˜…è¯»1.8çš„æºç ä¼šå‘ç°æ‰¾ä¸åˆ°HashMap#transfer()ï¼Œå› ä¸ºJDK1.8ç›´æ¥åœ¨HashMap#resize()ä¸­å®Œæˆäº†æ•°æ®è¿ç§»ã€‚</li></ul><p>2ã€HashMapçº¿ç¨‹ä¸å®‰å…¨çš„ä½“ç°ï¼š</p><ul><li>JDK1.7 HashMapçº¿ç¨‹ä¸å®‰å…¨ä½“ç°åœ¨ï¼šæ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±</li><li>JDK1.8 HashMapçº¿ç¨‹ä¸å®‰å…¨ä½“ç°åœ¨ï¼šæ•°æ®è¦†ç›–</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://nerkeler.github.io/tags/JUC/"/>
    
    <category term="è½¬è½½" scheme="https://nerkeler.github.io/tags/%E8%BD%AC%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>Javaçº¿ç¨‹æ± </title>
    <link href="https://nerkeler.github.io/2023/06/11/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    <id>https://nerkeler.github.io/2023/06/11/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0/</id>
    <published>2023-06-11T11:45:00.000Z</published>
    <updated>2023-06-11T11:47:07.887Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Javaçº¿ç¨‹æ± "><a href="#Javaçº¿ç¨‹æ± " class="headerlink" title="Javaçº¿ç¨‹æ± "></a>Javaçº¿ç¨‹æ± </h1><p><em><strong>ä»¥ä¸‹å†…å®¹ä¸ºé˜…è¯»ã€ŠJAVAå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹å­¦ä¹ æ€»ç»“ ç¬”è®°</strong></em></p><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Javaä¸­çš„çº¿ç¨‹æ± æ˜¯è¿ç”¨åœºæ™¯æœ€å¤šçš„å¹¶å‘æ¡†æ¶ï¼Œå‡ ä¹æ‰€æœ‰éœ€è¦å¼‚æ­¥æˆ–å¹¶å‘æ‰§è¡Œä»»åŠ¡çš„ç¨‹åº éƒ½å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆç†åœ°ä½¿ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥3ä¸ªå¥½å¤„ã€‚</p><h4 id="çº¿ç¨‹æ± çš„ä¼˜ç‚¹"><a href="#çº¿ç¨‹æ± çš„ä¼˜ç‚¹" class="headerlink" title="çº¿ç¨‹æ± çš„ä¼˜ç‚¹"></a>çº¿ç¨‹æ± çš„ä¼˜ç‚¹</h4><ul><li><strong>é™ä½èµ„æºæ¶ˆè€—</strong>ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li><li><strong>æé«˜å“åº”é€Ÿåº¦</strong>ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œ</li><li><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong>ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä¹…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜å’Œç›‘æ§ã€‚ä½†æ˜¯ï¼Œè¦åšåˆ°åˆç†åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå¿…é¡»å¯¹å…¶å®ç°åŸç†äº†å¦‚æŒ‡æŒã€‚</li></ul><h3 id="çº¿ç¨‹æ± çš„å®ç°åŸç†"><a href="#çº¿ç¨‹æ± çš„å®ç°åŸç†" class="headerlink" title="çº¿ç¨‹æ± çš„å®ç°åŸç†"></a>çº¿ç¨‹æ± çš„å®ç°åŸç†</h3><h4 id="çº¿ç¨‹æ± çš„åˆ›å»º"><a href="#çº¿ç¨‹æ± çš„åˆ›å»º" class="headerlink" title="çº¿ç¨‹æ± çš„åˆ›å»º"></a>çº¿ç¨‹æ± çš„åˆ›å»º</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>ThreadPoolExecutor</code>æ„é€ æ–¹æ³•ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡ï¼Œ<strong>ç§»é™¤äº†å†…éƒ¨ä»£ç ï¼Œåªç•™ä¸‹äº†æ„é€ å‚æ•°</strong>ï¼Œä¾¿äºç†è§£ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">                              TimeUnit unit,</span></span><br><span class="line"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">                              ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">                              RejectedExecutionHandler handler)</span> &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‚æ•°å¯¹åº”å…³ç³»</p><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>corePoolSize</code></td><td>æ ¸å¿ƒçº¿ç¨‹æ•°</td></tr><tr><td><code>maximumPoolSize</code></td><td>æœ€å¤§çº¿ç¨‹æ•°</td></tr><tr><td><code>keepAliveTime</code></td><td>çº¿ç¨‹æ´»åŠ¨ä¿æŒæ—¶é—´</td></tr><tr><td><code>TimeUnit</code></td><td>çº¿ç¨‹æ´»åŠ¨ä¿æŒæ—¶é—´çš„å•ä½</td></tr><tr><td><code>BlockingQueue</code><Runnable></td><td>ä»»åŠ¡é˜Ÿåˆ—</td></tr><tr><td><code>ThreadFactory</code></td><td>çº¿ç¨‹å·¥å‚</td></tr><tr><td><code>RejectedExecutionHandler</code></td><td>æ‹’ç»ç­–ç•¥</td></tr></tbody></table><p>å¤§è‡´æ˜ç™½å‚æ•°æ„ä¹‰åï¼Œæˆ‘ä»¬è¯´ä¸€ä¸‹çº¿ç¨‹æ± æ–°å»ºä¸€ä¸ªçº¿ç¨‹çš„è¿‡ç¨‹</p><p>å…ˆçœ‹ä¸€ä¸‹çº¿ç¨‹æ± çš„æ‰§è¡Œç¤ºæ„å›¾</p><ol><li>ä¸»çº¿ç¨‹æ‰§è¡Œ<code>execute</code>()æäº¤ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œé¦–å…ˆè¿›å…¥æ ¸å¿ƒçº¿ç¨‹æ± <code>corePoolSize</code>å¹¶åˆ¤æ–­æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæœªæ»¡åˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹<strong>ï¼ˆæ³¨æ„ï¼Œæ‰§è¡Œè¿™ä¸€æ­¥éª¤ éœ€è¦è·å–å…¨å±€é”ï¼‰ã€‚</strong></li><li>å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ± å·²æ»¡ï¼Œåˆ™è¿›å…¥é˜»å¡é˜Ÿåˆ—<code>BlockingQueue</code>è¿›è¡Œåˆ¤æ–­æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæœªæ»¡åˆ™æ’å…¥é˜Ÿåˆ—ï¼ˆé˜Ÿåˆ—ä¿æŒå…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œ ï¼‰</li><li>å¦‚æœé˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡<code>maximumPoolSize</code>ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ–°å»ºçº¿ç¨‹<strong>ï¼ˆæ³¨æ„ï¼Œæ‰§è¡Œè¿™ä¸€æ­¥éª¤ éœ€è¦è·å–å…¨å±€é”ï¼‰ã€‚</strong></li><li>å¦‚æœè¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥<code>RejectedExecutionHandler</code></li></ol><p><img src="https://pic.imgdb.cn/item/64807dd91ddac507cc2c89a9.png"></p><p>å¦‚æœå°†ä¸Šè¿°æè¿°è½¬åŒ–æˆæµç¨‹å›¾åˆ™ä¸º</p><p><img src="https://pic.imgdb.cn/item/64807fbf1ddac507cc2f94cf.png"></p><h4 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h4><p>ä¸Šé¢çš„æµç¨‹åˆ†æè®©æˆ‘ä»¬å¾ˆç›´è§‚åœ°äº†è§£äº†çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬å†é€šè¿‡æºä»£ ç æ¥çœ‹çœ‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Œçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡çš„æ–¹æ³•å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (command == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> ctl.get();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå°äºæ‰§è¡Œå½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;</span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="literal">true</span>))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        c = ctl.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦åˆ™å°è¯•åŠ å…¥é˜»å¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">recheck</span> <span class="operator">=</span> ctl.get();</span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">            reject(command);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">            addWorker(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€åå°è¯•åŠ å…¥æœ€å¤§çº¿ç¨‹ä¸­</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="literal">false</span>))</span><br><span class="line">        reject(command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å·¥ä½œçº¿ç¨‹"><a href="#å·¥ä½œçº¿ç¨‹" class="headerlink" title="å·¥ä½œçº¿ç¨‹"></a>å·¥ä½œçº¿ç¨‹</h4><p>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¼šå°†çº¿ç¨‹å°è£…æˆå·¥ä½œçº¿ç¨‹Workerï¼ŒWorkeråœ¨æ‰§è¡Œå®Œä»»åŠ¡åï¼Œè¿˜ä¼šå¾ªç¯è·å–å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä»Workerç±»çš„run()æ–¹æ³•é‡Œçœ‹åˆ°è¿™ç‚¹ã€‚</p><p><em><strong>åªå…³æ³¨whileå¾ªç¯å’Œå†…éƒ¨<code>task.run</code>å³å¯</strong></em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    runWorker(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">runWorker</span><span class="params">(Worker w)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">wt</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> w.firstTask;</span><br><span class="line">    w.firstTask = <span class="literal">null</span>;</span><br><span class="line">    w.unlock(); <span class="comment">// allow interrupts</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">completedAbruptly</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (task != <span class="literal">null</span> || (task = getTask()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            w.lock();</span><br><span class="line">            <span class="comment">// äºŒæ¬¡éªŒè¯çº¿ç¨‹æ˜¯å¦ä¸­æ–­æˆ–åœæ­¢</span></span><br><span class="line">            <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                 (Thread.interrupted() &amp;&amp;</span><br><span class="line">                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                !wt.isInterrupted())</span><br><span class="line">                wt.interrupt();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    task.run();</span><br><span class="line">                    afterExecute(task, <span class="literal">null</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                    afterExecute(task, ex);</span><br><span class="line">                    <span class="keyword">throw</span> ex;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                task = <span class="literal">null</span>;</span><br><span class="line">                w.completedTasks++;</span><br><span class="line">                w.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        completedAbruptly = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        processWorkerExit(w, completedAbruptly);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ThreadPoolExecutor</code>ä¸­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„ç¤ºæ„å›¾å¦‚ä¸‹</p><img src="https://pic.imgdb.cn/item/6481703c1ddac507cc81ba88.png"><p><strong>çº¿ç¨‹æ± ä¸­å¾—å…ˆæˆåŠŸæ‰§è¡Œä»»åŠ¡ä»½ä¸¤ç§æƒ…å†µ</strong></p><ul><li>åœ¨execute()æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œä¼šè®©è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå½“å‰ä»»åŠ¡</li><li>è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä¸Šå›¾ä¸­1å¾—ä»»åŠ¡åï¼Œä¼šåå¤ä»<code>BlockingQueue</code>è·å–ä»»åŠ¡æ¥æ‰§è¡Œ</li></ul><h4 id="çº¿ç¨‹æ± å‚æ•°"><a href="#çº¿ç¨‹æ± å‚æ•°" class="headerlink" title="çº¿ç¨‹æ± å‚æ•°"></a>çº¿ç¨‹æ± å‚æ•°</h4><h5 id="corePoolSizeï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰"><a href="#corePoolSizeï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰" class="headerlink" title="corePoolSizeï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰"></a><code>corePoolSize</code>ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰</h5><p>å½“æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± ä¸­æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå³ä½¿å…¶ä»–ç©ºé—²çš„åŸºæœ¬çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°ä»»åŠ¡ä¹Ÿä¼šåˆ›å»ºçº¿ç¨‹ï¼Œç­‰å¾…éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°å¤§äºçº¿ç¨‹æ± åŸºæœ¬å¤§å°ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰æ—¶å°±ä¸åœ¨åˆ›å»ºã€‚å¦‚æœè°ƒç”¨äº†çº¿ç¨‹æ± çš„prestartAllCoreThreads()æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚</p><h5 id="runnableTaskQueueï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰"><a href="#runnableTaskQueueï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰" class="headerlink" title="runnableTaskQueueï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰"></a><code>runnableTaskQueue</code>ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰</h5><p>ç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚æœ‰ä»¥ä¸‹å‡ ç§</p><ul><li><code>ArrayBlockingQueue</code>: ä¸€ä¸ªåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰ç…§FIFOï¼ˆfirst in first out)å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li><code>LinkedBlockingQueue</code>:ä¸€ä¸ªåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿæ˜¯æŒ‰ç…§FIFO åŸåˆ™æ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸é«˜äº<code>ArrayBlockingQueue</code>ã€‚é™æ€å·¥å‚æ–¹æ³•<code>Executors.newFixedThreadPool()</code>ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li><li><code>SynchronousQueue</code>: ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äº<code>LinkedBlockingQueue</code>,é™æ€å·¥å‚æ–¹æ³•<code>Executors.newCachedThreadPool</code>ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—</li><li><code>ProirityBlockingQueue</code>:ä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§çš„æ— é™é˜»å¡é˜Ÿåˆ—</li></ul><h5 id="maximumPoolSizeï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰"><a href="#maximumPoolSizeï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰" class="headerlink" title="maximumPoolSizeï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰"></a><code>maximumPoolSize</code>ï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰</h5><p>çº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœæ ¸å¿ƒçº¿ç¨‹å’Œé˜Ÿåˆ—éƒ½å·²ç»æ»¡äº†ï¼Œå¹¶ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­3è¿™ç§æƒ…å†µï¼Œåç»­æäº¤çš„çº¿ç¨‹åˆ™ä¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼Œ<strong>å½“ä½¿ç”¨æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼Œæäº¤çš„çº¿ç¨‹ä¼šæ— é™é˜»å¡åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªå‚æ•°å°±å¤±å»äº†æ„ä¹‰ã€‚</strong></p><h5 id="ThreadFactoryï¼ˆçº¿ç¨‹å·¥å‚ï¼‰"><a href="#ThreadFactoryï¼ˆçº¿ç¨‹å·¥å‚ï¼‰" class="headerlink" title="ThreadFactoryï¼ˆçº¿ç¨‹å·¥å‚ï¼‰"></a><code>ThreadFactory</code>ï¼ˆçº¿ç¨‹å·¥å‚ï¼‰</h5><p><code>ThreadFactory</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ã€‚å®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå’Œå®šåˆ¶çº¿ç¨‹çš„æ–¹å¼ï¼Œè®©ä½ èƒ½å¤Ÿå¯¹çº¿ç¨‹è¿›è¡Œæ›´å¤šçš„æ§åˆ¶å’Œç®¡ç†ã€‚ä¾‹å¦‚è‡ªå®šä¹‰çº¿ç¨‹åç§°ã€è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ã€è®¾ç½®çº¿ç¨‹ç»„ç­‰ã€‚</p><h5 id="RejectedExecutionHandlerï¼ˆæ‹’ç»ç­–ç•¥ï¼‰"><a href="#RejectedExecutionHandlerï¼ˆæ‹’ç»ç­–ç•¥ï¼‰" class="headerlink" title="RejectedExecutionHandlerï¼ˆæ‹’ç»ç­–ç•¥ï¼‰"></a><code>RejectedExecutionHandler</code>ï¼ˆæ‹’ç»ç­–ç•¥ï¼‰</h5><p>å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»æ‰éœ€ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚é»˜è®¤è¯·æƒ…å†µä¸‹ä½¿ç”¨çš„æ—¶AbortPolicy,è¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚è‡ªJDK1.5 Javaçº¿ç¨‹æ± æä¾›äº†4ä¸­ç­–ç•¥</p><ul><li><code>AbortPolicy</code> ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li><li><code>CallerRunsPolicy</code> åªç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹è¿è¡Œä»»åŠ¡</li><li><code>DiscardOldestPolicy</code> ä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€æ—§çš„ä»»åŠ¡ä¹Ÿå°±æ˜¯æœ€æ—©æ·»åŠ çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶å°è¯•æ‰§è¡Œå½“å‰ä»»åŠ¡</li><li><code>DiscardPolicy</code> ä¸å¤„ç†  ç›´æ¥ä¸¢å¼ƒ</li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯è‡ªå·±å®ç°<code>RejectedExecutionHandler</code>æ¥å£è‡ªå®šä¹‰ç­–ç•¥ï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡</p><h5 id="keepAliveTimeï¼ˆå­˜æ´»æ—¶é—´ï¼‰"><a href="#keepAliveTimeï¼ˆå­˜æ´»æ—¶é—´ï¼‰" class="headerlink" title="keepAliveTimeï¼ˆå­˜æ´»æ—¶é—´ï¼‰"></a><code>keepAliveTime</code>ï¼ˆå­˜æ´»æ—¶é—´ï¼‰</h5><p>çº¿ç¨‹æ± å¯¹çš„å·¥ä½œçº¿ç¨‹ç©ºé—²åï¼Œä¿æŒå­˜æ´»çš„æ—¶é—´ï¼Œçº¿ç¨‹åœ¨å­˜æ´»æ—¶é—´å†…å¯è¢«é‡å¤åˆ©ç”¨ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œè°ƒå¤§å­˜æ´»æ—¶é—´å¯ä»¥æé«˜çº¿ç¨‹åˆ©ç”¨ç‡ï¼Œé¿å…çº¿ç¨‹çš„é‡æ–°å¯åŠ¨å’Œç»ˆæ­¢æ‰€äº§ç”Ÿçš„é¢å¤–æ—¶é—´æ¶ˆè€—</p><h5 id="TimeUnit-å­˜æ´»æ—¶é—´å•ä½"><a href="#TimeUnit-å­˜æ´»æ—¶é—´å•ä½" class="headerlink" title="TimeUnit(å­˜æ´»æ—¶é—´å•ä½)"></a><code>TimeUnit</code>(å­˜æ´»æ—¶é—´å•ä½)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.util.concurrent.TimeUnit</span><br></pre></td></tr></table></figure><p>å¯é€‰</p><ul><li>SECONDS                           ç§’</li><li>DAYS                                   å¤©</li><li>HOURS                               å°æ—¶</li><li>MICROSECONDS              å¾®ç§’</li><li>MILLISECONDS                 æ¯«ç§’</li><li>MINUTES                           åˆ†é’Ÿ</li><li>NANOSECONDS               çº³ç§’</li></ul><h4 id="æäº¤çº¿ç¨‹ä»»åŠ¡"><a href="#æäº¤çº¿ç¨‹ä»»åŠ¡" class="headerlink" title="æäº¤çº¿ç¨‹ä»»åŠ¡"></a>æäº¤çº¿ç¨‹ä»»åŠ¡</h4><p>çº¿ç¨‹æ± æäº¤ä»»åŠ¡ä½¿ç”¨execute()æ–¹æ³•å’Œsubmit()æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äºexecute()æ–¹æ³•æ— è¿”å›å€¼ï¼Œsubmit()æ–¹æ³•å¯ä»¥è·å–çº¿ç¨‹æ‰§è¡Œè¿”å›å€¼ï¼Œå®ƒè¿”å›ä¸€ä¸ªFutureæ¥å£å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>future.get()</code>é˜»å¡çº¿ç¨‹è·å–è¿”å›å€¼</p><h5 id="execute"><a href="#execute" class="headerlink" title="execute()"></a>execute()</h5><p>æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°execute()æ¥æ”¶ä¸€ä¸ªRunnableçš„å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿæ— è¿”å›å€¼ï¼Œæ‰€ä»¥æ— æ³•åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æ˜¯å¦è¢«çº¿ç¨‹æ± æ‰§è¡ŒæˆåŠŸï¼ˆå¦‚æœçº¿ç¨‹æ²¡æœ‰æ‰“å°æˆ–æ—¥å¿—çš„æƒ…å†µä¸‹ï¼‰ï¼Œä¸€ä¸ªå°ä¾‹å­å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">    executorService.execute(()-&gt; System.out.println(<span class="string">&quot;æäº¤æ–°çº¿ç¨‹æˆåŠŸ&quot;</span>));</span><br><span class="line">    executorService.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœä¸è¨€è€Œå–»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æäº¤æ–°çº¿ç¨‹æˆåŠŸ</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h5 id="submit"><a href="#submit" class="headerlink" title="submit()"></a>submit()</h5><p>æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br><span class="line">&lt;T&gt; Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Runnable task, T result)</span>;</span><br><span class="line">&lt;T&gt; Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Callable&lt;T&gt; task)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°submit()æ–¹æ³•è¿”å›ä¸€ä¸ªFutureæ¥å£å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Futureçš„get()æ–¹æ³•è·å–è¿”å›å€¼ï¼Œå½“ç„¶get()æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹</p><p>ä¸€ä¸ªå°ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">    Future&lt;String&gt; submit = executorService.submit(() -&gt; <span class="string">&quot;æäº¤æ–°çº¿ç¨‹æˆåŠŸ&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(submit.get());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    executorService.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æäº¤æ–°çº¿ç¨‹æˆåŠŸ</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="å…³é—­çº¿ç¨‹æ± "><a href="#å…³é—­çº¿ç¨‹æ± " class="headerlink" title="å…³é—­çº¿ç¨‹æ± "></a>å…³é—­çº¿ç¨‹æ± </h4><p>å…³é—­çº¿ç¨‹æ± å¯ä»¥ä½¿ç”¨shutdownæˆ–shutdownNowæ–¹æ³•ï¼Œä»–ä»¬çš„åŸç†æ˜¯éå†çº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ï¼Œç„¶åé€ä¸ªè°ƒç”¨çº¿ç¨‹çš„interruptæ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹ã€‚</p><p>åŒºåˆ«åœ¨äºshutdownNowä¼šå…ˆå°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®æˆstop,ç„¶åå°è¯•åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œæˆ–æš‚åœçš„ä»»åŠ¡çº¿ç¨‹ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„åˆ—è¡¨ï¼Œè€Œshutdownåªæ˜¯å°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®æˆSHUTDOWNçŠ¶æ€ï¼Œç„¶åä¸­æ–­æ‰€æœ‰æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡çº¿ç¨‹</p><p>åªè¦è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œ<code>isShutdown</code>æ–¹æ³•å°±ä¼šè¿”å›<code>ture</code>,å½“æ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»å…³é—­åï¼Œæ‰è¡¨ç¤ºçº¿ç¨‹æ± å…³é—­æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™è°ƒç”¨<code>idTerminaed</code>æ–¹æ³•ä¼šè¿”å›<code>true</code>ã€‚é€šå¸¸ä½¿ç”¨shutdownæ–¹æ³•å…³é—­çº¿ç¨‹ã€‚</p><h4 id="åˆç†åœ°é…ç½®çº¿ç¨‹æ± "><a href="#åˆç†åœ°é…ç½®çº¿ç¨‹æ± " class="headerlink" title="åˆç†åœ°é…ç½®çº¿ç¨‹æ± "></a>åˆç†åœ°é…ç½®çº¿ç¨‹æ± </h4><p>è¦æƒ³åˆç†åœ°é…ç½®çº¿ç¨‹æ± ï¼Œå°±å¿…é¡»é¦–å…ˆåˆ†æä»»åŠ¡ç‰¹æ€§ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦æ¥åˆ†æã€‚</p><ul><li>ä»»åŠ¡çš„æ€§è´¨ï¼šCPUå¯†é›†å‹ä»»åŠ¡ã€IOå¯†é›†å‹ä»»åŠ¡å’Œæ··åˆå‹ä»»åŠ¡ã€‚ </li><li>ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼šé«˜ã€ä¸­å’Œä½ã€‚ Â·ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼šé•¿ã€ä¸­å’ŒçŸ­ã€‚</li><li>ä»»åŠ¡çš„ä¾èµ–æ€§ï¼šæ˜¯å¦ä¾èµ–å…¶ä»–ç³»ç»Ÿèµ„æºï¼Œå¦‚æ•°æ®åº“è¿æ¥ã€‚</li></ul><p>æ€§è´¨ä¸åŒçš„ä»»åŠ¡å¯ä»¥ç”¨ä¸åŒè§„æ¨¡çš„çº¿ç¨‹æ± åˆ†å¼€å¤„ç†ã€‚CPUå¯†é›†å‹ä»»åŠ¡åº”é…ç½®å°½å¯èƒ½å°çš„ çº¿ç¨‹ï¼Œå¦‚é…ç½®<code>**Ncpu+1**</code>ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ç”±äºIOå¯†é›†å‹ä»»åŠ¡çº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ç›´åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™åº”é… ç½®å°½å¯èƒ½å¤šçš„çº¿ç¨‹ï¼Œå¦‚<code>**2*Ncpu**</code>ã€‚æ··åˆå‹çš„ä»»åŠ¡ï¼Œå¦‚æœå¯ä»¥æ‹†åˆ†ï¼Œå°†å…¶æ‹†åˆ†æˆä¸€ä¸ªCPUå¯†é›†å‹ä»»åŠ¡ å’Œä¸€ä¸ªIOå¯†é›†å‹ä»»åŠ¡ï¼Œåªè¦è¿™ä¸¤ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ç›¸å·®ä¸æ˜¯å¤ªå¤§ï¼Œé‚£ä¹ˆåˆ†è§£åæ‰§è¡Œçš„ååé‡ å°†é«˜äºä¸²è¡Œæ‰§è¡Œçš„ååé‡ã€‚å¦‚æœè¿™ä¸¤ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´ç›¸å·®å¤ªå¤§ï¼Œåˆ™æ²¡å¿…è¦è¿›è¡Œåˆ†è§£ã€‚å¯ä»¥é€šè¿‡ <code>**Runtime.getRuntime().availableProcessors()**</code>æ–¹æ³•è·å¾—å½“å‰è®¾å¤‡çš„CPUä¸ªæ•°ã€‚</p><ul><li>ä¼˜å…ˆçº§ä¸åŒçš„ä»»åŠ¡å¯ä»¥ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—<code>PriorityBlockingQueue</code>æ¥å¤„ç†ã€‚å®ƒå¯ä»¥è®©ä¼˜å…ˆçº§é«˜ çš„ä»»åŠ¡å…ˆæ‰§è¡Œã€‚</li><li>æ‰§è¡Œæ—¶é—´ä¸åŒçš„ä»»åŠ¡å¯ä»¥äº¤ç»™ä¸åŒè§„æ¨¡çš„çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œè®© æ‰§è¡Œæ—¶é—´çŸ­çš„ä»»åŠ¡å…ˆæ‰§è¡Œã€‚</li><li>ä¾èµ–æ•°æ®åº“è¿æ¥æ± çš„ä»»åŠ¡ï¼Œå› ä¸ºçº¿ç¨‹æäº¤SQLåéœ€è¦ç­‰å¾…æ•°æ®åº“è¿”å›ç»“æœï¼Œç­‰å¾…çš„æ—¶é—´è¶Š é•¿ï¼Œåˆ™CPUç©ºé—²æ—¶é—´å°±è¶Šé•¿ï¼Œé‚£ä¹ˆçº¿ç¨‹æ•°åº”è¯¥è®¾ç½®å¾—è¶Šå¤§ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°åˆ©ç”¨CPUã€‚</li></ul><p><em><strong>PS:</strong></em></p><p>***å¦‚æœä¸€ç›´æœ‰ä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡æäº¤åˆ°é˜Ÿåˆ—é‡Œï¼Œé‚£ä¹ˆä¼˜å…ˆçº§ä½çš„ä»»åŠ¡å¯èƒ½æ°¸è¿œä¸èƒ½ æ‰§è¡Œã€‚***</p><p>â€‹*<strong>å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</strong>,æœ‰ç•Œé˜Ÿåˆ—èƒ½å¢åŠ ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé¢„è­¦èƒ½åŠ›ã€‚</p><h4 id="çº¿ç¨‹æ± çš„ç›‘æ§"><a href="#çº¿ç¨‹æ± çš„ç›‘æ§" class="headerlink" title="çº¿ç¨‹æ± çš„ç›‘æ§"></a>çº¿ç¨‹æ± çš„ç›‘æ§</h4><p>å¦‚æœåœ¨ç³»ç»Ÿä¸­å¤§é‡ä½¿ç”¨çº¿ç¨‹æ± ï¼Œåˆ™æœ‰å¿…è¦å¯¹çº¿ç¨‹æ± è¿›è¡Œç›‘æ§ï¼Œæ–¹ä¾¿åœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥æ ¹æ®çº¿ç¨‹æ± çš„ä½¿ç”¨çŠ¶å†µå¿«é€Ÿå®šä½é—®é¢˜ã€‚</p><p>å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æä¾›çš„å‚æ•°è¿›è¡Œç›‘æ§ï¼Œåœ¨ç›‘æ§çº¿ç¨‹æ± çš„ æ—¶å€™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§ã€‚ </p><ul><li><code>taskCount</code>ï¼šçº¿ç¨‹æ± éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ã€‚ </li><li><code>completedTaskCount</code>ï¼šçº¿ç¨‹æ± åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å·²å®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼Œå°äºæˆ–ç­‰äº<code>taskCount</code>ã€‚ </li><li><code>largestPoolSize</code>ï¼šçº¿ç¨‹æ± é‡Œæ›¾ç»åˆ›å»ºè¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚é€šè¿‡è¿™ä¸ªæ•°æ®å¯ä»¥çŸ¥é“çº¿ç¨‹æ± æ˜¯ å¦æ›¾ç»æ»¡è¿‡ã€‚å¦‚è¯¥æ•°å€¼ç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§å¤§å°ï¼Œåˆ™è¡¨ç¤ºçº¿ç¨‹æ± æ›¾ç»æ»¡è¿‡ã€‚</li><li><code>getPoolSize</code>ï¼šçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ã€‚å¦‚æœçº¿ç¨‹æ± ä¸é”€æ¯çš„è¯ï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹ä¸ä¼šè‡ªåŠ¨é”€ æ¯ï¼Œæ‰€ä»¥è¿™ä¸ªå¤§å°åªå¢ä¸å‡ã€‚ </li><li><code>getActiveCount</code>ï¼šè·å–æ´»åŠ¨çš„çº¿ç¨‹æ•°ã€‚</li></ul><p>é€šè¿‡æ‰©å±•çº¿ç¨‹æ± è¿›è¡Œç›‘æ§ã€‚å¯ä»¥é€šè¿‡ç»§æ‰¿çº¿ç¨‹æ± æ¥è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œé‡å†™çº¿ç¨‹æ± çš„ <code>beforeExecute</code>ã€<code>afterExecute</code>å’Œ<code>terminated</code>æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå‰ã€æ‰§è¡Œåå’Œçº¿ç¨‹æ± å…³é—­å‰æ‰§ è¡Œä¸€äº›ä»£ç æ¥è¿›è¡Œç›‘æ§ã€‚ä¾‹å¦‚ï¼Œç›‘æ§ä»»åŠ¡çš„å¹³å‡æ‰§è¡Œæ—¶é—´ã€æœ€å¤§æ‰§è¡Œæ—¶é—´å’Œæœ€å°æ‰§è¡Œæ—¶é—´ç­‰ã€‚ è¿™å‡ ä¸ªæ–¹æ³•åœ¨çº¿ç¨‹æ± é‡Œæ˜¯ç©ºæ–¹æ³•ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://nerkeler.github.io/tags/JUC/"/>
    
    <category term="çº¿ç¨‹æ± " scheme="https://nerkeler.github.io/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    
  </entry>
  
  <entry>
    <title>Futureå’ŒCompletableFuture</title>
    <link href="https://nerkeler.github.io/2023/06/04/UntitledFuture%E5%92%8CCompletableFuture/"/>
    <id>https://nerkeler.github.io/2023/06/04/UntitledFuture%E5%92%8CCompletableFuture/</id>
    <published>2023-06-04T03:36:00.000Z</published>
    <updated>2023-06-04T03:45:37.427Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Futureå’ŒCompletableFuture"><a href="#Futureå’ŒCompletableFuture" class="headerlink" title="Futureå’ŒCompletableFuture"></a>Futureå’ŒCompletableFuture</h1><h2 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @since 1.5</span></span><br><span class="line"><span class="comment">* @author Doug Lea</span></span><br><span class="line"><span class="comment">* @param &lt;V&gt; The result type returned by this FutureTask&#x27;s &#123;@code get&#125; methods</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureTask</span>&lt;V&gt; <span class="keyword">implements</span> <span class="title class_">RunnableFuture</span>&lt;V&gt; &#123;</span><br></pre></td></tr></table></figure><p>Futureæ¥å£åœ¨Java 5ä¸­è¢«å¼•å…¥ï¼Œè®¾è®¡åˆè¡·æ˜¯å¯¹å°†æ¥æŸä¸ªæ—¶åˆ»ä¼šå‘ç”Ÿçš„ç»“æœè¿›è¡Œå»ºæ¨¡ã€‚å®ƒå»ºæ¨¡ äº†ä¸€ç§å¼‚æ­¥è®¡ç®—ï¼Œè¿”å›ä¸€ä¸ªæ‰§è¡Œè¿ç®—ç»“æœçš„å¼•ç”¨ï¼Œå½“è¿ç®—ç»“æŸåï¼Œè¿™ä¸ªå¼•ç”¨è¢«è¿”å›ç»™è°ƒç”¨æ–¹ã€‚</p><h4 id="ä¸€ä¸ªç®€å•ä¾‹å­"><a href="#ä¸€ä¸ªç®€å•ä¾‹å­" class="headerlink" title="ä¸€ä¸ªç®€å•ä¾‹å­"></a>ä¸€ä¸ªç®€å•ä¾‹å­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class="line">       <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">       <span class="comment">// æŠŠéœ€è¦è€—æ—¶å¾—äº‹æƒ…äº¤ç»™ future ä¸­å¾—çº¿ç¨‹æ± </span></span><br><span class="line">       Future&lt;Double&gt; future = executor.submit(() -&gt; &#123;</span><br><span class="line">           TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">           System.out.println(<span class="string">&quot;doSomeLongComputation&quot;</span>);</span><br><span class="line">           <span class="keyword">return</span> ThreadLocalRandom.current().nextDouble();</span><br><span class="line">       &#125;);</span><br><span class="line">       <span class="comment">// åšä¸€äº›å…¶ä»–çš„äº‹æƒ…</span></span><br><span class="line">       System.out.println(<span class="string">&quot;doSomethingElse&quot;</span>);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">Double</span> <span class="variable">result</span> <span class="operator">=</span> future.get(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">           System.out.println(result);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           <span class="comment">// è®¡ç®—æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</span></span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">       executor.shutdown();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">doSomethingElse</span><br><span class="line">doSomeLongComputation</span><br><span class="line"><span class="number">0.3039716200549002</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç è®©æˆ‘ä»¬å¯ä»¥ä»¥å¹¶å‘å¾—æ–¹å¼è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œå¾—åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å»æ‰§è¡Œä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚å¯åŠ¨å¼‚æ­¥ä»»åŠ¡ï¼Œåæˆ‘ä»¬å¯ä»¥è°ƒç”¨å®ƒå¾—get()æ–¹æ³•è·å–æ“ä½œè¿”å›å€¼ï¼Œå¦‚æœé€šè¿‡getè·å–æ—¶ç¨‹åºåœ¨ä¼ å…¥è§„å®šæ—¶é—´è¿˜æ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè·å–æ—¶è¿˜æ²¡æœ‰ç”Ÿæˆè¿”å›å€¼åˆ™ä¼šè¿›è¡Œé˜»å¡ã€‚</p><p><img src="https://pic.imgdb.cn/item/6475a5ecf024cca1734dcc0b.png"></p><p>ç†è§£äº†ä¸Šè¿°æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹Futureæ¥å£æä¾›çš„å‡ ä¸ªåŸºæœ¬æ–¹æ³•</p><table><thead><tr><th>Modifier and Type</th><th>Method and Description</th></tr></thead><tbody><tr><td><code>boolean</code></td><td>cancel(<code>boolean</code> <code>mayInterruptIfRunning</code>) å°è¯•å–æ¶ˆæ‰§è¡Œæ­¤ä»»åŠ¡ã€‚</td></tr><tr><td>V</td><td>get() ç­‰å¾…è®¡ç®—å®Œæˆï¼Œç„¶åæ£€ç´¢å…¶ç»“æœã€‚</td></tr><tr><td>V</td><td>get(long timeout, <code>TimeUnit</code> unit) å¦‚æœéœ€è¦ç­‰å¾…æœ€å¤šåœ¨ç»™å®šçš„æ—¶é—´è®¡ç®—å®Œæˆï¼Œç„¶åæ£€ç´¢å…¶ç»“æœï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚</td></tr><tr><td><code>boolean</code></td><td>isCancelled() å¦‚æœæ­¤ä»»åŠ¡åœ¨æ­£å¸¸å®Œæˆä¹‹å‰è¢«å–æ¶ˆï¼Œåˆ™è¿”å› true ã€‚</td></tr><tr><td><code>boolean</code></td><td>isDone() è¿”å› trueå¦‚æœä»»åŠ¡å·²å®Œæˆã€‚</td></tr></tbody></table><p>æˆ‘ä»¬çœ‹åˆ°getæ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½å¾—æ–¹æ³•ï¼Œget(long timeout,<code>TimeUnit</code> unit) å’Œget(ï¼‰çš„åŒºåˆ«æ˜¯å¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å¾—åˆ°ç»“æœçš„è¿”å›å€¼ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç¨‹åºä¼šç»§ç»­è¿è¡Œï¼Œè€Œget()æ–¹æ³•åˆ™ä¼šé˜»å¡ä¸»çº¿ç¨‹è¿›è¡Œç­‰å¾…ï¼ŒçŸ¥é“è·å–è¿”å›å€¼ï¼Œå¦‚æœå¼‚æ­¥çº¿ç¨‹æ˜¯ä¸€ä¸ªæå…¶è€—è´¹æ—¶é—´çš„æ“ä½œï¼Œåˆ™ä¼šå¯¼è‡´ä¸»çº¿ç¨‹è¿›å…¥æ¼«é•¿çš„ç­‰å¾…</p><h4 id="Future-æ¥å£çš„å±€é™æ€§"><a href="#Future-æ¥å£çš„å±€é™æ€§" class="headerlink" title="Future æ¥å£çš„å±€é™æ€§"></a><strong>Future æ¥å£çš„å±€é™æ€§</strong></h4><p>é€šè¿‡ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹åˆ°Futureæ¥å£å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿›å…¥æ¼«é•¿çš„ç­‰å¾…æˆ–è€…ç›´æ¥æŠ›å¼ƒè·å–å€¼æ“ä½œï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡isDone()æ£€æµ‹ç¨‹åºæ˜¯å¦è¿è¡Œå®Œæ¯•ï¼Œä½†æ˜¯å§‹ç»ˆè¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„è¿è¡Œé˜»å¡ä¸ç­‰å¾…<br>å¦‚æœæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šæˆ‘ä»¬éœ€è¦å®Œæˆä¸¤ä¸ªè®¡ç®—ä»»åŠ¡ï¼Œå½“å‰ä¸€ä¸ªè®¡ç®—ä»»åŠ¡ç»“æŸåï¼Œéœ€è¦å°†æ”¹è®¡ç®—çš„ç»“æœé€šçŸ¥åˆ°å¦ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„è®¡ç®—ä»»åŠ¡ï¼Œå½“ä¸¤ä¸ªè®¡ç®—ä»»åŠ¡éƒ½ç»“æŸåï¼Œå°†ä¸¤ä¸ªè®¡ç®—ä»»åŠ¡åˆå¹¶åè¾“å‡ºã€‚ æ–°çš„<code>CompletableFuture</code>ç±»  ä¼šå¾ˆæ–¹ä¾¿çš„è§£å†³è¿™ç±»é—®é¢˜ã€‚</p><h2 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a><strong><code>CompletableFuture</code></strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletableFuture</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Future</span>&lt;T&gt;, CompletionStage&lt;T&gt; </span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç±»å›¾å¯çŸ¥ï¼Œ<code>CompletableFuture</code> å®ç°äº†Futureæ¥å£å’Œ<code>CompletionStage</code>æ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åŸæœ‰Futureæ¥å£çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€äº›æ‰©å±•ï¼Œè‡ªç„¶åŠŸèƒ½æ›´ä¸ºå¼ºå¤§</p><p><img src="https://pic.imgdb.cn/item/6476a114f024cca1733367f4.png"></p><h4 id="CompletionStageæ¥å£"><a href="#CompletionStageæ¥å£" class="headerlink" title="CompletionStageæ¥å£"></a><code>CompletionStage</code>æ¥å£</h4><p><code>CompletionStage</code> æ˜¯ Java 8 å¼•å…¥çš„æ¥å£ï¼Œç”¨äºæ”¯æŒå¼‚æ­¥è®¡ç®—å’Œå¤„ç†ç»“æœçš„æ“ä½œã€‚å®ƒæ˜¯ Java ä¸­çš„ä¸€ä¸ª Future æ¥å£çš„æ‰©å±•ï¼Œå¹¶æä¾›äº†æ›´å¼ºå¤§çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹</p><ol><li><code>CompletionStage</code>ä»£è¡¨å¼‚æ­¥è®¡ç®—è¿‡ç¨‹ä¸­çš„æŸä¸€ä¸ªé˜¶æ®µ,ä¸€ä¸ªé˜¶æ®µå®Œæˆåå¯èƒ½ä¼šè§¦å‘å¦å¤–ä¸€ä¸ªé˜¶æ®µ</li><li>ä¸€ä¸ªé˜¶æ®µçš„è®¡ç®—æ‰§è¡Œå¯ä»¥æ˜¯ä¸€ä¸ª<code>Funcation</code>ã€Consumerã€Runnableã€‚æ¯”å¦‚:<code>stage.thenApply (x-&gt;square(x)).thenAccept(x-&gt;System.out.println(x)).thenRun(()-&gt;&#123;System.out.println()&#125;);</code></li><li>ä¸€ä¸ªé˜¶æ®µçš„æ‰§è¡Œå¯èƒ½æ˜¯è¢«å•ä¸ªé˜¶æ®µçš„å®Œæˆè§¦å‘,ä¹Ÿå¯èƒ½æ˜¯ç”±å¤šä¸ªé˜¶æ®µä¸€èµ·è§¦å‘.æœ‰äº›ç±»ä¼¼Linuxç³»ç»Ÿçš„ç®¡é“åˆ†éš”ç¬¦ä¼ å‚æ•°</li></ol><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletableFutureExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡</span></span><br><span class="line">        CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Hello, CompletableFuture!&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å†Œä»»åŠ¡å®Œæˆåçš„å›è°ƒ</span></span><br><span class="line">        future.thenAccept(result -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Task completed: &quot;</span> + result);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Main thread continues to execute...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Main thread continues to execute...</span><br><span class="line">Task completed: Hello, CompletableFuture!</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤º<code>CompletableFuture</code>ä½¿ç”¨é™æ€æ–¹æ³•æ„é€ <code>CompletableFuture</code>å¯¹è±¡ï¼Œå¸¸ç”¨çš„é™æ€æ„é€ æ–¹æ³•å¦‚ä¸‹æ‰€ç¤º</p><h4 id="å¸¸ç”¨é™æ€æ„é€ æ–¹æ³•"><a href="#å¸¸ç”¨é™æ€æ„é€ æ–¹æ³•" class="headerlink" title="å¸¸ç”¨é™æ€æ„é€ æ–¹æ³•"></a><strong>å¸¸ç”¨é™æ€æ„é€ æ–¹æ³•</strong></h4><table><thead><tr><th>Modifier and Type</th><th>Modifier and Type</th><th>describe</th></tr></thead><tbody><tr><td><code>CompletableFuture</code><Void></td><td><code>runAsync</code>(<code>Runnablerunnable</code>)</td><td>æ— è¿”å›å€¼</td></tr><tr><td><code>CompletableFuture</code><Void></td><td><code>runAsync</code>(<code>Runnablerunnable</code>, <code>Executorexecutor</code>)</td><td>æ— è¿”å›å€¼ï¼ŒæŒ‡å®šçº¿ç¨‹æ± </td></tr><tr><td><code>CompletableFuture</code><U></td><td>supplyAsync(Supplier<U>supplier)</td><td>æœ‰è¿”å›å€¼</td></tr><tr><td><code>CompletableFuture</code><U></td><td>supplyAsync(Supplier<U>supplier, Executor executor)</td><td>æœ‰è¿”å›å€¼ï¼ŒæŒ‡å®šçº¿ç¨‹æ± </td></tr></tbody></table><p>ä¸ºä»€ä¹ˆä¸ç”¨æ„é€ æ–¹æ³•å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹jdkæ–‡æ¡£çš„æè¿°</p><h4 id="æ„é€ æ–¹æ³•æ‘˜è¦"><a href="#æ„é€ æ–¹æ³•æ‘˜è¦" class="headerlink" title="æ„é€ æ–¹æ³•æ‘˜è¦"></a>æ„é€ æ–¹æ³•æ‘˜è¦</h4><table><thead><tr><th>Constructor and Description</th></tr></thead><tbody><tr><td><code>CompletableFuture</code>() åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å®Œæ•´çš„<code>CompletableFuture</code>ã€‚</td></tr></tbody></table><p>é»˜è®¤ç©ºå‚æ„é€ å™¨åªèƒ½æ–°å»ºä¸€ä¸ªä¸å®Œæ•´çš„<code>CompletableFuture</code>å¯¹è±¡ï¼ŒåŸå› ç®€ç•¥çœ‹ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a new CompletableFuture that is asynchronously completed</span></span><br><span class="line"><span class="comment"> * by a task running in the &#123;<span class="doctag">@link</span> ForkJoinPool#commonPool()&#125; with</span></span><br><span class="line"><span class="comment"> * the value obtained by calling the given Supplier.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> supplier a function returning the value to be used</span></span><br><span class="line"><span class="comment"> * to complete the returned CompletableFuture</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;U&gt; the function&#x27;s return type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the new CompletableFuture</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> asyncSupplyStage(asyncPool, supplier);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">asyncSupplyStage</span><span class="params">(Executor e,</span></span><br><span class="line"><span class="params">                                                 Supplier&lt;U&gt; f)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (f == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    CompletableFuture&lt;U&gt; d = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;U&gt;();</span><br><span class="line">    e.execute(<span class="keyword">new</span> <span class="title class_">AsyncSupply</span>&lt;U&gt;(d, f));</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>supplyAsync</code>é™æ€æ–¹æ³•åœ¨æ‰§è¡Œæ—¶ï¼Œä¹Ÿnewäº†ä¸€ä¸ªæ–°çš„<code>ComPletableFuture</code>å¯¹è±¡ï¼Œä¸åŒçš„æ˜¯ï¼Œ<code>supplyAsync</code>æ–¹æ³•è°ƒç”¨<code>asyncSupplyStage</code>åä½¿ç”¨e.<code>execute</code> å¼€å¯äº†çº¿ç¨‹ã€‚æ‰€ä»¥<code>ComPletableFuture</code> ç©ºå‚æ„é€ åªæ˜¯ä¸€ä¸ª<code>ComPletableFuture</code>å¯¹è±¡ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥å¼€å¯çº¿ç¨‹ï¼Œå…¶ä»–é™æ€æ„é€ æ–¹æ³•åŸç†ä¸€è‡´ã€‚</p><h4 id="çº¿ç¨‹æ± ç›¸å…³"><a href="#çº¿ç¨‹æ± ç›¸å…³" class="headerlink" title="çº¿ç¨‹æ± ç›¸å…³"></a><strong>çº¿ç¨‹æ± ç›¸å…³</strong></h4><p>é€šè¿‡ä¸Šé¢çš„æ„é€ æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œç›¸åŒä¸¤ä¸ªæ–¹æ³•åä¹‹é—´çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦æŒ‡å®šäº†æ–°çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šçº¿ç¨‹æ± ï¼Œåˆ™ä¼šä½¿ç”¨<code>ComPletableFuture</code>å†…ç½®çš„çº¿ç¨‹æ± <code>ForkJoinPool</code>ã€‚</p><p>å®ç°æºç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;U&gt; CompletableFuture&lt;U&gt; <span class="title function_">supplyAsync</span><span class="params">(Supplier&lt;U&gt; supplier)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> asyncSupplyStage(asyncPool, supplier);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Default executor -- ForkJoinPool.commonPool() unless it cannot</span></span><br><span class="line"><span class="comment"> * support parallelism.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Executor</span> <span class="variable">asyncPool</span> <span class="operator">=</span> useCommonPool ?</span><br><span class="line">    ForkJoinPool.commonPool() : <span class="keyword">new</span> <span class="title class_">ThreadPerTaskExecutor</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Fallback if ForkJoinPool.commonPool() cannot support parallelism */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ThreadPerTaskExecutor</span> <span class="keyword">implements</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable r)</span> &#123; <span class="keyword">new</span> <span class="title class_">Thread</span>(r).start(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåªæ˜¯åšäº†ä¸€ä¸ªä¸‰ç›®è¿ç®—æ¥åˆ¤æ–­æ˜¯å¦æŒ‡å®šäº†çº¿ç¨‹æ± ã€‚</p><h4 id="ç®€å•å®è·µ"><a href="#ç®€å•å®è·µ" class="headerlink" title="ç®€å•å®è·µ"></a>ç®€å•å®è·µ</h4><p>æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå–å‡ºæ¯ä¸ªå­—ç¬¦ä¸²å¹¶è·å¾—ç¬¬ä¸€ä¸ªå­—ç¬¦ ï¼Œç­‰å¾…ä¸€ç§’åï¼Œä¸ä¸€ä¸ªéšæœºæ•°ç›¸ä¹˜, æ¯”å¦‚å­—ç¬¦ä¸²â€helloâ€ ,å–å‡ºhï¼Œç­‰å¾…ä¸€ç§’åï¼Œç”¨hçš„ASCIIç ä¸ä¸€ä¸ªéšæœºæµ®ç‚¹æ•°ç›¸ä¹˜ã€‚</p><h5 id="Streamæµæ–¹å¼"><a href="#Streamæµæ–¹å¼" class="headerlink" title="Streamæµæ–¹å¼"></a>Streamæµæ–¹å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;BestPrice&quot;</span>, <span class="string">&quot;LetsSaveBig&quot;</span>, <span class="string">&quot;MyFavoriteShop&quot;</span>, <span class="string">&quot;BuyItAll&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    List&lt;Double&gt; collect = strings.stream()</span><br><span class="line">            .map(s -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> s.charAt(<span class="number">0</span>) * ThreadLocalRandom.current().nextDouble();</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(end - start);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶é—´ä¸ºï¼š <strong>4108æ¯«ç§’</strong></p><h5 id="å¹¶è¡Œæµæ–¹å¼"><a href="#å¹¶è¡Œæµæ–¹å¼" class="headerlink" title="å¹¶è¡Œæµæ–¹å¼"></a>å¹¶è¡Œæµæ–¹å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;BestPrice&quot;</span>, <span class="string">&quot;LetsSaveBig&quot;</span>, <span class="string">&quot;MyFavoriteShop&quot;</span>, <span class="string">&quot;BuyItAll&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    List&lt;Double&gt; collects = strings.parallelStream()</span><br><span class="line">            .map(s -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> s.charAt(<span class="number">0</span>) * ThreadLocalRandom.current().nextDouble();</span><br><span class="line">            &#125;)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(end - start);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>æ”¹åŠ¨ä¹‹å¤„ï¼šstreamï¼ˆï¼‰â€”ã€‹parallelStream()</strong></em></p><p>æ‰§è¡Œæ—¶é—´ä¸ºï¼š<strong>1067æ¯«ç§’</strong></p><h5 id="CompletableFutureå®ç°"><a href="#CompletableFutureå®ç°" class="headerlink" title="CompletableFutureå®ç°"></a>CompletableFutureå®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;BestPrice&quot;</span>, <span class="string">&quot;LetsSaveBig&quot;</span>, <span class="string">&quot;MyFavoriteShop&quot;</span>, <span class="string">&quot;BuyItAll&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    List&lt;CompletableFuture&lt;Double&gt;&gt; collect = strings.stream()</span><br><span class="line">            .map(s -&gt;</span><br><span class="line">                    CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> s.charAt(<span class="number">0</span>) * ThreadLocalRandom.current().nextDouble();</span><br><span class="line">                    &#125;)</span><br><span class="line">            )</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    List&lt;Double&gt; collect1 = collect.stream()</span><br><span class="line">            .map(CompletableFuture::join)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(end - start);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶é—´ä¸ºï¼š<strong>1072æ¯«ç§’</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨å¹¶è¡Œæµå’ŒCompletableFutureå®ç°æ¯”åŸå…ˆé¡ºåºæµè¦å¿«äº†å¾ˆå¤šï¼Œè€Œå¹¶è¡Œæµå’ŒCompletableFutureå¥½åƒå¹¶æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚è¿™æ˜¯å› ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><h5 id="å¹¶è¡Œæµå’ŒCompletableFutureå·®åˆ«"><a href="#å¹¶è¡Œæµå’ŒCompletableFutureå·®åˆ«" class="headerlink" title="å¹¶è¡Œæµå’ŒCompletableFutureå·®åˆ«"></a>å¹¶è¡Œæµå’ŒCompletableFutureå·®åˆ«</h5><p>å¹¶è¡Œæµå’ŒCompletableFutureå†…éƒ¨é‡‡ç”¨çš„æ˜¯åŒæ ·çš„é€šç”¨çº¿ç¨‹æ± ä¹Ÿå°±æ˜¯ä¸Šæ–‡è¯´çš„<strong>ForkJoinPool</strong> ï¼Œé»˜è®¤éƒ½ä½¿ç”¨å›ºå®šæ•°ç›®çš„çº¿ç¨‹ï¼Œå…·ä½“çº¿ç¨‹æ•°å–å†³äº<code>Runtime.getRuntime().availableProcessors()</code>çš„è¿”å›å€¼ã€‚</p><p>è€ŒCompletableFutureä¸æ­¢å¯ä»¥ä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹æ± ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚æä¾›å¯¹åº”çš„çº¿ç¨‹æ± å¯¹è±¡ï¼Œå°¤å…¶æ˜¯çº¿ç¨‹æ± çš„å¤§å°ï¼Œè¿™æ˜¯å¹¶è¡ŒæµAPIæ— æ³•æä¾›çš„ï¼Œè€ŒCompletableFutureä¹Ÿå¹¶éä»…ä»…ä¸ºäº†å®ç°å¤šçº¿ç¨‹ï¼Œæ›´é‡è¦æ˜¯æ˜¯å¼¥è¡¥Futureæ¥å£ä½¿ç”¨å¸¦æ¥çš„ç¼ºé™·å’Œä¸è¶³ã€‚</p><h5 id="æ‰§è¡Œæµç¨‹å›¾"><a href="#æ‰§è¡Œæµç¨‹å›¾" class="headerlink" title="æ‰§è¡Œæµç¨‹å›¾"></a>æ‰§è¡Œæµç¨‹å›¾</h5><p><img src="https://pic.imgdb.cn/item/64795c9ff024cca173266bdd.png"></p><p>è€ŒCompletableFutureå®ç°åˆ™æ˜¯å…ˆç”¨é¡ºåºæµè¿”å›äº†ä¸€ä¸ªCompletableFutureå¯¹è±¡ï¼Œç›¸å½“äºæ”¶é›†äº†ä¸€ä¸ªå¤šçº¿ç¨‹é›†åˆï¼Œç„¶åé¡ºåºå¯åŠ¨å¤šçº¿ç¨‹ã€‚</p><h4 id="CompletableFuture-å¸¸ç”¨æ–¹æ³•"><a href="#CompletableFuture-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="CompletableFuture å¸¸ç”¨æ–¹æ³•"></a>CompletableFuture å¸¸ç”¨æ–¹æ³•</h4><h5 id="è·å–ç»“æœ"><a href="#è·å–ç»“æœ" class="headerlink" title="è·å–ç»“æœ"></a>è·å–ç»“æœ</h5><ul><li>public T get( )  å®ç°äº†Futureæ¥å£çš„æ–¹æ³•ï¼Œç­‰å¾…çº¿ç¨‹æ‰§è¡Œè·å–ç»“æœï¼Œå¯èƒ½ä¼šé˜»å¡çº¿ç¨‹å»ç­‰å¾…</li><li>public T get(long timeout, TimeUnit unit)     å®ç°äº†Futureæ¥å£çš„æ–¹æ³•ï¼Œç­‰å¾…çº¿ç¨‹è·å–ç»“æœï¼Œè¶…è¿‡æŒ‡å®šæ—¶é—´æŠ›å‡ºå¼‚å¸¸</li><li>public T getNow(T valuelfAbsent)                   ç›¸å½“äºä¸‰å…ƒè¿ç®—ï¼Œéœ€è¦ç«‹å³è·å–ç»“æœï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨valuelfAbsent</li><li>public T join( ):                                                     joinæ–¹æ³•å’Œget( ) æ–¹æ³•ä½œç”¨å‡ ä¹,ä¸åŒçš„æ˜¯,joinæ–¹æ³•ä¸æŠ›å‡ºå¼‚å¸¸</li></ul><p>ç®€å•æ¼”ç¤ºä¸€ä¸‹getNow()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">      CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">1</span>);  &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="type">Integer</span> <span class="variable">now1</span> <span class="operator">=</span> future.getNow(<span class="number">3</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">2</span>);  &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;e.printStackTrace();&#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">Integer</span> <span class="variable">now2</span> <span class="operator">=</span> future.getNow(<span class="number">3</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;now1: &quot;</span>+ now1);</span><br><span class="line">      System.out.println(<span class="string">&quot;now2: &quot;</span>+ now2);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">now1: <span class="number">3</span></span><br><span class="line">now2: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h5 id="å¯¹è®¡ç®—ç»“æœè¿›è¡Œå¤„ç†"><a href="#å¯¹è®¡ç®—ç»“æœè¿›è¡Œå¤„ç†" class="headerlink" title="å¯¹è®¡ç®—ç»“æœè¿›è¡Œå¤„ç†"></a>å¯¹è®¡ç®—ç»“æœè¿›è¡Œå¤„ç†</h5><h6 id="thenApplyã€handle"><a href="#thenApplyã€handle" class="headerlink" title="(thenApplyã€handle)"></a><strong>(thenApplyã€handle)</strong></h6><p>**<code>thenApply(Function&lt;? super T,? extends U&gt; fn)</code>**ï¼š</p><ul><li>è¯¥æ–¹æ³•ç”¨äºåœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåå¯¹ç»“æœè¿›è¡Œè½¬æ¢ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li>å®ƒæ¥å—ä¸€ä¸ª <code>Function</code> å‚æ•°ï¼Œè¯¥å‡½æ•°å°†ä»»åŠ¡çš„ç»“æœç±»å‹ <code>T</code> è½¬æ¢ä¸ºç±»å‹ <code>U</code>ã€‚</li><li><code>thenApply()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆï¼Œå¹¶å°†ä»»åŠ¡çš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºå¯¹ç»“æœè¿›è¡Œè½¬æ¢åçš„å€¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future1 = future.thenApply(String::length);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = future1.thenApply(s -&gt; s * <span class="number">100</span> +<span class="number">88</span>);</span><br><span class="line">    System.out.println(future2.join());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">588</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°thenApplyå°±æ˜¯æŠŠä¸Šä¸€ä¸ªç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ª<code>CompletableFuture</code> å¯¹è±¡ï¼Œç›¸å½“äºé“¾å¼è°ƒç”¨ã€‚</p><p>ä¸Šè¿°ä»£ç ä¹Ÿå¯ä»¥è¿™æ ·å®ç°ï¼Œä¹Ÿå°±æ˜¯é“¾å¼è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">            .thenApply(String::length)</span><br><span class="line">            .thenApply(s -&gt; s * <span class="number">100</span> +<span class="number">88</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(future.join());</span><br></pre></td></tr></table></figure><p>**<code>handle(BiFunction&lt;? super T,Throwable,? extends U&gt; fn)</code>**ï¼š</p><ul><li>è¯¥æ–¹æ³•ç”¨äºåœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåå¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œæ— è®ºä»»åŠ¡æ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œå¤„ç†é€»è¾‘ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li>å®ƒæ¥å—ä¸€ä¸ª <code>BiFunction</code> å‚æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä»»åŠ¡çš„ç»“æœç±»å‹ <code>T</code> å’Œå¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸ç±»å‹ <code>Throwable</code>ï¼Œå¹¶è¿”å›ç±»å‹ <code>U</code>ã€‚</li><li><code>handle()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆï¼Œå¹¶å°†ä»»åŠ¡çš„ç»“æœæˆ–å¼‚å¸¸ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºå¤„ç†åçš„ç»“æœã€‚</li></ul><p>handleæ–¹æ³•å’ŒthenApplyæ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯handleåœ¨ä¸­é—´æ“ä½œæ—¶å‡ºç°å¼‚å¸¸ä¸ä¼šåœæ­¢ä»»åŠ¡ï¼Œè€Œæ˜¯æŠŠå¼‚å¸¸ä¼ é€’ç»™ä¸‹ä¸€ä¸ªCompletableå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="number">10</span>)</span><br><span class="line">                    .handle((result, ex) -&gt; &#123;</span><br><span class="line">                            <span class="keyword">if</span> (ex != <span class="literal">null</span>) &#123;</span><br><span class="line">                                System.out.println(<span class="string">&quot;Exception occurred: &quot;</span> + ex);</span><br><span class="line">                                <span class="keyword">return</span> -<span class="number">1</span>;  <span class="comment">// å¤„ç†å¼‚å¸¸æƒ…å†µï¼Œè¿”å›é»˜è®¤å€¼</span></span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">return</span> result * <span class="number">2</span>;  <span class="comment">// å¤„ç†æ­£å¸¸æƒ…å†µï¼Œè¿”å›ç»“æœçš„ä¸¤å€</span></span><br><span class="line">                            &#125;</span><br><span class="line">                     &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    System.out.println(future.join());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ç¨å¾®æ”¹åŠ¨ä¸€ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="number">1</span>/<span class="number">0</span>)</span><br><span class="line">                .handle((result, ex) -&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ex != <span class="literal">null</span>) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;Exception occurred: &quot;</span> + ex);</span><br><span class="line">                            <span class="keyword">return</span> -<span class="number">1</span>;  <span class="comment">// å¤„ç†å¼‚å¸¸æƒ…å†µï¼Œè¿”å›é»˜è®¤å€¼</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> result * <span class="number">2</span>;  <span class="comment">// å¤„ç†æ­£å¸¸æƒ…å†µï¼Œè¿”å›ç»“æœçš„ä¸¤å€</span></span><br><span class="line">                        &#125;</span><br><span class="line">                 &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System.out.println(future.join());</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception occurred: java.util.concurrent.CompletionException: java.lang.ArithmeticException: / by zero</span><br><span class="line">-<span class="number">1</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯å‡ºç°äº†å¼‚å¸¸å¹¶æ•è·ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å½±å“ç»“æœæ‰§è¡Œã€‚</p><h5 id="å¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹"><a href="#å¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹" class="headerlink" title="å¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹"></a>å¯¹è®¡ç®—ç»“æœè¿›è¡Œæ¶ˆè´¹</h5><h6 id="thenRunã€thenAcceptã€thenApply"><a href="#thenRunã€thenAcceptã€thenApply" class="headerlink" title="(thenRunã€thenAcceptã€thenApply)"></a><strong>(thenRunã€thenAcceptã€thenApply)</strong></h6><p><strong><code>thenRun(Runnable action)</code></strong>:</p><ul><li>è¯¥æ–¹æ³•åœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œä¸æ¥æ”¶ä»»åŠ¡çš„ç»“æœã€‚</li><li>å®ƒæ¥å—ä¸€ä¸ª <code>Runnable</code> å‚æ•°ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„æ“ä½œã€‚</li><li><code>thenRun()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆåï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œæ— è®ºå‰ä¸€ä¸ªä»»åŠ¡çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">            .thenRun(() -&gt; System.out.println(<span class="string">&quot;Task completed&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Task completed</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong><code>thenAccept(Consumer&lt;? super T&gt; action)</code></strong>:</p><ul><li>è¯¥æ–¹æ³•åœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆåå¯¹ç»“æœè¿›è¡Œæ¶ˆè´¹ï¼Œä¸è¿”å›ä»»ä½•ç»“æœã€‚</li><li>å®ƒæ¥å—ä¸€ä¸ª <code>Consumer</code> å‚æ•°ï¼Œè¡¨ç¤ºå¯¹ç»“æœè¿›è¡Œæ¶ˆè´¹çš„æ“ä½œã€‚</li><li><code>thenAccept()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆåï¼Œå°†ä»»åŠ¡çš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™æ“ä½œè¿›è¡Œæ¶ˆè´¹ã€‚</li></ul><p>é€šè¿‡ä¼ å‚å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæ¶ˆè´¹å‹æ¥å£ï¼Œå¯¹ä¼ å…¥æ•°æ®è¿›è¡Œæ¶ˆè´¹ï¼Œä¸è¿”å›ç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">            .thenApply(s -&gt; s+ <span class="string">&quot; world&quot;</span>)</span><br><span class="line">            .thenAccept(s -&gt; System.out.println(<span class="string">&quot;Result: &quot;</span> + s));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Result: Hello world</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><code>thenApplyæ–¹æ³•åŒä¸Š</code></p><h5 id="å¯¹è®¡ç®—ç»“æœè¿›è¡Œåˆå¹¶"><a href="#å¯¹è®¡ç®—ç»“æœè¿›è¡Œåˆå¹¶" class="headerlink" title="å¯¹è®¡ç®—ç»“æœè¿›è¡Œåˆå¹¶"></a>å¯¹è®¡ç®—ç»“æœè¿›è¡Œåˆå¹¶</h5><h6 id="thenCombineã€thenAcceptBothã€runAfterBoth"><a href="#thenCombineã€thenAcceptBothã€runAfterBoth" class="headerlink" title="(thenCombineã€thenAcceptBothã€runAfterBoth)"></a><strong>(thenCombineã€thenAcceptBothã€runAfterBoth)</strong></h6><p><strong><code>thenCombine(CompletableFuture&lt;? extends U&gt; other, BiFunction&lt;? super T, ? super U, ? extends V&gt; fn)</code></strong>:</p><ul><li>è¯¥æ–¹æ³•ç”¨äºç»„åˆä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»“æœï¼Œå¹¶åœ¨ä¸¤ä¸ªä»»åŠ¡éƒ½å®Œæˆåæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li>å®ƒæ¥å—å¦ä¸€ä¸ª <code>CompletableFuture</code> å¯¹è±¡ <code>other</code> å’Œä¸€ä¸ª <code>BiFunction</code> å‚æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœç±»å‹ <code>T</code> å’Œ <code>U</code>ï¼Œå¹¶è¿”å›ç±»å‹ <code>V</code>ã€‚</li><li><code>thenCombine()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å’Œ <code>other</code> ä»»åŠ¡éƒ½å®Œæˆåï¼Œå°†ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ï¼Œè¡¨ç¤ºå¯¹ç»“æœè¿›è¡Œç»„åˆåçš„å€¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; <span class="number">10</span>);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; <span class="number">20</span>)</span><br><span class="line">                            .thenCombine(future1, (s1,s2) -&gt; s1*s2);</span><br><span class="line">    System.out.println(future2.join());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">200</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong><code>thenAcceptBoth(CompletableFuture&lt;? extends U&gt; other, BiConsumer&lt;? super T, ? super U&gt; action)</code></strong>:</p><ul><li>è¯¥æ–¹æ³•ç”¨äºåœ¨ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡éƒ½å®Œæˆåæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œä¸è¿”å›ä»»ä½•ç»“æœã€‚</li><li>å®ƒæ¥å—å¦ä¸€ä¸ª <code>CompletableFuture</code> å¯¹è±¡ <code>other</code> å’Œä¸€ä¸ª <code>BiConsumer</code> å‚æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœç±»å‹ <code>T</code> å’Œ <code>U</code>ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚</li><li><code>thenAcceptBoth()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å’Œ <code>other</code> ä»»åŠ¡éƒ½å®Œæˆåï¼Œå°†ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™æ“ä½œè¿›è¡Œæ¶ˆè´¹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; <span class="number">10</span>);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; <span class="number">20</span>);</span><br><span class="line">    CompletableFuture&lt;Void&gt; combinedFuture = future1.</span><br><span class="line">            thenAcceptBoth(future2, (result1, result2) -&gt;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Combined result: &quot;</span> + (result1 + result2)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ä¸thenCombineç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºthenCombineæœ‰è¿”å›ï¼Œè€ŒthenAcceptBothæ— è¿”å›å€¼</p><p>ç»“æœä¸è¨€è€Œå–»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Combined result: <span class="number">30</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong><code>runAfterBoth(CompletableFuture&lt;?&gt; other, Runnable action)</code></strong>:</p><ul><li><p>è¯¥æ–¹æ³•ç”¨äºåœ¨ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡éƒ½å®Œæˆåæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œä¸æ¥æ”¶ä»»åŠ¡çš„ç»“æœã€‚</p></li><li><p>å®ƒæ¥å—å¦ä¸€ä¸ª <code>CompletableFuture</code> å¯¹è±¡ <code>other</code> å’Œä¸€ä¸ª <code>Runnable</code> å‚æ•°ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„æ“ä½œã€‚</p></li><li><p><code>runAfterBoth()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å’Œ <code>other</code> ä»»åŠ¡éƒ½å®Œæˆåï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; <span class="number">10</span>);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; <span class="number">20</span>);</span><br><span class="line">    CompletableFuture&lt;Void&gt; combinedFuture = future1.</span><br><span class="line">            runAfterBoth(future2, () -&gt; System.out.println(<span class="string">&quot;Both tasks completed&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸è¾ƒäºä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ï¼ŒrunAfterBoth åˆæœ‰äº›ä¸åŒï¼Œä»–æ—¢ä¸æ¥æ”¶è¿”å›å€¼ï¼Œä¹Ÿä¸è¿”å›ï¼Œè€Œæ˜¯ç­‰å¾…ä¸¤ä¸ªfutureæ‰§è¡Œå¥½äº†ä¹‹ååœ¨å»æ‰§è¡Œï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨äºåœ¨ç¨‹åºç»“æŸ</p><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Both tasks completed</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h5 id="å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨"><a href="#å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨" class="headerlink" title="å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨"></a>å¯¹è®¡ç®—é€Ÿåº¦è¿›è¡Œé€‰ç”¨</h5><h6 id="applyToEitherã€acceptEitherã€runAfterEither"><a href="#applyToEitherã€acceptEitherã€runAfterEither" class="headerlink" title="(applyToEitherã€acceptEitherã€runAfterEither)"></a><strong>(applyToEitherã€acceptEitherã€runAfterEither)</strong></h6><p><strong><code>applyToEither(CompletableFuture&lt;? extends T&gt; other, Function&lt;? super T, U&gt; fn)</code></strong>:</p><ul><li>è¯¥æ–¹æ³•æ¥å—å¦ä¸€ä¸ª <code>CompletableFuture</code> å¯¹è±¡ <code>other</code> å’Œä¸€ä¸ª <code>Function</code> å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li><code>applyToEither()</code> æ–¹æ³•ä¼šç­‰å¾…å½“å‰ä»»åŠ¡å’Œ <code>other</code> ä»»åŠ¡ä¸­çš„ä»»æ„ä¸€ä¸ªå®Œæˆï¼Œå¹¶å°†é¦–å…ˆå®Œæˆçš„ä»»åŠ¡çš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°è¿›è¡Œè½¬æ¢ã€‚</li><li>è¿”å›çš„ <code>CompletableFuture</code> å¯¹è±¡çš„ç»“æœç±»å‹ä¸º <code>U</code>ï¼Œè¡¨ç¤ºå¯¹é¦–å…ˆå®Œæˆä»»åŠ¡çš„ç»“æœè¿›è¡Œè½¬æ¢åçš„å€¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; voidCompletableFuture = future1.applyToEither(future2, s -&gt; s * <span class="number">123</span>)</span><br><span class="line">            .thenApply(s -&gt; <span class="string">&quot;Result: &quot;</span> + s)</span><br><span class="line">            .thenAccept(res -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;--------------------------&quot;</span>);</span><br><span class="line">                System.out.println(res);</span><br><span class="line">            &#125;);</span><br><span class="line">    voidCompletableFuture.join();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--------------------------</span><br><span class="line">Result: <span class="number">2460</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾è¿”å›çš„æ˜¯ <strong>future2 çš„20</strong></p><p><strong><code> acceptEither(CompletionStage&lt;? extends T&gt; other, Consumer&lt;? super T&gt; action)</code></strong></p><p><code>acceptEither</code> æ˜¯ <code>CompletableFuture</code> ç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¤„ç†ä¸¤ä¸ªç‹¬ç«‹çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”åªæ¥å—å…¶ä¸­ä¸€ä¸ªæ“ä½œçš„ç»“æœã€‚å¯ä»¥è¿™ä¹ˆç†è§£ï¼šå¦‚æœç¬¬ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å®Œæˆäº†ï¼Œåˆ™ä½¿ç”¨å®ƒçš„ç»“æœè¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ä½¿ç”¨ç¬¬äºŒä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»“æœ</p><p>ç¤ºä¾‹ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    future1.acceptEither(future2, System.out::println).join();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>runAfterEitheræ–¹æ³•ç­¾å</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> CompletionStage&lt;Void&gt; <span class="title function_">runAfterEither</span><span class="params">(CompletionStage&lt;?&gt; other, Runnable action)</span>;</span><br></pre></td></tr></table></figure><p><code>runAfterEither</code> æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å¦ä¸€ä¸ª <code>CompletionStage</code> å¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸€ä¸ª <code>Runnable</code> æˆ–è€… <code>Consumer</code> å¯¹è±¡ã€‚å½“å…¶ä¸­ä»»æ„ä¸€ä¸ª <code>CompletionStage</code> å®Œæˆï¼ˆæ— è®ºæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸å®Œæˆï¼‰ï¼Œå°±ä¼šæ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Integer&gt; future1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡ŒæŸä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">future1.runAfterEither(future2, () -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰§è¡Œäº†æ“ä½œ&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ª <code>CompletableFuture</code> å¯¹è±¡ <code>future1</code> å’Œ <code>future2</code>ï¼Œåˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>runAfterEither</code> æ–¹æ³•ï¼Œä¼ é€’äº†è¿™ä¸¤ä¸ª <code>CompletableFuture</code> å¯¹è±¡å’Œä¸€ä¸ª <code>Runnable</code> å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚å½“ <code>future1</code> æˆ–è€… <code>future2</code> ä¸­çš„ä»»æ„ä¸€ä¸ªå®Œæˆæ—¶ï¼Œå³å¯æ‰§è¡Œä¼ å…¥çš„æ“ä½œï¼Œè¿™é‡Œæ˜¯ç®€å•åœ°æ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚</p><h5 id="å¤šä»»åŠ¡ç»„åˆ"><a href="#å¤šä»»åŠ¡ç»„åˆ" class="headerlink" title="å¤šä»»åŠ¡ç»„åˆ"></a>å¤šä»»åŠ¡ç»„åˆ</h5><p><strong><code>allOf(CompletableFuture&lt;?&gt;... futures)</code></strong>:</p><ul><li>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª <code>CompletableFuture</code> æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li><code>allOf()</code> æ–¹æ³•ç­‰å¾…æ‰€æœ‰ç»™å®šçš„ä»»åŠ¡éƒ½å®Œæˆåï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li>è¿”å›çš„ <code>CompletableFuture</code> å¯¹è±¡çš„ç»“æœä¸º <code>Void</code>ï¼Œè¡¨ç¤ºæ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;Result 1&quot;</span>);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; <span class="number">42</span>);</span><br><span class="line">    CompletableFuture&lt;Boolean&gt; future3 = CompletableFuture.supplyAsync(() -&gt; <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; allFutures = CompletableFuture.allOf(future1, future2, future3);</span><br><span class="line">    allFutures.thenRun(() -&gt; System.out.println(<span class="string">&quot;All tasks completed&quot;</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>allofæ–¹æ³•ä½¿ç”¨ç±»ä¼¼äºéå†ä¸€ä¸ªCompletableFutureæ•°ç»„å¹¶æ‰§è¡Œï¼Œä¸åŒæ˜¯çš„ï¼Œä»–ä¼šç­‰å¾…æ‰€æœ‰ç»“æœå‡ºæ¥åæ‰ä¼šæ‰“å° thenRun()åå¾—å†…å®¹ã€‚è€Œä¸è¿”å›ä»»ä½•å†…å®¹ã€‚</p><p>ç»“æœä¸è¨€è€Œå–»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">All tasks completed</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong><code>anyOf(CompletableFuture&lt;?&gt;... futures)</code></strong>:</p><ul><li>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª <code>CompletableFuture</code> æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li><code>anyOf()</code> æ–¹æ³•ç­‰å¾…ä»»ä½•ä¸€ä¸ªç»™å®šçš„ä»»åŠ¡å®Œæˆåï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletableFuture</code> å¯¹è±¡ã€‚</li><li>è¿”å›çš„ <code>CompletableFuture</code> å¯¹è±¡çš„ç»“æœä¸ºç¬¬ä¸€ä¸ªå®Œæˆçš„ä»»åŠ¡çš„ç»“æœã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Result 1&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    CompletableFuture&lt;Boolean&gt; future3 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Object&gt; anyFuture = CompletableFuture.anyOf(future1, future2, future3);</span><br><span class="line">    System.out.println(anyFuture.join());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªCompletableå¯¹è±¡ï¼Œå¹¶ä¸€æ¬¡åŠ å…¥ä¸€ä¸ªæ–°çš„CompletableFuture.anyofæ–¹æ³•ä¸­ï¼Œä¸‰ä¸ªçº¿ç¨‹åˆ†åˆ«ç­‰å¾…ä¸åŒçš„æ—¶é—´ï¼Œæˆ‘ä»¬é¢„è®¡anyFutureæ¥æ”¶ç¬¬ä¸€ä¸ªè¿è¡Œç»“æŸå¹¶è¿”å›å¾—CompletableFutureå¯¹è±¡</p><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">42</span></span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://nerkeler.github.io/tags/JUC/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://nerkeler.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>synchronizedå’Œlock</title>
    <link href="https://nerkeler.github.io/2023/05/29/synchronized%E5%92%8Clock/"/>
    <id>https://nerkeler.github.io/2023/05/29/synchronized%E5%92%8Clock/</id>
    <published>2023-05-29T08:31:00.000Z</published>
    <updated>2023-05-29T08:32:03.069Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="synchronizedå’Œlock"><a href="#synchronizedå’Œlock" class="headerlink" title="synchronizedå’Œlock"></a>synchronizedå’Œlock</h1><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><p>synchronizedå…³é”®å­—ç”¨äºJavaä¸­åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­ï¼Œé˜²æ­¢èµ„æºå†²çªã€‚å½“ä»»åŠ¡è¦æ‰§è¡Œè¢«synchronizedå…³é”®å­—ä¿æŠ¤çš„ä»£ç ç‰‡æ®µçš„æ—¶å€™ï¼Œå®ƒå°†æ£€æŸ¥é”æ˜¯å¦å¯ç”¨ï¼Œç„¶åè·å–é”ï¼Œæ‰§è¡Œä»£ç ï¼Œé‡Šæ”¾é”ã€‚</p><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><h4 id="åŒæ­¥æ–¹æ³•"><a href="#åŒæ­¥æ–¹æ³•" class="headerlink" title="åŒæ­¥æ–¹æ³•"></a>åŒæ­¥æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">synchronizedMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¯¥æ–¹æ³•çš„å†…å®¹åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŒæ­¥ä»£ç å—"><a href="#åŒæ­¥ä»£ç å—" class="headerlink" title="åŒæ­¥ä»£ç å—"></a>åŒæ­¥ä»£ç å—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">someMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// éåŒæ­¥çš„ä»£ç </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">        <span class="comment">// è¢«åŒæ­¥çš„ä»£ç å—</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éåŒæ­¥çš„ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä½™ä¸åœ¨èµ˜è¿°ï¼Œç›¸å…³ä½¿ç”¨åº”è¯¥å¾ˆå¸¸è§</p><h2 id="lock"><a href="#lock" class="headerlink" title="lock"></a>lock</h2><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><p>é™¤äº†ä½¿ç”¨synchronizedå¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lockæ¥å£å†™çš„<code>ReentrantLock</code> å®ç°ç‹¬å é”çš„åŠŸèƒ½ã€‚</p><p>æŸ¥çœ‹ç±»å›¾å¯çŸ¥ï¼Œ<code>ReentrantLock</code> å®ç°äº†Lockæ¥å£</p><p><img src="https://pic1.imgdb.cn/item/64741b67f024cca1738eebeb.png"></p><p>Lockæ¥å£å®šä¹‰äº†å‡ ä¸ªæ–¹æ³•ç”¨æ¥å®ç°é”çš„åŸºæœ¬åŠŸèƒ½</p><ul><li><code>lock() : void</code>           &#x2F;&#x2F;è·å¾—é”ã€‚</li><li><code>lockInterruptibly() : void</code>    &#x2F;&#x2F; è·å–é”å®šï¼Œé™¤éå½“å‰çº¿ç¨‹æ˜¯ <a href="../../../../java/lang/Thread.html#interrupt--">interrupted</a> ã€‚ </li><li><code>tryLock() : boolean</code>                   &#x2F;&#x2F;   åªæœ‰åœ¨è°ƒç”¨æ—¶æ‰å¯ä»¥è·å¾—é”</li><li><code>tryLock(time : long,unit : TimeUnit ) : boolean</code>   &#x2F;&#x2F; å¦‚æœåœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´å†…æ˜¯ç©ºé—²çš„ï¼Œå¹¶ä¸”å½“å‰çš„çº¿ç¨‹å°šæœªå¾—åˆ° <a href="../../../../java/lang/Thread.html#interrupt--">interruptedï¼Œ</a>åˆ™è·å–è¯¥é”ã€‚ </li><li><code>unlock() : void</code>                           &#x2F;&#x2F;  é‡Šæ”¾é”ã€‚</li><li><code>newCondition() : Condition</code>    &#x2F;&#x2F; è¿”å›ä¸€ä¸ªæ–°<a href="../../../../java/util/concurrent/locks/Condition.html"><code>Condition</code></a>ç»‘å®šåˆ°è¯¥å®ä¾‹<code>Lock</code>å®ä¾‹ã€‚</li></ul><p>å¸¸ç”¨æ–¹æ³•åº”è¯¥æ˜¯lock()&#x2F;unlock()å’ŒnewCondition(),ç®€è¦é˜è¿°ä¸€ä¸‹ï¼Œç”±ReentrantLockå®ç°</p><h4 id="lockå’Œunlock"><a href="#lockå’Œunlock" class="headerlink" title="lockå’Œunlock"></a>lockå’Œunlock</h4><p>lockå’Œunlockæ–¹æ³•æ˜¯Lockæ¥å£æä¾›çš„é‡è¦çš„åŠ é”è§£é”æ–¹æ³•ï¼Œä»–ä»¬åŒ…å›´çš„ä»£ç ç‰‡æ®µå°±æ˜¯ç›¸åº”çš„åŠ é”å¤„ç†ç‰‡æ®µï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span>   <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        System.out.println(<span class="string">&quot;lock æµ‹è¯•&quot;</span>+ object.toString());</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æ–°å»ºLockå¯¹è±¡ååœ¨éœ€è¦é”çš„å¼€å§‹å’Œç»“æŸå¤„ä½¿ç”¨lockæ–¹æ³•å’Œunlockæ–¹æ³•è¿›è¡ŒåŠ é”å’Œè§£é”å°±å¯ä»¥å®Œæˆç›¸åº”çš„åŠŸèƒ½ã€‚</p><p>éœ€è¦æ³¨æ„ï¼Œå¦‚æœé”å†…éƒ¨ä»£ç å‡ºç°å¼‚å¸¸å¯èƒ½ä¼šé€ æˆlockå¯¹è±¡çš„unlockæ–¹æ³•æ²¡æœ‰æ‰§è¡Œï¼Œä»è€Œæœªé‡Šæ”¾é”ã€‚æ‰€ä»¥ç›¸åº”çš„åŠŸèƒ½åº”è¯¥å¸è½½try catchä»£ç å—ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span>   <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;lock æµ‹è¯•&quot;</span>+ object.toString());</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="newCondition"><a href="#newCondition" class="headerlink" title="newCondition"></a>newCondition</h4><p><code>newCondition</code>()æ–¹æ³•æ˜¯Lockæ¥å£ä¸­çº¿ç¨‹é€šè®¯çš„é‡è¦å®ç°ï¼Œä»–è¿”å›ä¸€ä¸ª<code>Condition</code>å¯¹è±¡ï¼Œ<code>Condition</code>ç±»ä¼¼äº<code>Object</code>ç›‘è§†å™¨æ–¹æ³•ï¼ˆ <a href="../../../../java/lang/Object.html#wait--"><code>wait</code></a> ï¼Œ <a href="../../../../java/lang/Object.html#notify--"><code>notify</code></a>å’Œ<a href="../../../../java/lang/Object.html#notifyAll--"><code>notifyAll</code></a>  ï¼‰ï¼Œå°†å…¶ä¸­çš„é‡è¦æ–¹æ³•å°è£…æˆäº†ä¸åŒçš„å¯¹è±¡ï¼Œä»¥å¾—åˆ°å…·æœ‰å¤šä¸ªç­‰å¾…é›†çš„æ¯ä¸ªå¯¹è±¡ï¼Œé€šè¿‡å°†å®ƒä»¬ä¸ä½¿ç”¨ä»»æ„çš„ç»„åˆçš„æ•ˆæœ<a href="../../../../java/util/concurrent/locks/Lock.html"><code>Lock</code>ä¸ª</a>å®ç°ã€‚  <code>Lock</code>æ›¿æ¢<code>synchronized</code>æ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼Œ  <code>Condition</code>å–ä»£äº†å¯¹è±¡ç›‘è§†å™¨æ–¹æ³•çš„ä½¿ç”¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.juc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå…±äº«çš„è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªé”å’Œæ¡ä»¶å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå¢åŠ è®¡æ•°å™¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count++;</span><br><span class="line">            System.out.println(<span class="string">&quot;Counter value: &quot;</span> + count);</span><br><span class="line">            <span class="comment">// é€šçŸ¥å…¶ä»–çº¿ç¨‹ï¼Œè®¡æ•°å™¨å·²ç»å¢åŠ </span></span><br><span class="line">            condition.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå‡å°‘è®¡æ•°å™¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// ç­‰å¾…å…¶ä»–çº¿ç¨‹é€šçŸ¥ï¼Œè®¡æ•°å™¨å·²ç»å¢åŠ </span></span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            count--;</span><br><span class="line">            System.out.println(<span class="string">&quot;Counter value: &quot;</span> + count);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Counter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Counter</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªå¢åŠ è®¡æ•°å™¨ï¼Œä¸€ä¸ªå‡å°‘è®¡æ•°å™¨</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                counter.increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                counter.decrement();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t1.join();</span><br><span class="line">            t2.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ç±»å®šä¹‰äº†ä¸€ä¸ªèµ„æºç±»å’Œä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå¢åŠ è®¡æ•°ï¼Œä¸€ä¸ªå‡å°‘è®¡æ•°ï¼Œå¾ªç¯5æ¬¡ï¼Œåé€šçŸ¥å¦ä¸€çº¿ç¨‹æ‰§è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Counter value: <span class="number">1</span></span><br><span class="line">Counter value: <span class="number">2</span></span><br><span class="line">Counter value: <span class="number">3</span></span><br><span class="line">Counter value: <span class="number">4</span></span><br><span class="line">Counter value: <span class="number">5</span></span><br><span class="line">Counter value: <span class="number">4</span></span><br><span class="line">Counter value: <span class="number">3</span></span><br><span class="line">Counter value: <span class="number">2</span></span><br><span class="line">Counter value: <span class="number">1</span></span><br><span class="line">Counter value: <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>conditionçš„ä½¿ç”¨ç±»ä¼¼äºObjectæ–¹æ³•ä¸­çš„waitå’Œnotifyæ–¹æ³•ï¼Œä¸åŒçš„æ˜¯Conditionç±»å¯ä»¥æä¾›å¤šä¸ªæ¡ä»¶ï¼Œå®ç°æ›´ç»†ç²’åº¦çš„çº¿ç¨‹ç­‰å¾…å’Œé€šçŸ¥</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.juc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiConditionExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">condition1Met</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">condition2Met</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">awaitCondition1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!condition1Met) &#123;</span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// condition1Met ä¸º trueï¼Œæ‰§è¡Œç›¸å…³æ“ä½œ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Condition 1 å¼€å§‹è¿è¡Œ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">awaitCondition2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!condition2Met) &#123;</span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// condition2Met ä¸º trueï¼Œæ‰§è¡Œç›¸å…³æ“ä½œ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Condition 2 met&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">signalCondition1</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            condition1Met = <span class="literal">true</span>;</span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">signalCondition2</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            condition2Met = <span class="literal">true</span>;</span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MultiConditionExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiConditionExample</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                example.signalCondition1();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">                example.signalCondition2();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                example.awaitCondition1();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                example.awaitCondition2();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line">        thread4.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            thread1.join();</span><br><span class="line">            thread2.join();</span><br><span class="line">            thread3.join();</span><br><span class="line">            thread4.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Condition <span class="number">1</span> met</span><br><span class="line">Condition <span class="number">2</span> met</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹åªæ˜¯å°†ä¸€å¯¹Conditionä¿¡å·å¤åˆ¶äº†ä¸€ä»½æ”¾åœ¨ä¸€ä¸ªç±»ä¸­æ‰§è¡Œï¼Œä¸åŒäºwait&#x2F;notifyï¼ŒConditionåœ¨è¿™ä¸ªå¯ä»¥æ ¹æ®å®ä¾‹ä¿¡å·ï¼ˆcondition1&#x2F;condition2)æ¥æŒ‡å®šéœ€è¦é€šè®¯çš„çº¿ç¨‹ã€‚</p><h2 id="Synchronizedå’ŒLockå¯¹æ¯”"><a href="#Synchronizedå’ŒLockå¯¹æ¯”" class="headerlink" title="Synchronizedå’ŒLockå¯¹æ¯”"></a>Synchronizedå’ŒLockå¯¹æ¯”</h2><ol><li><strong>è·å–æ–¹å¼</strong>ï¼š<ul><li><code>Synchronized</code>ï¼šé€šè¿‡ <code>synchronized</code> å…³é”®å­—æ¥å®ç°ï¼Œå¯ä»¥ä¿®é¥°æ–¹æ³•æˆ–ä»£ç å—ã€‚</li><li><code>Lock</code>ï¼šé€šè¿‡ <code>Lock</code> æ¥å£çš„å®ç°ç±»ï¼ˆå¦‚ <code>ReentrantLock</code>ï¼‰æ¥åˆ›å»ºå®ä¾‹ï¼Œå¹¶è°ƒç”¨å…¶æ–¹æ³•è¿›è¡Œè·å–é”ã€‚</li></ul></li><li><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š<ul><li><code>Synchronized</code>ï¼šåœ¨æ–¹æ³•ä¸Šä½¿ç”¨ <code>synchronized</code> å…³é”®å­—æˆ–ä½¿ç”¨ <code>synchronized</code> å—æ¥æŒ‡å®šéœ€è¦åŒæ­¥çš„ä»£ç å—ã€‚</li><li><code>Lock</code>ï¼šä½¿ç”¨ <code>Lock</code> å¯¹è±¡çš„ <code>lock()</code> æ–¹æ³•è·å–é”ï¼Œç„¶åä½¿ç”¨ <code>unlock()</code> æ–¹æ³•é‡Šæ”¾é”ã€‚</li></ul></li><li><strong>çµæ´»æ€§</strong>ï¼š<ul><li><code>Synchronized</code>ï¼šæ˜¯å†…ç½®çš„ã€<strong>éšå¼</strong>çš„é”æœºåˆ¶ï¼Œå…·æœ‰<strong>è‡ªåŠ¨é‡Šæ”¾é”</strong>çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨ï¼Œä½†ç›¸å¯¹è¾ƒä¸ºç®€å•ï¼Œæä¾›çš„åŠŸèƒ½ç›¸å¯¹æœ‰é™ã€‚</li><li><code>Lock</code>ï¼šæ˜¯<strong>æ˜¾å¼</strong>çš„é”æœºåˆ¶ï¼Œæä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’ŒåŠŸèƒ½ï¼Œä¾‹å¦‚å¯é‡å…¥æ€§ã€å…¬å¹³æ€§ã€æ¡ä»¶å˜é‡ç­‰ï¼Œä½†éœ€è¦æ‰‹åŠ¨ç®¡ç†é”çš„è·å–å’Œé‡Šæ”¾ã€‚</li></ul></li><li><strong>æ€§èƒ½</strong>ï¼š<ul><li><code>Synchronized</code>ï¼šåœ¨ Java 6 ä¹‹åè¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ€§èƒ½å·²ç»å¤§å¹…æå‡ï¼Œå°¤å…¶åœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½è¡¨ç°è‰¯å¥½ã€‚</li><li><code>Lock</code>ï¼šæ€§èƒ½ç›¸å¯¹è¾ƒå¥½ï¼Œå¹¶ä¸”åœ¨é«˜åº¦ç«äº‰çš„æƒ…å†µä¸‹èƒ½å¤Ÿæä¾›æ›´å¥½çš„æ€§èƒ½è¡¨ç°ã€‚</li></ul></li><li><strong>å¯ä¸­æ–­æ€§</strong>ï¼š<ul><li><code>Synchronized</code>ï¼šä¸€æ—¦è·å–åˆ°é”ï¼Œæ— æ³•è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ï¼Œåªèƒ½ç­‰å¾…é”çš„é‡Šæ”¾ã€‚</li><li><code>Lock</code>ï¼šæä¾›äº†å¯ä¸­æ–­çš„è·å–é”çš„æ–¹æ³• <code>lockInterruptibly()</code>ï¼Œå¯ä»¥åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­å“åº”ä¸­æ–­ã€‚</li></ul></li><li><strong>æ¡ä»¶å˜é‡</strong>ï¼š<ul><li><code>Synchronized</code>ï¼šä¸ç›´æ¥æ”¯æŒæ¡ä»¶å˜é‡ï¼Œä½†å¯ä»¥é€šè¿‡ <code>Object</code> çš„ <code>wait()</code>ã€<code>notify()</code> å’Œ <code>notifyAll()</code> æ–¹æ³•ç»“åˆ <code>synchronized</code> å…³é”®å­—æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚</li><li><code>Lock</code>ï¼šæä¾›äº† <code>Condition</code> æ¥å£æ¥æ”¯æŒæ¡ä»¶å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ <code>newCondition()</code> æ–¹æ³•åˆ›å»ºæ¡ä»¶å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å…¶ <code>await()</code>ã€<code>signal()</code> å’Œ <code>signalAll()</code> æ–¹æ³•è¿›è¡Œçº¿ç¨‹ç­‰å¾…å’Œé€šçŸ¥ã€‚</li></ul></li></ol><h4 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h4><p>JDKå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html">Synchronized Methods (The Javaâ„¢ Tutorials &gt; Essential Java Classes &gt; Concurrency) (oracle.com)</a></p><p><a href="https://www.cnblogs.com/cz123/p/7435113.html">synchronized VS Lock, wait-notify VS Condition</a></p><p>chatGPT3.5</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="JUC" scheme="https://nerkeler.github.io/tags/JUC/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://nerkeler.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº</title>
    <link href="https://nerkeler.github.io/2023/05/19/%E5%A6%82%E4%BD%95%E8%B6%85%E8%BF%87%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BA%BA/"/>
    <id>https://nerkeler.github.io/2023/05/19/%E5%A6%82%E4%BD%95%E8%B6%85%E8%BF%87%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BA%BA/</id>
    <published>2023-05-19T09:22:00.000Z</published>
    <updated>2023-05-19T09:25:11.031Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="å¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº"><a href="#å¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº" class="headerlink" title="å¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº"></a>å¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº</h1><h5 id="è½¬è½½è‡ª-https-coolshell-cn-articles-19464-html-åŸä½œè€…ï¼šé™ˆçš“ï¼ˆå·¦è€³æœµè€—å­ï¼‰é…·-å£³-â€“-CoolShell"><a href="#è½¬è½½è‡ª-https-coolshell-cn-articles-19464-html-åŸä½œè€…ï¼šé™ˆçš“ï¼ˆå·¦è€³æœµè€—å­ï¼‰é…·-å£³-â€“-CoolShell" class="headerlink" title="è½¬è½½è‡ª https://coolshell.cn/articles/19464.html  åŸä½œè€…ï¼šé™ˆçš“ï¼ˆå·¦è€³æœµè€—å­ï¼‰é…· å£³ â€“ CoolShell****"></a><em><strong>è½¬è½½è‡ª <a href="https://coolshell.cn/articles/19464.html">https://coolshell.cn/articles/19464.html</a>  åŸä½œè€…ï¼šé™ˆçš“ï¼ˆå·¦è€³æœµè€—å­ï¼‰</strong><a href="https://link.juejin.cn/?target=https://coolshell.cn/">é…· å£³ â€“ CoolShell</a></em>****</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps:è¯»è¿™ç¯‡æ–‡ç« å‰å…ˆçœ‹çœ‹ä¸‹é¢è¿™æ®µè¯ï¼Œé¿å…è¯¯å¯¼å¤§å®¶ã€‚</span><br><span class="line"></span><br><span class="line">åˆ‡è®°ï¼Œè¿™ç¯‡æ–‡ç« ä¸è¦è¿‡åº¦æ·±æ€ï¼ˆä»»ä½•ä¸œè¥¿éƒ½æ— æ³•ç»å¾—èµ·å®¡è§†ï¼Œå› ä¸ºè¿™ä¸–ä¸Šæ²¡æœ‰åŒæ ·çš„æˆé•¿ç¯å¢ƒï¼Œä¹Ÿæ²¡æœ‰åŒæ ·çš„è®¤çŸ¥æ°´å¹³åŒæ—¶ä¹Ÿ**æ²¡æœ‰é€‚ç”¨äºæ‰€æœ‰äººçš„è§£å†³æ–¹æ¡ˆ**ï¼›ä¹Ÿä¸è¦å»æ€¥ç€è¯„åˆ¤é‡Œé¢åˆ—å‡ºçš„è§‚ç‚¹ï¼Œåªéœ€ä»£å…¥åˆ°å…¶ä¸­é€‚åº¦å®¡è§†ä¸€ç•ªè‡ªå·±å³å¯ï¼Œèƒ½**è·³è„±å‡ºæ¥ä»å¤–äººçš„è§’åº¦çœ‹çœ‹ç°åœ¨çš„è‡ªå·±å¤„åœ¨ä»€ä¹ˆæ ·çš„é˜¶æ®µ**å°±è¡Œã€‚å…·ä½“æ€ä¹ˆæƒ³æ€ä¹ˆåšå…¨åœ¨ä½ è‡ªå·±å»**ä¸æ–­å®è·µä¸­å¯»æ‰¾é‚£ä¸ªé€‚åˆè‡ªå·±çš„æ–¹æ¡ˆ**ï¼‰</span><br><span class="line"></span><br><span class="line">å¼•ç”¨è‡ªï¼šhttps://juejin.cn/post/7207648496978870333</span><br></pre></td></tr></table></figure><p>å½“ä½ çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜ï¼Œä½ ä¸€å®šå¯¹è¿™ç¯‡æ–‡ç« äº§ç”Ÿäº†å·¨å¤§çš„å…´è¶£ï¼Œå› ä¸ºä½ çš„æ½œæ„è¯†åœ¨å‘Šè¯‰ä½ ï¼Œè¿™æ˜¯ä¸€æœ¬äººç”Ÿçš„â€œæ­¦æ—ç§˜ç±â€ï¼Œè€Œä¸”è¿˜æ˜¯å·¦è€³æœµå†™çš„ï¼Œä¸€å®šæœ‰å¹²è´§æ»¡æ»¡ï¼Œåªè¦è¯»å®Œï¼Œä¸€å®šå¯ä»¥ç»ƒå°±ç¥åŠŸå¹¶æ‰¾åˆ°è¶…è¿‡å¤§å¤šæ•°äººçš„å¿«è½¦é“å’Œæ·å¾„â€¦â€¦ç„¶è€Œâ€¦â€¦ å½“ä½ çœ‹åˆ°æˆ‘è¿™æ ·å¼€ç¯‡æ—¶ï¼Œä½ ä¸€å®šä¼šè§‰å¾—æˆ‘é©¬ä¸Šå°±è¦æœ‰ä¸ªè½¬æŠ˜ï¼Œå‘Šè¯‰ä½ è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œä¸€åˆ‡éƒ½éœ€è¦ä»˜å‡ºå’ŒåŠªåŠ›â€¦â€¦ç„¶è€Œï¼Œä½ é”™äº†ï¼Œè¿™ç¯‡æ–‡ç« è¿˜çœŸå°±æ˜¯ä¸€ç¯‡â€œç§˜ç±â€ï¼Œåªè¦ä½ æŠŠè¿™äº›â€œç§˜ç±â€ç”¨èµ·æ¥ï¼Œä½ å°±ä¸€å®šå¯ä»¥è¶…è¿‡å¤§å¤šæ•°äººã€‚è€Œä¸”ï¼Œè¿™ç¯‡æ–‡ç« åªæœ‰æˆ‘è¿™ä¸ªâ€œäººç”Ÿå¯¼å¸ˆâ€å¯ä»¥å†™å¾—å¥½ã€‚æ¯•ç«Ÿï¼Œæˆ‘çš„ç”Ÿå‘½è¿‡åˆ°äº†åå…­è¿›åˆ¶2Bçš„å¹´çºªï¼Œè¸å…¥è¿™ä¸ªç¤¾ä¼šå·²è¶…è¿‡20å¹´ï¼Œèˆæˆ‘å…¶è°å‘¢ï¼Ÿï¼</p><p>P.S. è¿™ç¯‡æ–‡ç« å€Ÿé‰´äºã€Š<a href="https://coolshell.cn/articles/4758.html">å¦‚ä½•å†™å‡ºæ— æ³•ç»´æŠ¤çš„ä»£ç </a>ã€‹ä¸€æ–‡çš„é£æ ¼â€¦â€¦å˜¿å˜¿</p><h4 id="ç›¸å…³æŠ€å·§å’Œæœ€ä½³å®è·µ"><a href="#ç›¸å…³æŠ€å·§å’Œæœ€ä½³å®è·µ" class="headerlink" title="ç›¸å…³æŠ€å·§å’Œæœ€ä½³å®è·µ"></a>ç›¸å…³æŠ€å·§å’Œæœ€ä½³å®è·µ</h4><p>è¦è¶…è¿‡åˆ«äººå…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå°¤å…¶åœ¨ä»Šå¤©çš„ä¸­å›½ï¼Œæ›´æ˜¯ç®€å•ã€‚å› ä¸ºï¼Œä½ åªçœ‹çœ‹ä¸­å›½çš„äº’è”ç½‘ï¼Œä½ å°±ä¼šå‘ç°ï¼Œä»–ä»¬åŸºæœ¬ä¸Šå…¨éƒ¨éƒ½æ˜¯åœ¨æ¶ˆè´¹å¤§ä¼—ï¼Œè®©å¤§ä¼—å˜å¾—æ›´ä¸ºåœ°æ„šè ¢å’Œå‚»ç“œã€‚<strong>æ‰€ä»¥ï¼Œåœ¨ä»Šå¤©çš„ä¸­å›½ï¼Œä½ åŸºæœ¬ä¸Šä¸ç”¨åšä»€ä¹ˆï¼Œåªéœ€è¦ä¸ä½¿ç”¨ä¸­å›½äº’è”ç½‘ï¼Œä½ å°±å¾ˆè‡ªç„¶åœ°è¶…è¿‡å¤§å¤šæ•°äººäº†</strong>ã€‚å½“ç„¶ï¼Œå¦‚æœä½ è¿˜æƒ³è·Ÿä»–ä»¬å½»åº•æ‹‰å¼€ï¼Œç”©ä»–ä»¬å‡ ä¸ªèº«ä½ï¼ŒæŠŠåˆ«äººæ‰“åˆ°åº•å±‚ï¼Œä¸‹é¢çš„è¿™äº›â€œæŠ€å·§â€ä½ è¦å¤šå¤šäº†è§£ä¸€ä¸‹ã€‚</p><p>åœ¨ä¿¡æ¯è·å–ä¸Šï¼Œä½ è¦ä¸æ–­åœ°å‘å¤§ä¼—é¼“å¹ä¸‹é¢çš„è¿™äº›äº‹ï¼š</p><ul><li>è®©å¤§å®¶éƒ½ç”¨ç™¾åº¦æœç´¢å¼•æ“æŸ¥æ‰¾ä¿¡æ¯ï¼Œè®¢é˜…å¾®ä¿¡å…¬ä¼—å·æˆ–æ˜¯åˆ°çŸ¥ä¹ä¸Šå­¦ä¹ çŸ¥è¯†â€¦â€¦è¦åšåˆ°è¿™ä¸€æ­¥ï¼Œä½ å°±éœ€è¦æŠŠâ€œç™¾åº¦ä¸€ä¸‹â€æŒ‚åœ¨å˜´è¾¹ï¼Œç„¶åè¦ç»å¸¸åœ¨ç¾¤æˆ–æœ‹å‹åœˆä¸­è½¬å‘å¾®ä¿¡å…¬ä¼—å·çš„æ–‡ç« ï¼Œå¹¶ä¸”è½¬å‘çŸ¥ä¹é‡Œçš„å„ç§â€œå¦‚ä½•çœ‹å¾…â€¦â€¦â€è¿™æ ·çš„æ–‡ç« ï¼Œè®©ä»–ä»¬çˆ±ä¸Šå…«å¦ï¼Œçˆ±ä¸Šè½¬å‘ï¼Œçˆ±ä¸Šç¢ç‰‡ã€‚</li><li>è®©å¤§å®¶åˆ°å¾®åšæˆ–æ˜¯çŸ¥è¯†æ˜Ÿçƒä¸Šç²‰ä¸€äº›å¤§å’–ï¼Œå¯†åˆ‡å…³æ³¨ä»–ä»¬çš„è¨€è®ºå’ŒåŠ¨å‘â€¦â€¦æ˜¯çš„ï¼Œå‘Šè¯‰å¤§å®¶ï¼Œå¤§å’–çš„ä»»ä½•æƒ³æ³•ä¸€è¨€ä¸€è¡Œéƒ½å¯ä»¥åœ¨å¾®åšã€æœ‹å‹åœˆæˆ–æ˜¯çŸ¥è¯†æ˜Ÿçƒä¸Šè·å¾—ï¼Œè®©å¤§å®¶ç›¸ä¿¡ï¼Œä½ çš„æˆé•¿å’Œå¤§å’–çš„è§é—»å’Œé—²æ‰¯éå¸¸æœ‰å…³ç³»ï¼Œä½ è·Ÿç‰›äººåœ¨ä¸€ä¸ªåœˆå­é‡Œä½ ä¹Ÿä¼šå˜ç‰›ã€‚</li><li>æŠŠä»Šæ—¥å¤´æ¡å’ŒæŠ–éŸ³è¿™æ ·çš„APPæ¨èç»™å¤§å®¶â€¦â€¦ä½ åªéœ€è¦è®©ä½ æœ‰æœ‹å‹æˆåŠŸåœ°å®‰è£…è¿™ä¸¤ä¸ªAPPï¼Œä»–ä»¬å°±ä¼šèŠ±å¤§é‡çš„æ—¶é—´åœ¨ä¸Šé¢ï¼Œè€Œä¸èƒ½è‡ªæ‹”ï¼Œè¦è®©ä»–ä»¬å®‰è£…å…¶å®è¿˜æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½ è¦ä¸ä¿¡ä½ å°±è£…ä¸€ä¸ªè¯•ç©ä¸€ä¼šçœ‹çœ‹ï¼ˆå˜¿å˜¿å˜¿ï¼‰ã€‚</li><li>è®©å¤§å®¶çƒ­çˆ±å…«å¦ï¼Œå…«å¦å¹¶ä¸ä¸€å®šæ˜¯æ˜æ˜Ÿçš„å…«å¦ï¼Œè¿˜å¯ä»¥æ˜¯ä½ èº«è¾¹çš„äººï¼Œæ¯”å¦‚ï¼Œå…¬å¸çš„åŒäº‹ï¼Œè‡ªå·±çš„åŒå­¦ï¼ŒèŒåœºè§é—»ï¼Œç¤¾ä¼šçƒ­ç‚¹ï¼Œäº‰è®®è¯é¢˜ï¼Œâ€¦â€¦è¿™äº›ä¸œè¥¿æ€»æœ‰ä¸€äº›ä¸œè¥¿ä¼šè®©äººå¿ƒæ€æœ‰å¾ˆå¤šå¾®å¦™çš„å˜åŒ–ï¼Œç”šè‡³èŠ±å¤§é‡çš„æ—¶é—´å»æœç´¢å’Œé˜…è¯»å¤§é‡çš„è§‚ç‚¹ï¼Œä»¥åŠèŠ±å¤§é‡æ—¶é—´ä¸äººè¾©è®ºäº‰è®ºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè®©äººä¸Šç˜¾ï¼Œè®©äººæ¬²ç½¢ä¸èƒ½ï¼Œç„¶è€Œè¿™äº›äº‹å´å’Œè‡ªå·±æ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚ä½ è¦åšçš„äº‹å°±æ˜¯è½¬å‘å…¶ä¸­ä¸€äº›SBæˆ–æ˜¯å¾ˆæç«¯çš„è§‚ç‚¹ï¼Œé€ æˆå¤§å®¶çš„ä¸€ç¦è®¨è®ºåï¼Œå°±æ—©æ—©ç¦»åœºâ€¦â€¦</li><li>åˆ©ç”¨çˆ±å›½ä¸»ä¹‰ï¼Œè®©å¤§å®¶è§‰å¾—ä¸ç”¨å­¦è‹±æ–‡ï¼Œä¸è¦å‡ºå›½ï¼Œä¸è¦ç¿»å¢™ï¼Œå’±ä»¬å·²ç»æ˜¯å¼ºå›½äº†â€¦â€¦è¿™ç‚¹å…¶å®è¿˜æ˜¯å¾ˆå®¹æ˜“åšåˆ°çš„ï¼Œå› ä¸ºå­¦ä¹ æ˜¯æ¯”è¾ƒé€†äººæ€§çš„ï¼Œæ‰€ä»¥ï¼Œåªè¦ä½ é¼“å¹é‚£äº›è‹±æ–‡æ— ç”¨è®ºï¼Œå‡ºå›½æ´»å¾—æ›´æƒ¨ï¼Œå›½å®¶å’Œæ°‘æ—éƒ½å˜å¾—å¾ˆå¼ºå¤§ï¼Œå°±ç®—è‡ªå·±è¿‡å¾—å¾ˆåº•å±‚ï¼Œä¹Ÿæœ‰å¤§å›½äººæ°‘çš„æ„Ÿè§‰ã€‚</li></ul><p>ç„¶åï¼Œåœ¨çŸ¥è¯†å­¦ä¹ å’ŒæŠ€èƒ½è®­ç»ƒä¸Šï¼Œè®©ä»–ä»¬ä¸å¾—è¦é¢†å¹¶äº§ç”Ÿå¹»è§‰</p><ul><li>è®©ä»–ä»¬æ··æ·†è®¤è¯†å’ŒçŸ¥è¯†ï¼Œä»¥ä¸ºå¼€é˜”è®¤çŸ¥å°±æ˜¯å­¦ä¹ ï¼Œè®©ä»–ä»¬æœ‰å­¦ä¹ å’Œæˆé•¿çš„å¹»è§‰â€¦â€¦</li><li>åŸ¹å…»ä»–ä»¬è¦å­¦ä¼šä½¿ç”¨ç¢ç‰‡æ—¶é—´å­¦ä¹ ã€‚ç­‰ä»–ä»¬ä¹ æƒ¯åˆ©ç”¨ç¢ç‰‡æ—¶é—´åƒå¿«é¤åï¼Œä»–ä»¬å°±ä¼šå¤±å»ç²¾è¯»ä¸€æœ¬ä¹¦çš„è€æ€§â€¦â€¦</li><li>ä¸æ–­åœ°ç»™ä»–ä»¬å„ç§å„æ ·â€œæœ‰ä»·å€¼çš„å­¦ä¹ èµ„æ–™â€ï¼Œè®©ä»–ä»¬æŠ“ä¸ä½é‡ç‚¹ï¼Œæˆä¸ºä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·æˆ–ç”µå­ä¹¦â€œæ”¶è—å®¶â€â€¦â€¦</li><li>è®©ä»–ä»¬çœ‹ä¸€äº›æ¯ç‡¥æ— å‘³çš„åŸºç¡€çŸ¥è¯†å’Œç¡¬æ ¸çŸ¥è¯†ï¼Œè¿™æ ·è®©ä»–ä»¬åªä¼šç”¨â€œæ­»è®°ç¡¬èƒŒâ€çš„æ–¹å¼æ¥å­¦ä¹ ï¼Œç”šè‡³ç›´æ¥è®©ä»–ä»¬å¤±å»ä¿¡å¿ƒï¼Œç›´æ¥æ”¾å¼ƒâ€¦â€¦</li><li>ç©å…·æ‰‹æªæ˜¯æ˜“ç”¨çš„ï¼Œé‡æ­¦å™¨æ˜¯éš¾ä»¥æ“æ§çš„ï¼Œå¤šç»™ä»–ä»¬ä¸€äº›ç©å…·ï¼Œè¿™æ ·ä»–ä»¬å°±ä¼šå¯¹ç©å…·ç©åœ°å¾—å¿ƒåº”æ‰‹ï¼Œè§‰å¾—ç©ç©å…·å°±æ˜¯è‡ªå·±çš„ä¸“ä¸šâ€¦â€¦</li><li>è®©ä»–ä»¬å–œæ¬¢ç›´æ¥å¾—åˆ°ç­”æ¡ˆçš„å·¥ä½œå’Œå­¦ä¹ æ–¹å¼ï¼Œæˆä¸ºä¸€ä¸ªä¼¸æ‰‹å…šï¼Œä»æ­¤å­¦ä¹ å†ä¹Ÿä¸æ€è€ƒâ€¦â€¦</li><li>å‘Šè¯‰ä»–ä»¬ä¸œè¥¿åšå‡ºæ¥å°±å¥½äº†ï¼Œä¸è¦è¿½æ±‚åšæ¼‚äº®ï¼Œåšä¼˜é›…ï¼Œè¿™æ ·ä»–ä»¬å°±ä¼šæ…¢æ…¢åœ°å˜æˆåŠ³åŠ¨å¯†é›†å‹â€¦â€¦</li><li>è®©ä»–ä»¬è§‰å¾—è‡ªå·±å·²ç»å¾ˆåŠªåŠ›äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯è¿æ°”ï¼Œå¹¶è¯´æœä»–ä»¬å»â€˜åŠæ—¶è¡Œä¹â€™ï¼Œç„¶åå†ä¹Ÿæ‰¾ä¸åˆ°é«˜é˜¶å’Œé«˜æ•ˆç‡å­¦ä¹ çš„æ„Ÿè§‰â€¦â€¦</li><li>è®©ä»–ä»¬è§‰å¾—â€œè¯»å®Œä¹¦â€ã€â€œè¯»è¿‡ä¹¦â€å°±è¡Œäº†ï¼Œä¸éœ€è¦å¯¹ä¹¦ä¸­çš„ä¸œè¥¿è¿›è¡Œæ€è€ƒï¼Œè¿›è¡Œæ€»ç»“ï¼Œæˆ–æ˜¯å®è·µï¼Œåªè¦å›«å›µåæ£å°½å¿«è¯»å®Œå°±ç­‰åŒäºå­¦å¥½äº†â€¦â€¦</li></ul><p>æœ€åï¼Œåœ¨è®¤çŸ¥å’Œæ ¼å±€ä¸Šï¼Œå½»åº•æ‰“å®ä»–ä»¬ï¼Œè®©ä»–ä»¬å˜æˆéŸ­èœã€‚</p><ul><li>è®©ä»–ä»¬å°½å¯èƒ½åœ°ç”¨æ‹¼å‘½å’ŒåŠ ç­ï¼Œå°½å¯èƒ½çš„996ï¼Œå¹¶å‘Šè¯‰ä»–ä»¬è¿™å°±æ˜¯é€šå¾€æˆåŠŸçš„å”¯ä¸€è·¯å¾„ã€‚è¿™æ ·ä¸€æ¥ï¼Œä»–ä»¬å¿…ç„¶ä¼šè¢«æ°¸è¿œå›°åœ¨ä½ç«¯æˆä¸ºæœ€ä½çš„åŠ³åŠ¨åŠ›ã€‚</li><li>è®©ä»–ä»¬ä¸è¦çœ‹åˆ°å¤§çš„å½¢åŠ¿ï¼Œåªçœ‹åˆ°çœ¼å‰çš„ä¸€äº©ä¸‰åˆ†åœ°ï¼Œåšå¥½ä¸€ä¸ªäº•åº•ä¹‹è›™ã€‚å…¶å®è¿™å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸è¦å‘Šè¯‰ä»–è¿˜æœ‰å¦å¤–ä¸€ç§æ´»æ³•ï¼Œä¸è¦æ‰©å¤§ä»–çš„è®¤è¯†â€¦â€¦</li><li>å®£æ‰¬ä¸€å¤œæš´å¯Œä»¥åŠå¿«é€ŸæŒ£é’±çš„æ¡ˆä¾‹ï¼Œæœ€å¥½è®©ä»–ä»¬è¿›å…¥â€œèµŒåšç±»â€æˆ–æ˜¯â€œä¼ é”€ç±»â€çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼šè‚¡å¸‚ã€æ•°å­—è´§å¸â€¦â€¦è¦è®©ä»–ä»¬ç›¸ä¿¡å„ç§è´¢å¯Œç¥è¯ï¼Œç›¸ä¿¡ä»–ä»¬å°±æ˜¯é‚£ä¸ªå¹¸è¿å„¿ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥æˆä¸ºå·´è²ç‰¹ï¼Œå¯ä»¥æˆä¸ºé©¬äº‘â€¦â€¦</li><li>å‘Šè¯‰ä»–ä»¬ï¼Œä¸€äº›çœ‹ä¸Šå»å¾ˆéš¾çš„äº‹éƒ½æ˜¯æœ‰æ·å¾„çš„ï¼Œæ¯”å¦‚ï¼š21å¤©å°±èƒ½å­¦ä¼šæœºå™¨å­¦ä¹ ï¼Œç”¨åŒºå—é“¾å°±èƒ½é¢ è¦†ä»¥åŠé‡æ„æ•´ä¸ªä¸–ç•Œç­‰ç­‰â€¦â€¦</li><li>å¤šè·Ÿä»–ä»¬è®²ä¸€äº›å°äººç‰©çš„åŠ±å¿—çš„æ•…äº‹ï¼Œè¿™æ ·è®©ä»–ä»¬ç›¸ä¿¡ï¼Œä¸éœ€è¦å­¦ä¹ é«˜çº§çŸ¥è¯†ï¼Œä¸éœ€è¦æŒæ¡é«˜çº§æŠ€èƒ½ï¼Œåªéœ€è¦ç”¨ä½ç­‰çš„çŸ¥è¯†å’Œä½çº§çš„æŠ€èƒ½ï¼Œå†åŠ ä¸ŠæŒç»­ä¸æ–­æ‹¼å‘½é‡å¤ç°æœ‰çš„å·¥ä½œï¼Œç»ˆæœ‰ä¸€å¤©å°±ä¼šæˆåŠŸâ€¦â€¦</li><li>å¤šè®©ä»–ä»¬è·Ÿåˆ«äººæ¯”è¾ƒï¼Œäººæ¯”äººä¸ä¼šæ°”æ­»äººï¼Œä½†æ˜¯ä¼šè®©äººå˜å¾—æµ®èºï¼Œå˜å¾—å¿ƒæ€¥ï¼Œå˜å¾—ç„¦è™‘ï¼Œå½“ä¸€ä¸ªäººæ²¡æœ‰åŠæ³•æ§åˆ¶è‡ªå·±çš„æƒ…ç»ªï¼Œæ²¡æœ‰åŠæ³•è®©è‡ªå·±é™ä¸‹å¿ƒæ¥ï¼Œäººä¼šå¤±å»è€æ€§å’ŒåšæŒï¼Œå¼€å§‹å¥½å¤§å–œæ¬¢åŠŸï¼Œå¼€å§‹è£…é€¼ï¼Œå¼€å§‹æ­ªé—¨é‚ªé“å‰‘èµ°åé”‹â€¦â€¦</li><li>è®©ä»–ä»¬åˆ°ä½“åˆ¶å†…çš„ä¸€äº›éå¸¸ç¨³å®šçš„åœ°æ–¹å·¥ä½œï¼Œè¿™æ ·ä»–ä»¬æ‹¥æœ‰ä¸æ€è¿›å–ã€æ€•æ‰¿æ‹…è´£ä»»ã€å®³æ€•çŠ¯é”™ã€å–œæ¬¢å·æ‡’ã€å¾—è¿‡ä¸”è¿‡çš„ç´ è´¨â€¦â€¦</li><li>è®©ä»–ä»¬åˆ°ä½“åˆ¶å¤–çš„é‚£äº›å–œæ¬¢æ‹¼å‘½å–œæ¬¢åŠ ç­çš„åœ°æ–¹å·¥ä½œï¼Œå‘Šè¯‰ä»–ä»¬çˆ±æ‹¼æ‰ä¼šèµ¢ï¼ŒåŠªåŠ›åŠ ç­æ˜¯ä¸€ç§ç¦æŠ¥ï¼Œé’æ˜¥å°±æ˜¯ç”¨æ¥æ‹¼çš„ï¼Œè®©ä»–ä»¬å–œæ¬¢ä¸Šä½¿è›®åŠ›çš„æ„Ÿè§‰â€¦â€¦</li><li>å‘Šè¯‰ä»–ä»¬ä½ çš„è¡Œä¸šå¤ªç´¯å¤ªè¾›è‹¦ï¼Œå¹²ä¸åˆ°30å²ã€‚è®©ä»–ä»¬æ—©ç‚¹è½¬è¡Œï¼Œä¸è¦è€½è¯¯äººç”Ÿå’Œé’æ˜¥â€¦â€¦</li><li>å½“ä»–ä»¬è¦åšå†³å®šçš„æ—¶å€™ï¼Œä¸€å®šè¦è®©ä»–ä»¬æ›´å¤šçš„å…³æ³¨è‡ªå·±ä¼šå¤±å»çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯ä¼šå¾—åˆ°çš„ä¸œè¥¿ã€‚åŸ¹å…»ä»–ä»¬æ‚£å¾—æ‚£å¤±å¿ƒæ€ï¼Œè®©ä»–ä»¬è®¤è¯†ä¸åˆ°äº‹ç‰©çœŸæ­£çš„ä»·å€¼ï¼Œå¤±å»åˆ¤æ–­èƒ½åŠ›â€¦â€¦ï¼ˆæ¯”å¦‚ï¼šè®©ä»–ä»¬è§‰å¾—è·Ÿå¯¹äººæ‹é¢†å¯¼çš„é©¬å±å¿ äºå…¬å¸æ¯”è‡ªæˆ‘çš„æˆé•¿æ›´æœ‰ä»·å€¼ï¼‰</li><li>å‘Šè¯‰ä»–ä»¬ï¼Œä½ ç°æœ‰çš„æŠ€èƒ½å’ŒçŸ¥è¯†ä¸ç”¨æ›´æ–°ï¼Œå°±èƒ½è¿‡å¥½ä¸€è¾ˆå­ï¼Œæ–°å‡ºæ¥çš„ä¸œè¥¿æ²¡æœ‰ç”Ÿå‘½åŠ›çš„â€¦â€¦è¿™æ ·ä»–ä»¬å°±ä¼šåƒæˆ‘ä»¬å†ä¹Ÿä¸å­¦ä¹ çš„çˆ¶è¾ˆä¸€æ ·å¾ˆå¿«å°±ä¼šè¢«æ—¶ä»£æ‰€æŠ›å¼ƒâ€¦â€¦</li><li>æ¯ä¸ªäººéƒ½å–œæ¬¢åœ¨ä¸€äº›è‡ªå·±åšä¸åˆ°çš„äº‹ä¸Šæ‰¾ç†ç”±ï¼Œè¿™ç§èƒ½åŠ›ä¸æ•™å°±ä¼šï¼Œæ¯”å¦‚ï¼Œäº‹æƒ…å¤ªå¤šæ²¡æœ‰æ—¶é—´ï¼Œå› ä¸ºå·¥ä½œä¸Šæ²¡æœ‰ç”¨åˆ°ï¼Œç­‰ç­‰ï¼Œä½ è¦åšçš„å°±æ˜¯å¸®ä»–ä»¬ä¸ºä»–ä»¬åšä¸åˆ°çš„äº‹æ‰¾å„ç§éå¸¸åˆç†çš„ç†ç”±ï¼Œæ¯”å¦‚ï¼šæ²¡äº‹çš„ï¼Œä¸€åˆ‡éƒ½æ˜¯æœ€å¥½çš„å®‰æ’ï¼›ä½ å¾—ä¸åˆ°çš„é‚£ä¸ªäº‹æ²¡ä»€ä¹ˆæ„æ€ï¼›ä½ æ²¡æœ‰é¢å¥½ä¸»è¦åŸå› æ˜¯é‚£ä¸ªé¢è¯•å®˜é—®çš„é—®é¢˜éƒ½æ˜¯å¯ä»¥ä¸Šç½‘æŸ¥å¾—åˆ°çš„çŸ¥è¯†ï¼Œè€Œä¸æ²¡æœ‰é—®åˆ°ä½ çœŸæ­£çš„èƒ½åŠ›ä¸Šï¼›è¿™äº›ä¸œè¥¿å­¦äº†ä¸ç”¨å¾ˆå¿«ä¼šå¿˜äº†ï¼Œç­‰æœ‰äº†ç¯å¢ƒå†å­¦ä¹Ÿä¸è¿Ÿâ€¦â€¦</li></ul><p><strong>æœ€åå‹æƒ…æç¤ºä¸€ä¸‹ï¼Œä¸Šè¿°çš„è¿™äº›â€œæœ€ä½³å®è·µâ€ä½ è¦å°å¿ƒï¼Œæ˜¯æ‰€è°“ï¼Œè´©æ¯’çš„äººä»æ¥ä¸å¸æ¯’ï¼Œå¼€èµŒåœºçš„äººä»æ¥ä¸èµŒåšï¼æ‰€ä»¥ï¼Œä½ è¦å°å¿ƒåˆ«è‡ªå·±ä¹Ÿæ‰è¿›å»äº†ï¼è¿™å°±æ˜¯â€œæ¬²ç»ƒç¥åŠŸï¼Œå¿…å…ˆè‡ªå®«â€çš„é“ç†ã€‚</strong></p><h4 id="ç›¸å…³åŸç†å’Œæ€ç»´æ¨¡å‹"><a href="#ç›¸å…³åŸç†å’Œæ€ç»´æ¨¡å‹" class="headerlink" title="ç›¸å…³åŸç†å’Œæ€ç»´æ¨¡å‹"></a>ç›¸å…³åŸç†å’Œæ€ç»´æ¨¡å‹</h4><p>å¯¹äºä¸Šé¢çš„è¿™äº›æŠ€å·§è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œä½ è‡ªå·±ä¹Ÿå¯ä»¥å‘æ˜æˆ–æ˜¯æ‰¾åˆ°å¾ˆå¤šã€‚æ‰€ä»¥ï¼Œæˆ‘æ¥è®²è®²è¿™å…¶ä¸­çš„ä¸€äº›åŸç†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¶…è¿‡åˆ«äººä¸€èˆ¬æ¥è¯´å°±æ˜¯ä¸¤ä¸ªç»´åº¦ï¼š</p><ol><li><strong>åœ¨è®¤çŸ¥ã€çŸ¥è¯†å’ŒæŠ€èƒ½ä¸Š</strong>ã€‚è¿™æ˜¯ä¸€ä¸ªäººèµ–ä»¥ç«‹è¶³ç¤¾ä¼šçš„èƒ½åŠ›ï¼ˆå‚çœ‹ã€Š<a href="https://coolshell.cn/articles/4235.html">ç¨‹åºå‘˜çš„è’è°¬ä¹‹è¨€è¿˜æ˜¯è‡³ç†åè¨€ï¼Ÿ</a>ã€‹å’Œã€Š<a href="https://coolshell.cn/articles/2250.html">21å¤©æ•™ä½ å­¦ä¼šC++</a>ã€‹ï¼‰</li><li><strong>åœ¨é¢†å¯¼åŠ›ä¸Š</strong>ã€‚æ‰€è°“é¢†å¯¼åŠ›å°±æ˜¯ä½ è·‘åœ¨åˆ«äººå‰é¢ï¼Œä½ å¾—è¦æœ‰æ¯”åˆ«äººæ›´å¥½çš„èƒ½åŠ›æ›´é«˜çš„æ ‡å‡†ï¼ˆå‚çœ‹ã€Š<a href="https://coolshell.cn/articles/17583.html">æŠ€æœ¯äººå‘˜å‘å±•ä¹‹è·¯</a>ã€‹ï¼‰</li></ol><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜ç™½ï¼Œäººçš„æŠ€èƒ½æ˜¯ä»è®¤è¯†å¼€å§‹ï¼Œç„¶åé€šè¿‡å­¦æ ¡ã€åŸ¹è®­æˆ–æ˜¯ä¹¦æœ¬æŠŠâ€œé›¶ç¢çš„è®¤çŸ¥â€è½¬æ¢æˆâ€œç³»ç»Ÿçš„çŸ¥è¯†â€ï¼Œè€Œæœ‰è¦æŠŠçŸ¥è¯†è½¬æ¢æˆæŠ€èƒ½ï¼Œå°±éœ€è¦è®­ç»ƒå’Œå®è·µï¼Œè¿™æ ·æ‰èƒ½å®Œæˆä»ï¼šè®¤è¯† -&gt; çŸ¥è¯† -&gt; æŠ€èƒ½ çš„è½¬æ¢ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹æ˜¯éœ€è¦è€—è´¹å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›çš„ï¼Œè€Œä¸”å…¶ä¸­è¿˜éœ€è¦æœ‰å¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›å’ŒåŠ¨æ‰‹èƒ½åŠ›ï¼Œè¿™æ¡è·¯å¾„ä¸Šæœ‰å¾ˆå¤šçš„â€œå…³å¡â€ï¼Œæ¯é“å…³å¡éƒ½ä¼šè¿‡æ»¤æ‰ä¸€å¤§éƒ¨åˆ†äººã€‚æ¯”å¦‚ï¼šå¯¹äºä¸€äº›æ¯”è¾ƒæ¯ç‡¥çš„ç¡¬æ ¸çŸ¥è¯†æ¥è¯´ï¼Œ90%çš„äººåŸºæœ¬ä¸Šå°±å€’ä¸‹æ¥ï¼Œä¸æ˜¯å› ä¸ºä»–ä»¬æ²¡æœ‰æ™ºå•†ï¼Œè€Œæ˜¯ä»–ä»¬æ²¡æœ‰è€å¿ƒã€‚</p><h5 id="è®¤çŸ¥"><a href="#è®¤çŸ¥" class="headerlink" title="è®¤çŸ¥"></a>è®¤çŸ¥</h5><p>è¦åœ¨è®¤çŸ¥ä¸Šè¶…è¿‡åˆ«äººï¼Œå°±è¦åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢ä¸Šåšè¶³åŠŸå¤«ï¼š</p><p>1ï¼‰<strong>ä¿¡æ¯æ¸ é“</strong>ã€‚è¯•æƒ³å¦‚æœåˆ«äººçš„ä¿¡æ¯æºæ²¡æœ‰ä½ çš„å¥½ï¼Œé‚£ä¹ˆï¼Œè¿™äº›çœ‹ä¸è§ä¿¡æ¯æºçš„äººï¼Œåªèƒ½æ¥è§¦å¾—åˆ°äºŒæ‰‹ä¿¡æ¯ç”šè‡³ä¸‰æ‰‹ä¿¡æ¯ï¼Œåªèƒ½è·å¾—è¢«åˆ«äººè§£è¯»è¿‡çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¸‰ä¼ ä¸¤é€’åå¿…å®šä¼šæœ‰é”™è¯¯å’Œå¤±çœŸï¼Œç”šè‡³ä¼šè¢«ä¼ é€’ä¿¡æ¯çš„ä¸­é—´äººhackå…¶ä¸­çš„ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯â€œä¸­é—´äººæ”»å‡»â€ï¼‰ï¼Œè€Œè¿™äº›æ‰¾ä¸å‡ºä¿¡æ¯æºçš„äººï¼Œåªèƒ½â€œè¢«äººå–‚å…»â€ï¼Œäºæ˜¯ï¼Œä»–ä»¬æœ€ç»ˆä¼šè¢«å›°åœ¨ä¿¡æ¯çš„åº•å±‚ï¼Œæ°¸ä¸–ä¸å¾—ç¿»èº«ã€‚ï¼ˆæ¯”å¦‚ï¼šå­¦ä¹ Cè¯­è¨€ï¼Œæ”¾ç€åŸä½œè€…K&amp;Rçš„ä¸ç”¨ï¼Œç¡¬è¦ç”¨é”™è¯¯ç™¾å‡ºè°­æµ©å¼ºçš„ä¹¦ï¼Œèƒ½æœ‰ä»€ä¹ˆå¥½å‘¢ï¼Ÿï¼‰</p><p>2ï¼‰<strong>ä¿¡æ¯è´¨é‡</strong>ã€‚ä¿¡æ¯è´¨é‡ä¸»è¦è¡¨ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯ä¿¡æ¯ä¸­çš„ç‡¥éŸ³ï¼Œå¦ä¸€ä¸ªæ˜¯ä¿¡æ¯ä¸­çš„è´¨é‡ç­‰çº§ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨å¤§æ•°æ®å¤„ç†ä¸­æœ‰ä¸€å¥åè¨€ï¼Œå« garbage in garbage outï¼Œä½ å¤©å¤©çœ‹çš„éƒ½æ˜¯åƒåœ¾ï¼Œä½ çš„æ€æƒ³å’Œè®¤è¯†ä¹Ÿåªæœ‰åƒåœ¾ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ä¿¡æ¯è´¨é‡å¹¶ä¸å¥½çš„è¯ï¼Œä½ çš„è®¤çŸ¥ä¹Ÿä¸ä¼šå¥½ï¼Œè€Œä¸”ä½ è¿˜è¦èŠ±å¤§é‡çš„æ—¶é—´æ¥è¿›è¡Œæœ‰ä»·å€¼ä¿¡æ¯çš„æŒ–æ˜å’Œå¤„ç†ã€‚</p><p>3ï¼‰<strong>ä¿¡æ¯å¯†åº¦</strong>ã€‚ä¼˜è´¨çš„ä¿¡æ¯ï¼Œå¯†åº¦ä¸€èˆ¬éƒ½å¾ˆå¤§ï¼Œå› ä¸ºè¿™ç§ä¿¡æ¯ä¼šé€¼ç€ä½ å»å¹²è¿™ä¹ˆå‡ ä»¶äº‹ï¼Œaï¼‰æœç´¢å¹¶å­¦ä¹ å…¶å…³è”çš„çŸ¥è¯†ï¼Œbï¼‰æ²‰æ€å’Œåçœï¼Œcï¼‰äº²æ‰‹å»æ¨ç†ã€éªŒè¯å’Œå®è·µâ€¦â€¦ä¸€èˆ¬æ¥è¯´ï¼Œç»éªŒæ€§çš„æ–‡ç« ä¼šæ¯”çŸ¥è¯†æ€§çš„æ–‡ç« ä¼šæ›´æœ‰è¿™æ ·çš„åŠŸæ•ˆã€‚æ¯”å¦‚ï¼Œç±»ä¼¼äºåƒ Effiective C++&#x2F;Javaï¼Œè®¾è®¡æ¨¡å¼ï¼ŒUnixç¼–ç¨‹è‰ºæœ¯ï¼Œç®—æ³•å¯¼è®ºç­‰ç­‰è¿™æ ·çš„ä¹¦å°±æ˜¯å±äºè¿™ç§å¯†åº¦å¾ˆå¤§çš„ä¹¦ï¼Œè€Œåƒ<a href="https://medium.com/netflix-techblog">Netflixçš„å®˜æ–¹blog</a>å’Œ<a href="https://www.allthingsdistributed.com/">AWS CTOçš„blog</a>ç­‰ç­‰åœ°æ–¹ä¹Ÿä¼šç»å¸¸æœ‰ä¸€äº›è¿™æ ·çš„æ–‡ç« ã€‚</p><h5 id="çŸ¥è¯†"><a href="#çŸ¥è¯†" class="headerlink" title="çŸ¥è¯†"></a>çŸ¥è¯†</h5><p>è¦åœ¨çŸ¥è¯†ä¸Šè¶…è¿‡åˆ«äººï¼Œä½ å°±éœ€è¦åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢ä¸Šåšè¶³åŠŸå¤«ï¼š</p><p>1ï¼‰<strong>çŸ¥è¯†æ ‘ï¼ˆå›¾ï¼‰</strong>ã€‚ä»»ä½•çŸ¥è¯†ï¼Œåªåœ¨ç‚¹ä¸Šå­¦ä¹ ä¸å¤Ÿçš„ï¼Œéœ€è¦åœ¨é¢ä¸Šå­¦ä¹ ï¼Œè¿™å«ç³»ç»Ÿåœ°å­¦ä¹ ï¼Œè¿™éœ€è¦æˆ‘ä»¬å»æ€»ç»“å¹¶å½’çº³çŸ¥è¯†æ ‘æˆ–çŸ¥è¯†å›¾ï¼Œä¸€ä¸ªçŸ¥è¯†é¢ä¼šæœ‰å¤šä¸ªçŸ¥è¯†æ¿å—ç»„æˆï¼Œä¸€ä¸ªæ¿å—åˆæœ‰å„ç§çŸ¥è¯†ç‚¹ï¼Œä¸€ä¸ªçŸ¥è¯†ç‚¹ä¼šå¯¼å‡ºå¦å¤–çš„çŸ¥è¯†ç‚¹ï¼Œå„ç§çŸ¥è¯†ç‚¹åˆä¼šäº¤å‰å’Œä¾èµ–èµ·æ¥ï¼Œå­¦ä¹ å°±æ˜¯è¦ç³»ç»Ÿåœ°å­¦ä¹ æ•´ä¸ªçŸ¥è¯†æ ‘ï¼ˆå›¾ï¼‰ã€‚è€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<strong>å¯¹äºä¸€æ£µæ ‘æ¥è¯´ï¼Œâ€œæ ¹åŸºâ€æ˜¯éå¸¸é‡è¦çš„ï¼Œæ‰€ä»¥ï¼Œå­¦å¥½åŸºç¡€çŸ¥è¯†ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯¹äºä¸€ä¸ªé™Œç”Ÿçš„åœ°æ–¹ï¼Œæœ‰ä¸€ä»½åœ°å›¾æ˜¯éå¸¸é‡è¦çš„ï¼Œæ²¡æœ‰åœ°å›¾çš„ä½ åªä¼šä¹±çªœï¼Œåªä¼šè¿·è·¯ã€ç»ƒè·¯ã€èµ°å†¤æ‰è·¯ï¼</strong></p><p>2ï¼‰<strong>çŸ¥è¯†ç¼˜ç”±</strong>ã€‚ä»»ä½•çŸ¥è¯†éƒ½æ˜¯æœ‰ç¼˜ç”±çš„ï¼Œäº†è§£ä¸€ä¸ªçŸ¥è¯†çš„æ¥é¾™å»è„‰å’Œå‰ä¸–ä»Šç”Ÿï¼Œä¼šè®©ä½ å¯¹è¿™ä¸ªçŸ¥è¯†æœ‰éå¸¸å¼ºçš„æŒæ¡ï¼Œè€Œä¸å†åªæ˜¯é è®°å¿†å»å­¦ä¹ ã€‚é è®°å¿†å»å­¦ä¹ æ˜¯ä¸€ä»¶éå¸¸ç³Ÿç³•çš„äº‹ã€‚è€Œå¯¹äºä¸€äº›æ“ä½œæ€§çš„çŸ¥è¯†ï¼ˆä¸éœ€è¦äº†è§£ç”±æ¥çš„ï¼‰ï¼Œæˆ‘æŠŠå…¶å«æ“ä½œçŸ¥è¯†ï¼Œå°±åƒä¸€äº›å‡½æ•°åº“ä¸€æ ·ï¼Œè¿™æ ·çš„çŸ¥è¯†åªè¦å­¦ä¼šæŸ¥æ–‡æ¡£å°±å¥½äº†ã€‚<strong>èƒ½å¤ŸçŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶çš„äººè‡ªç„¶ä¼šæ¯”è¯†çŸ¥è¯†åˆ°è¡¨çš®çš„äººæ®µä½è¦é«˜å¾ˆå¤šã€‚</strong></p><p>3ï¼‰<strong>æ–¹æ³•å¥—è·¯</strong>ã€‚å­¦ä¹ ä¸æ˜¯ä¸ºäº†æ‰¾åˆ°ç­”æ¡ˆï¼Œè€Œæ˜¯æ‰¾åˆ°æ–¹æ³•ã€‚å°±åƒæ•°å­¦ä¸€æ ·ï¼Œä½ å­¦çš„æ˜¯æ–¹æ³•ï¼Œæ˜¯è§£é¢˜æ€è·¯ï¼Œæ˜¯å¥—è·¯ï¼Œä¼šç”¨æ–¹ç¨‹å¼è§£é¢˜çš„å’Œä¸ä¼šç”¨æ–¹ç¨‹å¼è§£é¢˜çš„åœ¨è§£é¢˜æ•ˆç‡ä¸Šä¸å¯æ¯”è¾ƒï¼Œè€Œåœ¨å¾®ç§¯åˆ†é¢å‰ï¼Œå…¶å®ƒçš„è§£é¢˜æ–¹æ³•éƒ½å˜æˆäº†æ¸£æ¸£ã€‚<strong>ä½ å¯ä»¥çœ‹åˆ°ï¼ŒæŒæ¡é«˜çº§æ–¹æ³•çš„äººæ¯”åˆ«äººçš„ä¼˜åŠ¿æœ‰å¤šå¤§ï¼Œå­¦ä¹ çš„ç›®çš„å°±æ˜¯ä¸ºäº†æŒæ¡æ›´ä¸ºé«˜çº§çš„æ–¹æ³•å’Œè§£é¢˜æ€è·¯</strong>ã€‚</p><h5 id="æŠ€èƒ½"><a href="#æŠ€èƒ½" class="headerlink" title="æŠ€èƒ½"></a>æŠ€èƒ½</h5><p>è¦åœ¨æŠ€èƒ½ä¸Šè¶…è¿‡åˆ«äººï¼Œä½ å°±éœ€è¦åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢åšè¶³åŠŸå¤«ï¼š</p><p>1ï¼‰<strong>ç²¾ç›Šæ±‚ç²¾</strong>ã€‚å¦‚æœä½ æƒ³æ‹¥æœ‰ä¸“ä¸šçš„æŠ€èƒ½ï¼Œä½ è¦åšä¸ä»…ä»…æ˜¯æ‹¼å‘½åœ°é‡å¤ä¸€éåˆä¸€éçš„è®­ç»ƒï¼Œè€Œæ˜¯åœ¨æ¯ä¸€æ¬¡é‡å¤è®­ç»ƒæ—¶ä½ éƒ½è¦æ‰¾åˆ°æ›´å¥½çš„æ–¹æ³•ï¼Œæ€»ç»“ç»éªŒï¼Œè®©æ–°çš„ä¸€éèƒ½å¤Ÿæ›´å¥½ï¼Œæ›´æ¼‚äº®ï¼Œæ›´æœ‰æ•ˆç‡ï¼Œå¦åˆ™ï¼Œç”¨ç›¸åŒçš„æ–¹æ³•é‡å¤ï¼Œé‚£ä½ åªä¸è¿‡åœ¨æ¬ç –ç½¢äº†ã€‚</p><p>2ï¼‰<strong>è®©è‡ªå·±çŠ¯é”™</strong>ã€‚çŠ¯é”™æ˜¯æœ‰åˆ©äºæˆé•¿çš„ï¼Œè¿™æ˜¯å› ä¸ºå‡ºé”™ä¼šè®©äººåæ€ï¼Œåæ€æ›´å¥½çš„æ–¹æ³•ï¼Œåæ€æ›´å®Œç¾çš„æ–¹æ¡ˆï¼Œæ€»ç»“æ•™è®­ï¼Œå¯»æ±‚æ›´å¥½æ›´å®Œç¾çš„è¿‡ç¨‹ï¼Œæ˜¯æŠ€èƒ½å‡çº§çš„æœ€å¥½çš„æ–¹å¼ã€‚å°¤å…¶æ˜¯å½“ä½ åœ¨å‡ºé”™åï¼Œè¢«äººé„™è§†ï¼Œè¢«äººå˜²ç¬‘åï¼Œä½ ä¼šæœ‰æ›´å¤§çš„åŠ¨åŠ›æå‡è‡ªå·±ï¼Œè¿™æ ·çš„åŠ¨åŠ›æ‰æ˜¯è¿›æ­¥çš„æºåŠ¨åŠ›ã€‚å½“ç„¶ï¼Œåƒä¸‡ä¸è¦åŒä¸€ä¸ªé”™è¯¯é‡å¤åœ°çŠ¯ï¼</p><p>3ï¼‰<strong>æ‰¾é«˜æ‰‹åˆ‡ç£‹</strong>ã€‚ä¸‹è¿‡æ£‹ï¼Œæ‰“ä¸ªçƒçš„äººéƒ½çŸ¥é“ï¼Œä½ è¦æƒ³æå‡è‡ªå·±çš„æŠ€è‰ºï¼Œä½ å¿…éœ€æ‰¾é«˜æ‰‹åˆ‡ç£‹ï¼Œåœ¨å’Œé«˜æ‰‹åˆ‡ç£‹çš„è¿‡ç¨‹ä¸­ä½ ä¼šæ„Ÿå—åˆ°é«˜æ‰‹çš„æŠ€èƒ½å’Œæ–¹æ³•ï¼Œæœ‰æ—¶å€™ä½ ä¼šæƒ…ä¸è‡ªç¦åœ°å“‡åœ°ä¸€ä¸‹ï¼Œæˆ‘é ï¼Œè¿˜å¯ä»¥è¿™ä¹ˆç©ï¼</p><h5 id="é¢†å¯¼åŠ›"><a href="#é¢†å¯¼åŠ›" class="headerlink" title="é¢†å¯¼åŠ›"></a>é¢†å¯¼åŠ›</h5><p>æœ€åä¸€ä¸ªæ˜¯é¢†å¯¼åŠ›ï¼Œè¦æœ‰é¢†å¯¼åŠ›æˆ–æ˜¯å½±å“åŠ›è¿™ä¸ªäº‹å¹¶ä¸å®¹æ˜“ï¼Œè¿™è·Ÿä½ çš„é‡å¿ƒæœ‰å¤šå¤§ï¼Œå¥½èƒœå¿ƒæœ‰å¤šå¼º ï¼Œä½ æ„¿æ„ä»˜å‡ºå¤šå°‘å¾ˆæœ‰å…³ç³»ï¼Œå› ä¸ºä¸€ä¸ªäººçš„é¢†å¯¼åŠ›è·Ÿä»–çš„æ ‡å‡†å¾ˆæœ‰å…³ç³»ï¼Œå› ä¸ºæœ‰é¢†å¯¼åŠ›çš„äººçš„æ ‡å‡†æ¯”ç»å¤§å¤šæ•°äººéƒ½è¦é«˜ã€‚</p><p>1ï¼‰<strong>è¯†åˆ«è‡ªå·±çš„ç‰¹é•¿å’Œå¤©èµ‹</strong>ã€‚é¦–å…ˆï¼Œæ¯ä¸ªäººDNAéƒ½å¯èƒ½æˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰ä¸€äº›æ¯”å¤§å¤šæ•°äººNBçš„ä¸œè¥¿ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼‰ï¼Œå¦‚æœä½ æœ‰äº†ï¼Œé‚£ä¹ˆåœ¨ä½ è¿‡å»çš„äººç”Ÿä¸­å°±ä¸€å®šä¼šè¡¨ç°å‡ºæ¥äº†ï¼Œå°±æ˜¯é‚£ç§å¤§å®¶é‡åˆ°è¿™ä¸ªäº‹ä¼šæ¥è¯·æ•™ä½ çš„å¯»æ±‚ä½ å¸®åŠ©çš„ç°è±¡ã€‚é‚£ç§ï¼Œåˆ«äººè¦éå¸¸åŠªåŠ›ï¼Œè€Œä¸”æ¯«ä¸è´¹åŠ²çš„äº‹ã€‚ä¸€æ—¦ä½ æœ‰äº†è¿™æ ·çš„ç‰¹é•¿æˆ–å¤©èµ‹ï¼Œé‚£ä½ å°±è¦å¤§åŠ›åœ°æ‰©å¤§ä½ çš„é¢†å…ˆä¼˜åŠ¿ï¼Œåƒä¸‡ä¸è¦è¿›åˆ°é‚£äº›ä¼šé™åˆ¶ä½ ä¼˜åŠ¿çš„åœ°æ–¹ã€‚ä½ æ˜¯ä¸€æ¡é±¼ï¼Œä½ å°±ä¸€å®šè¦æŠŠåˆ«äººæ‹‰åˆ°æ°´é‡Œæ¥ç©ï¼Œç»å¯¹ä¸è¦å»é™†åœ°ä¸Šè·Ÿåˆ«äººæ‹¼ï¼Œä¸æ–­åœ°åœ¨è‡ªå·±çš„ç‰¹é•¿å’Œå¤©èµ‹ä¸Šæ‰©å¤§è‡ªå·±çš„é¢†å…ˆä¼˜åŠ¿ï¼Œå½»åº•ä¸€éª‘ç»å°˜ã€‚</p><p>2ï¼‰<strong>è¯†åˆ«è‡ªå·±çš„å…´è¶£å’Œäº‹ä¸š</strong>ã€‚æ²¡æœ‰å¤©èµ‹ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œè¿˜æœ‰å…´è¶£ç‚¹ï¼Œéƒ½è¯´å…´è¶£æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œå½“å¹´ï¼ŒLinuså°±æ˜¯åœ¨å­¦æ ¡é‡Œå¯¹minxç€è¿·äº†ï¼Œäºæ˜¯æ•´å‡ºä¸ªLinuxæ¥ï¼Œè¿™å°±æ˜¯å…´è¶£é©±åŠ¨å‡ºçš„ä¸œè¥¿ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…´è¶£é©±åŠ¨çš„äº‹æ€»æ˜¯ä¼šæ¯”é‚£äº›è¢«åŠ¨é©±åŠ¨çš„æ›´å¥½ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæˆ‘æƒ³è¯´æ˜ä¸€ä¸‹ä»€ä¹ˆå«â€œçœŸâˆ™å…´è¶£â€ï¼ŒçœŸæ­£çš„å…´è¶£ä¸æ˜¯é‚£ç§ä¸‰å¤©çƒ­åº¦çš„ä¸œè¥¿ï¼Œè€Œæ˜¯é‚£ç§ï¼Œä½ æ„¿æ„ä¸ºä¹‹ä»˜å‡ºä¸€è¾ˆå­çš„äº‹ï¼Œæ˜¯é‚£ç§æ— è®ºæœ‰å¤šå¤§å›°éš¾æœ‰å¤šéš¾å—ä½ éƒ½è¦æ­»ç£•çš„äº‹ï¼Œè¿™æ‰æ˜¯â€œçœŸâˆ™å…´è¶£â€ï¼Œè¿™ä¹Ÿå°±æ˜¯ä½ çš„â€œé‡å¿ƒâ€å’Œâ€œå¥½èƒœå¿ƒâ€æ‰€åœ¨ï¼Œå…¶å®ä¸Šå‡åˆ°äº†ä½ çš„äº‹ä¸šã€‚ç›¸ä¿¡æˆ‘ï¼Œç»å¤§å¤šæ•°äººåªæœ‰èŒä¸šè€Œæ²¡æœ‰äº‹ä¸šçš„ã€‚</p><p>3ï¼‰<strong>å»ºç«‹é«˜çº§çš„ä¹ æƒ¯å’Œæ–¹æ³•</strong>ã€‚æ²¡æœ‰å¤©èµ‹æ²¡æœ‰é‡å¿ƒï¼Œä¹Ÿè¿˜æ˜¯å¯ä»¥è·Ÿåˆ«äººæ‹¼ä¹ æƒ¯æ‹¼æ–¹æ³•çš„ï¼Œåªè¦ä½ æœ‰ä¸€äº›æ¯”è¾ƒå¥½çš„ä¹ æƒ¯å’Œæ–¹æ³•ï¼Œé‚£ä¹ˆä½ ä¸€æ ·å¯ä»¥è¶…è¿‡å¤§å¤šæ•°äººã€‚å¯¹æ­¤ï¼Œåœ¨ä¹ æƒ¯ä¸Šä½ è¦åšåˆ°æ¯”è¾ƒå¤§å¤šæ•°äººæ›´è‡ªå¾‹ï¼Œæ›´æœ‰è®¡åˆ’æ€§ï¼Œæ›´æœ‰ç›®æ ‡æ€§ï¼Œæ¯”å¦‚ï¼Œæ¯å¹´å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€æˆ–æŠ€æœ¯ï¼Œå¹¶å¯ä»¥å‚ä¸ç›¸å…³çš„é¡¶çº§å¼€æºé¡¹ç›®ï¼Œæ¯ä¸ªæœˆè®­ç»ƒä¸€ä¸ªç±»ç®—æ³•ï¼ŒæŒæ¡ä¸€ç§ç®—æ³•ï¼Œæ¯å‘¨é˜…è¯»ä¸€ç¯‡è‹±æ–‡è®ºæ–‡ï¼Œå¹¶æŠŠé˜…è¯»ç¬”è®°æ•´ç†å‡ºæ¥â€¦â€¦è‡ªå¾‹çš„æ˜¯éå¸¸å¯æ€•çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜éœ€è¦åœ¨æ–¹æ³•ä¸Šè¶…è¿‡åˆ«äººï¼Œä½ éœ€è¦æ»¡ä¸–ç•Œçš„æ‰¾å„ç§é«˜çº§çš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼Œæ€è€ƒçš„æ–¹æ³•ï¼Œå­¦ä¹ çš„æ–¹æ³•ã€æ—¶é—´ç®¡ç†çš„æ–¹æ³•ã€æ²Ÿé€šçš„æ–¹æ³•è¿™ç±»è½¯å®åŠ›çš„ï¼Œè¿˜æœ‰ï¼Œè§£å†³é—®é¢˜çš„æ–¹æ³•ï¼ˆtrouble shooting å’Œ problem solvingï¼‰ï¼Œè®¾è®¡çš„æ–¹æ³•ï¼Œå·¥ç¨‹çš„æ–¹æ³•ï¼Œä»£ç çš„æ–¹æ³•ç­‰ç­‰ç¡¬å®åŠ›çš„ï¼Œä¸€å¼€å§‹ç…§çŒ«ç”»è™ï¼Œæ—¶é—´é•¿äº†å°±å¯èƒ½ä¼šè‡ªå·±å‘æ˜æˆ–æ¨å¯¼æ–°çš„æ–¹æ³•ã€‚</p><p>4ï¼‰<strong>å‹¤å¥‹åŠªåŠ›æ‰§ç€åšæŒ</strong>ã€‚å¦‚æœä¸Šé¢ä¸‰ä»¶äº‹ä½ éƒ½æ²¡æœ‰ä¹Ÿæ²¡æœ‰èƒ½åŠ›ï¼Œé‚£è¿˜æœ‰æœ€åä¸€ä»¶äº‹äº†ï¼Œé‚£å°±æ˜¯å‹¤å¥‹åŠªåŠ›äº†ï¼Œå°±æ˜¯æ‰€è°“çš„â€œä¸€ä¸‡å°æ—¶å®šå¾‹â€äº†ï¼ˆå‚çœ‹ã€Š<a href="https://coolshell.cn/articles/2250.html">21å¤©æ•™ä½ å­¦ä¼šC++</a>ã€‹ä¸­çš„åå¹´å­¦ç¼–ç¨‹ä¸€èŠ‚ï¼‰ï¼Œæˆ‘è§è¿‡å¾ˆå¤šä¸èªæ˜çš„äººï¼Œæ‚Ÿæ€§ä¹Ÿä¸å¤Ÿï¼ˆæ¯”å¦‚æˆ‘å°±æ˜¯ä¸€ä¸ªï¼‰ï¼Œåˆ«äººå­¦ä¸€ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæœˆå°±å¥½äº†ï¼Œè€Œæˆ‘éœ€è¦1å¹´ç”šè‡³æ›´é•¿ï¼Œä½†æ˜¯å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯æ­»çš„ï¼Œåªè¦è‚¯èŠ±æ—¶é—´å°±æœ‰ä¸€å¤©ä½ ä¼šææ‡‚çš„ï¼Œè€ä¸ä½æˆ‘åšæŒåå¹´äºŒåå¹´ï¼Œèªæ˜çš„äººå‘æ˜ä¸ªé£æœºé£è¿‡å»äº†ï¼Œç¬¨ä¸€ç‚¹çš„äººæ„šå…¬ç§»å±±ä¹Ÿè¿‡å¾—å»ï¼Œå› ä¸ºæ›´å¤šçš„äººæ˜¯æ‡’äººï¼Œæˆ‘ä¸ç”¨æ‹¼è¿‡èªæ˜äººï¼Œæˆ‘åªç”¨æ‹¼è¿‡é‚£äº›æ‡’äººå°±å¥½äº†ã€‚</p><p>å¥½äº†ï¼Œå°±è¿™ä¹ˆå¤šï¼Œå¦‚æœå“ªå¤©ä½ å˜å¾—æ¶ˆæå’Œä¸è‡ªä¿¡ï¼Œä½ è¦æ¥è¯»è¯»æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œå­æ›°ï¼šæ¸©æ•…è€ŒçŸ¥æ–°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="ä»£ç äººç”Ÿ" scheme="https://nerkeler.github.io/categories/%E4%BB%A3%E7%A0%81%E4%BA%BA%E7%94%9F/"/>
    
    
    <category term="è½¬è½½" scheme="https://nerkeler.github.io/tags/%E8%BD%AC%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œå¸¸ç”¨æ–¹æ³•</title>
    <link href="https://nerkeler.github.io/2023/05/19/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>https://nerkeler.github.io/2023/05/19/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/</id>
    <published>2023-05-19T03:14:00.000Z</published>
    <updated>2023-05-19T03:15:32.194Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œå¸¸ç”¨æ–¹æ³•"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œå¸¸ç”¨æ–¹æ³•" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œå¸¸ç”¨æ–¹æ³•"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå’Œå¸¸ç”¨æ–¹æ³•</h1><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><p>æ ¹æ®<code>jdk</code>å®˜æ–¹æ–‡æ¡£ï¼Œçº¿ç¨‹çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ç§</p><ul><li><a href="https://www.matools.com/file/manual/jdk_api_1.8_google/java/lang/Thread.State.html#NEW"><code>NEW</code></a><br>å°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚</li><li><a href="https://www.matools.com/file/manual/jdk_api_1.8_google/java/lang/Thread.State.html#RUNNABLE"><code>RUNNABLE</code></a><br>åœ¨Javaè™šæ‹Ÿæœºä¸­æ‰§è¡Œçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚</li><li><a href="https://www.matools.com/file/manual/jdk_api_1.8_google/java/lang/Thread.State.html#BLOCKED"><code>BLOCKED</code></a><br>è¢«é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”å®šçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚</li><li><a href="https://www.matools.com/file/manual/jdk_api_1.8_google/java/lang/Thread.State.html#WAITING"><code>WAITING</code></a><br>æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚</li><li><a href="https://www.matools.com/file/manual/jdk_api_1.8_google/java/lang/Thread.State.html#TIMED_WAITING"><code>TIMED_WAITING</code></a><br>æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŠ¨ä½œè¾¾åˆ°æŒ‡å®šç­‰å¾…æ—¶é—´çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚</li><li><a href="https://www.matools.com/file/manual/jdk_api_1.8_google/java/lang/Thread.State.html#TERMINATED"><code>TERMINATED</code></a><br>å·²é€€å‡ºçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚</li></ul><p>ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åœ¨ç»™å®šæ—¶é—´ç‚¹å¤„äºä¸€ä¸ªçŠ¶æ€ã€‚ è¿™äº›çŠ¶æ€æ˜¯ä¸åæ˜ ä»»ä½•æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€çš„è™šæ‹ŸæœºçŠ¶æ€ã€‚</p><h3 id="å¦‚å›¾ç¤ºæ‰€è§"><a href="#å¦‚å›¾ç¤ºæ‰€è§" class="headerlink" title="å¦‚å›¾ç¤ºæ‰€è§"></a>å¦‚å›¾ç¤ºæ‰€è§</h3><p><img src="https://pic2.imgdb.cn/item/6466c5a70d2dde57773e2592.png"></p><h3 id="ä»£ç æ¼”ç¤º"><a href="#ä»£ç æ¼”ç¤º" class="headerlink" title="ä»£ç æ¼”ç¤º"></a>ä»£ç æ¼”ç¤º</h3><h4 id="NEW-x2F-TIMED-WAITING-x2F-TERMINATED"><a href="#NEW-x2F-TIMED-WAITING-x2F-TERMINATED" class="headerlink" title="NEW &#x2F; TIMED_WAITING &#x2F; TERMINATED"></a>NEW &#x2F; TIMED_WAITING &#x2F; TERMINATED</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ThreadMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadState</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹çŠ¶æ€ï¼š&quot;</span>+ thread.getState());</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹çŠ¶æ€ï¼š&quot;</span> + thread.getState());</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;çº¿ç¨‹çŠ¶æ€ï¼š&quot;</span> + thread.getState());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹çŠ¶æ€ï¼šNEW</span><br><span class="line">çº¿ç¨‹çŠ¶æ€ï¼šTIMED_WAITING</span><br><span class="line">çº¿ç¨‹çŠ¶æ€ï¼šTERMINATED</span><br><span class="line">çº¿ç¨‹çŠ¶æ€ï¼šTERMINATED</span><br></pre></td></tr></table></figure><h4 id="WAITING-x2F-BLOCKED"><a href="#WAITING-x2F-BLOCKED" class="headerlink" title="WAITING &#x2F; BLOCKED"></a>WAITING &#x2F; BLOCKED</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ThreadMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockThreadState</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">BlockThreadState</span> <span class="variable">blockThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlockThreadState</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(blockThread);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread state : &quot;</span> + thread.getState());</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread state : &quot;</span> + thread.getState());</span><br><span class="line">        <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">            lock.notify();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;thread state : &quot;</span> + thread.getState());</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread state : &quot;</span> + thread.getState());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line"><span class="comment">// waitçŠ¶æ€</span></span><br><span class="line">                lock.wait();</span><br><span class="line">                <span class="comment">// synchronizedé‡æ–°æ‹¿åˆ°é” å¤„äºblockçŠ¶æ€</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000000000</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="ç»“æœ-1"><a href="#ç»“æœ-1" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">thread state : NEW</span><br><span class="line">thread state : WAITING</span><br><span class="line">thread state : BLOCKED</span><br><span class="line">thread state : TERMINATED</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§æ–¹æ³•"><a href="#å¸¸è§æ–¹æ³•" class="headerlink" title="å¸¸è§æ–¹æ³•"></a>å¸¸è§æ–¹æ³•</h2><h3 id="wait"><a href="#wait" class="headerlink" title="wait()"></a>wait()</h3><p>wait()æ–¹æ³•æ‰§è¡Œåï¼Œä¼šé˜»å¡çº¿ç¨‹ï¼ŒåŒæ—¶é‡Šæ”¾é”ï¼Œå¦‚æœæƒ³è¦å”¤é†’è¯¥çº¿ç¨‹ï¼Œåˆ™éœ€è¦ä»¥ä¸‹æ¡ä»¶</p><ul><li>å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„notify()æ–¹æ³•ï¼Œä¸”åˆšå¥½è¢«å”¤é†’çš„æ—¶æœ¬çº¿ç¨‹</li><li>å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº†è¿™ä¸ªå¯¹è±¡çš„<code>notifyAll</code>()æ–¹æ³•</li><li>è¿‡äº†wait(long timeout) è§„å®šçš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœä¼ å…¥0å°±æ˜¯æ°¸ä¹…ç­‰å¾…</li><li>çº¿ç¨‹è‡ªèº«è°ƒç”¨äº†interrupt() </li><li></li></ul><p><em><strong>PSï¼š ä½¿ç”¨wait()æ–¹æ³•æ—¶ï¼Œå¿…é¡»å…ˆæ‹¥æœ‰monitoré”, ä¹Ÿå°±æ˜¯è¯´waitæ–¹æ³•éœ€è¦æ”¾åœ¨åŒæ­¥ä»£ç å—ä¸­æ‰§è¡Œ</strong></em></p><h3 id="notify-x2F-notifyAll"><a href="#notify-x2F-notifyAll" class="headerlink" title="notify&#x2F;notifyAll"></a>notify&#x2F;<code>notifyAll</code></h3><p>notify&#x2F;<code>notifyAll</code>ç”¨äºå”¤é†’çº¿ç¨‹ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨wait()è¿›å…¥  <code>waitting</code>çŠ¶æ€æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨<code>notifyAll</code>()å¯å”¤é†’å½“å‰çº¿ç¨‹ï¼ˆå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨notifyå¹¶ä¸ä¸€å®šèƒ½å¤Ÿå”¤é†’çº¿ç¨‹ï¼‰</p><p>ç»„åˆä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockThread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªç­‰å¾…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">waitThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">WaitThread</span>(message));</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå”¤é†’çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">notifyThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">NotifyThread</span>(message));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨ç­‰å¾…çº¿ç¨‹å’Œå”¤é†’çº¿ç¨‹</span></span><br><span class="line">        waitThread.start();</span><br><span class="line">        notifyThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…±äº«çš„æ¶ˆæ¯ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isReady</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">waitForMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!isReady) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å½“æ¶ˆæ¯ä¸å¯ç”¨æ—¶ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">                System.out.println(<span class="string">&quot;çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€&quot;</span>);</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œåˆ°è¿™é‡Œè¡¨ç¤ºæ”¶åˆ°æ¶ˆæ¯ï¼Œè¿›è¡Œå¤„ç†</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å”¤é†’æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚è·å–æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">        isReady = <span class="literal">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;å”¤é†’ç­‰å¾…çš„çº¿ç¨‹&quot;</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WaitThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Message message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WaitThread</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç­‰å¾…æ¶ˆæ¯</span></span><br><span class="line">        message.waitForMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å”¤é†’çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotifyThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Message message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NotifyThread</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        message.sendMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line"><span class="comment">å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line"><span class="comment">æ”¶åˆ°æ¶ˆæ¯ï¼</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Process finished with exit code 0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="å›¾ç¤º-monitoré”"><a href="#å›¾ç¤º-monitoré”" class="headerlink" title="å›¾ç¤º monitoré”"></a>å›¾ç¤º monitoré”</h3><p><img src="https://pic2.imgdb.cn/item/6462384a0d2dde577761578b.png"></p><ul><li>Entry Set å…¥å£é›†  <ul><li>çº¿ç¨‹è¿›å…¥åæŠ¢é”</li></ul></li><li>The owner é”æŒæœ‰çº¿ç¨‹<ul><li>å¦‚æœæ–¹æ³•æ²¡æœ‰æ‰§è¡Œå®Œä¹‹å‰æ²¡æœ‰é‡Šæ”¾é”ï¼Œåˆ™ç¨‹åºæ­£å¸¸é€€å‡ºå¹¶é‡Šæ”¾é”</li><li>å¦‚æœæ–¹æ³•æ²¡æœ‰æ‰§è¡Œå®Œä¹‹å‰é‡Šæ”¾äº†é”å¦‚è°ƒç”¨äº†wait()æ–¹æ³•ï¼Œåˆ™ç¨‹åºå†æ¬¡è¿›å…¥ç­‰å¾…é›†è¿›è¡ŒæŠ¢é”</li></ul></li><li>Wait Set ç­‰å¾…é›† <ul><li>å¦‚æœä¸Šæ–¹å…¥å£é›†ï¼Œä¸åŒç‚¹æ˜¯ç­‰å¾…é›†åœ¨æ‰§è¡Œæ–¹æ³•é”æ—¶ä¸­é€”é‡Šæ”¾äº†é”</li></ul></li></ul><h3 id="waitã€notify-å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼"><a href="#waitã€notify-å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼" class="headerlink" title="waitã€notify å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼"></a>waitã€notify å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductAndConsumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Object&gt; container = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ProductAndConsumer</span> <span class="variable">productAndConsumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductAndConsumer</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Product</span>(productAndConsumer));</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(productAndConsumer));</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addObject</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (container.size() &gt;=<span class="number">100</span>)&#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        container.add(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨ç”Ÿäº§ç¬¬&quot;</span>+ container.size() + <span class="string">&quot;ä¸ª&quot;</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">conObject</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (container.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        container.remove(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨æ¶ˆè´¹ç¬¬&quot;</span>+ container.size() + <span class="string">&quot;ä¸ª&quot;</span>);</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProductAndConsumer productAndConsumer;</span><br><span class="line"></span><br><span class="line">    Product(ProductAndConsumer productAndConsumer)&#123;</span><br><span class="line">        <span class="built_in">this</span>.productAndConsumer = productAndConsumer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               productAndConsumer.addObject();</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProductAndConsumer productAndConsumer;</span><br><span class="line"></span><br><span class="line">    Consumer(ProductAndConsumer productAndConsumer)&#123;</span><br><span class="line">        <span class="built_in">this</span>.productAndConsumer = productAndConsumer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               productAndConsumer.conObject();</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h4><ul><li><strong>ä½¿ç”¨ç±»<code>ProductAndConsumer</code>ä½œä¸ºé”å¯¹è±¡ï¼Œcontainerä½œä¸ºå®¹å™¨</strong></li><li><strong>wait notifyæ¥è¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„é€šè®¯ï¼Œåœ¨æ•°é‡æ»¡è¶³æ¡ä»¶æ—¶ä½¿ç”¨waité‡Šæ”¾å½“å‰é”å¯¹è±¡ï¼Œå¦ä¸€ä¸ªå¯¹è±¡æ‹¿åˆ°é”ä¹‹åè¿›è¡Œç”Ÿäº§æˆ–æ¶ˆè´¹</strong></li></ul><h4 id="å›¾ç¤º"><a href="#å›¾ç¤º" class="headerlink" title="å›¾ç¤º"></a>å›¾ç¤º</h4><p><img src="https://pic2.imgdb.cn/item/6466d6fd0d2dde577751102f.png"></p><h3 id="sleep"><a href="#sleep" class="headerlink" title="sleep()"></a>sleep()</h3><p><code>Thread.sleep()</code>æ˜¯Javaä¸­ä¸€ä¸ªé™æ€nativeæ–¹æ³•ï¼Œç”¨äºä½¿å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼ˆæš‚åœæ‰§è¡Œï¼‰ä¸€æ®µæŒ‡å®šçš„æ—¶é—´ã€‚</p><p>å®ƒçš„æ–¹æ³•ç­¾åä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">long</span> millis)</span> <span class="keyword">throws</span> InterruptedException;</span><br></pre></td></tr></table></figure><p>å‚æ•°<code>millis</code>è¡¨ç¤ºçº¿ç¨‹ä¼‘çœ çš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ä¼ å…¥çš„å€¼æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºçº¿ç¨‹è¦ä¼‘çœ çš„æ¯«ç§’æ•°ã€‚æ³¨æ„ï¼Œè¯¥æ–¹æ³•ä¼šæŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸ï¼Œå› ä¸ºçº¿ç¨‹åœ¨ä¼‘çœ æœŸé—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚</p><h4 id="ç‰¹ç‚¹å’Œç”¨æ³•"><a href="#ç‰¹ç‚¹å’Œç”¨æ³•" class="headerlink" title="ç‰¹ç‚¹å’Œç”¨æ³•"></a>ç‰¹ç‚¹å’Œç”¨æ³•</h4><ul><li><strong>çº¿ç¨‹é˜»å¡</strong>ï¼šè°ƒç”¨<code>Thread.sleep()</code>æ–¹æ³•ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ã€‚åœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œçº¿ç¨‹ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œã€‚</li><li><strong>æ—¶é—´ç²¾åº¦</strong>ï¼šä¼ å…¥çš„ä¼‘çœ æ—¶é—´æ˜¯ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œä½†å®é™…çš„ä¼‘çœ æ—¶é—´å¯èƒ½ä¼šç¨é•¿æˆ–ç¨çŸ­ã€‚å…·ä½“çš„ç²¾åº¦å–å†³äºåº•å±‚æ“ä½œç³»ç»Ÿå’ŒJVMçš„å®ç°ã€‚</li><li><strong>ä¸­æ–­å“åº”</strong>ï¼šå¦‚æœåœ¨çº¿ç¨‹ä¼‘çœ æœŸé—´ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ–­äº†æ­£åœ¨ä¼‘çœ çš„çº¿ç¨‹ï¼Œ<code>Thread.sleep()</code>æ–¹æ³•ä¼šæŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸ã€‚å¯ä»¥åœ¨<code>catch</code>å—ä¸­å¤„ç†è¯¥å¼‚å¸¸ï¼Œæˆ–è€…å°†å¼‚å¸¸ç»§ç»­å‘ä¸ŠæŠ›å‡ºã€‚</li><li><strong>ä¸ä¼šé‡Šæ”¾é”</strong>ï¼š<code>Thread.sleep()</code>æ–¹æ³•ä¼šæš‚åœå½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œä½†ä¸ä¼šé‡Šæ”¾ä»»ä½•é”ã€‚å¦‚æœçº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•æ—¶è°ƒç”¨äº†<code>Thread.sleep()</code>ï¼Œå…¶ä»–çº¿ç¨‹ä»æ— æ³•è·å¾—è¯¥é”ã€‚</li><li><strong>é™æ€æ–¹æ³•</strong>ï¼š<code>Thread.sleep()</code>æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>Thread</code>ç±»è°ƒç”¨ï¼Œæ— éœ€åˆ›å»ºçº¿ç¨‹å¯¹è±¡ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šå¸¸è§çš„ç”¨é€”åŒ…æ‹¬æ¨¡æ‹Ÿå»¶è¿Ÿã€å®šæ—¶ä»»åŠ¡ã€æ§åˆ¶çº¿ç¨‹æ‰§è¡Œé¡ºåºç­‰ã€‚</li></ul><h4 id="Thread-sleepå’ŒTimeUnitæ¯”è¾ƒ"><a href="#Thread-sleepå’ŒTimeUnitæ¯”è¾ƒ" class="headerlink" title="Thread.sleepå’ŒTimeUnitæ¯”è¾ƒ"></a><code>Thread.sleep</code>å’Œ<code>TimeUnit</code>æ¯”è¾ƒ</h4><ul><li><strong>ç²¾åº¦å’Œå¯è¯»æ€§ï¼š</strong> <code>Thread.sleep()</code>çš„å‚æ•°æ˜¯ä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´å€¼ï¼Œè¡¨ç¤ºçº¿ç¨‹è¦ä¼‘çœ çš„æ—¶é—´ã€‚è€Œ<code>TimeUnit</code>æä¾›äº†æ›´é«˜å±‚æ¬¡çš„æ—¶é—´å•ä½ï¼Œå¦‚<code>TimeUnit.SECONDS</code>è¡¨ç¤ºç§’ï¼Œ<code>TimeUnit.MILLISECONDS</code>è¡¨ç¤ºæ¯«ç§’ç­‰ã€‚ä½¿ç”¨<code>TimeUnit</code>å¯ä»¥ä½¿ä»£ç æ›´å…·å¯è¯»æ€§ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨è®¡ç®—æ¯«ç§’æ•°ã€‚</li><li><strong>å¼‚å¸¸å¤„ç†ï¼š</strong> <code>Thread.sleep()</code>æ–¹æ³•ä¼šæŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸ï¼Œå› ä¸ºçº¿ç¨‹åœ¨ä¼‘çœ æœŸé—´å¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚è€Œ<code>TimeUnit</code>æ–¹å¼ä¸ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¤„ç†ä¸­æ–­æƒ…å†µã€‚</li><li><strong>é™æ€ä¸éé™æ€ï¼š</strong> <code>Thread.sleep()</code>æ˜¯<code>Thread</code>ç±»çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨ã€‚è€Œ<code>TimeUnit</code>æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œéœ€è¦é€šè¿‡å…·ä½“çš„æšä¸¾å¸¸é‡æ¥è°ƒç”¨å…¶æ–¹æ³•ï¼Œä¾‹å¦‚<code>TimeUnit.SECONDS.sleep(1)</code>ã€‚</li><li><strong>å¯è¯»æ€§å’Œæ˜“ç”¨æ€§ï¼š</strong> ä½¿ç”¨<code>TimeUnit</code>å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œå› ä¸ºå¯ä»¥ç›´è§‚åœ°è¡¨ç¤ºæ—¶é—´å•ä½ã€‚æ­¤å¤–ï¼Œ<code>TimeUnit</code>è¿˜æä¾›äº†å…¶ä»–æ–¹æ³•ï¼Œå¦‚<code>TimeUnit.toMillis()</code>ã€<code>TimeUnit.toSeconds()</code>ç­‰ï¼Œæ–¹ä¾¿è¿›è¡Œæ—¶é—´å•ä½ä¹‹é—´çš„è½¬æ¢ã€‚</li></ul><h5 id="TimeUnitæºç "><a href="#TimeUnitæºç " class="headerlink" title="TimeUnitæºç "></a><code>TimeUnit</code>æºç </h5><p><em>ä»¥ä¸‹æ˜¯æˆªå–éƒ¨åˆ†æºç </em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">TimeUnit</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs a &#123;<span class="doctag">@link</span> Thread#sleep(long, int) Thread.sleep&#125; using</span></span><br><span class="line"><span class="comment">     * this time unit.</span></span><br><span class="line"><span class="comment">     * This is a convenience method that converts time arguments into the</span></span><br><span class="line"><span class="comment">     * form required by the &#123;<span class="doctag">@code</span> Thread.sleep&#125; method.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout the minimum time to sleep. If less than</span></span><br><span class="line"><span class="comment">     * or equal to zero, do not sleep at all.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException if interrupted while sleeping</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (timeout &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ms</span> <span class="operator">=</span> toMillis(timeout);</span><br><span class="line">            <span class="type">int</span> <span class="variable">ns</span> <span class="operator">=</span> excessNanos(timeout, ms);</span><br><span class="line">            Thread.sleep(ms, ns);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>TimeUnit</code>åº•å±‚è¿˜æ˜¯è°ƒç”¨äº†<code>Thread.sleep()</code> æœ‰ä¸€ä¸ªæ¯”è¾ƒéšå«çš„åœ°æ–¹å°±æ˜¯å½“ä½¿ç”¨è¿‡<code>TimeUnit</code>çš„<code>sleep</code>æ–¹æ³•æ—¶ï¼Œå¦‚æœä¼ å…¥çš„æ—¶é—´å°äºæ˜¯ä¸ä¼šè¿›å…¥ifåˆ¤æ–­ï¼Œè€Œ<code>Thread.sleep()</code>æ–¹æ³•å¦‚æœä¼ å‚å°äº0åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸(æºç è§ä¸‹)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">long</span> millis, <span class="type">int</span> nanos)</span></span><br><span class="line"><span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nanos &lt; <span class="number">0</span> || nanos &gt; <span class="number">999999</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                            <span class="string">&quot;nanosecond timeout value out of range&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nanos &gt;= <span class="number">500000</span> || (nanos != <span class="number">0</span> &amp;&amp; millis == <span class="number">0</span>)) &#123;</span><br><span class="line">        millis++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sleep(millis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="join"><a href="#join" class="headerlink" title="join()"></a>join()</h3><p><code>Thread.join()</code>æ˜¯Javaä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºç­‰å¾…è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚å®ƒçš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç­‰å¾…æŒ‡å®šçº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œç„¶åå†ç»§ç»­æ‰§è¡Œå½“å‰çº¿ç¨‹çš„åç»­ä»£ç ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯é˜»å¡ä¸»çº¿ç¨‹ã€‚</p><h4 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ThreadMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinMethod</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">        &#125;,<span class="string">&quot;å­çº¿ç¨‹&quot;</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            thread1.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç»“æœ-2"><a href="#ç»“æœ-2" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span><br><span class="line">ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å­çº¿ç¨‹ç­‰å¾…äº†3ç§’ï¼Œä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯å­çº¿ç¨‹å…ˆæ‰§è¡Œå®Œæ¯•åœ¨æ‰§è¡Œä¸»çº¿ç¨‹æ‰“å°ï¼ŒåŸå› æ˜¯å› ä¸ºthread1.join å¯¹ä¸»çº¿ç¨‹è¿›è¡Œäº†é˜»å¡ï¼Œè¿™æ˜¯ä¸»çº¿ç¨‹éœ€è¦ç­‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œåé¢çš„è¯­å¥</p><h4 id="ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹"><a href="#ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹"></a>ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹</h4><ul><li><strong>ç­‰å¾…æ‰§è¡Œï¼š</strong> è°ƒç”¨<code>join()</code>æ–¹æ³•çš„çº¿ç¨‹å°†ä¼šç­‰å¾…æŒ‡å®šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœæŒ‡å®šçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™<code>join()</code>æ–¹æ³•ä¼šç«‹å³è¿”å›ã€‚</li><li><strong>é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼š</strong> åœ¨è°ƒç”¨<code>join()</code>æ–¹æ³•æœŸé—´ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œæš‚åœæ‰§è¡Œã€‚åªæœ‰å½“æŒ‡å®šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå½“å‰çº¿ç¨‹æ‰ä¼šè§£é™¤é˜»å¡ï¼Œç»§ç»­æ‰§è¡Œã€‚</li><li><strong>å¼‚å¸¸å¤„ç†ï¼š</strong> <code>join()</code>æ–¹æ³•ä¼šæŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸ï¼Œå› ä¸ºåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå½“å‰çº¿ç¨‹å¯èƒ½ä¼šè¢«ä¸­æ–­ã€‚å¯ä»¥åœ¨<code>catch</code>å—ä¸­å¤„ç†è¯¥å¼‚å¸¸ï¼Œæˆ–å°†å¼‚å¸¸ç»§ç»­å‘ä¸ŠæŠ›å‡ºã€‚</li><li><strong>é¡ºåºæ‰§è¡Œï¼š</strong> é€šè¿‡ä½¿ç”¨<code>join()</code>æ–¹æ³•ï¼Œå¯ä»¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚è°ƒç”¨<code>join()</code>æ–¹æ³•åï¼Œå½“å‰çº¿ç¨‹ä¼šç­‰å¾…æŒ‡å®šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åå†ç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚</li><li><strong>è°ƒç”¨å¯¹è±¡ï¼š</strong> <code>join()</code>æ–¹æ³•æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œéœ€è¦é€šè¿‡çº¿ç¨‹å¯¹è±¡è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ<code>thread1</code>æ˜¯ä¸€ä¸ª<code>Thread</code>å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>thread1.join()</code>æ¥ç­‰å¾…<code>thread1</code>æ‰§è¡Œå®Œæ¯•ã€‚</li></ul><h4 id="æºç å’Œåº•å±‚å®ç°"><a href="#æºç å’Œåº•å±‚å®ç°" class="headerlink" title="æºç å’Œåº•å±‚å®ç°"></a>æºç å’Œåº•å±‚å®ç°</h4><p>ä»¥ä¸‹æˆªå–éƒ¨åˆ†<code>Thread.join</code>æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">join</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    join(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨çš„join(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">join</span><span class="params">(<span class="type">long</span> millis)</span></span><br><span class="line">    <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">base</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (millis == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                wait(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">delay</span> <span class="operator">=</span> millis - now;</span><br><span class="line">                <span class="keyword">if</span> (delay &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                wait(delay);</span><br><span class="line">                now = System.currentTimeMillis() - base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®é™…è°ƒç”¨çš„æœ¬åœ°nativeæ–¹æ³•  wait</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°joinçš„åº•å±‚è¿˜æ˜¯ä½¿ç”¨waitæ–¹æ³•å®ç°çš„ï¼Œå­çº¿ç¨‹è°ƒç”¨waitæ–¹æ³•è®©ä¸»çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåœ¨è¿è¡Œç»“æŸåè‡ªåŠ¨è°ƒç”¨notifyæ–¹æ³•å”¤é†’ä¸»çº¿ç¨‹ã€‚ï¼ˆå…·ä½“å”¤é†’çš„æ–¹æ³•åœ¨jvmä¸­ï¼‰</p><p><em><strong>æœ‰ä¸€ç‚¹ç–‘é—®æˆ‘æ²¡æœ‰æ‰¾åˆ°è§£é‡Šï¼šä¸ºä»€ä¹ˆè°ƒç”¨å­çº¿ç¨‹çš„wait(0)æ–¹æ³•ï¼Œé˜»å¡çš„ç¡®æ˜¯ä¸»çº¿ç¨‹å‘¢ï¼Ÿ</strong></em></p><h4 id="CountDownLatchå’ŒCyclicBarrier"><a href="#CountDownLatchå’ŒCyclicBarrier" class="headerlink" title="CountDownLatchå’ŒCyclicBarrier"></a><code>CountDownLatch</code>å’Œ<code>CyclicBarrier</code></h4><p>ä½¿ç”¨<code>countDownLatch</code>å’Œ<code>CyclicBarrier</code>ä¹Ÿå¯ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é˜»å¡ï¼Œå…·ä½“æš‚ä¸è®¨è®º</p><h3 id="yeild-è®©æ­¥"><a href="#yeild-è®©æ­¥" class="headerlink" title="yeild() (è®©æ­¥)"></a>yeild() (è®©æ­¥)</h3><p><code>yield()</code> æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒå±äº <code>Thread</code> ç±»ï¼Œç”¨äºæç¤ºè°ƒåº¦å™¨å°†å½“å‰çº¿ç¨‹è®©å‡º CPU çš„æ‰§è¡Œæƒï¼Œä½¿å¾—å…¶ä»–å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œã€‚</p><p><code>yield()</code> æ–¹æ³•çš„è°ƒç”¨å¹¶ä¸èƒ½ä¿è¯ä¸€å®šä¼šä½¿å…¶ä»–çº¿ç¨‹è·å¾—æ‰§è¡Œæœºä¼šï¼Œå®ƒä»…æ˜¯ä¸€ä¸ªæç¤ºã€‚å…·ä½“çš„è°ƒåº¦è¡Œä¸ºå–å†³äºæ“ä½œç³»ç»Ÿå’Œ JVM çš„å®ç°ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸åº”è¿‡åº¦ä¾èµ– <code>yield()</code> æ–¹æ³•æ¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºï¼Œè€Œåº”ä½¿ç”¨æ›´å¯é çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶æ¥å®ç°éœ€è¦çš„çº¿ç¨‹åä½œå’ŒåŒæ­¥ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="java" scheme="https://nerkeler.github.io/tags/java/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://nerkeler.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹</title>
    <link href="https://nerkeler.github.io/2023/05/11/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%81%9C%E6%AD%A2%E7%BA%BF%E7%A8%8B/"/>
    <id>https://nerkeler.github.io/2023/05/11/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E5%81%9C%E6%AD%A2%E7%BA%BF%E7%A8%8B/</id>
    <published>2023-05-11T03:21:00.000Z</published>
    <updated>2023-05-11T03:25:05.430Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹"><a href="#å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹" class="headerlink" title="å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹"></a>å¦‚ä½•æ­£ç¡®åœæ­¢çº¿ç¨‹</h2><h4 id="æ–°å»ºçº¿ç¨‹"><a href="#æ–°å»ºçº¿ç¨‹" class="headerlink" title="æ–°å»ºçº¿ç¨‹"></a>æ–°å»ºçº¿ç¨‹</h4><h5 id="æ–°å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å¤šç§"><a href="#æ–°å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å¤šç§" class="headerlink" title="æ–°å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å¤šç§"></a>æ–°å»ºçº¿ç¨‹çš„æ–¹å¼æœ‰å¤šç§</h5><ul><li>å®ç°Runnableæ¥å£ï¼Œé‡å†™run()æ–¹æ³•</li><li>ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•</li><li>å®ç°callableæ¥å£ï¼Œé‡å†™callæ–¹æ³•</li><li>ä½¿ç”¨çº¿ç¨‹æ± </li><li>ä½¿ç”¨å®šæ—¶å™¨</li><li>â€¦â€¦â€¦â€¦..</li></ul><h5 id="ä»£ç ä¸¾ä¾‹-Runnableæ¥å£"><a href="#ä»£ç ä¸¾ä¾‹-Runnableæ¥å£" class="headerlink" title="ä»£ç ä¸¾ä¾‹-Runnableæ¥å£"></a>ä»£ç ä¸¾ä¾‹-Runnableæ¥å£</h5><p>Runnableæ¥å£é‡å†™runæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I am NewRunnable Thread&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NewRunnable</span> <span class="variable">newRunnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NewRunnable</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(newRunnable);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    I am NewRunnable Thread</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­æ–°å»º<code>NewRunnable</code> ç±»å®ç°äº†<code>Runnable</code>æ¥å£åé‡å†™äº†runæ–¹æ³•ï¼Œå®ç°æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¯èƒ½è¿™æ ·ä½“ç°ä¸å‡ºæ¥å¤šçº¿ç¨‹ï¼Œå¯ä»¥åŠ ä¸ªå¾ªç¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewThread</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">                        System.out.println(<span class="string">&quot;i am &quot;</span>+ i);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;i am mainThread&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i am <span class="number">0</span></span><br><span class="line">i am <span class="number">1</span></span><br><span class="line">i am mainThread</span><br><span class="line">i am <span class="number">2</span></span><br><span class="line">i am <span class="number">3</span></span><br><span class="line">i am <span class="number">4</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†åŒ¿åå†…éƒ¨ç±»é‡å†™äº†Runnableæ¥å£runæ–¹æ³•ï¼Œç„¶åå¾ªç¯äº”æ¬¡ï¼Œæ¯æ¬¡ç¡çœ 200æ¯«ç§’ï¼Œä¸»çº¿ç¨‹ä¸­ç¡çœ 500æ¯«ç§’ï¼Œæ‰€ä»¥å½“å­çº¿ç¨‹å¾ªç¯ä¸¤æ¬¡åï¼Œåœ¨ç¬¬ä¸‰æ¬¡æ‰“å°ä¸­é—´ä¸»çº¿ç¨‹å¼€å§‹æ‰“å°ã€‚</p><h5 id="ä»£ç ä¸¾ä¾‹-Threadç±»"><a href="#ä»£ç ä¸¾ä¾‹-Threadç±»" class="headerlink" title="ä»£ç ä¸¾ä¾‹-Threadç±»"></a>ä»£ç ä¸¾ä¾‹-Threadç±»</h5><p>ç»§æ‰¿Threadç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I am NewThread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NewThread</span> <span class="variable">newThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NewThread</span>();</span><br><span class="line">        newThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   I am NewThread!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h5 id="æ–°å»ºçº¿ç¨‹æ€»ç»“"><a href="#æ–°å»ºçº¿ç¨‹æ€»ç»“" class="headerlink" title="æ–°å»ºçº¿ç¨‹æ€»ç»“"></a>æ–°å»ºçº¿ç¨‹æ€»ç»“</h5><p>æ— è®ºæ˜¯å®ç°Runnableæ¥å£è¿˜æ˜¯ç»§æ‰¿Threadç±»ï¼Œå‘ç°æœ€ç»ˆéƒ½æ˜¯é€šè¿‡Threadç±»çš„start()æ–¹æ³•å¼€å¯çš„çº¿ç¨‹ï¼Œè€Œä¸æ˜¯é€šè¿‡run()æ–¹æ³•ï¼Œçœ‹ä¸€ä¸‹runæ–¹æ³•å’Œstartæ–¹æ³•çš„æºä»£ç </p><h6 id="run-æ–¹æ³•"><a href="#run-æ–¹æ³•" class="headerlink" title="run()æ–¹æ³•"></a>run()æ–¹æ³•</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Thread</span><span class="params">(Runnable target)</span> &#123;</span><br><span class="line">        init(<span class="literal">null</span>, target, <span class="string">&quot;Thread-&quot;</span> + nextThreadNum(), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">            target.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°Threadä¹Ÿå®ç°äº†Runnableæ¥å£ï¼Œå¹¶é‡å†™äº†runæ–¹æ³•ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å®ç°Runnableæ¥å£ï¼Œå¹¶æŠŠå¯¹è±¡å½“ä½œå‚æ•°ä¼ ç»™Threadç±»ä¸­ public Thread(Runnable target)ï¼›æ„é€ å™¨æ—¶ï¼Œè¿™æ—¶å€™run()æ–¹æ³•æ‰§è¡Œçš„å°±æ˜¯ä¼ å…¥å¯¹è±¡çš„run()æ–¹æ³•ï¼Œrun()æ–¹æ³•ä¸­ä¹Ÿåªæœ‰è¿™ä¸‰è¡Œä»£ç ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å®ç°å¤šçº¿ç¨‹ã€‚</p><h6 id="start-æ–¹æ³•"><a href="#start-æ–¹æ³•" class="headerlink" title="start()æ–¹æ³•"></a>start()æ–¹æ³•</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This method is not invoked for the main method thread or &quot;system&quot;</span></span><br><span class="line"><span class="comment">     * group threads created/set up by the VM. Any new functionality added</span></span><br><span class="line"><span class="comment">     * to this method in the future may have to also be added to the VM.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * A zero status value corresponds to state &quot;NEW&quot;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (threadStatus != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalThreadStateException</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Notify the group that this thread is about to be started</span></span><br><span class="line"><span class="comment">     * so that it can be added to the group&#x27;s list of threads</span></span><br><span class="line"><span class="comment">     * and the group&#x27;s unstarted count can be decremented. */</span></span><br><span class="line">    group.add(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">started</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        start0();</span><br><span class="line">        started = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!started) &#123;</span><br><span class="line">                group.threadStartFailed(<span class="built_in">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ignore) &#123;</span><br><span class="line">            <span class="comment">/* do nothing. If start0 threw a Throwable then</span></span><br><span class="line"><span class="comment">              it will be passed up the call stack */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é¦–å…ˆrun()æ–¹æ³•<code>if (threadStatus != 0)</code> åˆ¤æ–­çº¿ç¨‹çŠ¶æ€ï¼Œè€Œåè°ƒç”¨äº†start0æ–¹æ³•ï¼Œè€Œstart0æ–¹æ³•<code>private native void start0();</code>å¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œå¹¶éæ˜¯ç”±javaå®ç°</p><p>æœç´¢åå¾—çŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åœ¨Javaä¸­ï¼ŒThreadç±»æ˜¯ç”¨äºå®ç°å¤šçº¿ç¨‹ç¼–ç¨‹çš„ç±»ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶å¯åŠ¨å®ƒæ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†Threadç±»ä¸­çš„start()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæ‰§è¡Œä¸€ä¸ªæœ¬åœ°æ–¹æ³•start0()ã€‚start0()æ–¹æ³•ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ç³»ç»Ÿçº¿ç¨‹ï¼Œå¹¶è°ƒç”¨run()æ–¹æ³•ã€‚run()æ–¹æ³•æ˜¯çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œå½“run()æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œçº¿ç¨‹å°±ä¼šè‡ªåŠ¨ç»“æŸã€‚</span><br><span class="line"></span><br><span class="line">start0()æ–¹æ³•æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼ˆ<span class="keyword">native</span> methodï¼‰ï¼Œå®ƒæ˜¯ç”±JVMå®ç°çš„ã€‚æœ¬åœ°æ–¹æ³•æ˜¯æŒ‡ä½¿ç”¨C/C++ç­‰ä½çº§è¯­è¨€ç¼–å†™çš„æ–¹æ³•ï¼Œå®ƒä»¬é€šå¸¸ç”±JVMåŠ è½½å¹¶åœ¨æœ¬åœ°ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚start0()æ–¹æ³•åœ¨åº•å±‚å®ç°äº†çº¿ç¨‹çš„åˆ›å»ºå’Œå¯åŠ¨ï¼Œå…¶å…·ä½“å®ç°ä¼šä¾èµ–äºä¸åŒçš„æ“ä½œç³»ç»Ÿå’ŒJVMå®ç°ã€‚åœ¨JVMä¸­ï¼Œstart0()æ–¹æ³•çš„å®ç°æ˜¯ç”±<span class="keyword">native</span>å±‚é¢æä¾›çš„ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ç›´æ¥æŸ¥çœ‹å…¶æºä»£ç ã€‚</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œåœ¨javaä¸­çœŸæ­£å®ç°å¤šçº¿ç¨‹çš„æ˜¯Threadç±»ä¸­çš„start()æ–¹æ³•ã€‚</p><h5 id="è¡¥å……-callableæ¥å£"><a href="#è¡¥å……-callableæ¥å£" class="headerlink" title="è¡¥å…… callableæ¥å£"></a>è¡¥å…… callableæ¥å£</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;I am newCallable!&quot;</span>;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NewCallable</span> <span class="variable">newCallable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NewCallable</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">FutureTask</span> <span class="variable">futureTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(newCallable);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask);</span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line">            System.out.println(o);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;i am mainThread&quot;</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Thread-0</span></span><br><span class="line"><span class="comment">    I am newCallable!</span></span><br><span class="line"><span class="comment">    i am mainThread</span></span><br><span class="line"><span class="comment">    main</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ç°callableæ¥å£ä¹Ÿæ˜¯é€šè¿‡Threadç±»åˆ›å»ºçš„æ–°çº¿ç¨‹ï¼Œä¸åŒçš„æ˜¯ä½¿ç”¨äº†<code>FutureTask</code>ç±»æ¥æ”¶äº†è¿”å›å€¼</p><p>ç®€è¦è¯´ä¸€ä¸‹<code>futureTask</code>å¯ä»¥çœ‹åˆ°è¯¥ç±»é—´æ¥ç»§æ‰¿äº†Runnableæ¥å£ï¼Œæ‰€ä»¥ä¾ç„¶å¯ä»¥ç†è§£æˆcallableæ¥å£å°±æ˜¯å®ç°<code>Runnbale</code>æ¥å£ï¼Œé‡å†™äº†runæ–¹æ³•çš„æ–¹å¼å®ç°äº†å¤šçº¿ç¨‹ï¼Œå…¶ä»–æ–¹å¼ä¸åœ¨è¿‡å¤šé˜é‡Šã€‚</p><p><img src="https://pic2.imgdb.cn/item/645c4b0a0d2dde577754bbae.png"></p><h4 id="åœæ­¢çº¿ç¨‹"><a href="#åœæ­¢çº¿ç¨‹" class="headerlink" title="åœæ­¢çº¿ç¨‹"></a>åœæ­¢çº¿ç¨‹</h4><h5 id="å¦‚ä½•åœæ­¢çº¿ç¨‹ï¼Ÿ"><a href="#å¦‚ä½•åœæ­¢çº¿ç¨‹ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœæ­¢çº¿ç¨‹ï¼Ÿ"></a>å¦‚ä½•åœæ­¢çº¿ç¨‹ï¼Ÿ</h5><ul><li>stop()?</li><li>destroy()?</li><li>suspend()?</li><li>interrupt()?</li></ul><p>æŸ¥çœ‹ APIï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° <code>java.lang.Thread</code> ç±»å‹æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å¦‚ start()ã€stop()ã€resume()ã€suspend()ã€destroy()ç­‰æ–¹æ³•æ¥ç®¡ç†çº¿ç¨‹ã€‚ä½†æ˜¯é™¤äº† start() ä¹‹å¤–ï¼Œå…¶å®ƒå‡ ä¸ªæ–¹æ³•éƒ½è¢«å£°åä¸ºå·²è¿‡æ—¶ï¼ˆdeprecatedï¼‰</p><p>è¯¦ç»†åŸå› å¯çœ‹<code>jdk</code>æ–‡æ¡£çš„è§£é‡Š  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.oracle.com/javase/<span class="number">1.5</span>.<span class="number">0</span>/docs/guide/misc/threadPrimitiveDeprecation.html</span><br></pre></td></tr></table></figure><p><strong>æ­£ç¡®åœæ­¢çº¿ç¨‹çš„æ–¹å¼æ˜¯ä½¿ç”¨interrupt()æ–¹æ³•</strong></p><h5 id="Interrupt-æ–¹æ³•"><a href="#Interrupt-æ–¹æ³•" class="headerlink" title="Interrupt()æ–¹æ³•"></a>Interrupt()æ–¹æ³•</h5><p>åœ¨ Java ä¸­ï¼Œ<code>Thread.interrupt()</code> æ–¹æ³•ç”¨äºä¸­æ–­çº¿ç¨‹ï¼Œå…¶ä½œç”¨æ˜¯è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ä¸º <code>true</code>ã€‚è¢«ä¸­æ–­çš„çº¿ç¨‹å¯ä»¥é€šè¿‡æ£€æŸ¥è‡ªèº«çš„ä¸­æ–­æ ‡å¿—ä½æ¥åˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­ï¼Œç„¶åæ‰§è¡Œé€‚å½“çš„æ“ä½œã€‚</p><p>å¦‚æœçº¿ç¨‹è¢«é˜»å¡åœ¨æŸäº›æ“ä½œä¸Šï¼ˆå¦‚ç­‰å¾… I&#x2F;O æ“ä½œã€<code>sleep()</code> ç­‰ï¼‰ï¼Œè°ƒç”¨ <code>interrupt()</code> æ–¹æ³•ä¼šä¸­æ–­è¯¥çº¿ç¨‹çš„é˜»å¡çŠ¶æ€ï¼ŒæŠ›å‡º <code>InterruptedException</code> å¼‚å¸¸ï¼Œå¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ã€‚å¦‚æœçº¿ç¨‹æ²¡æœ‰è¢«é˜»å¡ï¼Œåˆ™è°ƒç”¨ <code>interrupt()</code> æ–¹æ³•åªæ˜¯è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ä¸º <code>true</code>ï¼Œçº¿ç¨‹ä»ç„¶å¯ä»¥ç»§ç»­è¿è¡Œã€‚</p><h5 id="ä¸¾ä¸ªä¾‹å­"><a href="#ä¸¾ä¸ªä¾‹å­" class="headerlink" title="ä¸¾ä¸ªä¾‹å­"></a>ä¸¾ä¸ªä¾‹å­</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;MyThread is running...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;MyThread is interrupted!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        myThread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    MyThread is running...</span></span><br><span class="line"><span class="comment">    MyThread is running...</span></span><br><span class="line"><span class="comment">    MyThread is running...</span></span><br><span class="line"><span class="comment">    MyThread is running...</span></span><br><span class="line"><span class="comment">    MyThread is running...</span></span><br><span class="line"><span class="comment">    MyThread is interrupted!</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ–°å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç¡çœ 5Såå°†æ–°å»ºçº¿ç¨‹ä¸­æ–­ï¼Œè¿™æ˜¯æ–°çº¿ç¨‹æ•è·ä¸­æ–­ï¼Œå¹¶æ‰“å°äº†<code>MyThread is interrupted!</code>ï¼Œ</p><h5 id="ä¸­æ–­æ ‡å¿—ä½"><a href="#ä¸­æ–­æ ‡å¿—ä½" class="headerlink" title="ä¸­æ–­æ ‡å¿—ä½"></a>ä¸­æ–­æ ‡å¿—ä½</h5><p>ä¸Šæ–¹ä»£ç ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ<code>while (!Thread.currentThread().isInterrupted())</code> æ¢æˆ <code>while (true)</code>å‘ç°è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™å°±ç‰µæ‰¯åˆ°ä¸­æ–­æ ‡å¿—ä½äº†ï¼Œå¦‚ä¸Šæ–¹æ‰€è¨€ <strong>å¦‚æœçº¿ç¨‹è¢«é˜»å¡åœ¨æŸäº›æ“ä½œä¸Šï¼ˆå¦‚ç­‰å¾… I&#x2F;O æ“ä½œã€<code>sleep()</code> ç­‰ï¼‰ï¼Œè°ƒç”¨ <code>interrupt()</code> æ–¹æ³•ä¼šä¸­æ–­è¯¥çº¿ç¨‹çš„é˜»å¡çŠ¶æ€ï¼ŒæŠ›å‡º <code>InterruptedException</code> å¼‚å¸¸ï¼Œå¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ã€‚</strong>ä¸Šæ–¹ä»£ç ä¸­5sä¸­æ–­çº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹åœ¨sleepçŠ¶æ€ï¼Œè¿™æ—¶å€™ç¨‹åºæŠ›å‡º <code>InterruptedException</code> å¼‚å¸¸ï¼Œå¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ã€‚åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶çº¿ç¨‹å·²ç»åœæ­¢äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted())&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ­£åœ¨æ‰“å°ï¼š&quot;</span>+ ++i);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        myThread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ­£åœ¨æ‰“å°ï¼š0</span></span><br><span class="line"><span class="comment">æ­£åœ¨æ‰“å°ï¼š1</span></span><br><span class="line"><span class="comment">æ­£åœ¨æ‰“å°ï¼š2</span></span><br><span class="line"><span class="comment">æ­£åœ¨æ‰“å°ï¼š3</span></span><br><span class="line"><span class="comment">........</span></span><br><span class="line"><span class="comment">æ­£åœ¨æ‰“å°ï¼š104</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡åˆ¤æ–­ç¨‹åºçš„ä¸­æ–­ä¿¡å·æ¥æ‰§è¡Œä»£ç ï¼Œå½“ç¨‹åºè¢«ä¸­æ–­æ—¶ï¼Œè·³å‡ºwhileå¾ªç¯ï¼Œæ–°çº¿ç¨‹è¿è¡Œç»“æŸ</p><h5 id="å¾ªç¯ä¸­ä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#å¾ªç¯ä¸­ä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="å¾ªç¯ä¸­ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>å¾ªç¯ä¸­ä½¿ç”¨æ³¨æ„äº‹é¡¹</h5><p>å¦‚æœæˆ‘ä»¬å°†try catch æ”¾åœ¨å¾ªç¯ä¸­å‘ç°ç¨‹åºå“åº”ä¸­æ–­åå¹¶æœªåœæ­¢ï¼Œè¿™æ˜¯å› ä¸ºsleepï¼ˆï¼‰æ¸…é™¤äº†ä¸­æ–­æ ‡å¿—ä½ï¼Œæ‰€ä»¥ä¸èƒ½å°†try catchè¯­å¥æ”¾åœ¨å¾ªç¯ä¸­ï¼Œè€Œåº”è¯¥æ”¾åœ¨å¾ªç¯å¤–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;MyThread is running...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        myThread.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        myThread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">MyThread is running...</span></span><br><span class="line"><span class="comment">MyThread is running...</span></span><br><span class="line"><span class="comment">MyThread is running...</span></span><br><span class="line"><span class="comment">MyThread is running...</span></span><br><span class="line"><span class="comment">java.lang.InterruptedException: sleep interrupted</span></span><br><span class="line"><span class="comment">at java.lang.Thread.sleep(Native Method)</span></span><br><span class="line"><span class="comment">at threadToStop.MyThread.run(MyThread.java:8)</span></span><br><span class="line"><span class="comment">MyThread is running...</span></span><br><span class="line"><span class="comment">MyThread is running...</span></span><br><span class="line"><span class="comment">    */</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="java" scheme="https://nerkeler.github.io/tags/java/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://nerkeler.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Pythonæ—¥å¿—æ¨¡å—loggingçš„ä½¿ç”¨è¯¦è§£</title>
    <link href="https://nerkeler.github.io/2023/05/04/ython%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97logging%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/"/>
    <id>https://nerkeler.github.io/2023/05/04/ython%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97logging%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/</id>
    <published>2023-05-04T08:28:00.000Z</published>
    <updated>2023-05-18T00:55:51.629Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Pythonæ—¥å¿—æ¨¡å—loggingçš„ä½¿ç”¨è¯¦è§£"><a href="#Pythonæ—¥å¿—æ¨¡å—loggingçš„ä½¿ç”¨è¯¦è§£" class="headerlink" title="Pythonæ—¥å¿—æ¨¡å—loggingçš„ä½¿ç”¨è¯¦è§£"></a>Pythonæ—¥å¿—æ¨¡å—loggingçš„ä½¿ç”¨è¯¦è§£</h1><p><em><strong>PS: è½¬è½½è‡ª  <a href="https://github.com/HuiDBK/LogSetupDemo">https://github.com/HuiDBK/LogSetupDemo</a></strong></em></p><h2 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h2><blockquote><p>åœ¨å¼€å‘ä¸€äº›å¤§å‹é¡¹ç›®çš„æ—¶å€™ï¼Œéƒ½ä¼šä½¿ç”¨æ—¥å¿—æ¥è®°å½•é¡¹ç›®è¿è¡Œæ—¶äº§ç”Ÿçš„ä¿¡æ¯ï¼Œä»¥å¤‡å‡ºé”™æ—¶å®šä½åˆ†æå’Œä»æ—¥å¿—ä¿¡æ¯ä¸­æå–æ•°æ®ç»Ÿè®¡åˆ†æç­‰ã€‚åœ¨ <code>Python</code> ä¸­ä½¿ç”¨ <code>logging</code> å†…ç½®æ¨¡å—å³å¯å¯¹é¡¹ç›®è¿›è¡Œæ—¥å¿—çš„é…ç½®ã€‚</p></blockquote><h2 id="loggingæ¨¡å—çš„ä½¿ç”¨"><a href="#loggingæ¨¡å—çš„ä½¿ç”¨" class="headerlink" title="loggingæ¨¡å—çš„ä½¿ç”¨"></a>loggingæ¨¡å—çš„ä½¿ç”¨</h2><h3 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h3><blockquote><p><code>logging</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ä¾¿åˆ©çš„å‡½æ•°</p><p>å®ƒä»¬åˆ†åˆ«æ˜¯ <code>debug(), info(), warning(), error(), critical()</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br><span class="line">logging.error(<span class="string">&#x27;error log test&#x27;</span>)</span><br><span class="line">logging.critical(<span class="string">&#x27;critical log test&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARNING:root:warning log test</span><br><span class="line">ERROR:root:error log test</span><br><span class="line">CRITICAL:root:critical log test</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆåªè¾“å‡ºäº† <code>warning</code>ï¼Œ <code>error</code> å’Œ <code>critical</code> çš„ç»“æœï¼Œå› ä¸º <code>logging</code> æ¨¡å—é»˜è®¤ä½¿ç”¨ <code>warning</code> æ—¥å¿—çº§åˆ«ï¼Œå°±æ˜¯åªæœ‰ <code>warning</code> åŠä»¥ä¸Šæ—¥å¿—ç­‰çº§æ‰ä¼šæ˜¾ç¤ºã€‚</p><p>æ—¥å¿—ç­‰çº§ä»é«˜åˆ°ä½ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><table><thead><tr><th>çº§åˆ«</th><th>æ•°å€¼</th><th>ä½•æ—¶ä½¿ç”¨</th></tr></thead><tbody><tr><td><code>CRITICAL</code></td><td>50</td><td>ä¸¥é‡çš„é”™è¯¯ï¼Œè¡¨æ˜ç¨‹åºå·²ä¸èƒ½ç»§ç»­æ‰§è¡Œ</td></tr><tr><td><code>ERROR</code></td><td>40</td><td>ç”±äºä¸¥é‡çš„é—®é¢˜ï¼Œç¨‹åºçš„æŸäº›åŠŸèƒ½å·²ç»ä¸èƒ½æ­£å¸¸æ‰§è¡Œ</td></tr><tr><td><code>WARNING</code></td><td>30</td><td>è¡¨æ˜æœ‰å·²ç»æˆ–å³å°†å‘ç”Ÿçš„æ„å¤–ï¼Œç¨‹åºä»æŒ‰é¢„æœŸè¿›è¡Œ</td></tr><tr><td><code>INFO</code></td><td>20</td><td>ç¡®è®¤ç¨‹åºæŒ‰é¢„æœŸè¿è¡Œ</td></tr><tr><td><code>DEBUG</code></td><td>10</td><td>ç»†èŠ‚ä¿¡æ¯ï¼Œä»…å½“è¯Šæ–­é—®é¢˜æ—¶é€‚ç”¨ã€‚</td></tr><tr><td><code>NOTSET</code></td><td>0</td><td>æ— ä»»ä½•ç­‰çº§é™åˆ¶</td></tr></tbody></table><p>æˆ‘ä»¬åªè¦æŠŠ <code>logging</code> çš„é»˜è®¤æ—¥å¿—ç­‰çº§æ”¹ä¸‹å°±å¥½äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®æ—¥å¿—ç­‰çº§</span></span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br><span class="line">logging.error(<span class="string">&#x27;error log test&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:root:debug log test</span><br><span class="line">INFO:root:info log test</span><br><span class="line">WARNING:root:warning log test</span><br><span class="line">ERROR:root:error log test</span><br></pre></td></tr></table></figure><h3 id="æŒ‡å®šæ—¥å¿—è¾“å‡ºæ ·å¼"><a href="#æŒ‡å®šæ—¥å¿—è¾“å‡ºæ ·å¼" class="headerlink" title="æŒ‡å®šæ—¥å¿—è¾“å‡ºæ ·å¼"></a>æŒ‡å®šæ—¥å¿—è¾“å‡ºæ ·å¼</h3><p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šæ—¥å¿—è¾“å‡ºæ ¼å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—è¾“å‡ºæ ·å¼</span></span><br><span class="line">log_format = <span class="string">&#x27;%(levelname)s %(asctime)s %(filename)s %(lineno)d %(message)s&#x27;</span></span><br><span class="line">logging.basicConfig(<span class="built_in">format</span>=log_format, level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br><span class="line">logging.error(<span class="string">&#x27;error log test&#x27;</span>)</span><br><span class="line">logging.critical(<span class="string">&#x27;critical log test&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG <span class="number">2021</span>-05-<span class="number">27</span> <span class="number">00</span>:04:<span class="number">26</span>,<span class="number">327</span> main.py <span class="number">65</span> debug log test</span><br><span class="line">INFO <span class="number">2021</span>-05-<span class="number">27</span> <span class="number">00</span>:04:<span class="number">26</span>,<span class="number">327</span> main.py <span class="number">66</span> info log test</span><br><span class="line">WARNING <span class="number">2021</span>-05-<span class="number">27</span> <span class="number">00</span>:04:<span class="number">26</span>,<span class="number">327</span> main.py <span class="number">67</span> warning log test</span><br><span class="line">ERROR <span class="number">2021</span>-05-<span class="number">27</span> <span class="number">00</span>:04:<span class="number">26</span>,<span class="number">327</span> main.py <span class="number">68</span> error log test</span><br><span class="line">CRITICAL <span class="number">2021</span>-05-<span class="number">27</span> <span class="number">00</span>:04:<span class="number">26</span>,<span class="number">327</span> main.py <span class="number">69</span> critical log test</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ—¥å¿—ä¿¡æ¯æ ¼å¼åŒ–è¾“å‡ºé…ç½®æ ·å¼è¯´æ˜</p><ul><li><strong>%(levelname)s ï¼Œæ—¥å¿—ç­‰çº§</strong></li><li><strong>%(asctime)s ï¼Œæ—¶é—´</strong></li><li><strong>%(filename)s ï¼Œæ–‡ä»¶å</strong></li><li><strong>%(lineno)d ï¼Œè¡Œå·</strong></li><li><strong>%(message)sï¼Œæ—¥å¿—ä¿¡æ¯</strong></li></ul><p>è¿™äº›é…ç½®éƒ½æ˜¯å›ºå®šï¼Œä¸å¯éšä¾¿å†™ï¼Œè¿˜æœ‰å¥½å¤šæ—¥å¿—æ ¼å¼åŒ–æ ·å¼ï¼Œè¿™é‡Œåªä»‹ç»äº†ä¸€äº›å¸¸ç”¨çš„æ ¼å¼é…ç½®ï¼Œå¤§å®¶å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹æ›´å¤šçš„æ ¼å¼åŒ–é…ç½®ä¿¡æ¯ã€‚<a href="https://docs.python.org/zh-cn/3.7/library/logging.html#formatter-objects">https://docs.python.org/zh-cn/3.7/library/logging.html#formatter-objects</a></p><h3 id="æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶ä¸­"><a href="#æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶ä¸­" class="headerlink" title="æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶ä¸­"></a>æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶ä¸­</h3><p>åœ¨ <code>logging.basicConfig</code> ä¸­è®¾ç½® <code>filename</code> å±æ€§å³å¯æŠŠæ—¥å¿—ä¿¡æ¯å†™å…¥æ–‡ä»¶ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—è¾“å‡ºæ ·å¼</span></span><br><span class="line">log_format = <span class="string">&#x27;%(levelname)s %(asctime)s %(filename)s %(lineno)d %(message)s&#x27;</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    filename=<span class="string">&#x27;test.log&#x27;</span>,</span><br><span class="line">    <span class="built_in">format</span>=log_format,</span><br><span class="line">    level=logging.DEBUG</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br><span class="line">logging.error(<span class="string">&#x27;error log test&#x27;</span>)</span><br><span class="line">logging.critical(<span class="string">&#x27;critical log test&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºå <code>test.log</code> å¦‚ä¸‹å†…å®¹</p><p><a href="https://camo.githubusercontent.com/0ec87edd65f7f606755fb53dce5758bfc8d623f6b913cba1e9f13d244c4530c5/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f38646262323366363033336434653565626134363138666232313033643264667e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765"><img src="https://camo.githubusercontent.com/0ec87edd65f7f606755fb53dce5758bfc8d623f6b913cba1e9f13d244c4530c5/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f38646262323366363033336434653565626134363138666232313033643264667e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765" alt="æ—¥å¿—ä¿¡æ¯å±•ç¤º"></a></p><h2 id="è‡ªå®šä¹‰æ—¥å¿—é…ç½®"><a href="#è‡ªå®šä¹‰æ—¥å¿—é…ç½®" class="headerlink" title="è‡ªå®šä¹‰æ—¥å¿—é…ç½®"></a>è‡ªå®šä¹‰æ—¥å¿—é…ç½®</h2><blockquote><p>é€šå¸¸æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­éƒ½æ˜¯è‡ªå®šä¹‰ä¸€äº›é€šç”¨æ—¥å¿—é…ç½®ï¼Œç„¶åä¾›é¡¹ç›®å…¨å±€ä½¿ç”¨ã€‚å†™å¥½è¿™äº›é…ç½®ä¸‹æ¬¡è¦åœ¨åˆ«çš„é¡¹ç›®ä½¿ç”¨ä¹‹é—´å¤åˆ¶ç²˜è´´è¿‡æ¥ä¿®æ”¹ä¿®æ”¹ä¸€ä¸‹å³å¯ã€‚æ¥åº·åº·æ˜¯å¦‚ä½•é…ç½®çš„ã€‚</p></blockquote><h3 id="å‡†å¤‡æ—¥å¿—é…ç½®ä¿¡æ¯"><a href="#å‡†å¤‡æ—¥å¿—é…ç½®ä¿¡æ¯" class="headerlink" title="å‡†å¤‡æ—¥å¿—é…ç½®ä¿¡æ¯"></a>å‡†å¤‡æ—¥å¿—é…ç½®ä¿¡æ¯</h3><p>é…ç½®æ—¥å¿—è¯¦ç»†ä¿¡æ¯ï¼Œéœ€è¦å¯¼å…¥ <code>logging.config</code> æ¥è¿›è¡ŒåŠ è½½æ—¥å¿—é…ç½®ä¿¡æ¯</p><p>é¦–å…ˆå‡†å¤‡æ—¥å¿—é…ç½®ä¿¡æ¯å­—å…¸</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">log_dict</span> <span class="string">=</span> &#123;</span><br><span class="line">    <span class="attr">&#x27;version&#x27;:</span> <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&#x27;disable_existing_loggers&#x27;:</span> <span class="literal">False</span>,  <span class="comment"># æ˜¯å¦ç¦ç”¨å·²ç»å­˜åœ¨çš„æ—¥å¿—å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ—¥å¿—ä¿¡æ¯æ ¼å¼åŒ–è¾“å‡ºé…ç½®</span></span><br><span class="line">    <span class="attr">&#x27;formatters&#x27;:</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç®€å•çš„æ—¥å¿—è¾“å‡º</span></span><br><span class="line">        <span class="attr">&#x27;simple&#x27;:</span> &#123;</span><br><span class="line">            <span class="attr">&#x27;format&#x27;:</span> <span class="string">&#x27;%(levelname)s %(module)s %(lineno)d %(message)s&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯¦ç»†çš„æ—¥å¿—è¾“å‡º</span></span><br><span class="line">        <span class="attr">&#x27;verbose&#x27;:</span> &#123;</span><br><span class="line">            <span class="attr">&#x27;format&#x27;:</span> <span class="string">&#x27;%(levelname)s %(asctime)s %(filename)s %(lineno)d %(message)s&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ—¥å¿—ä¿¡æ¯å¤„ç†å™¨é…ç½®</span></span><br><span class="line">    <span class="attr">&#x27;handlers&#x27;:</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å‘ç»ˆç«¯ä¸­è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">        <span class="attr">&#x27;console&#x27;:</span> &#123;</span><br><span class="line">            <span class="attr">&#x27;level&#x27;:</span> <span class="string">&#x27;DEBUG&#x27;</span>,                   <span class="comment"># å¤„ç†çš„æ—¥å¿—ç­‰çº§ï¼ŒDEBUGåŠä»¥ä¸Š</span></span><br><span class="line">            <span class="attr">&#x27;class&#x27;:</span> <span class="string">&#x27;logging.StreamHandler&#x27;</span>,   <span class="comment"># æ—¥å¿—å¤„ç†å™¨</span></span><br><span class="line">            <span class="attr">&#x27;formatter&#x27;:</span> <span class="string">&#x27;simple&#x27;</span>               <span class="comment"># æ—¥å¿—æ ¼å¼åŒ–é…ç½®</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å‘æ–‡ä»¶ä¸­è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">        <span class="attr">&#x27;file&#x27;:</span> &#123;</span><br><span class="line">            <span class="attr">&#x27;level&#x27;:</span> <span class="string">&#x27;INFO&#x27;</span>,                                    <span class="comment"># å¤„ç†çš„æ—¥å¿—ç­‰çº§ï¼ŒDEBUGåŠä»¥ä¸Š</span></span><br><span class="line">            <span class="attr">&#x27;class&#x27;:</span> <span class="string">&#x27;logging.handlers.RotatingFileHandler&#x27;</span>,    <span class="comment"># ä½¿ç”¨æ–‡ä»¶æ—¥å¿—å¤„ç†å™¨</span></span><br><span class="line">            <span class="attr">&#x27;formatter&#x27;:</span> <span class="string">&#x27;verbose&#x27;</span>,                             <span class="comment"># æ—¥å¿—æ ¼å¼åŒ–é…ç½®</span></span><br><span class="line">            <span class="attr">&#x27;filename&#x27;:</span> <span class="string">&#x27;./logs/test.log&#x27;</span>,                      <span class="comment"># æ—¥å¿—æ–‡ä»¶å­˜å‚¨ä½ç½®</span></span><br><span class="line">            <span class="attr">&#x27;maxBytes&#x27;:</span> <span class="number">1024</span> <span class="string">*</span> <span class="number">1024</span>,        <span class="comment"># æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ 10MB, å•ä½: byte</span></span><br><span class="line">            <span class="attr">&#x27;backupCount&#x27;:</span> <span class="number">20</span>,              <span class="comment"># å¦‚æœæ–‡ä»¶æ»¡äº†, è‡ªåŠ¨æ‰©å……, æœ€å¤šä¿ç•™ 20 ä¸ªæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">            <span class="attr">&#x27;encoding&#x27;:</span> <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é»˜è®¤æ ¹æ—¥å¿—å™¨</span></span><br><span class="line">    <span class="attr">&#x27;root&#x27;:</span> &#123;</span><br><span class="line">        <span class="attr">&#x27;level&#x27;:</span> <span class="string">&#x27;DEBUG&#x27;</span>,           <span class="comment"># å…è®¸æ¥å—çš„æ—¥å¿—ç­‰çº§</span></span><br><span class="line">        <span class="attr">&#x27;handlers&#x27;:</span> [<span class="string">&#x27;console&#x27;</span>]     <span class="comment"># é€‰æ‹©æ—¥å¿—å¤„ç†å™¨</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰çš„æ—¥å¿—å™¨</span></span><br><span class="line">    <span class="attr">&#x27;loggers&#x27;:</span> &#123;</span><br><span class="line">        <span class="attr">&#x27;server&#x27;:</span> &#123;</span><br><span class="line">            <span class="attr">&#x27;level&#x27;:</span> <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="attr">&#x27;handlers&#x27;:</span> [<span class="string">&#x27;file&#x27;</span>],</span><br><span class="line">            <span class="attr">&#x27;propagate&#x27;:</span> <span class="literal">True</span>       <span class="comment"># è®¾ä¸º Falseåˆ™ç¦æ­¢å°†æ—¥å¿—æ¶ˆæ¯ä¼ é€’ç»™çˆ¶çº§è®°å½•å™¨çš„å¤„ç†ç¨‹åºä¸­</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¤§å­—å…¸çš„ <code>key</code> éƒ½æ˜¯å›ºå®šï¼Œä¾‹å¦‚ <code>version,formatters, handlers, root, loggers</code>ç­‰éƒ½æ˜¯å›ºå®šçš„é…ç½®é¡¹ã€‚è€Œæœ‰ä¸€äº›å­é€‰é¡¹æ˜¯å¯ä»¥è‡ªå·±è‡ªå®šä¹‰å¦‚</p><ul><li><code>formatters</code> ä¸‹çš„ <code>simple</code> å’Œ <code>verbose</code>ï¼Œæ˜¯å¯ä»¥æ”¹æˆè‡ªå·±æƒ³è¦çš„åå­—ã€‚</li><li><code>handlers</code> ä¸‹çš„ <code>console</code> å’Œ <code>file</code> ä¹Ÿæ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚</li><li><code>loggers</code> ä¸‹çš„ <code>server</code> éƒ½æ˜¯ä¸€æ ·å¯ä»¥ä¿®æ”¹çš„</li></ul><p>å…·ä½“é…ç½®çš„è¯´æ˜ï¼Œåœ¨è¿™å­—å…¸ä¸­éƒ½æœ‰ä¸€ä¸€æ³¨é‡Šæˆ‘å°±ä¸å…¨ä»‹ç»äº†ï¼Œæˆ‘å°±ä»‹ç»ä¸€ä¸‹ <code>handlers</code> æ—¥å¿—å¤„ç†å™¨çš„é…ç½®</p><p>åœ¨ <code>logging</code> æ¨¡å—ä¸­æœ‰è®¸å¤š <strong>æ—¥å¿—å¤„ç†å™¨ç±»</strong>ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ <code>pycharm</code> ä¸­è¾“å…¥ <code>logging.Handler</code> å°±èƒ½å¼¹å‡ºæœ€åŸºæœ¬çš„å‡ ä¸ªæ—¥å¿—å¤„ç†ç±»ã€‚</p><p><a href="https://camo.githubusercontent.com/18888f035e50185a528db0d5c84d423b56415cea1c014f4fe73cc81834a07b5a/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f65306632643238303531316434363965616663636563663564643934363531317e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765"><img src="https://camo.githubusercontent.com/18888f035e50185a528db0d5c84d423b56415cea1c014f4fe73cc81834a07b5a/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f65306632643238303531316434363965616663636563663564643934363531317e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765" alt="æ—¥å¿—å¤„ç†å™¨"></a></p><p>è€Œä¸Šæ–‡æ‰€ç”¨åˆ°çš„ <code>StreamHandler</code> åˆ™æ˜¯æµå¤„ç†å™¨ï¼Œæ—¥å¿—å°†éšç€ç³»ç»Ÿæ ‡å‡†è¾“å…¥ã€è¾“å‡ºæµå±•ç¤ºï¼Œè€Œæˆ‘ä»¬çš„ <strong>PyCharmç»ˆç«¯ã€æ§åˆ¶å°ç­‰</strong> æ˜¾ç¤ºçš„ä¿¡æ¯å°±å±äºç³»ç»Ÿæ ‡å‡†è¾“å‡ºæµã€‚</p><p>è€Œ <code>RotatingFileHandler</code> æ—¥å¿—å¤„ç†å™¨åˆ™æ˜¯ <code>FileHandler</code> çš„å­ç±»ã€‚å…¶ä¸»è¦ä½œç”¨å°±æ˜¯æŠŠæ—¥å¿—å†™å…¥æ–‡ä»¶ä¸­ï¼Œå½“æ–‡ä»¶å†…å®¹è¾¾åˆ°æœ€å¤§é™åˆ¶æ—¶å¯ä»¥è‡ªåŠ¨æ‰©å……æ—¥å¿—æ–‡ä»¶ï¼Œä»¥è¾¾åˆ°æ—¥å¿—æ–‡ä»¶çš„è½®æ¢ã€‚</p><h3 id="åŠ è½½æ—¥å¿—é…ç½®ä¿¡æ¯"><a href="#åŠ è½½æ—¥å¿—é…ç½®ä¿¡æ¯" class="headerlink" title="åŠ è½½æ—¥å¿—é…ç½®ä¿¡æ¯"></a>åŠ è½½æ—¥å¿—é…ç½®ä¿¡æ¯</h3><p>ç„¶åä½¿ç”¨ <code>logging.config.dictConfig()</code> æ–¹æ³•åŠ è½½æ—¥å¿—é…ç½®ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª <strong>å­—å…¸</strong> å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Hui</span></span><br><span class="line"><span class="comment"># @Desc: &#123; æ—¥å¿—æ¨¡å—loggingçš„ä½¿ç”¨ &#125;</span></span><br><span class="line"><span class="comment"># @Date: 2021/05/26 23:14</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line">log_dict = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,  <span class="comment"># æ˜¯å¦ç¦ç”¨å·²ç»å­˜åœ¨çš„æ—¥å¿—å™¨</span></span><br><span class="line"></span><br><span class="line">    ...ä¸ä¸Šæ–‡ä¸€è‡´æ•…çœç•¥</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é»˜è®¤æ ¹æ—¥å¿—å™¨</span></span><br><span class="line">    <span class="string">&#x27;root&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;DEBUG&#x27;</span>,  <span class="comment"># æ¥å—çš„æ—¥å¿—ç­‰çº§</span></span><br><span class="line">        <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰çš„æ—¥å¿—å™¨</span></span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;server&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>: <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;file&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>       <span class="comment"># è®¾ä¸º Falseåˆ™ç¦æ­¢å°†æ—¥å¿—æ¶ˆæ¯ä¼ é€’ç»™çˆ¶çº§è®°å½•å™¨çš„å¤„ç†ç¨‹åºä¸­</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_logging</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    é…ç½®æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    logging.config.dictConfig(config=log_dict)</span><br><span class="line">    logger = logging.getLogger()</span><br><span class="line"><span class="comment"># logger = logging.getLogger(&#x27;root&#x27;)</span></span><br><span class="line">    </span><br><span class="line">    logger.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line">    logger.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line">    logger.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br><span class="line">    logger.error(<span class="string">&#x27;error log test&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    setup_logging()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>logging.getLogger()</code> å³å¯è·å–ç›¸åº”é…ç½®æ—¥å¿—å™¨ï¼Œå…¶æ¥å—ä¸€ä¸ªæ—¥å¿—å™¨çš„åå­—ï¼Œä¸ä¼ åˆ™é»˜è®¤ä½¿ç”¨ <code>root</code> æ ¹æ—¥å¿—å™¨ï¼ŒåŒ <code>logging.getLogger(&#39;root&#39;)</code> æ•ˆæœä¸€è‡´ã€‚</p><p>å¦‚æœä¹‹é—´è¿è¡Œç¨‹åºä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ValueError: Unable to configure handler &#x27;file&#x27;</span><br></pre></td></tr></table></figure><p>é‚£æ˜¯å› ä¸ºä½ åœ¨æ—¥å¿—é…ç½®ä¸­è®¾ç½®äº†ä¸€ä¸ªæ–‡ä»¶å¤„ç†å™¨ <code>file</code> ï¼Œå…¶æ—¥å¿—æ–‡ä»¶å°†å­˜å‚¨åœ¨ <code>filename</code> é…ç½®é¡¹ä¸­ï¼Œåœ¨è¿™é‡Œæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./logs/test.log# ä»£è¡¨å­˜å‚¨åœ¨å½“å‰è·¯å¾„ä¸‹çš„ logsç›®å½•ä¸‹çš„ test.log æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><code>logging</code> æ¨¡å—ä¸ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºç›®å½•ï¼Œå› æ­¤åªéœ€åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª <code>logs</code> ç›®å½•å³å¯ã€‚</p><p><strong>æœ€åç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG main <span class="number">74</span> debug log test</span><br><span class="line">INFO main <span class="number">75</span> info log test</span><br><span class="line">WARNING main <span class="number">76</span> warning log test</span><br><span class="line">ERROR main <span class="number">77</span> error log test</span><br></pre></td></tr></table></figure><p>ä¸ç”¨è·Ÿ <code>root</code> æ ¹æ—¥å¿—å™¨ï¼Œä½¿ç”¨ <code>server</code> æ—¥å¿—å™¨ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line">log_dict = &#123;...åŒä¸Šæ–‡çœç•¥...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_logging</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    é…ç½®æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    logging.config.dictConfig(config=log_dict)</span><br><span class="line">    <span class="comment"># logger = logging.getLogger()</span></span><br><span class="line"></span><br><span class="line">    logger = logging.getLogger(<span class="string">&#x27;server&#x27;</span>)</span><br><span class="line">    logger.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line">    logger.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line">    logger.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br><span class="line">    logger.error(<span class="string">&#x27;error log test&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    setup_logging()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()    </span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</strong></p><p>æ§åˆ¶å°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG main <span class="number">75</span> debug log test</span><br><span class="line">INFO main <span class="number">76</span> info log test</span><br><span class="line">WARNING main <span class="number">77</span> warning log test</span><br><span class="line">ERROR main <span class="number">78</span> error log test</span><br></pre></td></tr></table></figure><p>æ—¥å¿—æ–‡ä»¶ <code>logs/test.log</code></p><p><a href="https://camo.githubusercontent.com/95cd1e913e93ec90f1d6666131732faed0d27008fc37f04e070b5c2bb074e98b/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f39663435353663633439633734353664623264373438363765626262393238657e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765"><img src="https://camo.githubusercontent.com/95cd1e913e93ec90f1d6666131732faed0d27008fc37f04e070b5c2bb074e98b/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f39663435353663633439633734353664623264373438363765626262393238657e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765" alt="æ–‡ä»¶æ—¥å¿—ä¿¡æ¯"></a></p><p>ç”±äº <code>server</code> æ—¥å¿—å™¨è®¾ç½®äº† <code>&#39;propagate&#39;: True</code>ï¼Œä¼š å°†æ—¥å¿—æ¶ˆæ¯ä¼ é€’ç»™çˆ¶çº§è®°å½•å™¨çš„å¤„ç†ç¨‹åºä¸­ï¼Œå› æ­¤ä¸ä»…æ§åˆ¶å°ä¼šæ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯ï¼Œæ–‡ä»¶ä¹Ÿä¼šè®°å½•ï¼Œä½†æ–‡ä»¶è®°å½•çš„ç­‰çº§è¢«è®¾ç½®æˆ <code>INFO</code> äº†ï¼Œå› æ­¤ <code>DEBUG</code> è°ƒè¯•æ—¥å¿—ä¿¡æ¯ï¼Œå°†ä¸ä¼šå‡ºç°åœ¨æ–‡ä»¶ä¸­ã€‚</p><h2 id="ä½¿ç”¨æ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨æ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨æ—¥å¿—é…ç½®æ–‡ä»¶"></a>ä½¿ç”¨æ—¥å¿—é…ç½®æ–‡ä»¶</h2><blockquote><p>è¿™é‡Œæˆ‘å°†é‡‡ç”¨ <code>yaml</code> æ ¼å¼çš„æ—¥å¿—é…ç½®æ–‡ä»¶ã€‚å…·ä½“é…ç½®å†…å®¹å’Œä¸Šæ–‡å¤§è‡´ä¸€æ ·ï¼Œå¤šäº†ä¸€ä¸ª <code>error_file_handler</code> é”™è¯¯æ—¥å¿—å¤„ç†å™¨ï¼Œç›®çš„å°±æ˜¯æŠŠ <strong>é”™è¯¯æ—¥å¿—å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿ä»¥åæ’æŸ¥é”™è¯¯</strong>ã€‚</p></blockquote><h3 id="åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶"></a>åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶</h3><p>åˆ›å»º <code>logging.yaml</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">disable_existing_loggers:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—ä¿¡æ¯æ ¼å¼åŒ–è¾“å‡ºé…ç½®</span></span><br><span class="line"><span class="attr">formatters:</span></span><br><span class="line">    <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">&#x27;%(levelname)s %(filename)s %(lineno)d %(message)s&#x27;</span></span><br><span class="line">    <span class="attr">verbose:</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">&#x27;%(levelname)s %(asctime)s -Loc %(filename)s -Row %(lineno)d -%(name)s %(message)s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—ä¿¡æ¯å¤„ç†å™¨é…ç½®</span></span><br><span class="line"><span class="attr">handlers:</span></span><br><span class="line">    <span class="attr">console:</span></span><br><span class="line">        <span class="attr">class:</span> <span class="string">logging.StreamHandler</span></span><br><span class="line">        <span class="attr">level:</span> <span class="string">DEBUG</span></span><br><span class="line">        <span class="attr">formatter:</span> <span class="string">simple</span></span><br><span class="line">        <span class="attr">stream:</span> <span class="string">ext://sys.stdout</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># é”™è¯¯æ—¥å¿—å•ç‹¬å¤„ç†</span></span><br><span class="line">    <span class="attr">error_file_handler:</span></span><br><span class="line">        <span class="attr">class:</span> <span class="string">logging.handlers.RotatingFileHandler</span></span><br><span class="line">        <span class="attr">level:</span> <span class="string">ERROR</span></span><br><span class="line">        <span class="attr">formatter:</span> <span class="string">verbose</span></span><br><span class="line">        <span class="attr">filename:</span> <span class="string">./logs/errors.log</span>   <span class="comment"># é”™è¯¯æ—¥å¿—æ–‡ä»¶å­˜å‚¨ä½ç½®</span></span><br><span class="line">        <span class="attr">maxBytes:</span> <span class="number">10485760</span>            <span class="comment"># æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ 10MB</span></span><br><span class="line">        <span class="attr">backupCount:</span> <span class="number">20</span>               <span class="comment"># å¦‚æœæ–‡ä»¶æ»¡äº†, è‡ªåŠ¨æ‰©å……, æœ€å¤šä¿ç•™ 20 ä¸ªæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">        <span class="attr">encoding:</span> <span class="string">utf8</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">server_file_handler:</span></span><br><span class="line">      <span class="attr">class:</span> <span class="string">logging.handlers.RotatingFileHandler</span></span><br><span class="line">      <span class="attr">level:</span> <span class="string">INFO</span>                     <span class="comment"># åªåœ¨æ–‡ä»¶ä¸­è®°å½•INFOçº§åˆ«åŠä»¥ä¸Šçš„log</span></span><br><span class="line">      <span class="attr">formatter:</span> <span class="string">verbose</span></span><br><span class="line">      <span class="attr">filename:</span> <span class="string">./logs/server.log</span>    <span class="comment"># é¡¹ç›®æ—¥å¿—æ–‡ä»¶, è®°å½•æ‰€æœ‰æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line">      <span class="attr">maxBytes:</span> <span class="number">10485760</span>             <span class="comment"># 10MB</span></span><br><span class="line">      <span class="attr">backupCount:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">encoding:</span> <span class="string">utf8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ—¥å¿—å™¨</span></span><br><span class="line"><span class="attr">root:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">DEBUG</span></span><br><span class="line">    <span class="attr">handlers:</span> [<span class="string">console</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—å™¨</span></span><br><span class="line"><span class="attr">loggers:</span></span><br><span class="line">    <span class="attr">server:</span></span><br><span class="line">        <span class="attr">level:</span> <span class="string">DEBUG</span>      <span class="comment"># å…è®¸æ‰“å° DEBUG åŠä»¥ä¸Šlog</span></span><br><span class="line">        <span class="attr">handlers:</span> [<span class="string">server_file_handler</span>, <span class="string">error_file_handler</span>]</span><br><span class="line">        <span class="attr">propagate:</span> <span class="literal">True</span>   <span class="comment"># è®¾ä¸º Falseåˆ™ç¦æ­¢å°†æ—¥å¿—æ¶ˆæ¯ä¼ é€’ç»™çˆ¶çº§è®°å½•å™¨çš„å¤„ç†ç¨‹åºä¸­</span></span><br></pre></td></tr></table></figure><h3 id="åŠ è½½æ—¥å¿—é…ç½®å‡½æ•°"><a href="#åŠ è½½æ—¥å¿—é…ç½®å‡½æ•°" class="headerlink" title="åŠ è½½æ—¥å¿—é…ç½®å‡½æ•°"></a>åŠ è½½æ—¥å¿—é…ç½®å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># log_test.py æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> coloredlogs</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡¹ç›®æ ¹è·¯å¾„</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—é…ç½®æ–‡ä»¶</span></span><br><span class="line">LOG_CONF_FILE = os.path.join(BASE_DIR, <span class="string">&#x27;logging.yaml&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_logging</span>(<span class="params">default_path=LOG_CONF_FILE, default_level=logging.DEBUG, env_key=<span class="string">&#x27;LOG_CFG&#x27;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    é…ç½®é¡¹ç›®æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="string">    :param default_path: æ—¥å¿—æ–‡ä»¶é»˜è®¤è·¯å¾„</span></span><br><span class="line"><span class="string">    :param default_level: æ—¥å¿—é»˜è®¤ç­‰çº§</span></span><br><span class="line"><span class="string">    :param env_key: ç³»ç»Ÿç¯å¢ƒå˜é‡å</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    path = default_path</span><br><span class="line"></span><br><span class="line">    value = os.getenv(env_key, <span class="literal">None</span>)  <span class="comment"># è·å–å¯¹åº”çš„ç¯å¢ƒå˜é‡å€¼</span></span><br><span class="line">    <span class="keyword">if</span> value <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        path = value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                logging_yaml = yaml.safe_load(f.read())</span><br><span class="line">                logging.config.dictConfig(logging_yaml)</span><br><span class="line">                coloredlogs.install(level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(e)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;æ— æ³•åŠ è½½æ—¥å¿—é…ç½®æ–‡ä»¶, è¯·æ£€æŸ¥æ—¥å¿—ç›®å½•æ˜¯å¦åˆ›å»º, ä½¿ç”¨é»˜è®¤çš„æ—¥å¿—é…ç½®&#x27;</span>)</span><br><span class="line">                logging.basicConfig(level=default_level)</span><br><span class="line">                coloredlogs.install(level=default_level)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.basicConfig(level=default_level)</span><br><span class="line">        coloredlogs.install(level=default_level)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;æ—¥å¿—é…ç½®æ–‡ä»¶ä¸å­˜åœ¨, ä½¿ç”¨é»˜è®¤çš„æ—¥å¿—é…ç½®&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“å¦‚ä¸‹</p><ul><li><code>yaml</code> æ˜¯ç”¨äºè¯»å– <code>yaml</code> æ ¼å¼çš„æ—¥å¿—é…ç½®æ–‡ä»¶</li><li><code>coloredlogs</code> ç”¨äºè®©æ—¥å¿—åœ¨æ§åˆ¶å°ä¸­æœ‰é¢œè‰²æ˜¾ç¤ºã€‚</li></ul><p>ç„¶åæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªè¦æ‰§è¡Œå®Œ <code>setup_logging()</code> æ—¥å¿—é…ç½®å‡½æ•°</p><p>å…¶ä»–æ¨¡å—ç›´æ¥ä½¿ç”¨ <code>logging.getLogger(&#39;server&#39;)</code> å°±å¯è·å–æˆ‘ä»¬é…ç½®å¥½çš„æ—¥å¿—å™¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># log_demo.py æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;server&#x27;</span>)  <span class="comment"># ç»´æŠ¤ä¸€ä¸ªå…¨å±€æ—¥å¿—å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">logger.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_test1</span>():</span><br><span class="line">    logger.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log_test2</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        a = <span class="number">1</span> / <span class="number">0</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogDemo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_test</span>():</span><br><span class="line">        logger.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># log_test.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    setup_logging()</span><br><span class="line"></span><br><span class="line">    logger = logging.getLogger(<span class="string">&#x27;server&#x27;</span>)</span><br><span class="line">    logger.debug(<span class="string">&#x27;debug log test&#x27;</span>)</span><br><span class="line">    logger.info(<span class="string">&#x27;info log test&#x27;</span>)</span><br><span class="line">    logger.warning(<span class="string">&#x27;warning log test&#x27;</span>)</span><br><span class="line">    logger.error(<span class="string">&#x27;error log test&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ—¥å¿—åœ¨å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨æ¼”ç¤º</span></span><br><span class="line">    <span class="keyword">import</span> log_demo</span><br><span class="line">    log_demo.log_test1()</span><br><span class="line">    log_demo.log_test2()</span><br><span class="line">    log_demo.LogDemo.log_test()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()    </span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—æ•ˆæœå±•ç¤º"><a href="#æ—¥å¿—æ•ˆæœå±•ç¤º" class="headerlink" title="æ—¥å¿—æ•ˆæœå±•ç¤º"></a>æ—¥å¿—æ•ˆæœå±•ç¤º</h3><p>è¿è¡Œ <code>log_test.py</code> ç»“æœå¦‚ä¸‹</p><p><strong>æ§åˆ¶å°ä¿¡æ¯</strong></p><p><a href="https://camo.githubusercontent.com/ae64f35e9b97106fedf6d0117d57b0638b9285b0bdcecb9f6195f17ce2531e72/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f31663436653538633739333734343830393863316433333766636163633932667e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765"><img src="https://camo.githubusercontent.com/ae64f35e9b97106fedf6d0117d57b0638b9285b0bdcecb9f6195f17ce2531e72/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f31663436653538633739333734343830393863316433333766636163633932667e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765" alt="å¸¦é¢œè‰²çš„æ—¥å¿—ä¿¡æ¯"></a></p><p><strong>å…¨éƒ¨æ—¥å¿—é…ç½®æ–‡ä»¶ä¿¡æ¯</strong></p><p><a href="https://camo.githubusercontent.com/70d45751490fe41de35c4d6ab10a29f47ff9b20e203dfe89a8463fea0f14636a/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f34653139326435656530333234633536383037346564336561626361656337337e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765"><img src="https://camo.githubusercontent.com/70d45751490fe41de35c4d6ab10a29f47ff9b20e203dfe89a8463fea0f14636a/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f34653139326435656530333234633536383037346564336561626361656337337e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765" alt="å…¨éƒ¨æ—¥å¿—æ–‡ä»¶ä¿¡æ¯"></a></p><p><strong>é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¿¡æ¯</strong></p><p><a href="https://camo.githubusercontent.com/0ea4df88d6c05538a2d09a4b23a69c0fde2919fd8c113a6458f40d627e25ad3c/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f61656337323036363236316134646430383534613162633934633935646133367e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765"><img src="https://camo.githubusercontent.com/0ea4df88d6c05538a2d09a4b23a69c0fde2919fd8c113a6458f40d627e25ad3c/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f61656337323036363236316134646430383534613162633934633935646133367e74706c762d6b3375316662706663702d77617465726d61726b2e696d616765" alt="é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¿¡æ¯"></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Python" scheme="https://nerkeler.github.io/categories/Python/"/>
    
    
    <category term="python" scheme="https://nerkeler.github.io/tags/python/"/>
    
    <category term="æ—¥å¿—" scheme="https://nerkeler.github.io/tags/%E6%97%A5%E5%BF%97/"/>
    
    <category term="è½¬è½½" scheme="https://nerkeler.github.io/tags/%E8%BD%AC%E8%BD%BD/"/>
    
  </entry>
  
  <entry>
    <title>åŠ¨æ¼«ä¹‹å®¶ã€Šé•–äººã€‹çˆ¬è™«</title>
    <link href="https://nerkeler.github.io/2023/03/31/%E5%8A%A8%E6%BC%AB%E4%B9%8B%E5%AE%B6%E3%80%8A%E9%95%96%E4%BA%BA%E3%80%8B%E7%88%AC%E8%99%AB/"/>
    <id>https://nerkeler.github.io/2023/03/31/%E5%8A%A8%E6%BC%AB%E4%B9%8B%E5%AE%B6%E3%80%8A%E9%95%96%E4%BA%BA%E3%80%8B%E7%88%AC%E8%99%AB/</id>
    <published>2023-03-31T02:21:00.000Z</published>
    <updated>2023-03-31T03:02:23.395Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>åˆå­¦pythonæ—¶å†™çš„çˆ¬è™«å°ç¨‹åºï¼Œçˆ¬å–åŠ¨æ¼«ä¹‹å®¶  ã€Šé•–äººã€‹æ¼«ç”»æ‰€æœ‰æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œå•çº¿ç¨‹çˆ¬å–ï¼Œé€Ÿåº¦ä¸€èˆ¬ï¼Œå¦‚æœç”¨å¤šçº¿ç¨‹ä¼šæœ‰å¾ˆå¤§é€Ÿåº¦æå‡ï¼ŒæŠ½å–çˆ¬è™«é€»è¾‘å¯çˆ¬å…¨ç«™æ¼«ç”»èµ„æº</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æ¼«ç”»æ€»é“¾æ¥æ–‡æœ¬</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_url</span>(<span class="params">url</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Safari/537.36&quot;</span>&#125;</span><br><span class="line">    res = requests.get(url, headers=headers)</span><br><span class="line">    res.encoding = res.apparent_encoding</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> res.text</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ¬å–æ‰€æœ‰ç« èŠ‚æ ‡é¢˜ã€é“¾æ¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params">html</span>):</span><br><span class="line">    title_list, href_list = [], []</span><br><span class="line"></span><br><span class="line">    soups = BeautifulSoup(html, <span class="string">&quot;lxml&quot;</span>)</span><br><span class="line">    soups = soups.find(attrs=&#123;<span class="string">&quot;class&quot;</span>: <span class="string">&quot;list_con_li autoHeight&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> soup <span class="keyword">in</span> soups.select(<span class="string">&quot;li a&quot;</span>):</span><br><span class="line">        title_list.insert(<span class="number">0</span>, soup[<span class="string">&#x27;title&#x27;</span>])</span><br><span class="line">        href_list.insert(<span class="number">0</span>, soup[<span class="string">&#x27;href&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> title_list, href_list  <span class="comment"># è¿”å›åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—å‹å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_number</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">float</span>(s)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ¬å–ç« èŠ‚å†…æ‰€æœ‰å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main_download</span>(<span class="params">name, url</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Referer&quot;</span>: url&#125;  <span class="comment"># æµè§ˆå™¨æ ‡è¯†</span></span><br><span class="line">    res = requests.get(url, headers=headers)</span><br><span class="line">    html = res.text  <span class="comment"># åŠ¨æ€é¡µé¢ï¼Œè¿”å›jsä»£ç </span></span><br><span class="line">    link = re.findall(<span class="string">&quot;function\(p,a,c,k,e,d\).*?split&quot;</span>, html)  <span class="comment"># åŒ¹é…å›¾ç‰‡ä»£ç ç‰‡æ®µ</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è§£ç jsï¼Œæ„é€ å›¾ç‰‡çœŸå®é“¾æ¥&quot;&quot;&quot;</span></span><br><span class="line">    first_number = link[<span class="number">0</span>].split(<span class="string">&quot;&#x27;.split&quot;</span>)</span><br><span class="line">    first_number = first_number[<span class="number">0</span>].split(<span class="string">&quot;||&quot;</span>)</span><br><span class="line">    links, second = [], []</span><br><span class="line">    first = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> first_number:</span><br><span class="line">        number = i.split(<span class="string">&quot;|&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> number:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> is_number(num) <span class="keyword">and</span> <span class="built_in">len</span>(num) == <span class="number">4</span>:</span><br><span class="line">                    first = num  <span class="comment"># é“¾æ¥å¼€å§‹å››ä½æ•°æ•°å­—ä¸²</span></span><br><span class="line">                <span class="keyword">elif</span> is_number(num) <span class="keyword">and</span> (<span class="built_in">len</span>(num) == <span class="number">5</span> <span class="keyword">or</span> <span class="built_in">len</span>(num) == <span class="number">6</span>):</span><br><span class="line">                    second.append(<span class="built_in">int</span>(num))  <span class="comment"># é“¾æ¥ä¸­é—´æ•°å­—ä¸²</span></span><br><span class="line">                <span class="keyword">elif</span> is_number(num) <span class="keyword">and</span> <span class="built_in">len</span>(num) &gt;= <span class="number">7</span>:</span><br><span class="line">                    links.append(num)  <span class="comment"># é“¾æ¥æœ«å°¾æ•°å­—ä¸²</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    links = <span class="built_in">sorted</span>(links)  <span class="comment"># ç”±å°åˆ°å¤§æ’åº</span></span><br><span class="line">    <span class="comment"># å¼€å§‹ä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> links:</span><br><span class="line">        imgs_link = <span class="string">f&#x27;https://images.dmzj.com/img/chapterpic/<span class="subst">&#123;first&#125;</span>/<span class="subst">&#123;second[<span class="number">0</span>]&#125;</span>/<span class="subst">&#123;i&#125;</span>.jpg&#x27;</span>  <span class="comment"># æ„é€ çœŸå®é“¾æ¥</span></span><br><span class="line"></span><br><span class="line">        response = requests.get(url=imgs_link, headers=headers)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;é•–äºº/<span class="subst">&#123;name&#125;</span>/<span class="subst">&#123;i&#125;</span>.jpg&quot;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(response.content)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span>: å·²ç»ä¸‹è½½å®Œæˆ&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»å¾ªç¯</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;é•–äºº&quot;</span>):  <span class="comment"># åˆ›å»ºæ€»æ–‡ä»¶å¤¹</span></span><br><span class="line">        os.mkdir(<span class="string">&quot;é•–äºº&quot;</span>)</span><br><span class="line">    url = <span class="string">&quot;https://www.dmzj.com/info/biaoren.html&quot;</span></span><br><span class="line">    html = get_url(url)</span><br><span class="line">    title_list, href_list = get_page(html)</span><br><span class="line">    <span class="comment">#processing = tqdm(range(0,len(title_list)))</span></span><br><span class="line">    <span class="keyword">for</span> name, url <span class="keyword">in</span> <span class="built_in">zip</span>(title_list, href_list,):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">f&quot;é•–äºº/<span class="subst">&#123;name&#125;</span>&quot;</span>):</span><br><span class="line">            os.mkdir(<span class="string">f&quot;é•–äºº/<span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        main_download(name, url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Python" scheme="https://nerkeler.github.io/categories/Python/"/>
    
    
    <category term="çˆ¬è™«" scheme="https://nerkeler.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>Javaæ—¥æœŸå°å·¥å…·ç±»</title>
    <link href="https://nerkeler.github.io/2023/03/30/Java%E6%97%A5%E6%9C%9F%E5%B0%8F%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <id>https://nerkeler.github.io/2023/03/30/Java%E6%97%A5%E6%9C%9F%E5%B0%8F%E5%B7%A5%E5%85%B7%E7%B1%BB/</id>
    <published>2023-03-30T08:04:00.000Z</published>
    <updated>2023-03-30T08:07:33.674Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Java-æ—¥æœŸæœˆä»½å¤„ç†å°å·¥å…·ç±»"><a href="#Java-æ—¥æœŸæœˆä»½å¤„ç†å°å·¥å…·ç±»" class="headerlink" title="Java æ—¥æœŸæœˆä»½å¤„ç†å°å·¥å…·ç±»"></a>Java æ—¥æœŸæœˆä»½å¤„ç†å°å·¥å…·ç±»</h2><p>å†<code>sql</code>çš„æœˆä»½å’Œæ—¥æœŸæŸ¥è¯¢ä¸­ï¼Œå¯èƒ½ä¼šéœ€è¦å°†æ—¥æœŸæˆ–è€…æœˆä»½ç›¸åº”æ¨è¿Ÿ&#x2F;æå‰ä¸€å¤©æˆ–ä¸€æ®µæ—¶é—´ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªé€»è¾‘æ”¾åœ¨<code>sql</code>ä¸­ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå…·ä½“è¿˜æ˜¯è¦çœ‹éœ€æ±‚æ˜¯å¦åˆé€‚ã€‚åˆ†äº«ä¸‰ä¸ªå°æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è®¡ç®—æœˆä»½å·®ã€æ—¥æœŸåŠ å‡ä¸€&#x2F;å¤šå¤©ã€æœˆä»½åŠ å‡ä¸€&#x2F;å¤šå¤©</p><h4 id="æœˆä»½å·®"><a href="#æœˆä»½å·®" class="headerlink" title="æœˆä»½å·®"></a>æœˆä»½å·®</h4><h6 id="è¾“å…¥å‚æ•°ï¼š"><a href="#è¾“å…¥å‚æ•°ï¼š" class="headerlink" title="è¾“å…¥å‚æ•°ï¼š"></a>è¾“å…¥å‚æ•°ï¼š</h6><ul><li><code>startMonth</code><ul><li>å­—ç¬¦ä¸²ï¼Œæ ¼å¼åº”è¯¥ä¸º<code>yyyy-MM</code>å¯¹åº”ä¸‹é¢<code>SimpleDateFormat(&quot;yyyy-MM&quot;);</code>å¯æ ¹æ®éœ€è¦æ›´æ”¹æ ¼å¼</li></ul></li><li><code>endMonth</code><ul><li>å­—ç¬¦ä¸²ï¼Œæ ¼å¼åº”è¯¥ä¸º<code>yyyy-MM</code>å¯¹åº”ä¸‹é¢<code>SimpleDateFormat(&quot;yyyy-MM&quot;);</code>å¯æ ¹æ®éœ€è¦æ›´æ”¹æ ¼å¼</li></ul></li></ul><h6 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h6><ul><li>diff<ul><li>æ•´å‹ï¼Œæœˆä»½å·®å€¼ï¼Œå¦‚3æœˆ-6æœˆ  è¿”å›3</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>  <span class="type">int</span> <span class="title function_">getMonthDiff</span><span class="params">(String startMonth, String endMonth)</span> &#123;</span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM&quot;</span>);</span><br><span class="line">    <span class="type">Date</span> <span class="variable">start</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">Date</span> <span class="variable">end</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        start = dateFormat.parse(startMonth);</span><br><span class="line">        end = dateFormat.parse(endMonth);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Calendar</span> <span class="variable">c1</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">    <span class="type">Calendar</span> <span class="variable">c2</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">    c1.setTime(start);</span><br><span class="line">    c2.setTime(end);</span><br><span class="line">    <span class="type">int</span> <span class="variable">year1</span> <span class="operator">=</span> c1.get(Calendar.YEAR);</span><br><span class="line">    <span class="type">int</span> <span class="variable">year2</span> <span class="operator">=</span> c2.get(Calendar.YEAR);</span><br><span class="line">    <span class="type">int</span> <span class="variable">month1</span> <span class="operator">=</span> c1.get(Calendar.MONTH);</span><br><span class="line">    <span class="type">int</span> <span class="variable">month2</span> <span class="operator">=</span> c2.get(Calendar.MONTH);</span><br><span class="line">    <span class="type">int</span> <span class="variable">day1</span> <span class="operator">=</span> c1.get(Calendar.DAY_OF_MONTH);</span><br><span class="line">    <span class="type">int</span> <span class="variable">day2</span> <span class="operator">=</span> c2.get(Calendar.DAY_OF_MONTH);</span><br><span class="line">    <span class="comment">// è·å–å¹´çš„å·®å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">yearInterval</span> <span class="operator">=</span> year1 - year2;</span><br><span class="line">    <span class="comment">// å¦‚æœ d1çš„ æœˆ-æ—¥ å°äº d2çš„ æœˆ-æ—¥ é‚£ä¹ˆ yearInterval-- è¿™æ ·å°±å¾—åˆ°äº†ç›¸å·®çš„å¹´æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (month1 &lt; month2 || month1 == month2 &amp;&amp; day1 &lt; day2) &#123;</span><br><span class="line">        yearInterval--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–æœˆæ•°å·®å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">monthInterval</span> <span class="operator">=</span> (month1 + <span class="number">12</span>) - month2;</span><br><span class="line">    <span class="keyword">if</span> (day1 &lt; day2) &#123;</span><br><span class="line">        monthInterval--;</span><br><span class="line">    &#125;</span><br><span class="line">    monthInterval %= <span class="number">12</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">monthsDiff</span> <span class="operator">=</span> Math.abs(yearInterval * <span class="number">12</span> + monthInterval);</span><br><span class="line">    <span class="keyword">return</span> monthsDiff;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ—¥æœŸåŠ å‡"><a href="#æ—¥æœŸåŠ å‡" class="headerlink" title="æ—¥æœŸåŠ å‡"></a>æ—¥æœŸåŠ å‡</h4><h6 id="è¾“å…¥å‚æ•°ï¼š-1"><a href="#è¾“å…¥å‚æ•°ï¼š-1" class="headerlink" title="è¾“å…¥å‚æ•°ï¼š"></a>è¾“å…¥å‚æ•°ï¼š</h6><ul><li><code>day</code><ul><li>å­—ç¬¦ä¸²ï¼Œæ—¥æœŸï¼Œæ ¼å¼åº”è¯¥ä¸º<code>yyyy-MM-dd</code>å¯¹åº”ä¸‹é¢<code>SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</code>å¯æ ¹æ®éœ€è¦æ›´æ”¹æ ¼å¼</li></ul></li><li><code>num</code><ul><li>æ•´å‹ï¼Œåç§»é‡   ä¸ºæ­£ æ—¶é—´å¾€ååŠ ï¼Œè´Ÿ  æ—¶é—´å¾€å‰æ¨</li></ul></li></ul><h6 id="è¿”å›å€¼-1"><a href="#è¿”å›å€¼-1" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h6><ul><li>date<ul><li>Stringï¼Œæ ¼å¼å¤„ç†åçš„æ—¶é—´ï¼Œå¦‚3æœˆ1-3æœˆ4  è¿”å›3</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">dayFormat</span><span class="params">(String day, <span class="type">int</span> num)</span> &#123;</span><br><span class="line">       <span class="type">DateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">       <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           date = dateFormat.parse(day);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">       c.setTime(date);</span><br><span class="line">       c.add(Calendar.DATE,num);</span><br><span class="line">       date = c.getTime();</span><br><span class="line">       <span class="keyword">return</span>  dateFormat.format(date);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="æœˆä»½åŠ å‡"><a href="#æœˆä»½åŠ å‡" class="headerlink" title="æœˆä»½åŠ å‡"></a>æœˆä»½åŠ å‡</h4><h6 id="è¾“å…¥å‚æ•°ï¼š-2"><a href="#è¾“å…¥å‚æ•°ï¼š-2" class="headerlink" title="è¾“å…¥å‚æ•°ï¼š"></a>è¾“å…¥å‚æ•°ï¼š</h6><ul><li><code>day</code><ul><li>å­—ç¬¦ä¸²ï¼Œæ—¥æœŸï¼Œæ ¼å¼åº”è¯¥ä¸º<code>yyyy-MM</code>å¯¹åº”ä¸‹é¢<code>SimpleDateFormat(&quot;yyyy-MM&quot;);</code>å¯æ ¹æ®éœ€è¦æ›´æ”¹æ ¼å¼</li></ul></li><li><code>num</code><ul><li>æ•´å‹ï¼Œåç§»é‡   ä¸ºæ­£ æœˆä»½å¾€ååŠ ï¼Œè´Ÿ  æ—¶é—´å¾€å‰æ¨</li></ul></li></ul><h6 id="è¿”å›å€¼-2"><a href="#è¿”å›å€¼-2" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h6><ul><li>date<ul><li>Stringï¼Œæ ¼å¼å¤„ç†åçš„æ—¶é—´ï¼Œå¦‚3æœˆ-6æœˆ  è¿”å›3</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">monthFormat</span><span class="params">(String month, <span class="type">int</span> num)</span> &#123;</span><br><span class="line">       <span class="type">DateFormat</span> <span class="variable">dateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM&quot;</span>);</span><br><span class="line">       <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           date = dateFormat.parse(month);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">       c.setTime(date);</span><br><span class="line">       c.add(Calendar.MONTH,num);</span><br><span class="line">       date = c.getTime();</span><br><span class="line">       <span class="keyword">return</span>  dateFormat.format(date);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>æœ€è¿‘å¤ªæ°´äº†ï¼Œå·²ç»æ‰˜æ›´ä¸€å‘¨äº†ï¼Œè¿™æ¬¡åˆæ˜¯æ°´äº†ä¸€ç¯‡ï¼Œäº‰å–ä¸‹æ¬¡å¥½å¥½å†™ä¸€ç¯‡</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
  </entry>
  
  <entry>
    <title>windowsæœ¬åœ°å¯†ç ç®¡ç†å™¨</title>
    <link href="https://nerkeler.github.io/2023/03/20/windows%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%E5%99%A8/"/>
    <id>https://nerkeler.github.io/2023/03/20/windows%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%E5%99%A8/</id>
    <published>2023-03-20T00:42:00.000Z</published>
    <updated>2023-05-04T08:25:45.935Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="æœ¬åœ°å¯†ç ç®¡ç†å™¨4-0"><a href="#æœ¬åœ°å¯†ç ç®¡ç†å™¨4-0" class="headerlink" title="æœ¬åœ°å¯†ç ç®¡ç†å™¨4.0"></a>æœ¬åœ°å¯†ç ç®¡ç†å™¨4.0</h2><p><code>github</code>åœ°å€ï¼š<a href="https://github.com/nerkeler/account.git">https://github.com/nerkeler/account.git</a></p><p>è“å¥äº‘ï¼š<a href="https://wwtf.lanzoul.com/b01ereqoh">https://wwtf.lanzoul.com/b01ereqoh</a> å¯†ç :9920<br>æ–‡å”å”ï¼š<a href="https://t.wss.ink/f/b4jc2yer65e">https://t.wss.ink/f/b4jc2yer65e</a> </p><h4 id="é‡è¦æç¤º"><a href="#é‡è¦æç¤º" class="headerlink" title="é‡è¦æç¤º"></a>é‡è¦æç¤º</h4><p>ç¨‹åºé»˜è®¤å¯†ç ï¼š<strong>password</strong></p><p>å¯†é’¥ä½ç½®ï¼š<code>./resource/aesKey   </code>     å»ºè®®å¦å­˜ä¸€ä»½ä»¥ä½œå¤‡ä»½</p><h4 id="ä¿®æ”¹ç‚¹"><a href="#ä¿®æ”¹ç‚¹" class="headerlink" title="ä¿®æ”¹ç‚¹"></a>ä¿®æ”¹ç‚¹</h4><ul><li>æœ¬åœ°å¯†ç å¯¼å‡ºä¸­æ–‡ä¹±ç ä¿®å¤</li><li>å¼•å…¥æ—¥å¿—è®°å½•</li><li>ä¼˜åŒ–edge&#x2F;chrome æµè§ˆå™¨å¯¼å‡ºé€‚é…ç®¡ç†</li></ul><p><em>PS: ç¨‹åºç¬¬ä¸€æ¬¡æ‰“å¼€å…³äºé¡µé¢æ˜¾ç¤ºä¸å®Œæ•´ï¼Œå¦‚æœé‡åˆ°ï¼Œè¯·å…³é—­åå†æ‰“å¼€</em></p><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>é—²æ¥æ— äº‹ï¼Œçœ‹åˆ°è‡ªå·±æœ‰å¾ˆå¤šç½‘ç«™çš„è´¦æˆ·å¯†ç ï¼Œæœ‰äº›ç½‘ç«™å¯èƒ½æ‰“å¼€ä¸€ä¸¤æ¬¡ä¹Ÿå°±å¿˜è®°äº†ï¼Œä¸‹ä¸€æ¬¡åœ¨è¾“å…¥è´¦æˆ·å¯†ç å°±æƒ³ä¸èµ·æ¥ï¼Œè¿™æ ·å¾ˆå®¹æ˜“ä¸¢å¤±è´¦å·ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä¿å­˜åœ¨æµè§ˆå™¨è‡ªå¸¦çš„å¯†ç ç®¡ç†å™¨ä¸­ï¼‰ï¼Œè™½ç„¶å¸‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šä¼˜ç§€çš„è´¦æˆ·å¯†ç ç®¡ç†è½¯ä»¶ï¼Œä¸€æ¥æ˜¯è¿™äº›ç¨‹åºå¤§éƒ½æ˜¯è”ç½‘è¿è¡Œï¼Œåœ¨æä¾›äº†å¤šç«¯å­˜æ¡£çš„åŒæ—¶ï¼Œä¹Ÿå°†å¯†ç å’Œè´¦æˆ·åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œè™½ç„¶å®é™…ä¸Šå¾ˆå®‰å…¨ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ç»å¯¹çš„å®‰å…¨ï¼ŒäºŒæ¥ï¼Œéƒ¨åˆ†ä¼˜ç§€çš„ç¨‹åºéƒ½æ˜¯è®¢é˜…ä»˜è´¹æœºåˆ¶ï¼Œå°±æƒ³ç€è‡ªå·±å¹²è„†å†™ä¸ªç®€å•çš„æœ¬åœ°çš„è´¦æˆ·ç®¡ç†å™¨ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸ªå°ç¨‹åº</p><p>å…ˆè¯´ä¸€ä¸‹ä¼˜ç‚¹å§ï¼ŒåŒå¸‚é¢ä¸Šçš„ç¨‹åºæ¯”è¾ƒï¼Œä¸€ä¸ªæœ€çªå‡ºçš„ä¼˜ç‚¹å°±æ˜¯å®Œå…¨è¿è¡Œåœ¨æœ¬åœ°ï¼Œè´¦æˆ·å¯†ç ç»è¿‡<code>AES</code>åŠ å¯†ï¼Œåœ¨é€»è¾‘ä¸Šå¯ä»¥è¯´æ˜¯éå¸¸å®‰å…¨çš„ï¼Œå› ä¸ºä½ çš„å¯†ç ä¸ä¼šæš´æ¼åœ¨ç½‘ç»œä¸Šï¼Œæœ¬åœ°ä¹Ÿè¿›è¡Œäº†åŠ å¯†å¤„ç†ã€‚</p><p>å½“ç„¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¸€æ˜¯åŠŸèƒ½ä¸æ˜¯ååˆ†å®Œå–„ï¼ŒäºŒæ˜¯è¯¥ç¨‹åºä½¿ç”¨<code>tkinter</code> æ¨¡å—ç¼–å†™ï¼Œåœ¨å¸ƒå±€å’Œç•Œé¢å±•ç¤ºä¸Šéƒ½æ˜¾å¾—ååˆ†ç®€é™‹ï¼Œå¥½åœ¨åŸºæœ¬çš„åŠŸèƒ½æ²¡æœ‰é—®é¢˜</p><h4 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h4><ol><li>ä¸‹è½½è§£å‹ç¨‹åºæ–‡ä»¶</li><li>è¿è¡Œ<code>account.exe</code>æ–‡ä»¶</li><li>ç‚¹å‡»<code>æ–°å»ºè´¦å·</code>æŒ‰é’®æ·»åŠ æ–°çš„è´¦å·å¯†ç ä¿¡æ¯</li><li>åŒå‡»è¡¨æ ¼ä¸­çš„æ•°æ®è¿›è¡Œç¼–è¾‘æˆ–åˆ é™¤</li><li>ç‚¹å‡»<code>å¯¼å‡º</code>æŒ‰é’®éªŒè¯å¯†é’¥å¯†ç åå°†æ•°æ®å¯¼å‡ºä¸ºCSVæ ¼å¼æ–‡ä»¶</li><li>ç‚¹å‡»<code>å¯¼å…¥</code>æŒ‰é’®é€‰æ‹©CSVæ–‡ä»¶è¿›è¡Œå¯¼å…¥æ•°æ®</li><li>å¯æŒ‰éœ€æ±‚å¯¼å…¥å¹¶ç®¡ç†<code>Chrome/Edgeå¯†ç æœ¬</code>æµè§ˆå™¨å¯†ç </li></ol><h4 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h4><p><img src="https://pic.imgdb.cn/item/6415d3c2a682492fcc12ae16.png"></p><p>ç¬¬ä¸€æ¬¡ç™»é™†å¯†é’¥å¼¹å‡ºæ¡†è¢«å…³é—­æ—¶ï¼Œå°±è¿›å…¥äº†ç¨‹åºçš„ç™»å½•ç•Œé¢ï¼Œé»˜è®¤è´¦æˆ·åadmin ä¸å¯ä¿®æ”¹ï¼Œé»˜è®¤å¯†ç ä¸º ï¼š**<code>password</code>**ï¼Œå»ºè®®ç¬¬ä¸€æ¬¡ç™»é™†æ—¶ä¿®æ”¹å¯†ç </p><p><em><strong>PS: å¤šç”¨æˆ·åŠŸèƒ½å°šæœªå¼€å‘ï¼Œå› æ­¤è´¦æˆ·åé”å®šä¸å¯ç¼–è¾‘</strong></em></p><h4 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h4><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p><img src="https://pic.imgdb.cn/item/642fd3b4a682492fcc59f817.png"></p><p>åœ¨ç™»é™†ç•Œé¢ ç‚¹å‡»   <strong>æ”¹å¯†</strong>  è¿›å…¥ä¿®æ”¹å¯†ç ç•Œé¢ï¼Œæ–°å¯†ç è¦æ±‚å­—ç¬¦æ•°å¤§äº8ä½ï¼Œç‚¹å‡»<strong>ç¡®å®š</strong> æŒ‰é’®å³å¯è¿›è¡Œå¯†ç ä¿®æ”¹ï¼Œä¿®æ”¹æˆåŠŸåä¼šæç¤ºä¿®æ”¹æˆåŠŸï¼Œé‡æ–°ç™»é™†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://pic.imgdb.cn/item/6415d527a682492fcc1573f4.png"></p><h4 id="chrome-x2F-edgeæµè§ˆå™¨å¯†ç å¯¼å…¥ç®¡ç†"><a href="#chrome-x2F-edgeæµè§ˆå™¨å¯†ç å¯¼å…¥ç®¡ç†" class="headerlink" title="chrome&#x2F;edgeæµè§ˆå™¨å¯†ç å¯¼å…¥ç®¡ç†"></a>chrome&#x2F;edgeæµè§ˆå™¨å¯†ç å¯¼å…¥ç®¡ç†</h4><p>ä¾æ¬¡ç‚¹å‡»ï¼š</p><ol><li><p>è®¾ç½®</p></li><li><p>è‡ªåŠ¨å¡«å……</p></li><li><p>å¯†ç ç®¡ç†å™¨</p><p><strong>æ‰¾åˆ°å¦‚å›¾çº¢æ¡†å†…å®¹ï¼ŒéªŒè¯è®¾å¤‡å¯†ç åå¯¼å‡ºchromeå¯†ç æœ¬csvæ–‡ä»¶åˆ°æœ¬åœ°</strong></p><p><img src="https://pic2.imgdb.cn/item/645366670d2dde5777904d8e.png"></p></li></ol><p>å›åˆ°ç¨‹åºåç‚¹å‡»å¯¼å…¥</p><p>å¯¹åº”å¯¼å…¥æºåé€‰æ‹©å¯¼å…¥æ–‡ä»¶å³å¯å¯¼å…¥æ•°æ®ï¼Œ<strong>å•çº¿ç¨‹å¯¼å…¥è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…</strong>ï¼Œå¿«æ·é”®æš‚æœªé€‚é…</p><p><img src="https://pic2.imgdb.cn/item/645366ec0d2dde5777911e80.png"></p><h4 id="ä¸»é¡µé¢"><a href="#ä¸»é¡µé¢" class="headerlink" title="ä¸»é¡µé¢"></a>ä¸»é¡µé¢</h4><p>ä¸»ç•Œé¢ç•¥ä½œä¿®æ”¹</p><p><img src="https://pic2.imgdb.cn/item/645365530d2dde57778ec79f.png"></p><p>ä¸»ç•Œé¢å…±åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼š</p><ul><li>ä¸€ä¸ªæ˜¯ä¸Šæ–¹çš„åŠŸèƒ½åŒºï¼Œæä¾›äº†æŸ¥è¯¢ã€æŸ¥çœ‹ã€æ–°å¢ã€åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰åŠŸèƒ½ï¼Œ</li><li>ä¸€ä¸ªæ˜¯ä¸‹æ–¹çš„è´¦æˆ·å±•ç¤ºåŒºåŸŸï¼Œé»˜è®¤æ‰“å¼€æ—¶æŒ‰ç…§åˆ—è¡¨å±•ç¤ºæ‰€æœ‰è´¦æˆ·ä¿¡æ¯</li></ul><h5 id="ç›¸å…³æ“ä½œ"><a href="#ç›¸å…³æ“ä½œ" class="headerlink" title="ç›¸å…³æ“ä½œ"></a>ç›¸å…³æ“ä½œ</h5><ul><li><p>ä¸‹æ‹‰æ¡†æä¾›äº†  è´¦æˆ·ç¼–å·ï¼ˆå¯¹åº”ä¸‹æ–¹åºå·åˆ—ï¼‰ã€ç½‘ç«™åç§°ï¼ˆå¯¹åº”ä¸‹æ–¹ç½‘ç«™åˆ—ï¼‰ã€ç½‘ç«™ç½‘å€ï¼ˆå¯¹åº”ä¸‹æ–¹ç½‘å€åˆ—ï¼‰æŸ¥è¯¢æ¡ä»¶è½¬æ¢</p></li><li><p>æ–‡æœ¬æ¡†æ¥å—  ä¸‹æ‹‰æ¡†çš„å¯¹åº”å­—æ®µï¼Œ<strong>ä¸ºç©ºæ—¶é»˜è®¤æŸ¥è¯¢æ‰€æœ‰</strong></p></li><li><p>ç‚¹å‡»æŸä¸€é¡¹è´¦æˆ·æ—¶ï¼Œ<strong>ç‚¹å‡»æŸ¥çœ‹&#x2F;åŒå‡»å½“å‰é¡¹</strong>  å¯è¿›å…¥å½“å‰è´¦æˆ·æŸ¥çœ‹ç•Œé¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå½“å‰é¡µé¢ä¹Ÿå¯ä»¥æ›´æ–°è´¦æˆ·ä¿¡æ¯</p></li><li><p>æ–°å¢æŒ‰é’®ä¼šå¼¹å‡ºæ–°å¢ç•Œé¢ï¼ŒæŒ‰ç…§è§„å®šæŒ‡ç¤ºå¡«å†™å­—æ®µå³å¯æ–°å¢ä¸€æ¡è®°å½•</p></li><li><p>åˆ é™¤æŒ‰é’®  åœ¨ç‚¹å‡»æŸä¸€é¡¹è´¦æˆ·æ—¶ï¼Œç‚¹å‡»åˆ é™¤ï¼Œå³å¯åˆ é™¤å½“å‰è®°å½•ï¼ˆè½¯åˆ é™¤ï¼Œæ›´æ”¹äº†å½“å‰çš„çŠ¶æ€ï¼‰</p></li></ul><h4 id="éšæœºå¯†ç "><a href="#éšæœºå¯†ç " class="headerlink" title="éšæœºå¯†ç "></a>éšæœºå¯†ç </h4><p>å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ç”Ÿæˆç›¸åº”çš„å¯†ç è§„åˆ™ï¼Œ<code>ABC</code>&#x2F;<code>123</code>&#x2F;<code>abc</code>&#x2F;<code>#$&amp;</code></p><p><em>æ³¨ï¼šåœ¨å¯†ç é•¿åº¦&gt;å­—ç¬¦ç±»å‹æ•°çš„æ—¶å€™ä¼šè¡¥æ•°å­—  å¦‚  å¯†ç é•¿åº¦é€‰30  è§„åˆ™é€‰<code>abc</code>  ä¼šåœ¨26ä¸ªå­—ç¬¦åå†è¡¥å‡ ä¸ªæ•°å­—æ„æˆéšæœºå­—ç¬¦</em></p><p><img src="https://pic.imgdb.cn/item/6424f580a682492fcc9f685c.png"></p><h4 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h4><p>èŠèƒœäºæ— ï¼Œç®€å•è¯´ä¸€ä¸‹ï¼Œè¯¦ç»†è§ç¨‹åºé¡µé¢</p><h4 id="è¡¥å……è¯´æ˜"><a href="#è¡¥å……è¯´æ˜" class="headerlink" title="è¡¥å……è¯´æ˜"></a>è¡¥å……è¯´æ˜</h4><p>å¿˜è®°ç™»é™†è´¦æˆ·å¯†ç æ—¶ï¼Œå¯å°†<code>account.db</code> æ–‡ä»¶ä½¿ç”¨æ•°æ®åº“å¯è§†åŒ–å·¥å…·æ‰“å¼€ï¼Œå–å‡ºå½“å‰è´¦æˆ·çš„ç›¸å…³ä¿¡æ¯å’Œå¯†ç ï¼Œæ ¹æ®å¯†é’¥å’ŒåŠ å¯†é€»è¾‘è§£å¯†å½“å‰è´¦æˆ·çš„å¯†ç æ˜æ–‡</p><p>åŠ å¯†é€»è¾‘å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_password</span>(<span class="params">password</span>):</span><br><span class="line">key = yourkey<span class="comment"># key è¡¨ç¤ºä½ çš„å¯†é’¥ </span></span><br><span class="line">    </span><br><span class="line">slot = <span class="string">&quot;nerkeler&quot;</span></span><br><span class="line">    encode = key + slot</span><br><span class="line">    myKey = hashlib.md5(encode.encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest().__str__()[:<span class="number">24</span>]</span><br><span class="line">    <span class="keyword">return</span> aes_encode(myKey, password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decode</span>(<span class="params">key, ciphertext</span>):</span><br><span class="line">    <span class="comment"># å°†å¯†é’¥å¡«å……åˆ°16çš„å€æ•°</span></span><br><span class="line">    key = key + (<span class="number">16</span> - <span class="built_in">len</span>(key) % <span class="number">16</span>) * <span class="string">&#x27;\0&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºAESå¯†ç å™¨å¯¹è±¡</span></span><br><span class="line">    cipher = AES.new(key.encode(), AES.MODE_ECB)</span><br><span class="line">    <span class="comment"># è§£ç Base64ç¼–ç çš„å¯†æ–‡</span></span><br><span class="line">    ciphertext = base64.b64decode(ciphertext)</span><br><span class="line">    <span class="comment"># è§£å¯†</span></span><br><span class="line">    plaintext = cipher.decrypt(ciphertext)</span><br><span class="line">    <span class="comment"># å»é™¤å¡«å……å­—ç¬¦</span></span><br><span class="line">    plaintext = plaintext.rstrip(<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> plaintext.decode()</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>åæœŸæ‰“ç®—ä½¿ç”¨<code>pyside6</code>é‡å†™ä¸€ç‰ˆï¼Œ<code>Tkinter</code>ç‰ˆæœ¬ä¸å‡†å¤‡å¤§æ”¹åŠ¨äº†ï¼Œå¦‚æœæœ‰ä½¿ç”¨å»ºè®®å’Œbug,æ¬¢è¿æ‰“æ‰°ï¼Œè¯¦è§å…³äºé¡µ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Python" scheme="https://nerkeler.github.io/categories/Python/"/>
    
    
    <category term="python" scheme="https://nerkeler.github.io/tags/python/"/>
    
    <category term="tkinter" scheme="https://nerkeler.github.io/tags/tkinter/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</title>
    <link href="https://nerkeler.github.io/2023/03/10/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%92%8C%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"/>
    <id>https://nerkeler.github.io/2023/03/10/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%92%8C%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/</id>
    <published>2023-03-10T01:52:00.000Z</published>
    <updated>2023-03-30T08:10:02.763Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="å¯¹ç§°åŠ å¯†AESå’Œéå¯¹ç§°åŠ å¯†RSA"><a href="#å¯¹ç§°åŠ å¯†AESå’Œéå¯¹ç§°åŠ å¯†RSA" class="headerlink" title="å¯¹ç§°åŠ å¯†AESå’Œéå¯¹ç§°åŠ å¯†RSA"></a>å¯¹ç§°åŠ å¯†AESå’Œéå¯¹ç§°åŠ å¯†RSA</h2><h3 id="AESï¼ˆ-Advanced-Encryption-Standard-ï¼‰"><a href="#AESï¼ˆ-Advanced-Encryption-Standard-ï¼‰" class="headerlink" title="AESï¼ˆ Advanced Encryption Standard ï¼‰"></a>AESï¼ˆ Advanced Encryption Standard ï¼‰</h3><p><em>å¯¹ç§°åŠ å¯†ç®—æ³•</em>ï¼Œ<em>åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥</em></p><p>AESä¸ºåˆ†ç»„åŠ å¯†æ³•ï¼ŒæŠŠæ˜æ–‡åˆ†æˆä¸€ç»„ä¸€ç»„çš„ï¼Œæ¯ç»„é•¿åº¦ç›¸ç­‰ï¼Œæ¯æ¬¡åŠ å¯†ä¸€ç»„æ•°æ®ï¼Œç›´åˆ°åŠ å¯†å®Œæ•´ä¸ªæ˜æ–‡ï¼Œåœ¨AESæ ‡å‡†è§„èŒƒä¸­ï¼Œåˆ†ç»„é•¿åº¦åªèƒ½æ˜¯128ä½ï¼ŒAESæ˜¯æŒ‰ç…§å­—èŠ‚è¿›è¡ŒåŠ å¯†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªåˆ†ç»„ä¸º16ä¸ªå­—èŠ‚ï¼ˆæ¯ä¸ªå­—èŠ‚8ä½ï¼‰ã€‚å¯†é’¥çš„é•¿åº¦å¯ä»¥ä½¿ç”¨128ä½ã€192ä½æˆ–256ä½ã€‚è¿™å¯¼è‡´å¯†é’¥é•¿åº¦ä¸åŒï¼Œæ¨èåŠ å¯†çš„è½®æ•°ä¹Ÿä¸åŒã€‚</p><p><strong>å› ä¸ºæ˜æ–‡å’Œå¯†é’¥å¿…é¡»æ˜¯128ä½ï¼ˆå¯†é’¥å¯ä»¥æ˜¯192&#x2F;256 ä½ï¼‰ï¼Œæ‰€ä»¥éœ€è¦å°†åˆ†ç»„æ˜æ–‡å’Œå¯†é’¥è¿›è¡Œè¡¥ä½</strong></p><h4 id="pythonä»£ç å®ç°"><a href="#pythonä»£ç å®ç°" class="headerlink" title="pythonä»£ç å®ç°"></a>pythonä»£ç å®ç°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å¯†  ECBæ¨¡å¼  16ä»£è¡¨16å­—èŠ‚ä¹Ÿå°±æ˜¯128ä½</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encode</span>(<span class="params">key, password</span>):</span><br><span class="line">    <span class="comment"># å°†å¯†é’¥å¡«å……åˆ°16çš„å€æ•°</span></span><br><span class="line">    key = key + (<span class="number">16</span> - <span class="built_in">len</span>(key) % <span class="number">16</span>) * <span class="string">&#x27;\0&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºAESå¯†ç å™¨å¯¹è±¡</span></span><br><span class="line">    cipher = AES.new(key.encode(), AES.MODE_ECB)</span><br><span class="line">    <span class="comment"># å°†æ˜æ–‡å¡«å……åˆ°16çš„å€æ•°</span></span><br><span class="line">    password = password + (<span class="number">16</span> - <span class="built_in">len</span>(password) % <span class="number">16</span>) * <span class="string">&#x27;\0&#x27;</span></span><br><span class="line">    <span class="comment"># åŠ å¯†</span></span><br><span class="line">    ciphertext = cipher.encrypt(password.encode())</span><br><span class="line">    <span class="comment"># å°†å¯†æ–‡è¿›è¡ŒBase64ç¼–ç </span></span><br><span class="line">    ciphertext = base64.b64encode(ciphertext)</span><br><span class="line">    <span class="keyword">return</span> ciphertext.decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å¯†</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decode</span>(<span class="params">key, ciphertext</span>):</span><br><span class="line">    <span class="comment"># å°†å¯†é’¥å¡«å……åˆ°16çš„å€æ•°</span></span><br><span class="line">    key = key + (<span class="number">16</span> - <span class="built_in">len</span>(key) % <span class="number">16</span>) * <span class="string">&#x27;\0&#x27;</span></span><br><span class="line">    <span class="comment"># åˆ›å»ºAESå¯†ç å™¨å¯¹è±¡</span></span><br><span class="line">    cipher = AES.new(key.encode(), AES.MODE_ECB)</span><br><span class="line">    <span class="comment"># è§£ç Base64ç¼–ç çš„å¯†æ–‡</span></span><br><span class="line">    ciphertext = base64.b64decode(ciphertext)</span><br><span class="line">    <span class="comment"># è§£å¯†</span></span><br><span class="line">    plaintext = cipher.decrypt(ciphertext)</span><br><span class="line">    <span class="comment"># å»é™¤å¡«å……å­—ç¬¦</span></span><br><span class="line">    plaintext = plaintext.rstrip(<span class="string">b&#x27;\0&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> plaintext.decode()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>RSAæ˜¯ä¸€ç§å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå®ƒå¯ä»¥ç”¨äºä¿æŠ¤æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚å®ƒåŸºäºä¸¤ä¸ªå¤§è´¨æ•°çš„ä¹˜ç§¯éš¾ä»¥è¢«åˆ†è§£çš„æ•°å­¦é—®é¢˜ï¼Œé€šè¿‡è¿™ç§é—®é¢˜çš„è§£å†³æ¥ä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€‚</p><p>RSAç®—æ³•åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ï¼šå¯†é’¥ç”Ÿæˆã€åŠ å¯†å’Œè§£å¯†ã€‚åœ¨å¯†é’¥ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆé€‰æ‹©ä¸¤ä¸ªå¤§è´¨æ•°på’Œqï¼Œè®¡ç®—å®ƒä»¬çš„ä¹˜ç§¯n&#x3D;p<em>qï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªæ•´æ•°eï¼Œä½¿å¾—eå’Œ(p-1)</em>(q-1)äº’è´¨ã€‚ç„¶åè®¡ç®—dï¼Œä½¿å¾—(d<em>e) mod((p-1)</em>(q-1))&#x3D;1ã€‚å…¬é’¥æ˜¯(e,n)ï¼Œç§é’¥æ˜¯(d,n)ã€‚</p><p>åœ¨åŠ å¯†è¿‡ç¨‹ä¸­ï¼Œè¦å‘é€çš„æ¶ˆæ¯mè¢«è½¬æ¢ä¸ºæ•´æ•°Mï¼Œå¹¶ç”¨å…¬é’¥(e,n)è¿›è¡ŒåŠ å¯†ï¼Œè®¡ç®—C&#x3D;M^e mod nã€‚</p><p>åœ¨è§£å¯†è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ç§é’¥(d,n)å¯¹åŠ å¯†çš„æ¶ˆæ¯è¿›è¡Œè§£å¯†ï¼Œè®¡ç®—M&#x3D;C^d mod nã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key_pair</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç”ŸæˆRSAå¯†é’¥å¯¹&quot;&quot;&quot;</span></span><br><span class="line">    key_pair = RSA.generate(<span class="number">2048</span>)</span><br><span class="line">    private_key = key_pair.export_key()</span><br><span class="line">    public_key = key_pair.publickey().export_key()</span><br><span class="line">    <span class="keyword">return</span> private_key, public_key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">public_key, plaintext</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;RSAåŠ å¯†&quot;&quot;&quot;</span></span><br><span class="line">    key = RSA.import_key(public_key)</span><br><span class="line">    cipher = PKCS1_v1_5.new(key)</span><br><span class="line">    ciphertext = cipher.encrypt(plaintext.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(ciphertext).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">private_key, ciphertext</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;RSAè§£å¯†&quot;&quot;&quot;</span></span><br><span class="line">    key = RSA.import_key(private_key)</span><br><span class="line">    cipher = PKCS1_v1_5.new(key)</span><br><span class="line">    ciphertext = base64.b64decode(ciphertext.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    plaintext = cipher.decrypt(ciphertext, <span class="literal">None</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># ç”ŸæˆRSAå¯†é’¥å¯¹</span></span><br><span class="line">    private_key, public_key = generate_key_pair()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># unicode è½¬str</span></span><br><span class="line">    <span class="built_in">print</span>(private_key.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(public_key.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="comment"># åŠ å¯†æ¶ˆæ¯</span></span><br><span class="line">    message = <span class="string">&#x27;Hello, world!&#x27;</span></span><br><span class="line">    ciphertext = encrypt(public_key, message)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;åŠ å¯†åçš„æ¶ˆæ¯ï¼š&#x27;</span>, ciphertext)</span><br><span class="line">    <span class="comment"># è§£å¯†æ¶ˆæ¯</span></span><br><span class="line">    plaintext = decrypt(private_key, ciphertext)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;è§£å¯†åçš„æ¶ˆæ¯ï¼š&#x27;</span>, plaintext)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‘˜è¦ç®—æ³•ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•ä¸å¯¹ç§°åŠ å¯†ç®—æ³•-å®‰å…¨æ€§-æ¯”è¾ƒ"><a href="#æ‘˜è¦ç®—æ³•ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•ä¸å¯¹ç§°åŠ å¯†ç®—æ³•-å®‰å…¨æ€§-æ¯”è¾ƒ" class="headerlink" title="æ‘˜è¦ç®—æ³•ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•ä¸å¯¹ç§°åŠ å¯†ç®—æ³• å®‰å…¨æ€§ æ¯”è¾ƒ"></a>æ‘˜è¦ç®—æ³•ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•ä¸å¯¹ç§°åŠ å¯†ç®—æ³• å®‰å…¨æ€§ æ¯”è¾ƒ</h3><p><em>å¼•ç”¨åšå®¢  <a href="https://blog.betamao.me/posts/2021/24/pkcs-v1_5_misuse/">https://blog.betamao.me/posts/2021/24/pkcs-v1_5_misuse/</a></em></p><ul><li><strong>æ‘˜è¦ç®—æ³•</strong>é€šè¿‡å•å‘é™·é—¨å‡½æ•°å°†ä»»æ„é•¿åº¦æ˜ å°„åˆ°å›ºå®šé•¿åº¦ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œå†åŠ ä¸Šå®ƒçš„æŠ—ç¢°æ’æ€§è®©å®ƒæˆä¸ºæ ‡è¯†æ•°æ®çš„å¥½æ–¹æ³•ï¼Œè¿™æ–¹é¢å¦‚æœç”¨çš„ç®—æ³•æ˜¯è€å¤è‘£å°±å¯èƒ½å—ç¢°æ’å’Œ<a href="http://blog.chinaunix.net/uid-27070210-id-3255947.html">é•¿åº¦æ‰©å±•æ”»å‡»</a>çš„å½±å“ã€‚</li><li><strong>å¯¹ç§°åŠ å¯†ç®—æ³•</strong>ä½¿ç”¨çš„åŠ è§£å¯†é’¥ç›¸åŒï¼Œå¯å†åˆ†ä¸ºæµå¯†ç ä¸åˆ†ç»„å¯†ç ï¼Œæµå¯†ç å°†å®ƒçš„å¯†é’¥ä½œä¸ºéšæœºæ•°ç§å­é€šè¿‡ä¼ªéšæœºç”Ÿæˆå‡½æ•°æºæºä¸æ–­åœ°ç”Ÿæˆéšæœºæ•°ï¼Œæ˜æ–‡ä¸ä¹‹å¼‚æˆ–å°±å¾—åˆ°äº†å¯†æ–‡ï¼Œç”±äºå¼‚æˆ–è¿ç®—çš„ç‰¹æ€§å¯†æ–‡ä¸ä¹‹å¼‚æˆ–ä¹Ÿå°±æ¢å¤äº†æ˜æ–‡ï¼Œå› æ­¤å®ƒçš„åŠ è§£å¯†ç®—æ³•æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å®ƒé’ˆå¯¹çš„ä»»æ„é•¿åº¦çš„æ•°æ®ã€‚åˆ†ç»„å¯†ç çš„å¯†é’¥å’ŒåŠ å¯†é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå®ƒä¼šå¯¹åŠ å¯†å¯†é’¥è¿›è¡Œä¸€äº›å˜æ¢ï¼Œå†ä¸æ˜æ–‡è¿›è¡Œè¿ç®—ï¼Œè¯¥è¿‡ç¨‹å¯èƒ½è¿›è¡Œå¤šæ¬¡å› æ­¤åŠ è§£å¯†ç®—æ³•ä¸ä¸€å®šç›¸åŒï¼Œç”±äºå®ƒåªèƒ½åŠ å¯†å›ºå®šé•¿åº¦çš„æ•°æ®ï¼Œè€Œä¸€èˆ¬è¦åŠ å¯†çš„æ•°æ®é•¿åº¦éƒ½ä¸æ»¡è¶³è¦æ±‚ï¼Œæ­¤æ—¶å°±éœ€è¦æŠŠæ•°æ®åˆ†ç»„ï¼Œè‹¥åˆ†ç»„åæœ€åä¸€ç»„çš„é•¿åº¦ä¸æ»¡è¶³è¦æ±‚åˆéœ€è¦å¯¹å…¶å¡«å……ï¼Œå‰è€…å°±æ˜¯åˆ†ç»„å¯†ç çš„å·¥ä½œæ¨¡å¼ã€‚æ˜¯å¦éœ€è¦å¡«å……ä¹Ÿå’Œå·¥ä½œæ¨¡å¼ç›¸å…³ï¼Œå¦‚OFBæ¨¡å¼å°±å¯ä»¥å°†è¿‡ç¨‹è½¬æ¢ä¸ºç±»ä¼¼æµå¯†ç çš„æ–¹å¼ï¼Œè€ŒXTSä½¿ç”¨å¯†æ–‡çªƒå–ä¹Ÿä¸éœ€è¦å¡«å……ï¼Œå¦å¤–å³ä½¿é•¿åº¦åˆšå¥½ç¬¦åˆä¹Ÿå¯èƒ½éœ€è¦å¡«å……ï¼Œå¦‚PKCS7æ­¤æ—¶å°±éœ€è¦å†å¡«å……ä¸€ä¸ªå®Œæ•´çš„åˆ†ç»„ï¼Œä¹‹å‰æåˆ°è‹¥PKCS7ä¸CBCæ¨¡å¼ç»„åˆæ—¶ï¼Œå°±æœ‰å¯èƒ½å‡ºç°<a href="http://blog-archive.betamao.me/2019/11/15/shiro-po721%E5%88%A9%E7%94%A8%E7%AE%80%E6%9E%90/#padding-oracle">PaddingOracle</a>æ¼æ´ï¼Œå³è‹¥æœåŠ¡ç«¯ä¼šè¿”å›è§£å¯†çŠ¶æ€åˆ™å¯ä»¥é€šè¿‡æ¨æµ‹åŠ å¯†ä»»ä½•æ•°æ®ã€‚</li><li><strong>éå¯¹ç§°åŠ å¯†ç®—æ³•</strong>åŠ è§£å¯†ä¸å†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œè€Œä¸”å®ƒçš„ç»“æ„å’Œå¯¹ç§°å¯†ç æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå¯¹ç§°å¯†ç æ›´åƒæ˜¯é€»è¾‘ä½è¿ç®—è€Œéå¯¹ç§°æ˜¯æ•°å­¦è¿ç®—ï¼Œå®ƒåˆ©ç”¨çš„å…¨æ˜¯æ•°å­¦ä¸Šçš„éš¾é¢˜ï¼Œå°±æ˜¯(ç»™ä¸€ä¸ªé™åˆ¶)ååªæœ‰æ­£å‘è®¡ç®—çš„ç®—æ³•ï¼Œè€Œè¿˜æ²¡æœ‰é€†å‘è®¡ç®—çš„ç®—æ³•(å¤§æ•´æ•°åˆ†è§£ï¼Œæ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°ï¼Œæ ¼æœ€çŸ­å‘é‡ç­‰)ï¼Œå…ˆéšæœºç”Ÿæˆç¬¦åˆè¦æ±‚çš„ç§é’¥ï¼Œç§é’¥åˆ°å…¬é’¥çš„ç”Ÿæˆè¿‡ç¨‹æ˜¯æ­£å‘çš„æœ‰ç®—æ³•å› æ­¤å¾ˆå®¹æ˜“ï¼Œè€Œåè¿‡æ¥å°±æ²¡æœ‰ç®—æ³•å¯æ¢å¤ï¼Œé€šè¿‡å…¬å¼€å…¬é’¥å°±å¯å®ç°åŠ å¯†ä¸ç­¾ååŠŸèƒ½ï¼Œç”±äºè¿™ç§åŠ å¯†ä¹Ÿæ˜¯åœ¨æœ‰é™çš„èŒƒå›´ä¸Šå®Œæˆçš„å› æ­¤å•æ¬¡è¿ç®—çš„æ•°å­—å¤§å°æœ‰é™åˆ¶ï¼Œä¸ºæ­¤ä¹Ÿéœ€è¦å¯¹å…¶åˆ†ç»„å¡«å……ï¼ŒRSAå°±æœ‰PKCS1 V1.5ä¸PKCS OAEPã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Python" scheme="https://nerkeler.github.io/categories/Python/"/>
    
    
    <category term="python" scheme="https://nerkeler.github.io/tags/python/"/>
    
    <category term="åŠ å¯†ç®—æ³•" scheme="https://nerkeler.github.io/tags/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>EasyExcelå­¦ä¹ </title>
    <link href="https://nerkeler.github.io/2023/02/27/EasyExcel%E5%AD%A6%E4%B9%A0/"/>
    <id>https://nerkeler.github.io/2023/02/27/EasyExcel%E5%AD%A6%E4%B9%A0/</id>
    <published>2023-02-27T01:13:00.000Z</published>
    <updated>2023-03-30T08:10:55.116Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="Easyexcel"><a href="#Easyexcel" class="headerlink" title="Easyexcel"></a>Easyexcel</h2><p>EasyExcelæ˜¯ä¸€ä¸ªåŸºäºJavaçš„ç®€å•ã€çœå†…å­˜çš„è¯»å†™Excelçš„å¼€æºé¡¹ç›®ã€‚åœ¨å°½å¯èƒ½èŠ‚çº¦å†…å­˜çš„æƒ…å†µä¸‹æ”¯æŒè¯»å†™ç™¾Mçš„Excel</p><p>é¡¹ç›®githubåœ°å€ï¼š<a href="https://github.com/alibaba/easyexcel">https://github.com/alibaba/easyexcel</a> </p><p>å®˜ç½‘åœ°å€ï¼š<a href="https://easyexcel.opensource.alibaba.com/docs/current/">https://easyexcel.opensource.alibaba.com/docs/current/</a></p><p>å…ˆåæ§½ä¸€ä¸‹ï¼Œå®˜æ–¹æ–‡æ¡£å†™çš„å¤ªçƒ‚äº†ï¼Œç¼ºå°‘ä¾èµ–ã€é€»è¾‘ä¸æ¸…æ™°ã€å¤åˆ¶åˆ°ideaå¾ˆå¤šè·‘èµ·æ¥æŠ¥é”™</p><h4 id="å†™Excel"><a href="#å†™Excel" class="headerlink" title="å†™Excel"></a>å†™Excel</h4><ul><li>å‡†å¤‡å·¥ä½œ</li></ul><p>åˆ›å»ºé¡¹ç›®ï¼Œåœ¨pomæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- easyexcel ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œç”¨äºå†™å…¥excel</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿç¼–å·&quot;&#125;,order = 10)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿå§“å&quot;&#125;,order = 2)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿè–ªæ°´&quot;&#125;,order = 1)</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿç”Ÿæ—¥&quot;&#125;,order = 11)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç®€å•çš„å†™å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”Ÿæˆæ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Student&gt; lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setId(i + <span class="number">1</span>);</span><br><span class="line">        student.setName(<span class="string">&quot;æå››&quot;</span> + i);</span><br><span class="line">        student.setBirthday(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        student.setSalary(<span class="number">1500.00D</span>);</span><br><span class="line">        lists.add(student);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lists;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ€ç®€å•çš„å†™å…¥</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    EasyExcel.write(<span class="string">&quot;å­¦ç”Ÿä¿¡æ¯è¡¨.xlsx&quot;</span>, Student.class).sheet().doWrite(getData());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>PS:ä¸€ä¸‹æ–¹æ³•éƒ½æ˜¯æœ‰å…³æœ€ç®€å•å†™å…¥çš„å…·ä½“æ–¹æ³•è§£é‡Šï¼Œä¸æ„Ÿå…´è¶£çš„å¯ä»¥è·³è¿‡</em></p><h5 id="writeæ–¹æ³•"><a href="#writeæ–¹æ³•" class="headerlink" title="writeæ–¹æ³•"></a>writeæ–¹æ³•</h5><p>ä»£ç è§£é‡Šï¼š</p><p><code>EasyExcel.write</code>æºç å¦‚ä¸‹ï¼šä¸¤ä¸ªé‡è½½çš„æ–¹æ³•ï¼Œæ¥æ”¶æ–‡ä»¶åï¼ˆå«è·¯å¾„ï¼‰æˆ–æ–‡ä»¶åå’ŒExcelå¤´æ–‡ä»¶</p><p>ï¼Œnew äº†ä¸€ä¸ªExcelWriterBuilderå¯¹è±¡ï¼Œå°†pathNameæˆ–headå†™å…¥excelWriterBuilderå¹¶è¿”å›</p><ul><li>pathName:æ–‡ä»¶å</li><li>head:å†™å…¥è¡¨æ ¼çš„classå¯¹è±¡ï¼Œå¦‚ä¸Šæ–¹Student.classå¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EasyExcelFactory</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸€ä¸ªExcelå†™å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ExcelWriterBuilder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸€ä¸ªExcelå†™å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file ç”¨æ¥å†™å‡ºæ–‡ä»¶å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *            </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Excel writer builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">(File file)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> write(file, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»º Excelå†™å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     *           ç”¨æ¥å†™å‡ºçš„æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">     *          å†™å‡ºçš„æ•°æ®ç±»å‹çš„classå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Excel writer builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">(File file, Class head)</span> &#123;</span><br><span class="line">        <span class="type">ExcelWriterBuilder</span> <span class="variable">excelWriterBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExcelWriterBuilder</span>();</span><br><span class="line">        excelWriterBuilder.file(file);</span><br><span class="line">        <span class="keyword">if</span> (head != <span class="literal">null</span>) &#123;</span><br><span class="line">            excelWriterBuilder.head(head);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> excelWriterBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºExcel å†™å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pathName</span></span><br><span class="line"><span class="comment">     *           å†™å‡ºçš„æ–‡ä»¶è·¯å¾„å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Excel writer builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">(String pathName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> write(pathName, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºexcel å†™å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pathName</span></span><br><span class="line"><span class="comment">     *            å†™å‡ºçš„æ–‡ä»¶è·¯å¾„å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">     *            å†™å‡ºæ•°æ®çš„æ•°æ®ç±»å‹çš„classå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Excel writer builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">(String pathName, Class head)</span> &#123;</span><br><span class="line">        <span class="type">ExcelWriterBuilder</span> <span class="variable">excelWriterBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExcelWriterBuilder</span>();</span><br><span class="line">        excelWriterBuilder.file(pathName);</span><br><span class="line">        <span class="keyword">if</span> (head != <span class="literal">null</span>) &#123;</span><br><span class="line">            excelWriterBuilder.head(head);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> excelWriterBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºexcelå†™å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream</span></span><br><span class="line"><span class="comment">     *            å†™å‡ºçš„è¾“å‡ºæµå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Excel writer builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">(OutputStream outputStream)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> write(outputStream, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºexcelå†™å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream</span></span><br><span class="line"><span class="comment">     *           å†™å‡ºçš„è¾“å‡ºæµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">     *           å†™å‡ºæ•°æ®çš„æ•°æ®ç±»å‹çš„classå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Excel writer builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExcelWriterBuilder <span class="title function_">write</span><span class="params">(OutputStream outputStream, Class head)</span> &#123;</span><br><span class="line">        <span class="type">ExcelWriterBuilder</span> <span class="variable">excelWriterBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExcelWriterBuilder</span>();</span><br><span class="line">        excelWriterBuilder.file(outputStream);</span><br><span class="line">        <span class="keyword">if</span> (head != <span class="literal">null</span>) &#123;</span><br><span class="line">            excelWriterBuilder.head(head);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> excelWriterBuilder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="sheet-æ–¹æ³•"><a href="#sheet-æ–¹æ³•" class="headerlink" title="sheet()æ–¹æ³•"></a>sheet()æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    EasyExcel</span><br><span class="line">        .write(<span class="string">&quot;å­¦ç”Ÿä¿¡æ¯è¡¨.xlsx&quot;</span>, Student.class)</span><br><span class="line">        .sheet()</span><br><span class="line">        .doWrite(getData());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sheet()æ–¹æ³•ä»£è¡¨è¦åœ¨excelé‚£ä¸ªsheeté¡µå†™å…¥æ•°æ®ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œï¼Œé»˜è®¤å†™åœ¨ç¬¬ä¸€ä¸ªsheeté¡µï¼Œé»˜è®¤sheetåï¼š0</p><p>æºç è§£é‡Šï¼šæ‰€æœ‰é‡è½½çš„æ–¹æ³•å¯å½’ä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œæ¥æ”¶sheetNo(ç¬¬å‡ ä¸ªsheetï¼ˆIntegerï¼‰)ï¼ŒsheetName(sheeté¡µåç§°(String))ï¼Œè¿”å›ExcelWriterSheetBuilder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">      é€‰ä¸­ç¬¬ä¸€ä¸ªsheeté¡µ</span></span><br><span class="line"><span class="comment">      å†™æ“ä½œ sheet é¡µçš„å€¼ä¸º 0</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> ExcelWriterSheetBuilder <span class="title function_">sheet</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> sheet(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">      é€‰ä¸­ ç¬¬ä¸€ä¸ªçš„ sheeté¡µ</span></span><br><span class="line"><span class="comment">      sheet é¡µçš„åå­— ä¸º sheetNo</span></span><br><span class="line"><span class="comment">  */</span>  </span><br><span class="line">  <span class="keyword">public</span> ExcelWriterSheetBuilder <span class="title function_">sheet</span><span class="params">(Integer sheetNo)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> sheet(sheetNo, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">      é€‰ä¸­ç¬¬ä¸€ä¸ªçš„ sheeté¡µ</span></span><br><span class="line"><span class="comment">      sheet é¡µçš„åå­— ä¸º sheetName</span></span><br><span class="line"><span class="comment">  */</span>  </span><br><span class="line">  <span class="keyword">public</span> ExcelWriterSheetBuilder <span class="title function_">sheet</span><span class="params">(String sheetName)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> sheet(<span class="literal">null</span>, sheetName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">      é€‰ä¸­ç¬¬ä¸€ä¸ª sheeté¡µ</span></span><br><span class="line"><span class="comment">      sheet é¡µçš„åå­— ä¸º sheetNo æˆ–è€… sheetName</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">public</span> ExcelWriterSheetBuilder <span class="title function_">sheet</span><span class="params">(Integer sheetNo, String sheetName)</span> &#123;</span><br><span class="line">      <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> build();</span><br><span class="line">      <span class="type">ExcelWriterSheetBuilder</span> <span class="variable">excelWriterSheetBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExcelWriterSheetBuilder</span>(excelWriter);</span><br><span class="line">      <span class="keyword">if</span> (sheetNo != <span class="literal">null</span>) &#123;</span><br><span class="line">          excelWriterSheetBuilder.sheetNo(sheetNo);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (sheetName != <span class="literal">null</span>) &#123;</span><br><span class="line">          excelWriterSheetBuilder.sheetName(sheetName);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> excelWriterSheetBuilder;</span><br><span class="line">  </span><br></pre></td></tr></table></figure><h5 id="doWriteæ–¹æ³•"><a href="#doWriteæ–¹æ³•" class="headerlink" title="doWriteæ–¹æ³•"></a>doWriteæ–¹æ³•</h5><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doWrite</span><span class="params">(List data)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.excelWriter == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExcelGenerateException</span>(<span class="string">&quot;Must use &#x27;EasyExcelFactory.write().sheet()&#x27; to call this method&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.excelWriter.write(data, <span class="built_in">this</span>.build());</span><br><span class="line">            <span class="built_in">this</span>.excelWriter.finish();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šå¯è§ï¼ŒdoWriteæ–¹æ³•åªæ˜¯ç®€å•åˆ¤æ–­äº†ä¸€ä¸‹å½“å‰ExcelWriterSheetBuilderç±»æ˜¯å¦ä¸ºç©ºï¼Œç„¶åè°ƒç”¨äº†writeæ–¹æ³•ï¼Œå†å…³é—­excelWriter</p><p>æˆ‘ä»¬åœ¨æ·±å…¥çœ‹ä¸€ä¸‹writeæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ExcelWriter <span class="title function_">write</span><span class="params">(List data, WriteSheet writeSheet)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.write(data, (WriteSheet)writeSheet, (WriteTable)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ExcelWriter <span class="title function_">write</span><span class="params">(List data, WriteSheet writeSheet, WriteTable writeTable)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.excelBuilder.addContent(data, writeSheet, writeTable);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬è´¨ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•å±äºä¸€ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œè¿”å›ExcelWriterå¯¹è±¡</p><ul><li>List data: è¦å†™å…¥çš„æ•°æ®</li><li>WriteSheet writeSheet: doWriteæ–¹æ³•è¿”å›ExcelWriterSheetBuilderä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå­˜æ”¾äº†sheetä¿¡æ¯</li><li>writeTable:  å­˜æ”¾tableä¿¡æ¯ï¼Œæš‚ä¸è®¨è®º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> ExcelWriter <span class="title function_">write</span><span class="params">(List data, Sheet sheet)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.write(data, (Sheet)sheet, (Table)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@deprecated</span> */</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> ExcelWriter <span class="title function_">write</span><span class="params">(List data, Sheet sheet, Table table)</span> &#123;</span><br><span class="line">    <span class="type">WriteSheet</span> <span class="variable">writeSheet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (sheet != <span class="literal">null</span>) &#123;</span><br><span class="line">        writeSheet = <span class="keyword">new</span> <span class="title class_">WriteSheet</span>();</span><br><span class="line">        writeSheet.setSheetNo(sheet.getSheetNo() - <span class="number">1</span>);</span><br><span class="line">        writeSheet.setSheetName(sheet.getSheetName());</span><br><span class="line">        writeSheet.setClazz(sheet.getClazz());</span><br><span class="line">        writeSheet.setHead(sheet.getHead());</span><br><span class="line">        writeSheet.setTableStyle(sheet.getTableStyle());</span><br><span class="line">        writeSheet.setRelativeHeadRowIndex(sheet.getStartRow());</span><br><span class="line">        writeSheet.setColumnWidthMap(sheet.getColumnWidthMap());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.write(data, writeSheet, writeTable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·²è¿‡æ—¶æ–¹æ³•ï¼Œæœ¬è´¨å¦‚ä¸Š,æ ¹æ®returnè¯­å¥çœ‹ï¼Œè¿˜æ˜¯è°ƒç”¨ä»¥ä¸Šæ–¹æ³•ï¼Œ</p><h5 id="æ¥ç€çœ‹ä¸€ä¸‹addContent"><a href="#æ¥ç€çœ‹ä¸€ä¸‹addContent" class="headerlink" title="æ¥ç€çœ‹ä¸€ä¸‹addContent"></a>æ¥ç€çœ‹ä¸€ä¸‹addContent</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addContent</span><span class="params">(List data, WriteSheet writeSheet)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.addContent(data, writeSheet, (WriteTable)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addContent</span><span class="params">(List data, WriteSheet writeSheet, WriteTable writeTable)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.context.currentSheet(writeSheet, WriteTypeEnum.ADD);</span><br><span class="line">        <span class="built_in">this</span>.context.currentTable(writeTable);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.excelWriteAddExecutor == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.excelWriteAddExecutor = <span class="keyword">new</span> <span class="title class_">ExcelWriteAddExecutor</span>(<span class="built_in">this</span>.context);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.excelWriteAddExecutor.add(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException var5) &#123;</span><br><span class="line">        <span class="built_in">this</span>.finishOnException();</span><br><span class="line">        <span class="keyword">throw</span> var5;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var6) &#123;</span><br><span class="line">        <span class="built_in">this</span>.finishOnException();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExcelGenerateException</span>(var6);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>addContentæ¥æ”¶äº†ExcelåŸå§‹æ•°æ®ï¼Œé€šè¿‡excelWriteAddExecutor.addå†™å…¥ï¼Œå…·ä½“å†™å…¥è¿‡ç¨‹å¯çœ‹æ­¤æ–¹æ³•</p><h4 id="è¡¨å¤´æ“ä½œ"><a href="#è¡¨å¤´æ“ä½œ" class="headerlink" title="è¡¨å¤´æ“ä½œ"></a>è¡¨å¤´æ“ä½œ</h4><h5 id="å±æ€§æ³¨è§£"><a href="#å±æ€§æ³¨è§£" class="headerlink" title="å±æ€§æ³¨è§£"></a>å±æ€§æ³¨è§£</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿç¼–å·&quot;&#125;,order = 10)</span></span><br><span class="line">    <span class="meta">@NumberFormat(&quot;#,###&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿå§“å&quot;&#125;,order = 2)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿè–ªæ°´&quot;&#125;,order = 1)</span></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;å­¦ç”Ÿç”Ÿæ—¥&quot;&#125;,order = 11)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(&quot;yyyy-mm-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€è§ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªå±æ€§ä¸ŠåŠ å…¥äº†@ExcelPropertyæ³¨è§£ï¼Œè¡¨ç¤ºå½“å‰å±æ€§æ˜¯ä¸€ä¸ªexcelå­—æ®µï¼Œeasyexcelé‡‡ç”¨äº†æ³¨è§£çš„æ–¹å¼å®šä¹‰excel è¡¨å¤´å­—æ®µï¼Œç»™æˆ‘ä»¬å¼€å‘å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ã€‚</p><ul><li><code>ExcelProperty</code> index æŒ‡å®šå†™åˆ°ç¬¬å‡ åˆ—ï¼Œé»˜è®¤æ ¹æ®æˆå‘˜å˜é‡æ’åºã€‚<code>value</code>æŒ‡å®šå†™å…¥çš„åç§°ï¼Œé»˜è®¤æˆå‘˜å˜é‡çš„åå­—ï¼Œå¤šä¸ª<code>value</code>å¯ä»¥å‚ç…§å¿«é€Ÿå¼€å§‹ä¸­çš„å¤æ‚å¤´</li><li><code>ExcelIgnore</code> é»˜è®¤æ‰€æœ‰å­—æ®µéƒ½ä¼šå†™å…¥excelï¼Œè¿™ä¸ªæ³¨è§£ä¼šå¿½ç•¥è¿™ä¸ªå­—æ®µ</li><li><code>DateTimeFormat</code> æ—¥æœŸè½¬æ¢ï¼Œå°†<code>Date</code>å†™åˆ°excelä¼šè°ƒç”¨è¿™ä¸ªæ³¨è§£ã€‚é‡Œé¢çš„<code>value</code>å‚ç…§<code>java.text.SimpleDateFormat</code></li><li><code>NumberFormat</code> æ•°å­—è½¬æ¢ï¼Œç”¨<code>Number</code>å†™excelä¼šè°ƒç”¨è¿™ä¸ªæ³¨è§£ã€‚é‡Œé¢çš„<code>value</code>å‚ç…§<code>java.text.DecimalFormat</code></li><li><code>ExcelIgnoreUnannotated</code> é»˜è®¤ä¸åŠ <code>ExcelProperty</code> çš„æ³¨è§£çš„éƒ½ä¼šå‚ä¸è¯»å†™ï¼ŒåŠ äº†ä¸ä¼šå‚ä¸</li></ul><p>è¿˜æœ‰å…¶ä»–æ³¨è§£ï¼Œåœ°å€éƒ½åœ¨ï¼šcom.alibaba.excel.annotation</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Java" scheme="https://nerkeler.github.io/categories/Java/"/>
    
    
    <category term="excel" scheme="https://nerkeler.github.io/tags/excel/"/>
    
  </entry>
  
</feed>
